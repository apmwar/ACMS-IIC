label	description
Amazon SNS	"SNS message Content-type?
Hi all.

I've tried to solve my problem by reading the AWS docs, googling, and trawling the forums without luck for some time now, so here goes. I'm puzzled about the content-type of the messages SNS is sending. Take for example a SubscriptionConfirmation message - here are the headers:

POST /sns-notification-endpoint/ HTTP/1.1
Content-Length: 1351
Content-Type: text/plain; charset=ISO-8859-1
Host: j-gw.com
Connection: Keep-Alive
User-Agent: Amazon Simple Notification Service Agent

(This data is captured with tcpdump.) I was wondering, isn't the message supposed to be of content-type ""application/json"" because that's what the payoad, i.e. request body, is?

Now, this wouldn't otherwise be much of a problem but I'm using Tastypie and it needs to have a correct content-type fed to it."
Amazon SNS	"Re: SNS message Content-type?
Am having the same problem myself. I'm using asp.net mvc3 which has binding to json but it expects application/json content-type."
Amazon SNS	"Re: SNS message Content-type?
Hello, 

My apologies that we did not respond sooner.  When receiving SNS  messages via the HTTP protocol the mime type will be text/plain however the structure of the messages is in the JSON format."
Amazon SNS	"Re: SNS message Content-type?
No problem. But is this an intentional feature, or something that could perhaps change in a future API version? Having to force Content-type to application/json is ""sub-elegant"" in my opinion."
Amazon SNS	"Re: SNS message Content-type?
Very simply, it was an oversight on our part.  It should have been 'application/json' all along but we missed it.  Now we have to find a way to change it to what it should be without breaking anyone's integration with SNS."
Amazon SNS	"Re: SNS message Content-type?
This is biting me too... For instance, Loggly requires the application/json header to be in place to leverage their JSON parsing/search capabilities.

Any idea on when SNS might have this sorted out?  Would love to subscribe a bunch of JSON services to SNS."
Amazon SNS	"Re: SNS message Content-type?
Sorry to resurrect this question from the dead.  However it was implied that a solution was possibly in the works... but I'm having this very issue.  I'm using NodeJs with the express node module, and the subsequent bodyparser function provided by the connect module it sits on.  

the bodyparser function doesn't accurately grab the post data from a subscriptionconfirmation request because there's no content-type in the request header.  Would it be possible to modify the SNS system to allow people sending subscribe requests to specify the value of the content-type header used to reach the target endpoint?  This parameter would of course be optional with a default value of null to preserve compatibility with people who've got existing integrations that function to their satisfaction.

In the meantime, for other people who find this question based on issues with bodyparser having issues with SNS.  I've got a modification in place in bodyParser.js in which I force the plugin to use application/json as the content-type under a certain condition

function mime(req) {
  if(req.headers == 'SubscriptionConfirmation' && !req.headers.hasOwnProperty)
  {
      req.headers = 'application/json';
  }
  var str = req.headers || '';
  return str.split(';')[0];
}

Edited by: dmurker on May 25, 2012 12:30 AM"
Amazon SNS	"Re: SNS message Content-type?
Thanks for providing a workaround for Node.js

The hangup with changing the content type is there is no way of testing if the change will cause issues with all of the http listeners/hosts that are out there. 

There are ideas on ways to fix this, and we are looking into them.

Joel"
Amazon SNS	"Re: SNS message Content-type?
Please just fix this. text/plain is simply wrong. Many new user to SNS (like me) will have issues with this. The most users will not even notice, as they have there subscriptions confirmed."
Amazon SNS	"Re: SNS message Content-type?
I am using django and created an http endpoint like this (from some example).


def email_sns(request):
	msg = json.loads(request.raw_post_data)
	if msg == 'SubscriptionConfirmation':
        if process_subscription(msg):
            return HttpResponse('SubscriptionConfirmation OK')
        else:
            return HttpResponse('SubscriptionConfirmation Failed')
    elif msg == 'Notification':

def process_subscription(msg):
    try:
        urllib2.urlopen(msg).read()
        return True
    except IOError:
        traceback.print_exc()
        return False

When I create a new subscription in an sns topic using this endpoint, after sometime I get a ""Response contains invalid JSON"" error and the subscription remains in PendingConfirmation state. 

How can I explicitly confirm it. What is wrong with this?

Any link to python docs/api/implementation will also be very useful.

Edited by: kmrdeepak on Jan 22, 2013 11:51 PM"
Amazon SNS	"Re: SNS message Content-type?
I just spent a couple of hours trying to figure out why Node.js + Express were not giving me a JSON body. Express (with bodyParser middleware) will not parse the body unless it has a proper content type.

Please fix this, Amazon!

Mateusz"
Amazon SNS	"Re: SNS message Content-type?
+1 

please fix this"
Amazon SNS	"Re: SNS message Content-type?
+1 Please Fix this, Guys."
Amazon SNS	"Re: SNS message Content-type?
Could the solution just be a simple content-type configuration that defaults existing subscriptions to plain text, but defaults future subscriptions to application/json? The user could manually switch between them if needed and there would be no alterations to the existing subscriptions unless manually switched."
Amazon SNS	"Re: SNS message Content-type?
I first came across this a few years ago when this thread was new. I see it still hasn't been addressed.

Personally, given the amount of fantastic engineers you have at your disposal I have a hard time seeing how we've gone 3 years without any visible attempt to address this.

Couldn't it be as simple as offering another SNS payload type, e.g. JSON-without-blunder? It seems a solution like that could have been easily implemented while maintaining existing subscription compatibility while allowing for a migration path and a proper version we can build new software from?

Let's get this fixed... it's not necessary and there are many options.

Edited by: Steve on Sep 27, 2014 7:25 PM"
Amazon SNS	"Re: SNS message Content-type?
To workaround this issue we are using following ""middleware"" in node.js:

app.use(function (req, res, next) {
  if (req.get('x-amz-sns-message-type')) {
    req.headers = 'application/json';
  }
  next();
});

Edited by: gruveo on Jul 26, 2016 8:27 AM"
Amazon SNS	"Re: SNS message Content-type?
When using jersey with jackson, the wrong content type eliminates the automatic deserialization, and I didn't find a way to correct the incoming content type before jersey kicks in.

I created a filter now that reads the raw content and stores it in the context. In my Endpoint I use the raw data for extracting the payload data.

Filter:
try (BufferedReader buffer = new BufferedReader(new InputStreamReader(containerRequestContext.getEntityStream()))) {
    containerRequestContext.setProperty(""rawInput"", buffer.lines().collect(Collectors.joining(""\n"")));
}


Endpoint:
Map body = new ObjectMapper().readValue(context.getProperty(""rawInput"").toString(), Map.class);


PS: but I would prefer to have a correct content-type, though ...

Edited by: DirkPodolak on Sep 9, 2016 12:14 AM"
Amazon SNS	"Re: SNS message Content-type?
Very annoying ""feature"" which breaks Jersey/Spring MVC and maybe more framework's automatic deserialisation capability."
Amazon SNS	"Re: SNS message Content-type?
I agree that the current behavior is not entirely correct.
I'm pretty sure the text/plain bug wasted many hours and created a lot of frustration, so please do address the issue.

The simplest backwards-compatible fix would be to add 2 new protocols to SNS notifications:
http-application-json
https-application-json

What do you guys think?"
Amazon SNS	"Re: SNS message Content-type?
This worked for me instead
    if (req.header) {
        req.header(""Content-Type"") = ""application/json"";
    }"
Amazon SNS	"Re: SNS message Content-type?
This is a decent solution. However, it should be: req.headers['content-type'] = 'application/json'"
Amazon SNS	"Re: SNS message Content-type?
This is a good solution.

NOBODY CARES???

This problem can not be ignored for so long! It is not possible that Amazon does not care about the inconvenience that this ""little mistake"" causes to the developers."
Amazon SNS	"Re: SNS message Content-type?
I also ran into this today... 

Why is this not at least noted in the documentation? 

I understand that it may cause potential issues if changed. But maybe instead the documentation should adhere to your system actually does rather than what you wanted to achieve.

From a development perspective, we want to know how it works... not how you intended to build it."
Amazon SNS	"Re: SNS message Content-type?
I also ran into this today... 

Why is this not at least noted in the documentation? 

I understand that it may cause potential issues if changed. But maybe instead the documentation should adhere to your system actually does rather than what you wanted to achieve.

From a development perspective, we want to know how it works... not how you intended to build it."
Amazon SNS	"Re: SNS message Content-type?
Could this solution not simply be to allow headers in SNS subscriptions to be set? At a minimum, with the ability to override the content-type header, but beyond that, why not allow the subscription configuration to specify a set of HTTP headers that are added to the POST (and overriding some or all of the existing headers)?

I also like the previously suggested idea of making application/json the default content type for all new subscriptions, thereby guaranteeing that nothing that's already in place is broken."
Amazon SNS	"How to apply filter policy to many subscription?
Hi all,

I am reading this page:
https://docs.aws.amazon.com/sns/latest/dg/message-filtering-apply.html

From that page I know I can apply a filter policy to a subscription.
If I want to apply a filter policy to hundreds subscriptions. Is there a simple way to do it?
Can I give a list of subscript ARN to AWS SNS API, to apply a filter policy?

Thank you."
Amazon SNS	"Android SNS FCM Push notifications.
Hi guys,

I recently started developing a project and something is unclear for me.
I want to integrate SNS, Lambda, an Android app and FCM. I want to trigger a Lambda function, which calls an API and sends the results to the Android app. The thing is, the whole token thing is unclear for me. 
I got as far as getting the token, registering an application endpoint, a topic and I've been able to get notifications, but the thing is that I do not want to register every device by hand. Is there an automated way in which every time the Android app starts (or a new user is logged in) it automatically subscribes itself and can get notifications normally, without me registering the Instance ID token?

I am new to this and I'm excited to learn more, but I haven't been able to get enough information on the topic.
Thanks to anyone who can help!

Yours truly,
Hristo"
Amazon SNS	"SNS Limited to Manual Push Only?
Hi SNS Team,

I want to send a mobile push notification to all users in a group chat when a new message is made available. What approach do I need to take?

For SNS I would need a topic for every single group chat? I must be missing something here. I've read through a ton of documentation and I am not seeing anything that allows users in a group to received the other group users messages via mobile push notification.

I am using dynamodb to store the relationships and I was looking into DynamoDB streams to see if I could create a new topic every time a group is created. Please let me know if I am missing something on the approach. 

Thanks!!!

Mike"
Amazon SNS	"SNS HTTP/S notifications are slow sometimes...
We're seeing delays receiving notification from SNS to our HTTP/S receiver. Sometimes it's a few seconds and other times it's upwards of 6+ hrs or longer. We're using SES to send emails and we have SES send the events (delivered, open, etc.) to SNS. When it's delayed / slow, we do receive the email from SES within minutes, but it's the SNS notification to the HTTP/S receiver that's taking hours at times. Is there a threshold limit that needs increasing or something else we need to do to speed this up?"
Amazon SNS	"Text messaging: opted out numbers
Hello!
My number is opted out and I can't send text messages to myself but there's no my phone number in AWS Console under ""opted out numbers"". CloudWatch logs also says that my phone number is opted out.
How can I opt in my phone number if I cannot see it AWS console?
Thank you.

Edited by: yuliya on Mar 27, 2019 9:11 AM"
Amazon SNS	"SNS filters failing when string contains double quote (is this a BUG?)
I have a SNS Subscription with a Filter pointing to a lambda (I tried also with a SQS subscription with same results).

The problem is that when I try to include a double quote in one of the message attributes the Filter stop behaving as it should. The double quote is in an attribute that is not part of the filter,  but still causes the problem. Note: if you wonder why I pass a double quote, I really try to pass stringify JSON, but I isolate the issue to have a double quote ion the message.

This is the MessageAttributes that I pass that causes my filter to filter out my message:

{ 
    eventType: { 
              StringValue: 'nice_event',
              DataType: 'String' 
    },
    ctx: { 
             StringValue: 'anything',  //<---- GOOD 
             DataType: 'String' 
    } 
}


The following will not work
{ 
    eventType: { 
              StringValue: 'nice_event',
              DataType: 'String' 
    },
    ctx: { 
             StringValue: '""',  //<---- BAD
             DataType: 'String' 
    } 
}


The filter is:
    {
  ""eventType"": [
    ""nice_event"",
    ""another_nice_event""
  ]
}


I also tried:
{
  ""ctx"": [
    {
      ""anything-but"": [
        ""*skip*""
      ]
    }
  ],
  ""eventType"": [
    ""nice_event"",
    ""another_nice_event""
  ]
}


In case someone ones to verify, I have a couple of lambda, one that generate and publish the messages and another that consumes the message from the subscription.

The lambda used to generate messages:
const AWS = require('aws-sdk');
Â 
exports.handler = async (event) => {
    const sns = new AWS.SNS();
    
    const _ctx =  'whatever'; // change to '""' to cause the message to be ignored.
Â 
    const attri = {
        eventType: {
            StringValue: 'nice_event',
            DataType: 'String',
        },
        ctx: {
            StringValue: _ctx,
            DataType: 'String',
        }
    };
Â 
    const publishPromise = sns.publish({
        Message: JSON.stringify({ msg: `from dummy lambda: ${Date.now()}`, date: Date.now(), attri }),
        TopicArn: 'arn:aws:sns:...........',
        MessageAttributes: attri,
    }).promise();
Â 
    await publishPromise.then(
        (data) => {
            console.log({ data });
            console.log(`MessageID is ${data.MessageId}`);
        },
    ).catch(
        (err) => {
            console.error(err, err.stack);
        },
    );
Â 
    return true;
};


And the lambda used to verify the subscription messages:

exports.handler = async (event) => {
        console.log({ event });
        console.log({ records: event.Records });
        for (let i=0;i<event.Records.length;i++) {
            console.log({record: event.Records[i]})
            console.log({sns: event.Records[i].Sns})
            console.log({attr: event.Records[i].Sns.MessageAttributes})
        }
    const response = {
        statusCode: 200,
        body: JSON.stringify('Hello from Lambda!'),
    };
    return response;
};


Edited by: RGuiu on Mar 27, 2019 4:24 AM

Edited by: RGuiu on Mar 27, 2019 4:25 AM"
Amazon SNS	"Limiting the SNS emails per day
Is there a way to limit the number of SNS triggered emails sent per day?   Ideally, I would like to only send one email per day when conditions are met.   Right now, my SNS rule is causing the email inbox to be flooded.

Thanks,

Steve"
Amazon SNS	"How to extract token from SNS Subscribe and use it in confirmSubscription ?
Usecase

I want to subscribe email to SNS topic and i need to confirm it programmatically rather than manually clicking at the confirmation link.

What i had did

This is usually for confirmation i am using SNS confirmSubscription method which will take token as a parameter. I can able to achieve the token by calling the SNS subscribe method by passing protocol as email-json. For this i received the following subscription message at the endpoint.
{
  ""Type"" : ""SubscriptionConfirmation"",
  ""MessageId"" : ""xxx-9160-49a3-960f-xx"",
  ""Token"" : ""2336412f37fb687adfaf"",
  ""TopicArn"" : ""arn:aws:sns:ap-south-1:xx-xx"",
  ""Message"" : ""You have chosen to subscribe to the topic arn:aws:sns:ap-south-1:xx-xx.\nTo confirm the subscription, visit the SubscribeURL included in this message."",
  ""SubscribeURL"" : ""https://sns.ap-south-1.amazonaws.com/?Action=xx&TopicArn=arn:aws:sns:ap-south-1:477530015769:xx-xx&Token=2336412f37fb6872"",
  ""Timestamp"" : ""2019-03-21T08:34:26.597Z"",
  ""SignatureVersion"" : ""1"",
  ""Signature"" : ""bIwq8Q92Yvrn8bBrIDQJ2chc5y/5IPAZPPR4roZ6WfK7kaE0QTbJpqAmHMH0sHL4aoyTrapLwX4e6HaEd6nGny8EAWj5wA2JvFCrO9BFQu"",
  ""SigningCertURL"" : ""https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-xx.pem""
}

What i want

How can able to extract the token value from the above json. This is the below lambda i am using to programmatically confirm the sns subscriber.
const AWS = require('aws-sdk');
var sns = new AWS.SNS();
var snsconfirm= {
  Token: 'xx', /* required */ -->How can i able to retrieve the token value from the endpoint json.
  TopicArn: 'arn:aws:sns:ap-south-1:xxx:xx-xxx', /* required */
  AuthenticateOnUnsubscribe: 'true'
};
var snsparams = {
  Protocol: 'email-json', /* required */
  TopicArn: 'arn:aws:sns:ap-south-1:xx:xx-xx', /* required */
  Endpoint: 'abc@xyz.com'
};
exports.handler = async (event) => {
    // TODO implement
try {
  const snsrespone = await sns.subscribe(snsparams).promise();
  const confirmsub = await sns.confirmSubscription(snsconfirm).promise();
  } catch (err) {
    console.log(err.message);
    throw err;
  }
};

Any help is appreciated Thanks"
Amazon SNS	"I can't receive messages with SNS
Hello , i have a Lex bot and connected it with lambda code which get data from slots then send it on message to my number , the code work first 10 times and send the message but after this the code work but i don't get any messages , why!!"
Amazon SNS	"Unable to update iOS push certificate?
I have an Apple iOS push notification platform that I set up last year. It worked until the certificate expired.

I generated a new certificate and tried to upload it. I clicked the Edit button, selected the correct push certificate type, the correct .p12 file, and input the correct password, and pushed Save Changes.

I see a green box saying ""Platform application updated successfully"". However, just underneath this my certificate expiration date shows the old, expired date, and I'm not able to send push notifications.

What did I do wrong here, and how do I fix it?"
Amazon SNS	"SNS suddenly stopped sending SMS
I have a SNS topic that notifies me via email and SMS whenever there are issues on my EC2 infrastructures. For past 6 months or so, everything was working fine. 

Now, out of the blue I stopped receiving SMS on my cell phone. I only receive email messages. I did not change any configuration. The topic still shows that my cell phone is subscribed. I have no idea on how to troubleshoot this. Any pointers?

Thanks"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
I have been using SNS to send notifications directly to specific phone numbers, and it worked flawlessly a few weeks ago up until I tried again today.  None of them will send.  I hadn't tried for a few days, and it suddenly won't send a single SMS message.  I don't think it's a problem with our code or anything on our end, I think it's a problem with AWS themselves.  Please Amazon respond and let us know how to proceed.  Otherwise you'll be losing a huge number of customers to Twilio or some other service."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Good day

I have been noticing quite a number of posts and threads regarding this.

Is it possible for you to check the Account spend limit within the AWS console.
Update it to 50 USD and confirm if this has resolved the issue?

If your request amount is $51 or above please let us know so we can engage our Service team.

You can use the below link (which is region specific):
https://console.aws.amazon.com/sns/v2/home?region=us-east-1#/text-messaging/preferences

Regards
Imthian R

Edited by: Imthian@AWS on Dec 12, 2016 11:55 PM"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Hello me i have the same problem. 

4 on the 6 servers are down for sms. That mean when we go to our console you have no more the possibility to go for SMS. The 2 last are the asia one. You cant modify the spending limit just put 0, 1 or nothing.  I found lot of people on social media have the same problem. 

There are definitely a huge bug on SNS sms currently."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
We are reaching out to our service team for investigation and we will revert back to you. 

Thank you for working with us.

Regards
Imthian R"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
We are also experiencing issues with receiving SMS notifications.  For several SNS topics for which there are both email and SMS subscriptions, the emails are rec'd, but the text messages are not.

This issue occurs for us in the Oregon and Virginia regions."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Setting the spending quota fixed it for me."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
We're at ~50% delivery rate for SMS.  For the same topics, emails are delivered at 100%

We have had no code changes, no SNS-related .NET exceptions/errors are occurring on our end.  We just publish to topics as we've always done, but this SMS issue started occurring for us recently, and evidently several other users of the Simple Notification Service, as well.

An progress update on the investigation/resolution would be appreciated."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Hello, its started Friday night. And since 4 of the 6 servers are down the 2 last are limited. You can go to the 4 others server you see on the console the sms link has disappear that mean there are a huge problem.

Phil you told us you change the limit but i tried and i was unable to that! normally if you have a new account you can put until 50 dollars (and ask more to the support) But now the only number you can put is: 0 , 1 or nothing, all the other numbers you have an error."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
@AWS
Any update?

The spend limit is not the issue for us."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
I confirm this is not the issue. But this is a huge bug! it seems amazon have a big problem with the sms on SNS and COGNITO but i dont understand:

1- Why its not on the service health dashboard?
2- I wrote to the customer service last friday and nobody came to answers me yet!
3- they know since friday than SNS is down but after almost a week there are no improvement

Just some communication will help us. For my part i configured cognito and SNS and i need sms. 

SMS will running soon or this situation will be longer? 

If somebody have an account to contact the technical team, it should be great to inform them."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
My account spend limit is already at $50.

I updated the information anyways. I would not know if the issue has been fixed because the alarms trigger only under certain conditions. 

I tried sending a test message using console. That worked. But again I don't know if the SMS will be delivered when an alarm is triggered. 

It would be appreciated if you can post a feedback from your technical team."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Hello me after 2 messages is done i cant send anymore. Also i dont if you have like me the 4 first server (virginia, oregon, ireland and tokyo) when i m on the dashboard you dont have anymore the link to go for the sms. I dont if its your case as well"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Please give us some status on this.  Anything, pretty please..."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
crickets --




This is no way to treat an ""Amazon Customer""

Edited by: Amazon Customer on Dec 15, 2016 1:30 PM"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
hello @Imthian@AWS,

you know how aws amazon changed the life for every aws developper around the world.

Its normal, people like  @webtrend are stressed and push to have some news even im sure you are making the best to fix it.

Take my example. I paid a team to work on SNS for my app. It cost me money. And i need sms to launch this app. Imagine my case saturday i would put ""online"" my app. BIG LAUNCH. And the sms stopped last friday. BIG PROBLEM! So we lost now like a week.

But we totally understand you are facing an issue and ""hey"" you are amazon! You making your best! But the only problem is the lack of communication: On social media forum and even customer service dont give us any answers. So yes a little news to know if we can wait a little more or if we need to considerer some new possibilities outside amazon. This is not at all a ""threat"". This is just we wait for almost 1 week and we deserve a news to know whats happen. If sms will come back on aws amazon. If we can use sns, cognito or alert via SMS. You didnt even make an update on service health center, even everybody there know SNS are down for sms....

If you have any news, any good news i hope, send us! We love amazon and we are there to support you. Just support us as well. Thanks!"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
This is also a huge problem for us. Our spend is over $10K a month so the spend limit isn't the issue. When I put an email address in the SNS topic it works but SMS is not working.

This morning one of the four SMS recipients got the alert. Then I just tested again after adding the email address and no SMS was sent.

It's very disappointing that AWS isn't stating they know there's a problem and they are looking into it. Any news would be helpful."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Still SNS is not fixed  any update ?"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
After more testing and trying to understand what's happened ( and the fix ):

AWS changed how SMS messages are handled. They can now send SMS messages on mass to ""your mailing list"" or something similar. No Opt-In is required like it used to be, now it's an Opt-Out. There is also Promotional and Transactional messages. Transactional have a higher chance of delivery.

Prior to this change we used the SMS to alert our sys-admins that something needs to be fixed or reviewed. They were all system critical messages and it worked without a problem for a very long time. But when AWS rolled out this new SMS system (at least on our account) all SMS messages were put to Promotional and the max cost was set to $1 (current cost per message is $0.00645 in the US). Thats 155 messages in a month.

To get this back working for us I changed the default message type to transactional and set the max spend limit to $500 (should be way over kill). While the link provided by Imthian@AWS ( https://console.aws.amazon.com/sns/v2/home?region=us-east-1#/text-messaging/preferences ) was correct, it was unclear what I was looking at since I didn't know they changed something.

It's frustrating when AWS makes changes that have deep impacts on how we use the services without announcing those changes. AWS did a good job of telling us that instance IDs and other such things were changing length but on the SMS change, I think they failed."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
I've gotten evasion from AWS about the service upgrade. I tried to set my limit to $51, overkill for me as well, and I get back an email that 'this will have to be reviewed'.  And the messages are still not going out."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Good day all

I will be opening individual developer support cases with our support team for everyone on this thread that is still facing issues. 

Thank you for working with us.

Regards
Imthian R"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
It appears that the issue has finally been resolved as I am able to send messages again. Kudos to AWS for fixing the problem, but splats for the lack of transparency on the issue.

You can do better."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
I also experience problems when sending out text messages when a CloudWatch alarm is triggered or even when I try to publish a text messages in the console. I get the following error:

{ ""notification"": { ""messageId"": ""681fb4ae-7074-50bb-b822-e44870509b6c"", ""timestamp"": ""2017-01-03 19:39:16.721"" }, ""delivery"": { ""destination"": ""<censored>"", ""smsType"": ""Transactional"", ""providerResponse"": ""Internal error"", ""dwellTimeMs"": 77 }, ""status"": ""FAILURE""


I use one destination which did receive text messages a month ago and now it doesn't work anymore. Can somebody from Amazon take a look at this error?

Edited by: benik on Jan 3, 2017 11:59 AM"
Amazon SNS	"Re: SNS suddenly stopped sending SMS
SMS messaging worked again for me as soon as I updated my spending limit from $10 to $15. I was well within the free tier limit, so the spending limit was essentially meaningless. I switched back to $10 and SMS messaging continued to work.

My guess is that there was an SNS bug that discarded messages unless or until the customer spending limit profile was reloaded, and it wouldn't reload unless it changed. Changing the spending limit would trigger that reload.

SNS may have decided not to fix this on their side because it was November/December and they were locked down for the holidays, and there was an easy workaround (have the customer make a trivial change to their profile). If this guess is correct I just wish the SNS and support team had been more open and honest about the situation. Asking people to increase their spending limits when that seemed on the surface to be completely irrelevant is annoying."
Amazon SNS	"Re: SNS suddenly stopped sending SMS
Were experiencing the same issue. ""providerResponse"": ""Internal error"", Were you able to resolve it?

Edited by: chilscher on Mar 24, 2017 4:33 PM"
Amazon SNS	"SNS to encrypted SQS queue possible?
I have set up an SQS queue with SSE and a subscription to an SNS topic.  The queue is currently using the default KMS SSQ key for encryption.  I am able to send a message successfully to the queue from the AWS Console.  However, when a message is published to the SNS topic, the following error occurs when delivery to the SQS queue is attempted:

{
  ""ErrorCode"":""KMS.AccessDeniedException"",
  ""ErrorMessage"":""null (Service: AWSKMS; Status Code: 400; Error Code: AccessDeniedException; Request ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)"",
  ""sqsRequestId"":""Unrecoverable""
}


I don't see anywhere I could somehow give SNS the permissions it needs to the key.  Is it not possible for an SQS queue using SSE to subscribe to an SNS topic?

Relevant CloudFormation template resources:

SnsSubscriptionMyTopicMyQueue:
  Type: AWS::SNS::Subscription
  Properties:
    Endpoint:
      { ""Fn::GetAtt"": [""MySqsQueue"", ""Arn""] }
    FilterPolicy:
      myMessageAttribute:
        - ""MY_FILTER_VALUE""
    Protocol: sqs
    TopicArn: { ""Ref"": ""MySnsTopic"" }
MySnsTopic:
  Type: AWS::SNS::Topic
  Properties:
    DisplayName: ""My topic display name""
    TopicName: myApplication-${self:provider.stage}-MyTopic
SqsQueuePolicyMySnsTopicSendMessage:
  Type: AWS::SQS::QueuePolicy
  Properties:
    PolicyDocument:
      Id: SqsMySnsTopicSendPolicy
      Version: ""2012-10-17""
      Statement:
        - Effect: Allow
          Sid: ""Allow-Sns-SendMessage""
          Principal: ""*""
          Action:
            - sqs:SendMessage
          Resource:
            { ""Fn::GetAtt"": [""MySqsQueue"", ""Arn""] }
          Condition:
            ArnEquals:
              ""aws:SourceArn"": { ""Ref"": ""MySnsTopic"" }
      Queues:
        - { ""Ref"": ""MySqsQueue"" }
MySqsQueue:
  Type: AWS::SQS::Queue
  Properties:
    KmsMasterKeyId: ""alias/aws/sqs"""
Amazon SNS	"Re: SNS to encrypted SQS queue possible?
Answering my own question, this article: https://avinetworks.com/docs/17.2/aws-sqs-encryption/  got me started in the right direction (even though I am not using that product).

Not sure if it can be done somehow with the default SQS key, but it is working with my own custom key:

KmsKeySqsQueueFromSns:
  # KMS Key that can be used by SQS to encrypt messages from an SNS topic
  Type: ""AWS::KMS::Key""
  Properties:
    Description: ""Encrypts messages publishes to an SQS queue from an SNS topic""
    KeyPolicy:
      # https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html#key-policy-default
      Version: ""2012-10-17""
      Id: ""SNS-to-SQS-Key""
      Statement:
        - Sid: ""Enable IAM User Permissions""
          Effect: ""Allow""
          Principal:
            AWS: ""arn:aws:iam::${self:custom.accountId}:root""
          Action:
            - ""kms:*""
          Resource: ""*""
        - Sid: ""Allow SQS to use the key""
          Effect: ""Allow""
          Principal:
            Service: ""sqs.amazonaws.com""
          Action:
            - ""kms:GenerateDataKey*""
            - ""kms:Decrypt""
          Resource: ""*""
        - Sid: ""Allow SNS to use the key""
          Effect: ""Allow""
          Principal:
            Service: ""sns.amazonaws.com""
          Action:
            - ""kms:GenerateDataKey*""
            - ""kms:Decrypt""
          Resource: ""*""


then I reconfigured the SQS queue to use that key:

MySqsQueue:
  Type: AWS::SQS::Queue
  Properties:
    KmsMasterKeyId: { ""Ref"": ""KmsKeySqsQueueFromSns"" }"
Amazon SNS	"Re: SNS to encrypted SQS queue possible?
I would also like to know if it's possible with a default (alias/aws/sqs) key."
Amazon SNS	"Can I use SNS with instances in my VPC?
I tried to subscribe an HTTP endpoint in my VPC to an SNS topic using the console. I got the message below back. Can I not do this?

Subscriber endpoint:
http://10.0.234.144:9013/foo
Message:
Not authorized to subscribe internal endpoints (Service: AmazonSNS; Status Code: 403; Error Code: AuthorizationError; Request ID: 7a320845-1828-53e0-82c1-46e987305010)"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Hi DerrickLucid:
Thank you for reaching out. The http endpoint you used is an internal http endpoint. It can mean different things in different internal networks. SNS recognized it as an Amazon internal http endpoint and failed because SNS does not have permission to do so. Please use publish http endpoint instead. 

Best
Liang"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
""Please use publish http endpoint instead.""
Can you clarify?

Let me walk through the example a little more explicitly. I have a machine in a VPC with one network interface. The IP address of that interface is 10.0.140.70 for example. SNS is a pubsub service. The idea is that one node publishes a notification to a topic and several nodes can subscribe to that topic and SNS will send the notification to each of them. Machine 10.0.140.70 needs to subscribe to the SNS topic so it can receive the notifications that another node publishes.

Another machine with a public IP address can subscribe to the topic just fine and receive notifications. I am having trouble with the machine with a private VPC address. Is it possible? In other words, can SNS send notifications to machines in a VPC (without a second public network interface)?

Edited by: DerrickLucid on Nov 6, 2015 8:51 AM"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
I have this problem as well. I would like to use internal EC2 IPs with SNS (http endpoints) but apparently it doesn't allow me to. However, I don't want to expose my SNS endpoints to the outside world. Is there a way to use internal IP addresses with SNS?

Edited by: BosschaertD on Nov 11, 2015 7:08 AM"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
I too have a similar problem. Did you guys resolve the issue?

Subscribing to public dns works but since its vpc instance we would to use private ip."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
No solution yet. I may resort to publishing to an SQS queue per VPC machine, then polling the queue to get the notifications."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Thank you for contacting us,

At this time, SNS does not support VPC endpoints. We will take this as a feature request. Your approach of using SQS and polling from a machine within the VPC should work.

Regards,
George"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Thanks"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
This is major gap in the SNS. Please make sure your dev team is aware of this customer pain point.
Ideally I should be able to allow SNS to `connect` to my VPC and send messages to my internal machines."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Exposing SNS endpoints to the internet is MADNESS. 
Amazon is requiring its users to be insecure. Way to go."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
+1"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
I have the same problem too. Is there any update for this?

Br,
Arvin"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
+1 here too

I mean It would be great if VPC endpoint for SNS exists as for S3 buckets !

=> https://forums.aws.amazon.com/thread.jspa?threadID=180310

Thanks in advance

Edited by: Steph on Apr 24, 2017 1:57 AM (added endpoint comment)

Edited by: Steph on Apr 24, 2017 1:59 AM"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
+1"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
+1
2017 with no resolution.
Have the same issue while using Lambda function behind vpc ( due to redis connectivity )."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Inability to subscribe to internal endpoint is currently impacting our architecture. Please AWS SNS team help fix this gaps"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
I believe 2018 is the lucky year. I finally see official doc on the resolution of this issue.

If you use Amazon Virtual Private Cloud (Amazon VPC) to host your AWS resources, you can establish a private connection between your VPC and Amazon SNS. With this connection, you can publish messages to your Amazon SNS topics without sending them through the public internet.

https://docs.aws.amazon.com/sns/latest/dg/sns-vpc.html"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
That is only publish though? Not the subscription endpoint."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
That's correct.

Have you considered API Gateway to proxy your calls (https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-private-integration.html)?"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
I have the same issue. How can I subscribe to SNS and receive requests from SNS without specifying all the AWS sns it goes thru. I don't want to add all the ""X"" number of AWS SNS ips messages go thru. There are hundreds of them to be included in security groups."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Instead of adding all the ""intermediary AWS SNS ips"", why can't AWS define a security group that has all the ips and we can add that security group to our ec2's. AWS can then modify these IP's as needed with supposedly a Lambda function they have. 
This topic has be around for so long and seems like AWS does not want to address this issue"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
Well, no, ideally I should have my SNS running inside my VPC!"
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
5 years later and I still think that this would be a really useful feature.

My usecase is that I have an ASG you might want to send a message to all of the machines in that group.

You can look up all of the internal IPs within the group and send a message directly to each, but that seems like a lot of boiler plate over SNS..."
Amazon SNS	"Re: Can I use SNS with instances in my VPC?
We also need this"
Amazon SNS	"SNS Run on a Schedule?
Is it possible to run the Simple Notification Service on a schedule?  I want to use a rule to check a value from a sensor, then send an email alert.   But I dont want to flood the inbox with alerts.  It would be sufficient to send an email a couple of times a day.

Thanks,

Steve

Edited by: Albright on Mar 13, 2019 3:48 AM

Edited by: Albright on Mar 13, 2019 3:48 AM"
Amazon SNS	"Integrate AWS SNS with FCM not working for iOS ðŸŽˆ
Hi all, I am trying to integrate AWS SNS with FCM. What I wanted to achieve is to call SNS from my backend, then SNS call FCM to send push notifications to iOS and Android devices. It is working well for the Android Platform.

For iOS, I added a platform application for iOS, with FCM as the platform. 
I added a token to the platform application from my backend (call from iOS mobile app), but when I try to publish a message from SNS to the endpoint, the iOS device doesn't receive any push notifications. (The iOS device able to receive a push notification if directly send from Firebase messaging console, means the push notifications was set up correctly)

Questions:
1. I am wondering in AWS SNS, can we use FCM for iOS, or must use APNS for iOS?
2. If it is possible to use FCM with iOS, what is the correct format of the message body in order to send a push notification to iOS (when the SNS Platform Application is FCM)? So far I tried but not working. Can please provide a sample data which I can publish from SNS?

Thanks!

Edited by: clive107 on Mar 12, 2019 4:44 AM

Edited by: clive107 on Mar 12, 2019 4:51 AM"
Amazon SNS	"Amazon SNS Message push notification not received
Hi,
  I am trying to publish a message to mobile using endpoint created in Amazon SNS using FCM. The notification are getting received when application opens in the foreground. But, notification not working when application was closed.

When we directly publishing from FCM, notification works for the app.
But through SNS, notification is not working."
Amazon SNS	"SNS delivery failure message format
Hello,

I have the following scenario: I created a platform application in SNS for push notifications and I specified some topic in  ""Event Notifications"" for ""The topic for the Delivery Failure event"" attribute. I also created an SQS subscription for this topic and in case of failure for push delivery I receive messages in the following format:
{
	""DeliveryAttempts"": 1,
	""EndpointArn"": ""arn:aws:sns:us-west-2:***:endpoint/APNS/stage***/5afbbcc0-00b8-3be6-ad4b-258e2cd18d7c"",
	""EventType"": ""DeliveryFailure"",
	""FailureMessage"": ""Platform token associated with the endpoint is not valid"",
	""FailureType"": ""InvalidPlatformToken"",
	""MessageId"": ""244f509b-64f6-53d9-a169-04685570c729"",
	""Resource"": ""arn:aws:sns:us-west-2:***:app/APNS/stage***"",
	""Service"": ""SNS"",
	""Time"": ""2019-03-01T13:10:30.405Z""
}


So far it is OK, I can handle the message, but I am wondering whether this message format is stable and reliable? I mean I was not able to find any documentation about its format and I had to log it as a string and then create an appropriate data structure for it.  And I would like to be sure that this message is officially supported and is not going to be changed.
I would appreciate any useful information about it, thanks in advice!"
Amazon SNS	"Duplicate Reports in SNS Daily SMS Usage Reports
I'm facing issue with SNS's Daily SMS Usage Reports

In order to get daily reports for SMS usage and to manage SMS bounces, I had configured SMS Usage reports using the below steps from SNS developer guide. 
https://docs.aws.amazon.com/sns/latest/dg/sms_stats_usage.html 

From the usage report S3 Bucket, I had configured a Lambda function to trigger, which sends me daily report which is further analyzed for any errors.

From past few weeks, I got to see that I was getting duplicate records in my reports which was generated by lambda. I tried to troubleshoot this by having the trigger to SNS, so that I can see when new new log is added. I noticed that for each date's usage reports, the report was added twice by AWS.

example
On Mon, Feb 25, 4:11 pm UTC, SMS usage report was added for SMS sent on Feb 24
On Tue, Feb 26, 4:14 pm UTC, SMS usage report was added for SMS sent on Feb 24 again

Since the 2nd report had same name as of the earlier report, the earlier report got replaced with new file. This triggered the lambda and created duplicate records in my report. The new file had same data as of the old file 
i.e Report added for 24th Feb on 25th Feb was same as of the report added for 24th Feb on 26th Feb

If anyone can help me troubleshoot this duplicacy issue would be very useful as in SNS Console, there seems to not have any way to troubleshoot this."
Amazon SNS	"Signature in SNS message was invalid
We're using SES together with SNS to notify our server if an email bounces. We use the Java v1 SDK to handle the incoming SNS request. This has been working well for a few days. Now we're sometimes getting an error on incoming bounce notifications when we call snsMessageManager.parseMessage(): ""Signature in SNS message was invalid."" Is AWS fiddling around with its certificates today? Is the Java v1 SDK not reliable for consuming these notifications? Thanks for advice

Edited by: neffnet on Mar 8, 2019 6:29 PM"
Amazon SNS	"Confirm Subscription by HTTP and HTTPS doesn't working
Since today, the SNS Topic is presenting a blank page when creating a new HTTPS (or HTTP) subscription and click in ""Confirm Subscription"".

By AWS CLI doesn't possible confirm using the token too, I'm getting the error 'Invalid parameter: TopicArn', despite I am passing the correct ARN parameter.

Attached a image with firebug error when clicking on button."
Amazon SNS	"Sending JSON from SNS console not possible anymore
Since today the UI of the SNS service changed completly (side quest: where is the announcement? why can't I go back to the previous version?).

With this change I'm not able to send push messages as JSON like before.
Where can I configure to send JSON?, like:
{
""default"": ""notification"", 
""APNS"": ""{\""aps\"":{\""alert\"": {\""loc-key\"":\""notification\""}}"", 
""APNS_SANDBOX"":""{\""aps\"":{\""alert\"":{\""loc-key\"":\""notification\""}}"",
""GCM"": ""{ \""data\"": { \""body_loc_key\"": \""notification\""}}""
}"
Amazon SNS	"Re: Sending JSON from SNS console not possible anymore
I am also having this problem. Now I don't know if they removed the JSON option or if it's possible to send using the AWS sdk."
Amazon SNS	"Fail receiving sms with verification code for cognito MFA login
Im using cognito MFA autehtication for an Android app in Argentina. A lot of SMSs have delivery status ""Success"" but the phone does not receeive the message. We are having the problems with two phone carriers: ""Claro Argentina"" and ""Tuenti"". I contact support from Tuenti and they said that they disable SMSs coming from short numbers. There is any way I can resolve this problem? Can I force the use of long numbers to send SMSs in my app. This is an example of a SMS with ""SUCCESS"" status that is not received in the phone:

{ ""notification"": { ""messageId"": ""74a6902f-639c-5ebe-aaca-c4dd6bc0a995"", ""timestamp"": ""2019-02-28 16:02:36.357"" }, ""delivery"": { ""phoneCarrier"": ""Claro Argentina"", ""mnc"": 310, ""destination"": ""********3891"", ""priceInUSD"": 0.01937, ""smsType"": ""Transactional"", ""mcc"": 722, ""providerResponse"": ""Message has been accepted by phone carrier"", ""dwellTimeMs"": 156, ""dwellTimeMsUntilDeviceAck"": 408 }, ""status"": ""SUCCESS"" }"
Amazon SNS	"Failed SMS from Oregon
Why would SMS subscriptions and seperate attempts to send an SMS from Oregon, just start failing. 

Can you not send international SMS from Oregon region anymore (trying to sms australian numbers)? It was working and it just stopped on its own accord around the start of February.
I can send successfully from Sydney but not from Oregon however the application using it, is hardcoded to use the oregon topic, so difficult to change it to a sydney one... Any clues to why or what can be done to fix?"
Amazon SNS	"Limit Increase: SNS Text Messaging
Hi guys,

It is very urgent request as our application is in Production since yesterday, users are not able to register our app. I logged a ticket yesterday but still no response from the support team. I have to log a new one today. Can you please escalate this ticket for us? It has been 2 days but no response. 

We logged two tickets:
Case ID
5710267551

Case ID
5704644231

Thank you"
Amazon SNS	"Re: Limit Increase: SNS Text Messaging
How long did you end up waiting?"
