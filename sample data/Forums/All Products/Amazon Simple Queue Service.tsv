label	description
Amazon Simple Queue Service	"SQS per message retention value
Hey,

i was reading through the SQS documentation looking for a possibility to set a retention value for single messages of a queue.
But so far i was only able to find the retention values for a whole queue.

So i guess, that it is not possible at the moment.
Or have i overlooked something?

Kind regards
Fabian"
Amazon Simple Queue Service	"What is the max filter policy limit on SNS
Hi 
   AWS filter policy documentation says 5 attributes. However, it allows more than 10 attributes in filter policy.

  How many attributes keys it can have in filter policy? 
  I understand combination of key and values should be less than 100."
Amazon Simple Queue Service	"Posting a daily summary into a Slack Channel
We have several e-commerce platforms and we would like to post a combined daily summary into a Slack Channel. So far, every sale from every e-commerce site gets posted directly into the online-sales Slack Channel separately as it happens, simply using Slack Incoming Webhooks. What i am thinking about is having the e-commerce sites posting transaction details into an SQS, having a Lambda function trigger on a daily scheduled basis to construct the summary (x sales from ABC site, y sales from EFG site...) and then post all that into Slack using the same incoming webhooks.
Can any one comment on such a solution, is there any better architecture or approach?"
Amazon Simple Queue Service	"Messages disappearing from SQS queue
Recently we have been experiencing some issues with SQS. The messages sent from our SQS queues are dropping before our apps could read them. These messages are sent from EC2 nodes and are read by our servers outside EC2 cluster.Not all the messages are disappearing which is why it is hard to find the cause.

We are trying to debug this issue and would like some help from AWS support. We have experienced this problem on 4/26/2012, 5/7/2012, 5/8/2012, 5/9/2012, 5/10/2012.

We have the message IDs for missing message and following information regarding these missing SQS messages will help us debug this further

Time when Message was put on SQS
Time for how long Message was on SQS
Time when Message was last seen on SQS
If possible who deleted the message

We would appreciate your help for determining the cause of this issue.
Thanks"
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
""The messages sent from our SQS queues are dropping before our apps could read them"" - when you say they are dropping, do you mean that they are never delivered?

One reason messages may be sent to SQS but not delivered to consumers is because the messages expire.  This occurs when messages are not consumed before the Queue's MessageRetentionPeriod.  What is the MessageRetentionPeriod for your queue, and how long were the messages in the queue before the were ""dropped""?

Another reason messages may be sent to SQS but not delivered to consumers is if the Queue is deleted, and then recreated.  When a queue is deleted, any messages in the queue are deleted.  In your system, do you delete and recreate your queues?"
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
By  ""messages are dropped"" I mean they appear for short duration of time in queue and disappear before our apps could read them. We have seen messages in queue for 2-3 minutes before they disappeared. We couldn't find them in our app logs where we usually log them. We do have message IDs for these messages if that helps.

The queues message retention period is 4 days. Also we are not deleting and recreating them. The queues were created on Dec 6, 2011. We have seen this problem surfacing only recently which is why it is odd for us."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
I've sent you a private message asking for specific information, once you reply to that I'll take a deeper dive."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Thanks for the help! This helped us identify issue with our system and it proved that SQS was not dropping the messages."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Hello,

I am facing this exact same problem -for some strange reason, messages in my queue get deleted before i can process them - I was under the impression that queue messages have to be manually deleted - but in this case they automatically disappear. 
My settings Details are as below
1. I receive message from SNS to my queue.
2. I know that the messages are received, but after a brief period of 1-2 minutes, they disappear. 
3. The following are my settings 
a.  *Default Visibility Timeout*- 1 minute
b. Message Retention Period: 4 days
c. Delivery Delay: 0 seconds
d. Receive Message Wait Time: 20 seconds

Many Thanks,"
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Send me a PM with the details of your queue (QueueURL is best), so I can take a closer look.

In the past we've seen that when customers are reporting this issue, they have a piece of code running on some forgotten or development machine that keeps receiving and deleting messages from their queue. Double check if you in fact have some code somewhere consuming messages."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Hey,
That was an indeed the issue - we had set up a test server and that was consuming some of the messages.
Thanks for that. 

Is there any way that we can see a history of all messages that came to the queue ? Currently I realised that my messages were coming to the queue from sns properly but also creating another email subscription to the sns. This was I was able to figure out that sns was not the issue but sqs was the issue.

If we could see a history of each message, that will lead to easier debugging - Do let me know if it possible

Thanks."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Hi there,

We are experiencing similar issues and could not find what is consuming the messages. Could you help find out the consumer history of recent messages? I can PM the queue ARN.

Thank you in advance!"
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Yes, please DM me the queue ARN.

You can also mitigate this yourself. Create an IAM user limited to access that queue, use this IAM user in your legitimate queue consumption code, set up a queue policy to allow receive calls only from that IAM user.

This would prevent any other user from consuming messages from that queue."
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
Thanks for the suggestion! Will try that. 
But still it would be really helpful to see what has been consuming the messages"
Amazon Simple Queue Service	"Re: Messages disappearing from SQS queue
We got a similar case here.

Normally, the queue is processed by a daemon with several workers which is lead to a fast rate of consumption.

When the daemon is not running, I found out that looking at the messages status on the AWS console, the number of messages dropped at regular interval w/o having any consumer running.

Like already mentioned, it would be really nice to get some information about the consumer(s) of message(s).

Note: I will also DM you the ARN of our queue if you don't mind!"
Amazon Simple Queue Service	"SQS Lambda Trigger Polling Issue
Hello,

I have deployed several SQS queues that get populated with messages and have set it to trigger a Lambda function. My issue is that although I have configured long polling I still am receiving far too many NumberOfEmptyReceives requests. I do not know what I have configured wrong but in 4 days I have shot past the 1.000.000 Free Tier SQS requests and this is a real issue. Could somebody please point me in the right direction on how to solve it ?
Cloudwatch graph: http://oi64.tinypic.com/2n4p3a.jpg
SQS Configuration: http://oi64.tinypic.com/2ynfib8.jpg
Thanks,
Cris"
Amazon Simple Queue Service	"Re: SQS Lambda Trigger Polling Issue
Hello Cris,

When you set up an SQS trigger with a Lambda function, the Lambda service regularly polls the SQS queues for messages. Since this is entirely dependent on the Lambda service, the polling mechanism cannot be controlled. However, please note, Lambda does use long polling to retrieve messages from an SQS queue.

If there are no messages in your queue, it can lead to several EmptyReceives from SQS. Since the polling mechanism cannot be controlled, the NumberOfEmptyReceives metric rises. More details on Lambda behavior with SQS can be found here:
https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html

The only way to mitigate this is to disable the SQS triggers on the Lambda function. I understand that this may not be entirely feasible. As such, please do share details of your use case so we can find a possible work around."
Amazon Simple Queue Service	"Re: SQS Lambda Trigger Polling Issue
Hi @awschirags,

I understand that Lambda uses Long Polling and I am expecting a number of NumberOfEmptyReceives to be present but not to the level of 80 per minute! If it is using Long Polling and I am not receiving any message on the queue the whole day I would expect it to be max Long Polling(20s) * 3(Polls) = 60s. 

Therefore I would expect to see total NumberOfEmptyReceives per minute to be 3. Not 85. 85 tells me it is either not long polling or there are 85/3=28.3 threads long polling the queue, either case resulting in significant costs for a queue that is not receiving any messages the entire day! And due to having over 6 queues, per environment this results in many millions of empty requests.

My expectation is in line with this post https://forums.aws.amazon.com/thread.jspa?threadID=292720&tstart=0 but I am not seeing this behaviour.

Could you please help me in cutting down these empty polls and receives ?

Edited by: cristwelrine on Jan 16, 2019 1:12 AM"
Amazon Simple Queue Service	"FIFO queue subscribes to a SNS topic
Hi,

    I was trying to subscribe to an SNS topic using a FIFO queue. However I found the ""subscribe to SNS topic"" option under the ""Queue actions"" pulldown are disabled. The ""subscribe to SNS topic"" is working for a standard queue. Is it because this feature is not supported or I did something wrong. Please help. Thanks.

James"
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
This feature is not supported at the moment."
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
+1 For this feature"
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
I have tried following this:
https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-subscribe-queue-sns-topic.html

Didnt work till now"
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
Can we get any update on this?

It'd be good to know wether or not there are plans to support this feature in the near future, otherwise we might have to look into other solutions than SNS/SQS."
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
Any updates on this?"
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
Hey everyone!

This feature request has already been submitted to the concerned team. Rest assured, we take customer feedback seriously and are always looking forward to improving our services. Unfortunately, we will be unable to provide an ETA on when this will be implemented. 

However, please do keep an eye out on the following pages for updates regarding the release of this feature:
https://aws.amazon.com/new/"
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
I think it's a serious limitation of SNS/SQS integration and SNS itself. Usage of Lambda to call FIFO SQS queue won't make the solution FIFO. Can you at least put that information in more visible place? It'd spare bigger projects from additional costs of implementing own logic to support order assurance/migrating to other queuing mechanisms."
Amazon Simple Queue Service	"Re: FIFO queue subscribes to a SNS topic
Is there any update on this?

I have noticed that it is now possible to create a subscription from a FIFO SQS queue to a SNS Topic via the console. Sadly publishing to the SNS Topic does not place the message in the queue.
( It is possible to create the subscription via the SNS-Subscriptions page in the console, but not via the SQS-Queues page )

Is this an indication that the feature is any closer to being available?

Thanks

Edited by: peterkneale on Jan 15, 2019 10:28 PM"
Amazon Simple Queue Service	"SQS FIFO Lambda Trigger With Concurrency Set To 1
Appreciate that SQS does not support FIFO for triggering Lambdas, but is that still the case if the Lambda has concurrency set to 1? If concurrency of the Lambda is set to 1, then there is only a single instance of Lambda listening to SQS, so FIFO might be preserved?"
Amazon Simple Queue Service	"Multiple Consumers with Amazon SQS
Hi,

How multiple consumers can work with Amazon SQS ? 

I have a use case where a message in SQS should be consume by 5 different consumers applications. Each application creates one consumer on the same queue.
Is there any standard way to implement this ? 

One way It can be implemented: Reduce the visibility timeout to '0'. Now as soon as a consumer gets the message, the message will become visible again since visibility timeout is '0' and other consumer can consume it by receiveMessage() call. But the problem here is in deleting the messages. 
All 5 consumer applications are independent of each other and they cannot know when the message is consumed by all the application and message is good to delete. 

Thanks,
Anuj"
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
Did anyone get a chance to look at this ?"
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
Hi,

Unfortunately, as far as I know, this is not really possible in SQS. You could maybe have a look at AWS Kinesis for that. For SQS, the simplest way is to actually create 5 queues, and push the message to all 5 queues (one strategy would be to use SNS for that, as SNS can push messages to SQS queues):

1. You create 5 SQS queues.
2. You create one SNS topic, and each queue is subscribed to the SNS topic.
3. When pushing a message to a SNS topic, the message will be pushed to each 5 queues.
4. You create as many worker as queues.
5. Done =)"
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
Has there been any improvements on this topic or it's still not possible?"
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
Kinesis is the answer if you need multiple consumers on a single stream."
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
There is the option to use FIFO queues and have multiple applications poll from that queue with a specific group: https://aws.amazon.com/sqs/faqs/ (Q: Do Amazon SQS FIFO queues support multiple consumers?)

However, if you want 5 or more consumers to poll and process (and delete) the same produced message and continue to use SQS, then I'd recommend using one SQS per consuming application.

Producer -> SNS Topic -> 5+ Queues (each subscribed the producer SNS topic) <- Consumer Polls

Edited by: yuelchen on Jan 13, 2019 1:03 PM"
Amazon Simple Queue Service	"Re: Multiple Consumers with Amazon SQS
Hi Anuj!

As the others here have mentioned, if the same message needs to be processed by five separate consumers, the SNS-SQS fan-out architecture is the ideal approach. 

In this architecture, a single SNS topic can be created with five SQS queues configured as subscribers. Each SQS queue will then have a separate consumer associated with it. Once a message hits the SNS topic, the SNS service will then send the same message to all five SQS queues. 

Since each queue and consequently each consumer can operate independent of each other, the same message can be successfully processed and deleted by the consumers without being influenced by each other. 
Here's a brief visual description what has been proposed:
Producer ----> SNS
                          -------> SQS Queue #1 -------> Consumer #1

                          -------> SQS Queue #2 -------> Consumer #2

                          -------> SQS Queue #3 -------> Consumer #3

                          -------> SQS Queue #4 -------> Consumer #4

                          ------->SQS Queue #5 -------> Consumer #5


Here's an article to get started:
https://aws.amazon.com/getting-started/tutorials/send-fanout-event-notifications/

Let me know if you have any additional questions.

Edited by: awschirags on Jan 14, 2019 9:16 PM"
Amazon Simple Queue Service	"Dead Letter Queues - One Per Source Queue vs. Shared?
What is best practice for the relationship between Source Queues (SQs) and Dead Letter Queues (DLQs)? Do you prefer that each SQ have its own dedicated DLQ? Or do you prefer sharing one DLQ among several (or all of) your SQs?

On the one hand, a one-to-one relationship seems excessive, given how seldom DLQs should be used. And it's a little more overhead to set up management, monitoring, security, etc. of all those queues.

On the other hand, with one-to-one, it's automatically clear where a message in the DLQ came from. (When experimenting with DLQs in the AWS Console, I don't see any header info added to a message indicating which SQ it came from). Moreover you can control which humans/applications have access to which messages. With a shared DLQ, that's more difficult. Also, a shared DLQ also requires clients to browse through many more messages to find ones from a particular SQ, which could be prohibitively expensive based on the number of messages in the DLQ.

As a secondary question, do you insist that all your SQs have a redrive_policy?"
Amazon Simple Queue Service	"Re: Dead Letter Queues - One Per Source Queue vs. Shared?
I personally prefer one DLQ per Queue not only because - as you find out - there is no way to find out from which queue the dead letter came from.

Plus, keeping in mind, that behind one queue usually is (only) one application, and the nature of a failure may be different. Also the system throwing a message to the DLQ by design needs an other system to fix some data before re-deriving the message again to the original queue. Having all failures going into one queue forces error handlers to read and filter for the appropriate action on one specific message. This creates overhead and is dirty."
Amazon Simple Queue Service	"Re: Dead Letter Queues - One Per Source Queue vs. Shared?
Hi there!

SQS provides the freedom to set up DLQs in any way you see fit. The configuration of your DLQ is entirely dependent on your use case. 

As you mentioned, setting a one to one mapping of a DLQ and a queue ensures that consumers of the DLQ need not identify where the message originated from. This ensures that consumers can focus solely on the task of handling the erroneous messages instead of working on logic to first identify the source and then proceed with the processing.

Although there is initial overhead of setting up of the management, security and monitoring of each distinct DLQ, this ensures that the processing of your messages proceeds smoothly. With the 1:1 mapping, the risk of incorrectly processing messages vastly reduces. 

With the many to one relationship between queues and a DLQ, processing logic must be developed on the consumer side thus increasing the processing time for each message. Additionally, if you have applications that differ vastly in message type and the steps involved in message processing, multiple such producers sending data to the same dead letter queue may result in problematic/extended processing by the consumers.

However, if your environment does not contain a vast number of queues or an extremely varied set of message types, setting up a single DLQ can reduce the overhead of managing and maintaining multiple DLQs.

Additionally, SQS does not enforce the use of a redrive policy for a queue. If the messages in your application can be processed without any issues or if the errors are handled by the consumers themselves, a redrive policy may not be required for your application.

A careful examination of your application's architecture should provide the insight required to select either of the two options."
Amazon Simple Queue Service	"How to limit the maximum number of inflight messages
Hello!
I want to implement a small bulk-mail sending tool based on the Amazon API Gateway -> Lambda -> SES services. Now I need to develop the queue system to handle a ""Throttling – Maximum sending rate exceeded"". It seems that SQS should be a good choice for this task. But I could not find how to limit the maximum number of inflight messages per second.

Is it possible to do that? Or it is wrong way and I need to find another solution.

Thanks,
Andrey

Edited by: ov4innikov on Dec 13, 2018 12:52 AM"
Amazon Simple Queue Service	"Re: How to limit the maximum number of inflight messages
Hi Andrey!

SQS doesn't currently have a way to specify a custom limit on the number of inflight messages, but if you put a queue in-between API Gateway and Lambda and use the new support for SQS as a Lambda event source, you can use the Lambda concurrent execution limit to cap the number of SQS messages inflight:

https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html
https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html

This is becoming a common approach for rate limiting to protect downstream services with limited capacity.

Cheers,
Robin"
Amazon Simple Queue Service	"SQS Message Parsing Best Practices
I'm using the AWS SDK for .NET and have implemented SQS ReceiveMessageAsync in my ASP.NET Core web application.  My intent is to receive the message content, parse it into separate fields e.g. field 1, value 1, field 2, value 2 and output both field and value to my view.  I receive the message content without issue, but need guidance as to how best to parse the message body to pickup and populate the field name and value?  

Also, after I've parsed the message body, is it advisable to store it in a physical database table or make a new message request each time the view loads?"
Amazon Simple Queue Service	"SQS connector for Spark-Stream or etc
Hi,

Are there examples/ connectors in to connect SQS to an on-Prem HortonWorks?

The preferred connector would be between SQS and Spark-Steam on-Prem.

Thanks."
Amazon Simple Queue Service	"Control the Rate that Messages are released from SQS
Context: We currently need to call an external data source API that has a rate limit of 1 request per second. We embedded this API call within a Lambda. Several 100 requests might come in at once which means that traditionally we would set off several 100 lambdas to call the API; however, because we have a rate limit 1 request per second, the API will be throttled or shut down if we try to call the API 100s of times within a few seconds. Therefore, we were thinking of using SQS as a strategic bottleneck to control the flow to these Lambdas containing the API Calls. 

Here's an example flow:

User sends 1000 requests -> Queue -> Message (Request) Released at Rate of 1 per second -> Lambda calls API with the request -> API output pushed to our Database

The Queue will have 1000 messages, and we want only 1 message to be released to Lambda every second. (The Lambda itself might run for a few seconds but that doesn't matter - I only care that a new lambda is initialized only every second).

We are struggling with how to release messages at a given rate. We were thinking that FIFO queues make sense but they don't support native Lambda triggers, nor would we know how to configure the release rate at 1 / second. We also don't know how we would do this with standard queues. The idea we had was to stand up a Nano EC2 instance with a script that runs every second and pulls a message down from the queue and pushes it to Lambda. This is admittedly messy. 

Does anyone have an idea of how best to do this? Can we configure this in SQS (or lambda)? We are open to any suggestions and are not locked into anything including SQS at the moment."
Amazon Simple Queue Service	"AWSQueueService UsageValue
I'm new to this AWS and SQS and playing with it. My SQS billing says I have used my free tier allocation limit in just 10 days for the month and I am not clear what is the reason for such a heavy usage, when 99.9% if time the Queues are empty.

I have a total of 6 queues including 2 DLQs. I have created them all using default settings and not set any throttling or assigned any extra resources.

The functional logic I implemented is, a Lambda checks if there is any notifications to send every 30 minutes and if there are then it creates a message which it puts in a SQS. 99.9% of the time the lambda returns empty results.

When a message is put on SQS then a Lambda is triggered which actually sends the notifications and any failures are put in DLQ. And if the lambda receives any error response when sending a notification then all these error messages are put in another Queue which triggers another lambda and logs these in a database. But all of this is skipped 99.9% of the time, unless I am manually testing the flow.

Below is a snippet of the SQS usage report.

Service, Operation, UsageType, StartTime, EndTime, UsageValue
AWSQueueService, Receive, EU-Requests-Tier1, 11/01/18 00:00,11/01/18 01:00, 2699
AWSQueueService, GetQueueAttributes,EU-Requests-Tier1, 11/01/18 00:00, 11/01/18 01:00, 180
AWSQueueService,GetQueueAttributes, EU-Requests-Tier1,11/01/18 01:00,11/01/18, 02:00,180
AWSQueueService,Receive,EU-Requests-Tier1,11/01/18 01:00,11/01/18,02:00,2696

In the snippet I see most of the usage is due to below actions. 
AWSQueueService Receive 
AWSQueueService GetQueueAttributes

It is not clear what is causing such high usage value. In some forums I have read I need to make the Queue implement LongPolling than short polling (which is the default).

It would be great if someone can explain what the actions ""Receive"" and ""GetQueueAttributes"" represent and how those can be reduced?

Edited by: mhus on Nov 12, 2018 2:40 PM"
Amazon Simple Queue Service	"Re: AWSQueueService UsageValue
Are you using SQS as an event source for Lambda?
If yes, then you can read more about the behavior of Lambda polling your queue here:
https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html

And as mentioned here:
https://aws.amazon.com/blogs/aws/aws-lambda-adds-amazon-simple-queue-service-to-supported-event-sources/
""There are no additional charges for this feature, but because the Lambda service is continuously long-polling the SQS queue the account will be charged for those API calls at the standard SQS pricing rates."""
Amazon Simple Queue Service	"Allowing internal teams to only post to Queue
What are the best practices to let consumers of my application post events to my application queue? Note: They will need only write access to allow them to post events to the queue.

One way I could do this is to create a user with no access to aws console (just programmatic API access) and with inline policy(example policy below) to only allow ""SendMessage"" for the resource. Are there any security issues in doing this? What is the best way to solve this use case?
{
   ""Version"": ""2012-10-17"",
   ""Statement"": [{
      ""Effect"": ""Allow"",
      ""Action"": ""sqs:SendMessage"",
      ""Resource"": ""arn:aws:sqs:*:123456789012:MyAppQueue""
   }]
}"
Amazon Simple Queue Service	"Curious about Polling amount from a Lambda for SQS
I am currently experimenting with moving some of my personal projects away to AWS, and in the process migrate many of them to serverless where possible.
One of the critical parts of that is background processing, specifically from queues.
So I am experimenting with SQS and Lambda polling. 
Right now I am starting very small, a single queue and lambda. That queue gets 1 message a day. (yes this may not be the best use case for a queue, but I wanted to start small for this test)

When I look at my free tier billing dashboard for November I so far see 26,863 Requests. Estimating 402,945 for the month (which depending on timing that could be off, but not entirely sure).

Reading the docs I know that this is not a set number of how often it polls, it is based on activity and it goes up and down. My concern is how high this could get for a more normal queue that is constantly getting messages and processing in a lambda. 
Yes a million requests is only $0.50, but that could add up as I add more queues and more Lamda. 

I am curious if there are any examples out there of how many requests this setup turned out to be at the end of the month. So I can see if I need to go down a different path."
Amazon Simple Queue Service	"Re: Curious about Polling amount from a Lambda for SQS
You can enable long polling to reduce empty receives

https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-sqs-long-polling.html

If you set the long polling interval to 20 sec (max) then you can calculate the cost based on # of messages plus an estimate of the # of empty receives.

So in 1 day you'd have (3 per min * 60 * 24) = 4320 receives.  Add an extra for each message (since you will then invoke another poll almost immediately."
Amazon Simple Queue Service	"Listqueues API is limited to return 1000 queues for AmazonSQSClient
Hi,

I am using amazon sqs java SDK and i am able to get all available topics in an account.
But for some reason i am unable to fetch all queues in my account and it is getting limited to 1000 only. Actually i have queues in the account whose count is more than 1000.
I referred the doc and it didn't mention about count > 1000, http://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_ListQueues.html

Is there any other way to fetch queues which are more than 1000. 

Thanks in Advance.

Regards,
Ajay"
Amazon Simple Queue Service	"Re: Listqueues API is limited to return 1000 queues for AmazonSQSClient
Hello,

I've asked engineering to take a look at this for you. 

We'll be in touch as soon as possible, though I'd caution it is likely to be a few days at minimum.

Richard"
Amazon Simple Queue Service	"Re: Listqueues API is limited to return 1000 queues for AmazonSQSClient
Hi Ajay,

Each ListQueues  response is currently limited to a 1000 queues. In order to capture >1000 queues, you will need to use the ListQueues command in additon to a QueueNamePrefix filter. You would then need to ""bruteforce"" it by using a different filter for QueueNamePrefix on each capture round e.g. ""a"", then ""b"", then ""c"" etc.

We have created a feature request for  ListQueues to support pagination that will enable you to grab all queues in 1000 queue sections. Unfortunately we don't have an ETA on when this might be released, but all announcements are made on the AWS Forums for SQS, specifically at:


https://forums.aws.amazon.com/forum.jspa?forumID=12


Kind regards,
Chris"
Amazon Simple Queue Service	"Re: Listqueues API is limited to return 1000 queues for AmazonSQSClient
Is there an update on this?"
Amazon Simple Queue Service	"All permissions API gateway integrate SQS, POST returns queue AccessDenied
My role has AmazonSQSFullAccess, etc. My queue has Allow permission to everybody all SQS actions.
Using API gateway Service Proxy to integrate SQS queue with path override, POST method always returns 
Endpoint response body before transformations: {""Error"":{""Code"":""AccessDenied"",""Message"":""Access to the resource https://sqs.ap-southeast-2.amazonaws.com/xxxxxxxx/myQueue is denied."",""Type"":""Sender""}"
Amazon Simple Queue Service	"Re: All permissions API gateway integrate SQS, POST returns queue AccessDenied
Hello,

We might need more data regarding the behavior to correctly gauge what is wrong. 

But it might be that API Gateway does not have the appropriate permissions set in its execution role. You might need to provide SQS SendMessage permissions to the role that the API in API Gateway uses.

You might find this third party article useful:
https://dzone.com/articles/creating-aws-service-proxy-for-amazon-sqs

Let us know if this helps!"
Amazon Simple Queue Service	"Spring boot JMS ignores defaultVisibilityTimeout
I'm using spring boot JMS annotations to read from an SQS queue (following the guide at https://aws.amazon.com/blogs/developer/using-amazon-sqs-with-spring-boot-and-spring-jms/). The problem is that when I throw a JMSException (to put a failed message back in the queue for reprocessing) the message is immediately retrieved again, even though I have a defaultVisibilityTimeout set on my queue. Does anyone know how to make JMS respect the visibility timeout? I thought SQS would ""hide"" the message and JMS wouldn't even know it's there but it seems to be able to pull it out again."
Amazon Simple Queue Service	"Re: Spring boot JMS ignores defaultVisibilityTimeout
Hi.
In this case, the visibility timeout is used to hide the message in the queue, just to give the consumer time to process it. Check your SessionAcknowledgeMode, it's probably in CLIENT_ACKNOWLEDGE. So when you throw a JMSException the message is send back to SQS, not as an new message, but just releasing the current one.
To give your app some time to wait until receiving a new, try this link: https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-send-message-with-timer.html. I don't remember if Spring boot support this ""delay delivery"" attribute, but I think it's the best solution for you.
Good luck!"
Amazon Simple Queue Service	"Re: Spring boot JMS ignores defaultVisibilityTimeout
I actually switched from using JMS to using spring-cloud-aws-messaging and it seems to be respecting the visibility timeout and it provides annotation driven deletion policies which is nice."
Amazon Simple Queue Service	"Messaging between microservices via SQS
Here is the scenario:

We are running a microservices style architecture on AWS using API Gateway and EC2 instances. Let’s say there are five services: Photo Service, Topics Service, User Posts Service, User Messages Service and User Profile Service. There is also an SQS Consumer service, the “Message Worker”. Each microservice has its own database. Here is the sequence of events when a user makes a request to the User Posts Service (for example):

API Gateway routes the request to the User Posts Service. The User Posts Service updates the necessary items in its database. The User Posts Service publishes a message to the Message Worker (SQS). The Message Worker duplicates the message for as many services necessary, i.e. if the User Comments Service, User Profile Service and User Messages Service all need to be updated, it duplicates the message 3 times. The Message Worker sends the data to each service via HTTP, and each service responds via HTTP indicating that they have received the message or that it failed to update. Is this an efficient way to handle messaging between microservices? One concern is that the Message Worker is a single point of failure, but what is the alternative? We are considering creating a queue for each microservice and publishing the messages to the queues via SNS. Any other suggestions to make this more efficient?

We are restricted in what services we can use due to compliance, so using a ""smart queue"" with message broker capabilities like ZeroMQ / RabbitMQ isn't possible."
Amazon Simple Queue Service	"Re: Messaging between microservices via SQS
This is an old post so apologies for the delay. Using SNS with SQS is the standard way many customers build an event bus among microservices.  With the recently added message filtering capabilities for SNS, this becomes even more powerful.

There is also a more recent service, Amazon MQ, that is a managed message broker service for Apache ActiveMQ.  It may also be something for you to look into for this type of pattern."
Amazon Simple Queue Service	"Can not publish a message to SQS
Can not publish a message to SQS
Here is my setting

{
  ""Version"": ""2012-10-17"",
  ""Id"": ""arn:aws:sqs:ap-northeast-1:322940739131:xxx-SQS/SQSDefaultPolicy"",
  ""Statement"": [
    {
      ""Sid"": ""Sid1538990988643"",
      ""Effect"": ""Allow"",
      ""Principal"": {
        ""AWS"": ""arn:aws:iam::251123607109:user/bao-sns""
      },
      ""Action"": ""SQS:*"",
      ""Resource"": ""arn:aws:sqs:ap-northeast-1:322940739131:xxx-SQS""
    }
  ]
}

Please show me what wrong?

Edited by: baonguyenjp on Oct 8, 2018 2:38 AM"
Amazon Simple Queue Service	"Re: Can not publish a message to SQS
Hi there!

The SQS policy allows for the user “bao-sns” to access the queue present in account ID: 322940739131. However, we'll need a bit more information to figure out why you are unable to send messages. Could you please verify the following:

1. How is the message being published by SQS? Is it with an SDK or some third party tool?
2. Please execute the following command from AWS CLI and analyze the output. This should provide the data required:
aws sqs send-message --debug --queue-url QUEUE_URL --message-body 'sample' --region REGION_NAME

The QUEUE_URL will need to be replaced with the URL of the target queue and the REGION_NAME is the name of the region.

The debug option will log the details of the request and provide insight into why the user is unable to send data to the queue. Please do share the output so we can better understand the cause of the issue. 

AWS CLI setup and details can be found here:
https://aws.amazon.com/cli/

More details regarding the send-message command can be found here:
https://docs.aws.amazon.com/cli/latest/reference/sqs/send-message.html"
Amazon Simple Queue Service	"To convert a Standard SQS queue to FIFO queue
Is there any way to convert a pre-existing Standard SQS queue to FIFO queue?
If yes, please guide me with the steps to do so.

Edited by: Rajat1101 on Oct 2, 2018 11:28 PM"
Amazon Simple Queue Service	"Re: To convert a Standard SQS queue to FIFO queue
There is no built in way to convert an SQS queue between Standard and FIFO. The type of queue needs to be selected when the queue is created."
Amazon Simple Queue Service	"Delay does not seem to work
Hello

I just had a near server-crash because (presumably) the SQS delay parameter is ignored entirely.

I use the PHP SDK and post my messages to the queue with the DelaySeconds parameter set to anything between 0 and 60, but my SQS metrics report 0 messages delayed at all times.

I also tried posting a message manually from the AWS Console to an SQS queue and checked ""Delay this message"" by xx seconds. I am able to poll the queue immediately after this for the message regardless of what I set the delay to.

The column called ""Messages delayed"" also says 0 at all times. This is not a FIFO-queue. The default delay is set to 0. The column ""Messages available"" switches to 1 immediately.

I also tried creating a whole new queue to test this, but the behaviour is the same.

Edit:
I just tried setting the default delay for my test queue to 30 seconds and then posting a message. This works as expected; the ""Messages delayed"" column reads 1 and the message is not returned when polling the queue before 30 seconds have passed. Overriding the delay for this queue also does not work; it always delays by 30 seconds, even if I specify 10 minute delay when posting the message in the console.

Edit again:
My queue is in EU (Frankfurt). I just tried this in EU (Ireland) and the behaviour is the same, so it's not a regional thing either. It seems to be broken across the board.

Please advise."
Amazon Simple Queue Service	"Re: Delay does not seem to work
Hi there,

I've reproduced the issue you describe, and it appears to be a bug in the SQS console: it's ignoring the ""Delay this message"" parameter when you send a message. The DelaySeconds parameter is definitely functioning correctly through the API, which you can verify by using the AWS CLI. See the first example here: https://docs.aws.amazon.com/cli/latest/reference/sqs/send-message.html

Thanks for bringing this to our attention, and we will work on delivering a fix as soon as we are able."
Amazon Simple Queue Service	"Re: Delay does not seem to work
Also, if you are able to provide a code sample of your use of the PHP SDK, I can help determine why the DelaySeconds parameter is not being sent. It's possible that it is being set incorrectly and ignored. Here is the documentation on the correct usage: https://docs.aws.amazon.com/aws-sdk-php/v2/guide/service-sqs.html#sending-messages"
Amazon Simple Queue Service	"SQS Long Polling + DelaySeconds
Hello,

    Perhaps I could/should just test this, but if anybody wants the points...

    My understanding is that if my consuming program is using long polling on its ReceiveMessage call, that call will return a message immediately if one shows up any time during the polling interval (20 seconds).
    Is the same true for a message that was previously sent using DelaySeconds and has ""come due"" during the interval?

Thank you,
Twitless"
Amazon Simple Queue Service	"Re: SQS Long Polling + DelaySeconds
As of right now the SQS DelaySeconds parameter doesn't even work, so this depends on if they intend to fix that or not. See https://forums.aws.amazon.com/thread.jspa?threadID=290222

I've opened a support case for this matter yesterday as well, but haven't received any response yet 

Edit: I just noticed I necroed a 5 year old post. I have no idea how this happened."
Amazon Simple Queue Service	"Re: SQS Long Polling + DelaySeconds
The DelaySeconds parameter works, the SQS console is just ignoring it due to a bug. See my reply on https://forums.aws.amazon.com/thread.jspa?threadID=290222 - we will definitely fix that!

And to answer the 5-year old question...  Yes, when the delay time on a message expires it will be delivering on a pending long-poll receive just as a message with no delay would be.

Edited by: robin-aws on Sep 25, 2018 11:11 AM"
Amazon Simple Queue Service	"Can't send messages over Amazon SQS
Using Tomcat server version 8.0.53, JDK 1.8 for the server and to compile the application. Using Amazon SQS to send messages to another application, stopped working after upgrading to JDK 1.8.
Tried to simulate the environments with exact versions of the server and JDK, SQS working fine on my local server and working on one of the remote servers as well. But still not working on the server in question, despite simulating the environment exactly. 
Including the produced exception stack trace:


com.amazonaws.SdkClientException: Unable to execute HTTP request: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.handleRetryableException(AmazonHttpClient.java:1114)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeHelper(AmazonHttpClient.java:1064)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.doExecute(AmazonHttpClient.java:743)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeWithTimer(AmazonHttpClient.java:717)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.execute(AmazonHttpClient.java:699)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.access$500(AmazonHttpClient.java:667)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutionBuilderImpl.execute(AmazonHttpClient.java:649)
	at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:513)
	at com.amazonaws.services.sqs.AmazonSQSClient.doInvoke(AmazonSQSClient.java:2013)
	at com.amazonaws.services.sqs.AmazonSQSClient.invoke(AmazonSQSClient.java:1989)
	at com.amazonaws.services.sqs.AmazonSQSClient.executeSendMessageBatch(AmazonSQSClient.java:1698)
	at com.amazonaws.services.sqs.AmazonSQSClient.sendMessageBatch(AmazonSQSClient.java:1674)
	at com.syngenta.sqc_is.integration.util.SQSQueue.generateAndSendBatch(SQSQueue.java:178)
	at com.syngenta.sqc_is.integration.util.SQSQueue.SendMessagesBatch(SQSQueue.java:146)
	at com.syngenta.sqc_is.web.utils.core.AmsUtils.callSQSService(AmsUtils.java:105)
	at com.syngenta.sqc_is.service.results.impl.ResultServiceImpl.saveResults(ResultServiceImpl.java:408)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy34.saveResults(Unknown Source)
	at com.syngenta.sqc_is.web.controller.results.UploadResultsController.saveResults(UploadResultsController.java:287)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.servlet.mvc.multiaction.MultiActionController.invokeNamedMethod(MultiActionController.java:471)
	at org.springframework.web.servlet.mvc.multiaction.MultiActionController.handleRequestInternal(MultiActionController.java:408)
	at org.springframework.web.servlet.mvc.AbstractController.handleRequest(AbstractController.java:153)
	at org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter.handle(SimpleControllerHandlerAdapter.java:48)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:919)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:851)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:953)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:855)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:829)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:292)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:207)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:240)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:207)
	at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:264)
	at org.acegisecurity.intercept.web.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:107)
	at org.acegisecurity.intercept.web.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:72)
	at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:274)
	at org.acegisecurity.ui.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:110)
	at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:274)
	at org.acegisecurity.ui.AbstractProcessingFilter.doFilter(AbstractProcessingFilter.java:217)
	at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:274)
	at org.acegisecurity.context.HttpSessionContextIntegrationFilter.doFilter(HttpSessionContextIntegrationFilter.java:191)
	at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:274)
	at org.acegisecurity.util.FilterChainProxy.doFilter(FilterChainProxy.java:148)
	at org.acegisecurity.util.FilterToBeanProxy.doFilter(FilterToBeanProxy.java:90)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:240)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:207)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:212)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:94)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:492)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:141)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
	at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:88)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:502)
	at org.apache.coyote.ajp.AbstractAjpProcessor.process(AbstractAjpProcessor.java:870)
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:684)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1539)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1495)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192)
	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1964)
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:328)
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:322)
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1614)
	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:216)
	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:1052)
	at sun.security.ssl.Handshaker.process_record(Handshaker.java:987)
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1072)
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1385)
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1413)
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1397)
	at org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:396)
	at org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:355)
	at com.amazonaws.http.conn.ssl.SdkTLSSocketFactory.connectSocket(SdkTLSSocketFactory.java:132)
	at org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:142)
	at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:359)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at com.amazonaws.http.conn.ClientConnectionManagerFactory$Handler.invoke(ClientConnectionManagerFactory.java:76)
	at com.amazonaws.http.conn.$Proxy31.connect(Unknown Source)
	at org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:381)
	at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:237)
	at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)
	at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)
	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)
	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)
	at com.amazonaws.http.apache.client.impl.SdkHttpClient.execute(SdkHttpClient.java:72)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeOneRequest(AmazonHttpClient.java:1236)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeHelper(AmazonHttpClient.java:1056)
	... 78 more
Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:397)
	at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:302)
	at sun.security.validator.Validator.validate(Validator.java:262)
	at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:324)
	at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:229)
	at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:124)
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1596)
	... 105 more
Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.provider.certpath.SunCertPathBuilder.build(SunCertPathBuilder.java:141)
	at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:126)
	at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:280)
	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:392)
	... 111 more"
Amazon Simple Queue Service	"Re: Can't send messages over Amazon SQS
The error message mentions problems validating the server certificate:
com.amazonaws.SdkClientException: Unable to execute HTTP request: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target

This is most likely caused by the misconfiguration of Java certificate trust store on your server. It seems there are some ideas on how to troubleshoot this issue here:
https://stackoverflow.com/questions/9210514/unable-to-find-valid-certification-path-to-requested-target-error-even-after-c"
Amazon Simple Queue Service	"Not Able to Receive Messages from SQS
In my queue contains more than 2800 messages. But not able to retrieve from SQS..
Am not able to find which situation this occurred. Please help me to resolve this issue"
Amazon Simple Queue Service	"Re: Not Able to Receive Messages from SQS
Thanks for your request. If you are able to provide additional info, we can help determine what the issue is. Can you describe how you are trying to receive the messages? Are you using the AWS console (have you tried using the console?) or have you written an application using one of the AWS SDKs?

Thanks,
-Jerry"
Amazon Simple Queue Service	"Re: Not Able to Receive Messages from SQS
Hi,
I am facing the same issue. 
Have a python client for SQS FIFO queue. Both client and queue are in same aws region. 
very few times the receive_message fetches the messages and many times not.
Once the messages are retrieved, next several times no messages are returned? 
Is this problem with AWS SQS performance? 
Why is it so?
Sample request:

response = sqs.receive_message(
                QueueUrl=queue_url,
                MaxNumberOfMessages=10,
                WaitTimeSeconds=5,
                #AttributeNames= ,
        )

Tried increasing wait time to 20 seconds, but no use.

This is causing me a big problem now. Kindly help me out."
Amazon Simple Queue Service	"Amazon SQS only triggers one lambda at a time
Hi, I have a queue in amazon SQS with two lambdas that should be triggering when a message is received, but only one of them is being triggered. 
First message -> triggers lambda A
Second message -> triggers lambda B
Third message -> triggers lambda A
...
I don't know if I am doing something wrong with the lambdas (callback, context or something like that) or it is just a functionality that is not currently done. Any feedback is appreciated. Thank you."
Amazon Simple Queue Service	"Re: Amazon SQS only triggers one lambda at a time
If you want to have two different lambdas, where each one consumes every message, you should use two SQS queues and sent two copies of the message (one to each queue). You can use SNS to publish a single message to both SQS queues, so your code will still send just one copy of the message."
Amazon Simple Queue Service	"SQS as a source for lambda and concurrency
I'm trying to integrate SQS and lambda (and it's cool!) 
each 5 minutes, about 100 messages are added to a queue. I would like a lambda to be invoked but with a maximum concurrency of 2. 

It works well but the lambda throttles. I don't know why but it takes a very long time for throttle message to be try again. I think it's related to the message visibility but the problem if that if I set it too small, the message goes to failed queue (after 3 tries).

So, I would like my messages to be consumed by 2 lambda maximum. But each lambda execution takes about 3sec. I would like them to be invoked as soon as possible after the concurrency is below 2. But currently the system seems to wait a lot of time between retries.

How can I reduce the time between retries without making the messages to failed after 3 tries?
thanks

Edited by: jeromecance on Jul 26, 2018 1:27 PM"
Amazon Simple Queue Service	"Re: SQS as a source for lambda and concurrency
Had a similar issue, it seems there's no way to configure the behavior of SQS polling on CloudWatch Events, so it polls all SQS messages and tries to calls Lambda. 

Therefore if you put 100 messages on SQS with 1 Lambda concurrency, 1) CloudWatch Events attempts to fetch all 100 messages ASAP,  then 2) calls Lambda, so that 3) it get rejected by Lambda's concurrency limit, 4) which makes most of the SQS messages to go to dead letter queue.

In my case, passing reasonable DelaySeconds attribute on SQS sendMessage made CloudWatch Events to poll the minimum number of messages.

    for(var i=1; i <= 100; i++) {
        var params = {
            // here, delaying SQS message so that CloudWatch Events receives 
            // the number of messages that matches Lambda concurrency limit.
            DelaySeconds: i * 10,          
            MessageBody: 'whatever..',
            QueueUrl: ""https://sqs.us-west-2.amazonaws.com/my-queue""
        };
 
        sqs.sendMessage(params);
    }


Please note that this approach is only available when you could accurately estimate the number of incoming messages and duration of each Lambda invocation, and will NOT work if the incoming messages are uncontrollable."
Amazon Simple Queue Service	"Cloudwatch can't tell time
Either I'm missing something obvious, or Cloudwatch can't get it's time information right.

I posted a message to an SQS queue at around 00:45 local time (GMT-4), as shown in the log.jpg attachment.  Cloudwatch is showing it as arriving before 21:00, which I'm guessing means it thinks the time was 20:45. (seen in the cloudwatch.jpg attachment).

What's going on with this?"
Amazon Simple Queue Service	"Re: Cloudwatch can't tell time
It looks like your period might be set to 15 minutes. A period is the length of time associated with a specific Amazon CloudWatch statistic. Each statistic represents an aggregation of the metrics data collected for a specified period of time. For SQS the minimum period is 5 minutes."
Amazon Simple Queue Service	"Re: Cloudwatch can't tell time
My point was the time recorded for the event is wrong in the graph. It's showing 1 message 21:00, but nothing was sent at that time."
Amazon Simple Queue Service	"Unable to see messages in dead letter queue
Hi,

I have created a FIFO queue using the console. Once the queue was created, I configured it dead letter queue with ""Maximum Receives"" of 3 and the ""Dead Letter Queue"" name I set to my FIFO queue.
I only see my FIFO queue and unable to see the dead letter nor its messages.
Another thing which doesn't work (bug?) is when I am trying to configure DL queue in the page I am creating my queue (using AWS console). I am getting error: ""Specify the name of an existing dead letter queue that matches the type of the source queue.""

Thanks,"
Amazon Simple Queue Service	"Re: Unable to see messages in dead letter queue
Can you provide more details?

When configuring a DLQ, both the source queue and the DLQ have to already exist. The DLQ is not created automatically."
Amazon Simple Queue Service	"SQS getting list of queues with count in it
We are using SQS for our priority queue based implementation. For this we require creating multiple queues and would require the count in each queue to help us identify which queue to pick from. Currently list queues api does not give the count in each queue so we have to do a seperate call to each queue to get the count. Can this be done in the list queues api to speed up this process for us?"
Amazon Simple Queue Service	"SQS - Lambda Integration with CloudFormation
Is this feature able to be configured with CloudFormation (or is it in the works?)

From the Lambda CloudFormation documentationhttps://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-eventsourcemapping.html it looks like only Kinesis and DynamoDB are supported at this time."
Amazon Simple Queue Service	"SQS 500 error - We encountered an internal error. While receiving messages
Sometimes our application get:
AmazonSQSException: We encountered an internal error. Please try again
while receiving messages from a queue.
I have dozen EC2 instances which read messages from SQS and sometimes 5-6 hosts get the above Exception simultaneously.

Stacktrace:
2018-07-09T14:22:45.761Z [main] java.util.concurrent.ExecutionException: com.amazonaws.services.sqs.model.AmazonSQSException: We encountered an internal error. Please try again. (Service: AmazonSQS; Status Code: 500; Error Code: InternalError; Request ID: d1f39947-a9bc-5c5c-8c1f-cafad84d4bb7)
	at java.util.concurrent.FutureTask.report(FutureTask.java:122) ~[?:1.8.0_121]
	at java.util.concurrent.FutureTask.get(FutureTask.java:206) ~[?:1.8.0_121]
	at com.myapp.worker.WorkerMain.initialize(WorkerMain.java:198) [worker-0.9-SNAPSHOT.jar:?]
	at com.myapp.worker.WorkerMain.main(WorkerMain.java:45) [worker-0.9-SNAPSHOT.jar:?]
Caused by: com.amazonaws.services.sqs.model.AmazonSQSException: We encountered an internal error. Please try again. (Service: AmazonSQS; Status Code: 500; Error Code: InternalError; Request ID: d1f39947-a9bc-5c5c-8c1f-cafad84d4bb7)
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.handleErrorResponse(AmazonHttpClient.java:1639) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeOneRequest(AmazonHttpClient.java:1304) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeHelper(AmazonHttpClient.java:1056) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.doExecute(AmazonHttpClient.java:743) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeWithTimer(AmazonHttpClient.java:717) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.execute(AmazonHttpClient.java:699) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutor.access$500(AmazonHttpClient.java:667) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient$RequestExecutionBuilderImpl.execute(AmazonHttpClient.java:649) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:513) ~[aws-java-sdk-core-1.11.263.jar:?]
	at com.amazonaws.services.sqs.AmazonSQSClient.doInvoke(AmazonSQSClient.java:2013) ~[aws-java-sdk-sqs-1.11.263.jar:?]
	at com.amazonaws.services.sqs.AmazonSQSClient.invoke(AmazonSQSClient.java:1989) ~[aws-java-sdk-sqs-1.11.263.jar:?]
	at com.amazonaws.services.sqs.AmazonSQSClient.executeReceiveMessage(AmazonSQSClient.java:1471) ~[aws-java-sdk-sqs-1.11.263.jar:?]
	at com.amazonaws.services.sqs.AmazonSQSClient.receiveMessage(AmazonSQSClient.java:1447) ~[aws-java-sdk-sqs-1.11.263.jar:?]
	at com.myapp.worker.service.AwsSqsService.getMessagesFromQueue(AwsSqsService.java:119) ~[worker-0.9-SNAPSHOT.jar:?]
	at com.myapp.worker.dispatcher.MessageDispatcher.dispatchMessage(MessageDispatcher.java:134) ~[worker-0.9-SNAPSHOT.jar:?]
	at com.myapp.worker.dispatcher.MessageDispatcher.call(MessageDispatcher.java:88) ~[worker-0.9-SNAPSHOT.jar:?]
	at com.myapp.worker.dispatcher.MessageDispatcher.call(MessageDispatcher.java:36) ~[worker-0.9-SNAPSHOT.jar:?]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_121]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]
	at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_121]

I dont know QueueName/Url in this case.
The region is us-east-1.

And the next Request ID: a67a907c-f29e-5562-a785-c3c1836b56c4
with the same stacktrace we got from another EC2 instance at the same time.

I'm afraid maybe we have reached some of SQS limits.
We get AmazonSQSException(We encountered an internal error
2-3 times per month."
Amazon Simple Queue Service	"Re: SQS 500 error - We encountered an internal error. While receiving messages
This issue is still actual"
Amazon Simple Queue Service	"What is the better way to use polling service for SQS on EC2
Hi, 

I have an SQS queue which gets messages, based on the message content i need to call an api which is hosted on EC2 server. For this i had created a polling service on EC2 which will poll continuously checking for new messages in QUEUE. 
Is there any better approach or service which can trigger api once a queue gets message.

Thanks,
-Jackson

Edited by: jacksoncoutinho on Jul 17, 2018 8:11 AM"
Amazon Simple Queue Service	"SQS only triggers lambda once, with an empty queue?
Not sure if bug, config error or just confusion. The following is in us-east-1 region.

I have a lambda function that adds a message to an SQS queue. The SQS queue is configured to trigger a second lambda function (nodejs). The trigger works, but when my function tries to retrieve a message (sqs.receiveMessage) there is nothing in the queue (response.Messages does not exist). It does not seem to trigger lambda again after that (according to cloudwatch logs).

Delay is set to 0. I have WaitTimeSeconds set to 3 seconds, visbilitytimeout is 15, maxnumberofmessages is 1. (I just want to retrieve and process 1 message at a time). Lambda script was running for just over 3 seconds.

I tried again with wattimeseconds set to 20 seconds (and script execution time set to 40). This time the lambda script was running for about 20 seconds but still the same result: no messages in the queue and the lambda was only triggered once. I am unable to set it higher than 20 seconds. It also seems very wasteful to leave the lambda function running for any number of seconds.

in the SQS gui its also not showing any messages ""available"" or ""in flight"", both are 0 throughout this process.

The message was certainly created, as I have a message ID returned in the first lambda script and there is the cloudwatch log for the 1 request. But it seems like the trigger is happening before the sqs message is ready for pick up.

If i disable the trigger function and run my first lambda script, I see a 1 appear almost immediately in the ""available"" column of the SQS gui. I can then run my 2nd lambda script manually which proceeds to find and process the message as planned. 

So the bug/config issue/confusion seems to be limited to the lambda trigger function of SQS. 

Please advise, this is somewhat critical for my current project."
Amazon Simple Queue Service	"Re: SQS only triggers lambda once, with an empty queue?
resolved, the message is included in the params that the lambda function is called with, so there is no need to query sqs to retrieve messages. 

i dont know if a new instance of the lambda function is called for each item added to sqs or if multiple messages might be bundled in a single trigger, i still need to test that."
Amazon Simple Queue Service	"SQS FIFO for Sydney Region?
Dear AWS,

We're developing an M2M/IoT telematics solution. The solution is already in production, and we are using SQS, but we could really benefit from the use of the SQS FIFO queue.

Any ETA for Sydney? We would really not prefer to have to resort to another solution like RabbitMQ, as SQS is otherwise working well for us.

Happy for any AWS folk to reach out if you would like to discuss out requirements more!

-Steve"
Amazon Simple Queue Service	"Re: SQS FIFO for Sydney Region?
Still hanging out for FIFO support for the Sydney region...

Is this being considered?"
Amazon Simple Queue Service	"please help: SQS cannot receive message from SNS with ""Principal"":""*"",
Hi,

I'm having a sqs queue subscribed to a sns topic with the following setting:
    {
      ""Effect"": ""Allow"",
      ""Principal"": ""*"",
      ""Action"": ""sqs:SendMessage"",
      ""Condition"": {
        ""ArnEquals"": {
          ""aws:SourceArn"": ""${arn_of_the_topic}""
        }
      }
    }

i'm also able to see the permission is being added to the queue from console as 
Allow	Everybody (*)    sqs:SendMessage   ArnEquals  aws:SourceArn: ""arn_of_the_topic""


but messages sent to the topic is not in the queue
(while manually sending messages to the queue and email subscription of the topic both work)
am i having anything misconfigured here?

thanks!

Edited by: sd1053774 on Jun 6, 2018 10:35 AM"
Amazon Simple Queue Service	"Re: please help: SQS cannot receive message from SNS with ""Principal"":""*"",
deleted

Edited by: sd1053774 on Jul 11, 2018 4:00 PM"
Amazon Simple Queue Service	"How to see which signature version we use to connect to each queue
We recently received a message from Amazon Web Services with the subject, ""Amazon SQS to deprecate Signature Version 1 (SIGV1) by July 13, 2018"".

We have several queues and use various tools (Java SDK, boto, AWS CLI) to connect to these. Is there a way to find out which queues we connect to with calls that are signed by SIGV1? This would be helpful to narrow down what code and tools we need to upgrade in the next few weeks.

Thanks for any assistance,
Jim Sizelove"
Amazon Simple Queue Service	"Re: How to see which signature version we use to connect to each queue
We're looking for the information too. Can anyone from AWS comment on this?"
Amazon Simple Queue Service	"SQS Receive Message
In a SQS Queue have the 16 messages,to receive through request object set the maximum num of messages as 10 but the no.of messages receives only 1 or 2 something.Is there any posible way to receive the 10 messages?"
Amazon Simple Queue Service	"Re: SQS Receive Message
Hi.
The MaxNumberOfMessages attribute force to never returns more messages than this value. However, fewer messages might be returned. I think there is no way to force this maximum value.

Edited by: fcastanon on Jul 4, 2018 11:27 AM"
Amazon Simple Queue Service	"Enforce connection over HTTPS not HTTP
Is it possible to ensure that client connections to SQS must be using HTTPS and not via HTTP?

My SQS queue has an endpoint URL beginning with HTTPS, but I can still connect via CLI using HTTP protocol.

Thanks"
Amazon Simple Queue Service	"Re: Enforce connection over HTTPS not HTTP
You can do this by creating a ""Deny"" policy on your queue that matches unencrypted requests.

{
  ""Version"": ""2012-10-17"",
  ""Id"": ""arn:aws:sqs:us-west-2:0123456789012:queue_name/policy_id"",
  ""Statement"": [
    {
      ""Sid"": ""Sid01234567890"",
      ""Effect"": ""Deny"",
      ""Principal"": ""*"",
      ""Action"": ""SQS:*"",
      ""Resource"": ""arn:aws:sqs:us-west-2:0123456789012:queue_name"",
      ""Condition"": {
        ""Bool"": {
          ""aws:SecureTransport"": ""false""
        }
      }
    }
  ]
}


Here's the reference for all conditional operators in policies, with example for a boolean check:
https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition_operators.html#Conditions_Boolean

Here's a list of special variables you can use in policies:
https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_variables.html#policy-vars-infotouse"
Amazon Simple Queue Service	"Re: Enforce connection over HTTPS not HTTP
Fabulous, thanks for your help"
Amazon Simple Queue Service	"SQS Message IDs and sequence numbers are duplicated
Looking in my logs I find that a sequence of messages sent to the SQS queue have duplicate message_id and sequence_number despite the md5_of_message_body being different in all cases. There are no other messages in-between these messages and they were received correctly but it seems wrong that I am unable to uniquely identify a message. Is this expected behaviour? 

The application is in Ruby if that might be an issue

I, [2018-07-02T18:01:39.707770 #17651] Response: #<struct Aws::SQS::Types::SendMessageResult md5_of_message_body=""e183d4c9972ed8c40d5134474476f1db"", md5_of_message_attributes=""90c6d8330a9c09590932001c28bf1819"", message_id=""1c785c68-3d0d-4024-bf33-bbe2bdae57e2"", sequence_number=""18838566025626863616"">
I, [2018-07-02T18:01:39.729200 #17651] Response: #<struct Aws::SQS::Types::SendMessageResult md5_of_message_body=""cf5d2236d6ad6a57754ff6a3ff48e54f"", md5_of_message_attributes=""90c6d8330a9c09590932001c28bf1819"", message_id=""1c785c68-3d0d-4024-bf33-bbe2bdae57e2"", sequence_number=""18838566025626863616"">
I, [2018-07-02T18:01:39.749952 #17651] Response: #<struct Aws::SQS::Types::SendMessageResult md5_of_message_body=""4ec2b1449fe5f8af334f62f0cdade86d"", md5_of_message_attributes=""90c6d8330a9c09590932001c28bf1819"", message_id=""1c785c68-3d0d-4024-bf33-bbe2bdae57e2"", sequence_number=""18838566025626863616"">
I, [2018-07-02T18:01:39.771481 #17651] Response: #<struct Aws::SQS::Types::SendMessageResult md5_of_message_body=""18c7a675eec09a79f97e784faa0cf8ac"", md5_of_message_attributes=""90c6d8330a9c09590932001c28bf1819"", message_id=""1c785c68-3d0d-4024-bf33-bbe2bdae57e2"", sequence_number=""18838566025626863616"">"
Amazon Simple Queue Service	"Is there anything which allow me to access my on premises services over aws
i am trying to connect to my .net services which are already in my private network(On premises)
with AWS service (like web service hosted in AWS Elastic Beanstalk) but i tried with everything which u provide (Notes) but didn't get anything.

it's as simple like azure relay service(Service Bus), so do u have anything like that or similar to it.

please let me know earlier because i am trying from few days.

Thanks."
Amazon Simple Queue Service	"Re: Is there anything which allow me to access my on premises services over aws
Take a look at this comparison of available messaging services:

https://aws.amazon.com/messaging/"
Amazon Simple Queue Service	"Re: Is there anything which allow me to access my on premises services over aws
Let me provide a broader answer.

You can use our messaging services mentioned at https://aws.amazon.com/messaging and use queues, topics or message brokers to exchange information between your software components. 

Here's an example article explaining how you can use AmazonMQ to connect your on-premise software with your cloud hosted software: https://aws.amazon.com/blogs/compute/running-activemq-in-a-hybrid-cloud-environment-with-amazon-mq/

Or you can establish a more direct connection between software on-premise and software running inside your cloud VPC network by utilizing VPN connections, more details can be found here:
https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpn-connections.html"
Amazon Simple Queue Service	"Long wait for receiveMessage to return with lots of messages in queue
Hi,
So I have a queue with a lot of messages in it. Each ~10-15 min I see a weird behavior that when trying to receive messages from queue, it takes sometimes about 4 min to the call to return.

I am using the latest 1.11.337 aws sdk. 
Wait time seconds = 20 sec
There are no thread.sleep() in my code 
The behavior is replicated on different types of servers. 

Please advise"
Amazon Simple Queue Service	"Re: Long wait for receiveMessage to return with lots of messages in queue
How many threads do you have polling for messages? This may be a case where you should increase the max number of concurrent HTTP connections the SDK is allowed to make to SQS:
https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/section-client-configuration.html#maximum-connections

By default this is set to 50.

Your client side code may be waiting for those connections before making requests, contributing to longer perceived request times."
Amazon Simple Queue Service	"Re: Long wait for receiveMessage to return with lots of messages in queue
Hello,
I have set the max connections to 100 to check if it solves the problem. Unfortunately it didn't. The behavior persists."
Amazon Simple Queue Service	"SQS without SSE - Data security
Hi,

My organisation is currently looking at using SQS in a region (EU-west-2) which does not support SSE (Server Side Encryption), and we are wondering what the recommendation from AWS is on using SQS to move around PII (personal identifiable information) on an SQS queue?

If AWS do not recommend using SQS without encryption, would it be possible to provide an alternative service solution in the above region, or an estimate on when the SQS SSE will be available?

Kind Regards,

Dan"
Amazon Simple Queue Service	"Re: SQS without SSE - Data security
We are actively working on getting the SSE functionality out to EU-WEST-2, but I can't comment on a timeline at the moment.

In the mean time, can you leverage client side encryption? Here is an example with S3, but with some minor changes, you can do the same for messages you send to SQS: https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingClientSideEncryption.html."
Amazon Simple Queue Service	"Intermittent connection timeouts on sendMessages API calls
For the last two or three days we are seeing intermittent timeouts on sendMessage API calls. Using the AWS JS SDK, about 5-10% of our sendMessage requests take over two minutes.

The initial request eventually fails with ETIMEDOUT on the connnect() call, then the SDK retries and it succeeds.

I've logged out the error that the SDK is receiving:

error:
      { Error: connect ETIMEDOUT 54.239.27.172:443
          at Object.exports._errnoException (util.js:1020:11)
          at exports._exceptionWithHostPort (util.js:1043:20)
          at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1105:14)
        message: 'connect ETIMEDOUT 54.239.27.172:443',
        code: 'NetworkingError',
        errno: 'ETIMEDOUT',
        syscall: 'connect',
        address: '54.239.27.172',
        port: 443,
        region: 'us-east-1',
        hostname: 'sqs.us-east-1.amazonaws.com',
        retryable: true,
        time: 2018-05-08T20:55:08.568Z },


[AWS sqs 200 127.383s 1 retries] sendMessage({ MessageBody: '<body removed>'


Are there any known network connectivity issues with SQS in us-east-1?

Edited by: jn-accusoft on May 8, 2018 10:32 PM"
Amazon Simple Queue Service	"IAM Related SQS question
I have a need to give console access to couple of members of my team to manage queues only if they are named starting with gar (gar*). What's the best way to do this?

Currently I have this policy but it doesnt work -

        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""sqs:*""
            ],
            ""Resource"": [
                ""arn:aws:sqs:::gar*""
            ]
        },
        {
            ""Sid"": ""VisualEditor1"",
            ""Effect"": ""Allow"",
            ""Action"": [
                ""sqs:List*"",
                ""kms:List*""
            ],
            ""Resource"": ""*""
        }

Any help is appreciated 

Swapan

Edited by: SwapanG on Apr 25, 2018 3:53 PM"
Amazon Simple Queue Service	"What is a 'SNS Account'?
Re this thread https://forums.aws.amazon.com/thread.jspa?threadID=280287&tstart=0

Kuba@AWS mentioned ""that the call to SQS to SendMessage will come from the SNS account, not from your account.""

I'm curious to understand more about this 'SNS account'? 
Is it a AWS-owned account that's separated from any user account?"
Amazon Simple Queue Service	"Re: What is a 'SNS Account'?
You can find some more information about Service Principals here:
https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html

Look for the section titled ""AWS service""."
Amazon Simple Queue Service	"SQS cannot receive message from SNS
hi!

I've created a sns topic subscription through terraform like:

resource ""aws_sns_topic_subscription"" ""test-subscriptions"" {
  topic_arn = ""arn:aws:sns:us-west-2:555555555555:topic-foo""
  protocol  = ""sqs""
  endpoint  = ""arn:aws:sqs:us-west-2:555555555555:queue-bar""
}


and on the queue I'm having a policy of:
""Version"": ""2012-10-17"",
  ""Statement"": [
    {
      ""Effect"": ""Allow"",
      ""Principal"": {""AWS"": ""arn:aws:iam::555555555555:root""},
      ""Action"": ""SQS:SendMessage"",
      ""Condition"": {
        ""ArnEquals"": {
          ""aws:SourceArn"": ""arn:aws:sns:us-west-2:555555555555:topic-foo""
        }
      }
    }
  ]


but notification published to this topic is not received by the queue, although the email subscription to the same topic is working fine. 

Any suggestions on what might be wrong here?"
Amazon Simple Queue Service	"Re: SQS cannot receive message from SNS
Check out the example here:
https://docs.aws.amazon.com/sns/latest/dg/SendMessageToSQS.html#SendMessageToSQS.sqs.permissions

In your case your policy limits access to the root user of your own account. It should instead have
""Principal"": ""*""

Remember, that the call to SQS to SendMessage will come from the SNS account, not from your account."
Amazon Simple Queue Service	"Re: SQS cannot receive message from SNS
Many thanks!

With that, are we still limiting the queue is only receiving notifications from topic in the same account? (I guess so, by having the SourceArn condition?)

Also, how does a 'SNS account' differ from my account?

Edited by: sd1053774 on Apr 20, 2018 11:27 AM"
Amazon Simple Queue Service	"amazon-sqs-java-messaging-lib takes 2 messages at start
I am reading SQS queue with amazon-sqs-java-messaging-lib and @JmsListener.

My configuration is the following:

@Configuration
@EnableJms
public class JmsConfig {
  @Bean
  public SQSConnectionFactory connectionFactory(AmazonSQS amazonSQS) {
    return new SQSConnectionFactory(new ProviderConfiguration(), amazonSQS);
  }
 
  @Bean
  public JmsTemplate jmsTemplate(SQSConnectionFactory connectionFactory) {
    return new JmsTemplate(connectionFactory);
  }
 
  @Bean
  public DefaultJmsListenerContainerFactory jmsListenerContainerFactory(SQSConnectionFactory connectionFactory,
                                                                        MessageConverter converter) {
    DefaultJmsListenerContainerFactory factory = new DefaultJmsListenerContainerFactory();
    factory.setMaxMessagesPerTask(1);
    factory.setConnectionFactory(connectionFactory);
    factory.setDestinationResolver(new DynamicDestinationResolver());
    factory.setConcurrency(""1"");
    factory.setSessionAcknowledgeMode(Session.CLIENT_ACKNOWLEDGE);
    factory.setMessageConverter(converter);
    return factory;
  }
}


Here I mean that I want to process messages strictly one-by-one.

I'm working on the use-case when my queue contains several messages and the application starts.

When the application connects to the queue it takes 2 messages at the very beginning. Afterwards it consumes one-by-one but the number of messages In Flight is always 2.

(I tried to debug and looks like SQSMessageConsumerPrefetch misses its first reading)

Is it my bad configuration or is it a real issue? Thank you"
Amazon Simple Queue Service	"SQS - Unique names
Hi there - Does SQS require globally unique names, similar to that of S3 buckets? If so, how do developers push their code (SQS Queues) from dev, test and production without needing to change the SQS Queue each and everytime there is a development change?  Thanks!"
Amazon Simple Queue Service	"Re: SQS - Unique names
A queue is uniquely identified by it's QueueUrl, which is composed of AWS region name, account id and queue name, for example:
https://sqs.us-east-2.amazonaws.com/123456789012/MyQueue

This means that the name has to be unique within your account and region. You can have the same queue name in multiple regions and multiple accounts.

I'll follow up with our documentation team to make the uniqueness requirement here more specific:
https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-general-identifiers.html"
