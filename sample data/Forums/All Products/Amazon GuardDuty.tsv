label	description
Amazon GuardDuty	"Amazon Macie with Amazon Lambda
Hi Team, 
Is it possible to query Amazon Macie from a lambda function to get the metadata of the file? I.e. we do not want to have to login to Macie's dashboard daily to review the scan results. But want to create a lambda function that can give us back the scan results like file_name, PII detected and risk ranking. 

Best, 
Tony"
Amazon GuardDuty	"Re: Amazon Macie with Amazon Lambda
Hello Tonyz, 

Currently, the results of content classifications are only accessible through Macie console. As a workaround, you could create a custom rule to alert you on any risky Amazon S3 objects. Amazon Macie presents all alerts/findings in the console and sends a copy to CloudWatch Events (CWE). You can set a rule in CWE to trigger a Lambda function to further analyze the detected sensitive information. Please refer to this blog post to learn how you can create your custom rule in Amazon Macie (https://aws.amazon.com/blogs/security/how-to-create-custom-alerts-with-amazon-macie/).   

Thank You 
Zaher"
Amazon GuardDuty	"Re: Amazon Macie with Amazon Lambda
Hi Zaher, 

Thanks for your response. I was able to setup CWE to trigger a Lambda function that parse the object name in S3 and its DLP risk score. However, I noticed that Macie could classify more than one S3 object at a time and it is difficult to parse the CWE because the DLP aggregates the risk score. Do you know if we can configure Macie to classify one object at a time or if there is an alternative way to format the CWE?

{
  ""summary"": {
    ""Description"": ""Potential DLP Risk in S3 files. "",
    ""Object"": {
      ""s3_object_1"": 1,
      ""s3_object_2"": 1,
      ""s3_object_3"": 1,
      ""s3_object_4"": 1
    },
    ""Record Count"": 28,
    ""DLP risk"": {
      ""0"": 2,
      ""3"": 1,
      ""5"": 1
    }
  }
}

Edited by: tonyz on Oct 26, 2018 10:02 AM"
Amazon GuardDuty	"Get PII text from Macie
Hi Team,
Good day.
I have 4 queries regarding Macie. 

1. When I give an address in a file and upload to S3, Macie is not classifying it as an address. Ex. 242 George Plaza,East Lawrencefurt, VA 37287-7620. Can you let me know how to get it enabled or make changes so that it classifies it as an address.
2. How do we extract the PII information (or the line number) from the file. Example if my text file has a credit card number, can I get the credit card number or the line number where it is present. 
3. How do we send the PII alerts as email from Macie to users with the details like the file name and the violations. (not the cloudwatch event with only sev and details)
4. What all information are classified as PII , does gender, vehicle reg number, ethinicity etc are classified as PII.

Regards,
Preetish

Edited by: Preetish on Jun 18, 2018 11:43 AM

Edited by: Preetish on Jun 18, 2018 8:33 PM"
Amazon GuardDuty	"Re: Get PII text from Macie
Hi
I have the same question to Amazon Macie. How to get the detailed email, phone, or ssn from a file? where do these PIIs save? The Alerts won't help me a lot since I don't know if the Macie catches the right PII or not. If somebody knows the answer, please let me know.  
Many thanks!

Tiger"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Preetish, 

here are answers to your queries: 
1- Macie uses ML to detect addresses. The model is trained to detect actual addresses in the US. Recently, we updated the model to include addresses in other regions such as EU and South America and enhanced the recall rate. I recommend that you try your test again. 

2- Currently, Macie flags the Amazon S3 objects with sensitive data. We have a roadmap item to provide more information on where in the file, if possible, the credit card was found. We are not planning to retain any sensitive data within Macie. You are required to refer to the S3 object to inspect the detected sensitive data. 

3- Macie in integrated with CloudWatch Events. You can use this integration to send emails to your users. We are working on augmenting the finding/alert format to include more details about the impacted resource.

4- Macie PII definition is outlined in our documentation (https://docs.aws.amazon.com/macie/latest/userguide/macie-classify-objects-pii.html). 

Zaher"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Tiger, 

Currently, Amazon Macie classifies and discovers the Amazon S3 objects with sensitive information such as PII. The provided results include the type of detected results and the number of distinct matches. We have a roadmap item to enhance the experience by providing more information about the location of the sensitive data in the file to make it easy for you to investigate the findings. Macie does not save any content. Therefore, the service will not report back the actual detected PII information. 

Zaher

Edited by: Zaherataws on Oct 4, 2018 2:01 PM"
Amazon GuardDuty	"Re: Get PII text from Macie
Hi Zaher, 

I have a similar question. I am using a test file to test out Amazon Macie with the following sample data. However, Macie was only able to detect the email address. Any idea why it is not picking up the rest?

718-000-0000
01-01-1900
John Doe
John.doe@someemail.com
5454-5454-5454-5454

Best, 
Tony"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Tonyz, 

Thank you for reaching out to us. Amazon Macie uses multiple techniques to reduce false positives. For example, Macie runs the Luhn Algorithm check on any possible credit card number among other validation checks to report back actual credit numbers. For this reason, your test data was not detected by Macie. 

Zaher"
Amazon GuardDuty	"PHI Data in Macie
Hi, 

Does Macie detect the full 18 PHI attributes. Looking at the documentation I see that the regex is looking for HIPAA PHI National Drug code. 

Best, 
Tony"
Amazon GuardDuty	"Re: PHI Data in Macie
Hello Tonyz, 

Macie can only analyze text. So, all Biometric identifiers and images such as full face photographic images are not supported. Also, identifiers that require customization are not supported. For example, the""account number"" and ""device identifier and serial numbers"" format changes from vendor to another and therefore are not supported. You can find the full list of supported data types by following this link https://docs.aws.amazon.com/macie/latest/userguide/macie-classify-data.html.

Thank You 
Zaher"
Amazon GuardDuty	"Macie realtime?
I've been investigating Macie to detect PII in configured s3 buckets. After documents are uploaded, I don't see indications the data was analyzed for several minutes. Is this average? I was hoping for a response time in the range of seconds."
Amazon GuardDuty	"Re: Macie realtime?
Hello Quest313, 

Thank you for reaching out to us. Macie classifies new objects as soon as CloudTrail reports the PutObject API call. You should expect the results to be present in Macie's console within 60 minutes after uploading the object to Amazon S3. 

Zaher"
Amazon GuardDuty	"Enable Macie
After I created Roles for Macie and CloudTrail enabled, the ""ENABLE MACIE"" button is still not click-able (in grey color), did I miss anything here?

Thanks!"
Amazon GuardDuty	"Re: Enable Macie
NVM. GUI Thing."
Amazon GuardDuty	"Macie for GDPR assessment of data in S3.
Hi,

I'm interested in part of Macie can do.  My company is in the middle of a GDPR assessment to prepare for the upcoming enforcement date in the EU.  

Macie's ability to crawl and classify my data in S3 to identify with PII is lurking could be really helpful. However, similar to how I can instruct Glue to crawl my data in S3 for external table mappings one time or a periodic schedule, I'd like to be able to instruct Macie to just crawl my data in S3 once and then allow us to consume the results without ""automatically"" crawling the new data or doing anything with CloudTrail logs.  Think of it as a batch or on demand crawl/classify task that the customer, not the service, controls when it executes.

Is there any chance Macie could have the capability to do something like this soon?

Bear in mind that GDPR enforcement starts May 25th, 2018.  So to be useful for GDPR assessment the feature would have to be available NLT Feb 1, 2018.  Any later than that and we wouldn't have enough time to react to what Macie discovers in S3 to be GDPR compliant by May 25th.

Thanks,
-Kurt"
Amazon GuardDuty	"Re: Macie for GDPR assessment of data in S3.
Hi Kurt, 

Thanks for your feedback. The ability of only classifying existing content is in our backlog for considerations for future release. We are working on re-prioritizing the planned feature set for 2018. We will take into considerations your proposed time-frame for this feature.  

Cheers, 
Zaher"
Amazon GuardDuty	"Re: Macie for GDPR assessment of data in S3.
Hi Zaher,

Thanks for considering this capability as a feature.  

FWIW, when discussing this at the Macie walk up table at re:Invent there seemed to several AWS customers there that were all interested in the same limited use of Macie to help them too with their GDPR risk assessments of data at rest in S3.

Now that it's in your backlog somewhere, we'll work with out TAM to see if we can't get some confidence about when the feature might become available.  

Thanks,
-Kurrt"
Amazon GuardDuty	"Macie - HIPAA Compliance timeframe
I'm beginning the process of looking into DLP solutions for the healthcare startup I'm in... and I'm wondering what the timeframe for HIPAA compliance is. Do you all have any sense of that? I'd much rather use Macie than some 3rd-party solution."
Amazon GuardDuty	"Re: Macie - HIPAA Compliance timeframe
Hello,
Thanks for reaching out to us. We have escalated this to the service team. We will get back to you as soon as we get any reply from them.

Best Regards,
Masudur Rahaman Sayem"
Amazon GuardDuty	"Re: Macie - HIPAA Compliance timeframe
Hello, 

We are working on getting Amazon Macie HIPAA eligible. However, we do not have a specific date to share at this moment. I will update this thread once we have more information. 

Thank You

Zaher"
Amazon GuardDuty	"Amazon Macie with Amazon Lambda
Hi Team, 
Is it possible to query Amazon Macie from a lambda function to get the metadata of the file? I.e. we do not want to have to login to Macie's dashboard daily to review the scan results. But want to create a lambda function that can give us back the scan results like file_name, PII detected and risk ranking. 

Best, 
Tony"
Amazon GuardDuty	"Re: Amazon Macie with Amazon Lambda
Hello Tonyz, 

Currently, the results of content classifications are only accessible through Macie console. As a workaround, you could create a custom rule to alert you on any risky Amazon S3 objects. Amazon Macie presents all alerts/findings in the console and sends a copy to CloudWatch Events (CWE). You can set a rule in CWE to trigger a Lambda function to further analyze the detected sensitive information. Please refer to this blog post to learn how you can create your custom rule in Amazon Macie (https://aws.amazon.com/blogs/security/how-to-create-custom-alerts-with-amazon-macie/).   

Thank You 
Zaher"
Amazon GuardDuty	"Re: Amazon Macie with Amazon Lambda
Hi Zaher, 

Thanks for your response. I was able to setup CWE to trigger a Lambda function that parse the object name in S3 and its DLP risk score. However, I noticed that Macie could classify more than one S3 object at a time and it is difficult to parse the CWE because the DLP aggregates the risk score. Do you know if we can configure Macie to classify one object at a time or if there is an alternative way to format the CWE?

{
  ""summary"": {
    ""Description"": ""Potential DLP Risk in S3 files. "",
    ""Object"": {
      ""s3_object_1"": 1,
      ""s3_object_2"": 1,
      ""s3_object_3"": 1,
      ""s3_object_4"": 1
    },
    ""Record Count"": 28,
    ""DLP risk"": {
      ""0"": 2,
      ""3"": 1,
      ""5"": 1
    }
  }
}

Edited by: tonyz on Oct 26, 2018 10:02 AM"
Amazon GuardDuty	"Get PII text from Macie
Hi Team,
Good day.
I have 4 queries regarding Macie. 

1. When I give an address in a file and upload to S3, Macie is not classifying it as an address. Ex. 242 George Plaza,East Lawrencefurt, VA 37287-7620. Can you let me know how to get it enabled or make changes so that it classifies it as an address.
2. How do we extract the PII information (or the line number) from the file. Example if my text file has a credit card number, can I get the credit card number or the line number where it is present. 
3. How do we send the PII alerts as email from Macie to users with the details like the file name and the violations. (not the cloudwatch event with only sev and details)
4. What all information are classified as PII , does gender, vehicle reg number, ethinicity etc are classified as PII.

Regards,
Preetish

Edited by: Preetish on Jun 18, 2018 11:43 AM

Edited by: Preetish on Jun 18, 2018 8:33 PM"
Amazon GuardDuty	"Re: Get PII text from Macie
Hi
I have the same question to Amazon Macie. How to get the detailed email, phone, or ssn from a file? where do these PIIs save? The Alerts won't help me a lot since I don't know if the Macie catches the right PII or not. If somebody knows the answer, please let me know.  
Many thanks!

Tiger"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Preetish, 

here are answers to your queries: 
1- Macie uses ML to detect addresses. The model is trained to detect actual addresses in the US. Recently, we updated the model to include addresses in other regions such as EU and South America and enhanced the recall rate. I recommend that you try your test again. 

2- Currently, Macie flags the Amazon S3 objects with sensitive data. We have a roadmap item to provide more information on where in the file, if possible, the credit card was found. We are not planning to retain any sensitive data within Macie. You are required to refer to the S3 object to inspect the detected sensitive data. 

3- Macie in integrated with CloudWatch Events. You can use this integration to send emails to your users. We are working on augmenting the finding/alert format to include more details about the impacted resource.

4- Macie PII definition is outlined in our documentation (https://docs.aws.amazon.com/macie/latest/userguide/macie-classify-objects-pii.html). 

Zaher"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Tiger, 

Currently, Amazon Macie classifies and discovers the Amazon S3 objects with sensitive information such as PII. The provided results include the type of detected results and the number of distinct matches. We have a roadmap item to enhance the experience by providing more information about the location of the sensitive data in the file to make it easy for you to investigate the findings. Macie does not save any content. Therefore, the service will not report back the actual detected PII information. 

Zaher

Edited by: Zaherataws on Oct 4, 2018 2:01 PM"
Amazon GuardDuty	"Re: Get PII text from Macie
Hi Zaher, 

I have a similar question. I am using a test file to test out Amazon Macie with the following sample data. However, Macie was only able to detect the email address. Any idea why it is not picking up the rest?

718-000-0000
01-01-1900
John Doe
John.doe@someemail.com
5454-5454-5454-5454

Best, 
Tony"
Amazon GuardDuty	"Re: Get PII text from Macie
Hello Tonyz, 

Thank you for reaching out to us. Amazon Macie uses multiple techniques to reduce false positives. For example, Macie runs the Luhn Algorithm check on any possible credit card number among other validation checks to report back actual credit numbers. For this reason, your test data was not detected by Macie. 

Zaher"
Amazon GuardDuty	"PHI Data in Macie
Hi, 

Does Macie detect the full 18 PHI attributes. Looking at the documentation I see that the regex is looking for HIPAA PHI National Drug code. 

Best, 
Tony"
Amazon GuardDuty	"Re: PHI Data in Macie
Hello Tonyz, 

Macie can only analyze text. So, all Biometric identifiers and images such as full face photographic images are not supported. Also, identifiers that require customization are not supported. For example, the""account number"" and ""device identifier and serial numbers"" format changes from vendor to another and therefore are not supported. You can find the full list of supported data types by following this link https://docs.aws.amazon.com/macie/latest/userguide/macie-classify-data.html.

Thank You 
Zaher"
Amazon GuardDuty	"Macie realtime?
I've been investigating Macie to detect PII in configured s3 buckets. After documents are uploaded, I don't see indications the data was analyzed for several minutes. Is this average? I was hoping for a response time in the range of seconds."
Amazon GuardDuty	"Re: Macie realtime?
Hello Quest313, 

Thank you for reaching out to us. Macie classifies new objects as soon as CloudTrail reports the PutObject API call. You should expect the results to be present in Macie's console within 60 minutes after uploading the object to Amazon S3. 

Zaher"
Amazon GuardDuty	"Enable Macie
After I created Roles for Macie and CloudTrail enabled, the ""ENABLE MACIE"" button is still not click-able (in grey color), did I miss anything here?

Thanks!"
Amazon GuardDuty	"Re: Enable Macie
NVM. GUI Thing."
Amazon GuardDuty	"Macie for GDPR assessment of data in S3.
Hi,

I'm interested in part of Macie can do.  My company is in the middle of a GDPR assessment to prepare for the upcoming enforcement date in the EU.  

Macie's ability to crawl and classify my data in S3 to identify with PII is lurking could be really helpful. However, similar to how I can instruct Glue to crawl my data in S3 for external table mappings one time or a periodic schedule, I'd like to be able to instruct Macie to just crawl my data in S3 once and then allow us to consume the results without ""automatically"" crawling the new data or doing anything with CloudTrail logs.  Think of it as a batch or on demand crawl/classify task that the customer, not the service, controls when it executes.

Is there any chance Macie could have the capability to do something like this soon?

Bear in mind that GDPR enforcement starts May 25th, 2018.  So to be useful for GDPR assessment the feature would have to be available NLT Feb 1, 2018.  Any later than that and we wouldn't have enough time to react to what Macie discovers in S3 to be GDPR compliant by May 25th.

Thanks,
-Kurt"
Amazon GuardDuty	"Re: Macie for GDPR assessment of data in S3.
Hi Kurt, 

Thanks for your feedback. The ability of only classifying existing content is in our backlog for considerations for future release. We are working on re-prioritizing the planned feature set for 2018. We will take into considerations your proposed time-frame for this feature.  

Cheers, 
Zaher"
Amazon GuardDuty	"Re: Macie for GDPR assessment of data in S3.
Hi Zaher,

Thanks for considering this capability as a feature.  

FWIW, when discussing this at the Macie walk up table at re:Invent there seemed to several AWS customers there that were all interested in the same limited use of Macie to help them too with their GDPR risk assessments of data at rest in S3.

Now that it's in your backlog somewhere, we'll work with out TAM to see if we can't get some confidence about when the feature might become available.  

Thanks,
-Kurrt"
Amazon GuardDuty	"Macie - HIPAA Compliance timeframe
I'm beginning the process of looking into DLP solutions for the healthcare startup I'm in... and I'm wondering what the timeframe for HIPAA compliance is. Do you all have any sense of that? I'd much rather use Macie than some 3rd-party solution."
Amazon GuardDuty	"Re: Macie - HIPAA Compliance timeframe
Hello,
Thanks for reaching out to us. We have escalated this to the service team. We will get back to you as soon as we get any reply from them.

Best Regards,
Masudur Rahaman Sayem"
Amazon GuardDuty	"Re: Macie - HIPAA Compliance timeframe
Hello, 

We are working on getting Amazon Macie HIPAA eligible. However, we do not have a specific date to share at this moment. I will update this thread once we have more information. 

Thank You

Zaher"
Amazon GuardDuty	"GuardDuty x ThreatPipes
We're currently rolling out a beta version of ThreatPipes, a tool that allows security teams to curate and enrich threat intel from any source (threat feeds, Twitter, forums, etc.) and sync it with downstream security tools (inc. AWS GuardDuty).

https://www.threatpipes.com

I'm looking for some additional AWS GuardDuty users who would consider joining our beta to help us better understand GD use-cases. Drop me a PM if you're interested and I can share more info.

Thanks!

Edited by: dgreenwood-intelstitch on Dec 27, 2018 4:51 AM"
Amazon GuardDuty	"Re: GuardDuty x ThreatPipes
Hi everyone,

Thanks to all the users that reached out! The integration is now public:

https://www.threatpipes.com/integrations/aws-guardduty-output/"
Amazon GuardDuty	"Can GuardDuty monitor Lightsail?
Dear Experts,

I'm using Lightsail along with regular EC2 instances because of the lower bandwidth costs.  The two VPCs are bridged and in many ways the Lightsail instances are like regular EC2 instances.  I am using Route53 DNS for everything, not the Lightsail DNS.

What does GuardDuty do in this case?  Will it monitor the Lightsail instances?

Thanks, Phil."
Amazon GuardDuty	"Re: Can GuardDuty monitor Lightsail?
Hi,

Thanks for reaching out.

Lightsail runs on instances not in accounts but rather in AWS-owned accounts. Therefore, GuardDuty would not generate findings for LightSail at the present time.

Thanks!"
Amazon GuardDuty	"GuardDuty Trusted IP list not working
We've been having an issue with GuardDuty recently where it is generating findings for legitimate vulnerability scanning we are doing within our VPC. 

We are using a pre-authorized Nessus Scanner (https://aws.amazon.com/marketplace/pp/B01LXCD58S) within our VPC to perform vulnerability scans on our EC2 instances. During the scans, GuardDuty generates findings for the internal IP of the scanner instance and for the instance ID of the scanner instance, eg ""172.16.0.1 (scanner instance) is performing SSH brute force attacks against i-1a2b3c (target instance)"" and ""i-4d5e6f (scanner instance) is performing SSH brute force attacks against 172.16.2.1 (target instance)."" 

We've tried adding the scanner instance's IP to a trusted IP list per the instructions here (https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_upload_lists.html#upload-procedure). I can verify that the service-linked role for GuardDuty has permissions to read the S3 bucket and object that contains the list, the IP of the scanner instance is included in the list in the correct format, and that the list is active, yet the findings keep being generated. I can also confirm that the scanner instance is definitely scanning within the VPC, using its own private IP to complete teh scans and targeting the private IP addresses of all EC2 instances with its scans.

Are there any further steps that we can take to prevent findings from being generated based on activity from the scanner instance? Is there any reason why the Trusted IP list doesn't seem to be working in this case? I can see from the GuardDuty docs that ""GuardDuty doesn't generate findings for any non-routable or internal (or private) IP addresses in your threat lists."" Is the inverse of this also true (i.e. GuardDuty doesn't ignore findings from any private IP addresses in trusted IP lists)?

Thanks!"
Amazon GuardDuty	"Re: GuardDuty Trusted IP list not working
Hi, 
The Trusted IP list will not accept RFC1918 addresses, this is due to the ephemeral nature of IP addresses in VPCs.  For your use case where you'd like to suppress findings from your Nessus Scanner you should use the Filter and Auto-Archive feature to create a filter that is defined by the AMI-ID of the scanner, you can also scope the suppression down even further by specifying the finding types you expect (Please see: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html#guardduty_filter-findings ), provide a name for the filter and check the auto-archive box.  This will result in the findings being automatically archived and prevent CloudWatch Events from being sent for those findings.

Thanks
-ryan

Edited by: RyanH-AWS on Nov 2, 2018 1:46 PM"
Amazon GuardDuty	"Re: GuardDuty Trusted IP list not working
Thanks, that helps a lot!"
Amazon GuardDuty	"Do test findings create CloudWatch events?
I have GuardDuty hooked up to a Lambda function via CloudWatch.

When I generate sample findings, the Lambda does not appear to activated.  There are currently no naturally-generated findings.

Should sample findings be going to Cloudwatch and the Lambda function, or only the normal findings?"
Amazon GuardDuty	"Re: Do test findings create CloudWatch events?
The answer is ""yes"".

I recommend that the documentation be updated to point this out.  This would let people new to GuardDuty know that the sample findings can be used to troubleshoot assets downstream of GuardDuty."
Amazon GuardDuty	"Re: Do test findings create CloudWatch events?
As mentioned already the generated findings are sent to CloudWatch Events and it is a good way to test your Lambda functions.  If you are not receiving the findings check that you have not previously archived the generated findings as that would result in the new set of generated findings being  aggregated into those archived findings and thus not send to CloudWatch Events.  
-ryan"
Amazon GuardDuty	"GuardDuty notifying every 6 hours for an event 1 month ago
I appear to be having an issue where GuardDuty detected an incident that occurred only once, about a month ago, yet every 6 hours it continues to emit an event about the incident, as though perhaps it had been ""updated"" -- but with no obvious updates.  

Note the event is from October, with other dates from September, a count of 1, and the ""confidence"" of 0.0.  Note also that I'm not finding any evidence that these queries are still happening.  The console shows the old dates, as well, for this event.

Is this a known issue?

{
	""version"": ""0"",
	""id"": ""0f90f544-26cd-273d-2985-bbae170eb86c"",
	""detail-type"": ""GuardDuty Finding"",
	""source"": ""aws.guardduty"",
	""account"": ""redacted"",
	""time"": ""2018-10-06T12:00:07Z"",
	""region"": ""us-east-2"",
	""resources"": [],
	""detail"": {
		""schemaVersion"": ""2.0"",
		""accountId"": ""redacted"",
		""region"": ""us-east-2"",
		""partition"": ""aws"",
		""id"": ""56b2d7f0d77077bf8597173a3df51155"",
		""arn"": ""arn:aws:guardduty:us-east-2:redacted:detector/redacted/finding/56b2d7f0d77077bf8597173a3df51155"",
		""type"": ""Backdoor:EC2/C&CActivity.B!DNS"",
		""resource"": {
			""resourceType"": ""Instance"",
			""instanceDetails"": {
				""instanceId"": ""i-redacted"",
				""instanceType"": ""t2.nano"",
				""launchTime"": ""2018-04-05T17:02:00Z"",
				""platform"": null,
				""productCodes"": [{
					""productCodeId"": ""redacted"",
					""productCodeType"": ""marketplace""
				}],
				""iamInstanceProfile"": null,
				""networkInterfaces"": [{
					""networkInterfaceId"": ""eni-redacted"",
					""privateIpAddresses"": [{
						""privateDnsName"": ""ip-redacted.us-east-2.compute.internal"",
						""privateIpAddress"": ""redacted""
					}],
					""subnetId"": ""subnet-redacted"",
					""vpcId"": ""vpc-redacted"",
					""privateDnsName"": ""ip-redacted.us-east-2.compute.internal"",
					""securityGroups"": [{
						""groupName"": ""redacted"",
						""groupId"": ""sg-redacted""
					}],
					""publicIp"": ""redacted"",
					""ipv6Addresses"": [],
					""publicDnsName"": ""ec2-redacted.us-east-2.compute.amazonaws.com"",
					""privateIpAddress"": ""redacted""
				}],
				""tags"": [{
					""value"": ""i-redacted"",
					""key"": ""Name""
				}, {
					""value"": ""exclude"",
					""key"": ""Inspector""
				}],
				""instanceState"": ""running"",
				""availabilityZone"": ""us-east-2a"",
				""imageId"": ""ami-redacted"",
				""imageDescription"": ""redacted""
			}
		},
		""service"": {
			""serviceName"": ""guardduty"",
			""detectorId"": ""redacted"",
			""action"": {
				""actionType"": ""DNS_REQUEST"",
				""dnsRequestAction"": {
					""domain"": ""icanhazip.com"",
					""protocol"": ""UDP"",
					""blocked"": false
				}
			},
			""resourceRole"": ""TARGET"",
			""additionalInfo"": {
				""threatListName"": ""ProofPoint""
			},
			""eventFirstSeen"": ""2018-09-06T15:41:58Z"",
			""eventLastSeen"": ""2018-09-06T15:41:58Z"",
			""archived"": false,
			""count"": 1
		},
		""severity"": 8,
		""confidence"": 0.0,
		""createdAt"": ""2018-09-06T17:15:27.840Z"",
		""updatedAt"": ""2018-09-06T17:15:27.840Z"",
		""title"": ""Command and Control server domain name queried by EC2 instance i-redacted."",
		""description"": ""EC2 instance i-redacted is querying a domain name associated with a known Command & Control server.""
	}
}"
Amazon GuardDuty	"Re: GuardDuty notifying every 6 hours for an event 1 month ago
Apologies for not responding sooner.  We had identified an issue that resulted in the behavior you described and deployed a fix which was completed earlier this month.  If you are still experiencing this issue please let me know.

Thanks
-ryan"
Amazon GuardDuty	"Visualizing GuardDuty findings
Hi,

How can I make a visualizations of GD findings in Cloudwatch and/or QuickSight?
How can I filter findings by date/time?

Thanx"
Amazon GuardDuty	"Re: Visualizing GuardDuty findings
Hi,

Thanks for reaching out. GuardDuty sends CloudWatch events when any change in the findings takes place:

http://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings_cloudwatch.html

You can create a lambda that gets triggered when these events arrive and have the lambda generate any CloudWatch metrics required:

http://docs.aws.amazon.com/lambda/latest/dg/invoking-lambda-function.html#supported-event-source-cloudwatch-events

For filtering findings by date/time, you can use guardduty:ListFindings with a finding criterion that limits the date (in epoch milliseconds) to a certain range:

http://docs.aws.amazon.com/guardduty/latest/ug/list-findings.html

You can use ""createdAt"" (time at which the finding was created) or ""updatedAt"" (time at which the finding was last updated) as field names.

Regards,
Haitham"
Amazon GuardDuty	"Re: Visualizing GuardDuty findings
Thank you!"
Amazon GuardDuty	"Re: Visualizing GuardDuty findings
AWS Hast just published this Blog post with a solution to send findings to ElasticSearch:

https://aws.amazon.com/es/blogs/database/monitoring-your-security-with-guardduty-in-real-time-with-amazon-elasticsearch-service/

It unnecesarily uses two lambdas, as you can:


Create a CloudWatch rule to capture findings as they are created
Set a firehose stream as target for the rule
Set an ElasticSearch domain as destination for the firehose stream


You'll probably want a processing lambda attached to the firehose stream to fix JSON inconsistencies denormalize the array lists that ES does ont deal well with, etc.

Regards

Edited by: dxciber-sbx on Oct 2, 2018 4:28 AM"
Amazon GuardDuty	"JSON schema inconsistency
Hi, 

This is extracted from a PORT_PROBE finding. As you see, the asn field is of text type in the first element, but a number in the second. This creates unnecesary trouble to process the data. moreover it makes direct put to an ElasticSearch with auto-mapping fail. Not to say it makes working with the data a trial and fail process that is both frustrating and unpredictably time consuming.

Another conflictive field is service.additionalInfo.unusual, that depending on the context can have a number (when it represents a port number) or text value.

Network ports would be better provided as text considering we are most commonly not doing any arithmetic on them.

Please fix these inconsistencies (I believe this is not the only one), and please also provide a working mapping definition for ElasticSearch.

			""portProbeAction"":{			  
			   ""portProbeDetails"":[
 			     {
				    ""localPortDetails"":{""port"":25,
                      ""portName"":""SMTP""},
				    ""remoteIpDetails"":{
 				    ""ipAddressV4"":""178.73.215.171"",
					""organization"":{
""asn"":""42708"",
                       ""asnOrg"":""Portlane AB"",
                       ""isp"":""Portlane AB"",
                       ""org"":""Portlane Colocation""},
					   ""country"":{""countryName"":""Sweden""},
					   ""city"":{""cityName"":""""},
					   ""geoLocation"":{
					        ""lat"":59.3247,
                            ""lon"":18.056
						}				  
					}
					},
				{
 				  ""localPortDetails"":{""port"":389,
                     ""portName"":""Unknown""},
				     ""remoteIpDetails"":{""ipAddressV4"":""80.82.77.33"",
				     ""organization"":{
""asn"":29073,
                        ""asnOrg"":""Quasi Networks LTD."",
                        ""isp"":""Incrediserve LTD"",
                        ""org"":""Quasi Networks LTD.""},
				        ""country"":{""countryName"":""Seychelles""},
                        ""city"":{""cityName"":""""},
				        ""geoLocation"":{""lat"":-4.5833,
                            ""lon"":55.6667}}
 				},

Regards"
Amazon GuardDuty	"Cross-correlation among regions
I have started an open-source project, GDPatrol, to automate the incident response plan based off GuardDuty findings. https://github.com/ansorren/GDPatrol

I am building some use cases, and I'm using a new AWS exploitation framework, Pacu, to generate the findings. https://github.com/RhinoSecurityLabs/pacu

I'm using a Pacu module to enumerate and disrupt the monitoring, and I can see that it attempts to make several calls to CloudTrail, GuardDuty and Config that should easily trigger a finding. I'm also using a VPN while making those calls to make GuardDuty think that those calls are not coming from my usual network. However, GuardDuty is unable to generate any finding.
GuardDuty is enabled in all regions and I made sure to attach to the user a policy that would deny those calls so that the correlation is not affected by the logging disruption, but still nothing.
I think the issue here is that the calls are made in each AWS region, so that Pacu tries to enumerate the Cloudtrail trails in ap-northeast-2, then in ap-southeast-2 and so on and so forth, and GuardDuty sees those as single, rather innocuous calls. 

Currently I'm not using a master account, I'm just enabling GuardDuty on all regions. Is it possible to have GuardDuty to cross-correlate the calls made in different regions so that a finding can be generated?"
Amazon GuardDuty	"Re: Cross-correlation among regions
Hi ansorren,

Thanks for reaching out. Currently a GuardDuty detector is a regional resource, meaning that it captures and analyzes traffic in a single region. There's no way at the moment for GuardDuty to cross-correlate calls made in different regions.

Thanks,
Haitham"
Amazon GuardDuty	"Guard Duty invitation to member account verification failed
i sent an invitation from master account and the invitation status turned as ""Verification failed"".
But i didn't receive any notification in the member account. What could be the possible reason?
There is no document to troubleshoot this kind of issues. Do this actions log in cloudwatch logs and can we find the reason there?

Regards,
Sathish

Edited by: ManokarSathish on Apr 17, 2018 2:19 PM"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
Hi,

Thanks for reaching out.

The email you enter has to match the email associated with the given member account. There is a known issue that's being currently addressed where emails wouldn't match if they're using different case (e.g. MyName@example.com vs. myname@example.com). In the mean time, try using the same exact email address as that associated with the member account.

Thanks"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
Please, could this actually be specified in the AWS documentation - that the email address has to be the one associated with the member account?
Thanks"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
I really didn't notice case. But for sure didn't commit mistake in using email ID because its a copy paste action. And I deleted the invitation and resent it , it's done. But again do we have a mechanism to troubleshoot this kind of issues? Any logs 

Regards Sathish"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
Hello Team,

Even i am facing the same issue as Satish. I did try with other accounts as well but still no luck .

Can anyone kindly help here.

Thanks!!
Rashmi Naoley"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
clueless, But tried inviting one more time and added."
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
Hi ManokarSathish,

We pushed a change in a April that fixed the case-sensitive email comparison issue. Are you still seeing the same problem or is that a new issue?

Thanks,
Haitham"
Amazon GuardDuty	"Re: Guard Duty invitation to member account verification failed
Its resolved long back. Thanks for your support and update. Until now no issues."
Amazon GuardDuty	"How to alert on high-severity GuardDuty findings
We'd like to set up Cloudwatch alerts for high-severity GuardDuty findings. I've created a Cloudwatch rule for GuardDuty-generated events and it successfully sends notifications to an SNS topic.

However, because we have some instances that need to have port 22 open to the internet, we have a lot of low-severity events, and thus a lot of unimportant alerts.

I haven't found a way to filter by severity level in the Cloudwatch rule's event pattern (it just does JSON value matching). I could make the rule target a Lambda function that does the filtering, but that seems like overkill.

Is there a way to filter events based on a logical condition (e.g. greater-than, less-than, not-equal-to, etc)? Thanks."
Amazon GuardDuty	"Re: How to alert on high-severity GuardDuty findings
The most that the CloudWatch Rule input form will generate for you will look like this:
{
  ""source"": [
    ""aws.guardduty""
  ],
  ""detail-type"": [
    ""GuardDuty Finding""
  ]
}


Instead, when you are setting up the CloudWatch Rule, you should manually edit/specify the following json Event pattern:
{
  ""source"": [
    ""aws.guardduty""
  ],
  ""detail-type"": [
    ""GuardDuty Finding""
  ],
  ""detail"": {
    ""severity"": [
      4,
      4.0,
      4.1,
      4.2,
      4.3,
      4.4,
      4.5,
      4.6,
      4.7,
      4.8,
      4.9,
      5,
      5.0,
      5.1,
      5.2,
      5.3,
      5.4,
      5.5,
      5.6,
      5.7,
      5.8,
      5.9,
      6,
      6.0,
      6.1,
      6.2,
      6.3,
      6.4,
      6.5,
      6.6,
      6.7,
      6.8,
      6.9,
      7,
      7.0,
      7.1,
      7.2,
      7.3,
      7.4,
      7.5,
      7.6,
      7.7,
      7.8,
      7.9,
      8,
      8.0,
      8.1,
      8.2,
      8.3,
      8.4,
      8.5,
      8.6,
      8.7,
      8.8,
      8.9
    ]
  }
}


And you can customize the severity values to suite your needs.  I think the above will exclude very common findings such as BruteForce and PortScan's.  I think it covers Medium and High severity findings which is more reasonable than all the findings.

Credit for this solution goes to : 
https://github.com/hensonengineer/AWS_GuardDuty/blob/master/guardduty_cloudwatch_rule_low_noise.json

Edited by: b-at-webb on Jun 19, 2018 12:34 PM"
Amazon GuardDuty	"Re: How to alert on high-severity GuardDuty findings
Hi S. Thompson,

One way you can achieve this is by using an auto-archiving filter (https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html#guardduty_filter-findings). If you create an auto-archiving filter that auto-archives low-severity findings, they will not show up as CloudWatch events.

Thanks,
Haitham"
Amazon GuardDuty	"GuardDuty findings from member accounts not sending out CloudWatch events
Hi,

In my environment, I have a Guardduty master account which is receiving findings from the member accounts in the same region. This part is working perfectly fine. I have further configured CloudWatch Event Rule on my master account (in the same region) to direct these findings to Firehose, which then sends them to an S3 bucket (again in the same region). 

I have observed that only the GD findings generated in my master account are being obeyed by the CW rule which is further sending them to firehose and then s3. However, the GD findings which came in from the member accounts to my master does not follow the same flow. I checked the Firehose delivery stream metrics on the console but it doesn't show the member acc findings. Is it that CW events are not generated in master acc for the member acc findings? If not, what is going wrong here and how can I debug this?

Thanks,
Dadzz"
Amazon GuardDuty	"Re: GuardDuty findings from member accounts not sending out CloudWatch events
Hi,

Thanks for reaching out. How does your CW rule event pattern look like?

Thanks."
Amazon GuardDuty	"Re: GuardDuty findings from member accounts not sending out CloudWatch events
Thanks for your response. My CW rule's filter pattern is:
{
  ""source"": [
    ""aws.guardduty""
  ],
  ""detail-type"": [
    ""GuardDuty Finding""
  ]
}"
Amazon GuardDuty	"Re: GuardDuty findings from member accounts not sending out CloudWatch events
Thanks for the information.

The CW event pattern looks fine. I suggest you open a customer support ticket with the master and member account IDs, detector IDs and regions so we can take a deeper look into what's happening in your specific case.

Thanks,
Haitham"
Amazon GuardDuty	"Re: GuardDuty findings from member accounts not sending out CloudWatch events
Ah! This worked when I removed the ""detail-type"" filter from the rule. Looks like some of the GuardDuty's CW events had the detail-type coming as ""AWS API Call via CloudTrail"" instead of the usual ""GuardDuty Finding"", so was not being received because of the added filter. Can you help understand when will a GD event be assigned these varying detail-type values."
Amazon GuardDuty	"GuardDuty Pricing
The GuardDuty FAQ (*1) says that: ""CloudTrail Event analysis is charged per 1,000,000 events per month and pro-rated."" (my emphasis)

As I understand it, that means that analysing 2500 events per month would cost 0.01USD in one of the US regions (priced at 4USD per million events/month). Is that correct? Also, I haven't found a similar statement for the DNS and Flow Log analysis pricing. Are the log sizes rounded up to the nearest GB for billing purposes?

The examples on the pricing page (*2) all use round numbers which don't need to be pro-rated. I'd like to get confirmation of this as it will affect the baseline cost for enabling GuardDuty across all regions, as recommended by the User Guide.

(*1) https://aws.amazon.com/guardduty/faqs/
(*2) https://aws.amazon.com/guardduty/pricing/"
Amazon GuardDuty	"Re: GuardDuty Pricing
Hi,

Thanks for reaching out.

The actual pricing in our billing system is $0.000004 per CloudTrail Event and per byte on the VPC Flow Logs + DNS Logs side. So we are prorating down to the individual event in CloudTrail and the byte in Flow Logs + DNS logs.

Thanks"
Amazon GuardDuty	"Re: GuardDuty Pricing
That's good news, thanks for the clarification."
Amazon GuardDuty	"how to make nice slack reports from guard duty findings
Hi
I've gotten the guard duty findings to send to SNS and eventually email them to me..the problem is that they come in as unformatted text, reaadable but not very useful. I've tried to set up lambda functions to send them to slack,and it works, but they are not very appealing to the eye.
does anyone know of a way to make these convert to json payloads that area readable under slack?
we use prtg slack alerts that come over with very descriptive text, but I can't seem to convert this text to json payload. ( I'm Not a programmer, but i did sleep at a holiday Inn last night)
PROBE"",""portProbeAction"":{""portProbeDetails"":,""blocked"":false}},""resourceRole"":""TARGET"",""additionalInfo"":{""threatName"":""Scanner"",""threatListName"":""ProofPoint""},""eventFirstSeen"":""2018-02-03T12:55:32Z"",""eventLastSeen"":""2018-03-13T10:44:53Z"",""archived"":false,""count"":26.0},""severity"":2.0,""createdAt"":""2018-02-03T13:07:32.349Z"",""updatedAt"":""2018-03-13T10:56:35.239Z"",""title"":""Unprotected port on EC2 <instance>is being probed."",""description"":""EC2 instance has an unprotected port which is being probed by a known malicious host.""}}"
Amazon GuardDuty	"Re: how to make nice slack reports from guard duty findings
Hey there! I moved you to the GuardDuty forum, I think you'll get a better answer there."
Amazon GuardDuty	"Re: how to make nice slack reports from guard duty findings
Hi,

Thanks for reaching out.

Please check out this sample GuardDuty slack integration for an example:

https://github.com/aws-samples/amazon-guardduty-to-slack

Haitham"
Amazon GuardDuty	"Re: how to make nice slack reports from guard duty findings
Thanks for sharing the CF template. One question, do I need to deploy the CloudFormation stack in each region that GuardDuty is enabled ?

Peter"
Amazon GuardDuty	"Re: how to make nice slack reports from guard duty findings
Yes, GuardDuty detector is a regional resource, which means the GuardDuty findings (and their corresponding CloudWatch events) are also regional. So you would need to deploy the slack integration CloudFormation template in every region where GuardDuty is enabled. You might choose to use the same Slack webhook and channel for all regions if you wish to aggregate the findings from all regions in the same Slack channel.

Thanks"
Amazon GuardDuty	"GuardDuty invite from central account.
As I understand it's mandatory to know email with which account was created.
In case when this account was changed is it possible to use currently tied mail address?"
Amazon GuardDuty	"Re: GuardDuty invite from central account.
Hi,

Thanks for reaching out.

Yes,  InviteMembers API (https://docs.aws.amazon.com/guardduty/latest/ug/invite-members.html)  always checks the provided member email address with the one currently associated with that member account.

Thanks"
Amazon GuardDuty	"Re: GuardDuty invite from central account.
Thanks for reply.
For some reason can't receive invite via email (@gmail.com).
Is it possible to troubleshoot it in some way.

Edited by: vvadim on Mar 22, 2018 11:23 PM"
Amazon GuardDuty	"Re: GuardDuty invite from central account.
Hi,

Please open a support request with your account details (account number, email address and region where you're trying this) and we would be happy to look into it.

Thanks,
Haitham"
Amazon GuardDuty	"GuardDuty Not analysing VPC Flow logs or DNS Logs
Hi,

I configured GuardDuty in our organisation few months ago and linked some accounts to it. It is able to analyse the CloudTrail Logs but not the VPC flow or DNS logs. In the page which displays the usage details, Total events processed for VPC flow and DNS log is 0. The page which lists the accounts shows them as Monitored.

Am I missing something, I thought the flow logs are automatically streamed to GuardDuty without any vpc config change ?

Please help.

Thanks"
Amazon GuardDuty	"Re: GuardDuty Not analysing VPC Flow logs or DNS Logs
Hi,

Thanks for reaching out.

The usage details page currently shows the usage details of the current account. If that's the master account, then it's the usage details of the master account (not all member accounts). You need to login to a specific member account to view the usage details for that account.

Let us know if this answers your question.

Thanks"
Amazon GuardDuty	"AWS GuardDuty Manager
Hi, I started an open source project to simplify the GuardDuty management across multiple accounts, the current version supports to enable/disable/suspend/resume GuardDuty, add/invite members, accept invitations. All you need to do is to specify the 'desiredStatus' of each account, then the tool will configure it accordingly. If you are interested, here is the github repo: https://github.com/jc1518/AWS-GuardDuty-Manager

This is how the config file looks like:

regions = {
    ""us-west-2"": {
        ""master"": {
            ""id"": ""XXXXXXXXXXXXX"",
            ""profile"": ""account-A""
        },
        ""members"": [
            {
                ""id"": ""XXXXXXXXXXXX"",
                ""profile"": ""account-B"",
                ""email"": ""account-B-owner@mydomain.com"",
                ""desiredStatus"": ""start""
            },
            {
                ""id"": ""XXXXXXXXXXXX"",
                ""profile"": ""account-C"",
                ""email"": ""account-C-owner@mydomain.com"",
                ""desiredStatus"": ""start""
            }
        ]
    },
    ""us-east-1"": {
        ""master"": {
            ""id"": ""XXXXXXXXXXXXX"",
            ""profile"": ""account-A""
        },
        ""members"": [
            {
                ""id"": ""XXXXXXXXXXXX"",
                ""profile"": ""account-B"",
                ""email"": ""account-B-owner@mydomain.com"",
                ""desiredStatus"": ""stop""
            },
            {
                ""id"": ""XXXXXXXXXXXX"",
                ""profile"": ""account-C"",
                ""email"": ""account-C-owner@mydomain.com"",
                ""desiredStatus"": ""disable""
            }
        ]
    }
}"
Amazon GuardDuty	"Actor info missing from Recon:EC2/PortProbeUnprotectedPort
I am looking at Recon:EC2/PortProbeUnprotectedPort findings and retrieving them via boto3. I can see actor information in the console (see the screenshot) but this information seems to be missing from the finding I get from boto3.

  {
    ""Resource"": {
      ""ResourceType"": ""Instance"",
      ""InstanceDetails"": {
        ""ProductCodes"": [
          {}
        ],
        ""AvailabilityZone"": ""us-west-1a"",
        ""Tags"": [
          {
            ""Value"": ""xxxx"",
            ""Key"": ""Name""
          }
        ],
        ""InstanceId"": ""i-078843282e949bb15"",
        ""InstanceState"": ""running"",
        ""ImageId"": ""ami-af4333cf"",
        ""LaunchTime"": 1495192180000,
        ""InstanceType"": ""m4.xlarge"",
        ""NetworkInterfaces"": [
          {
            ""VpcId"": ""vpc-4046a725"",
            ""PrivateIpAddresses"": [
              {
                ""PrivateDnsName"": ""ip-172-31-18-139.us-west-1.compute.internal"",
                ""PrivateIpAddress"": ""172.31.18.139""
              }
            ],
            ""PublicDnsName"": ""ec2-xx-xx-xx-xx.us-west-1.compute.amazonaws.com"",
            ""PublicIp"": ""xx.xx.xx.xx"",
            ""PrivateDnsName"": ""ip-xx-xx-xx-xx.us-west-1.compute.internal"",
            ""SecurityGroups"": [
              {
                ""GroupName"": ""ray"",
                ""GroupId"": ""sg-51d1c035""
              },
              {
                ""GroupName"": ""ssh"",
                ""GroupId"": ""sg-5956473d""
              },
              {
                ""GroupName"": ""sift-vpn"",
                ""GroupId"": ""sg-10df9577""
              },
              {
                ""GroupName"": ""streambright-debug"",
                ""GroupId"": ""sg-30b3a254""
              },
              {
                ""GroupName"": ""Eddie"",
                ""GroupId"": ""sg-cba0d5ac""
              }
            ],
            ""Ipv6Addresses"": [],
            ""SubnetId"": ""subnet-f07f8895"",
            ""PrivateIpAddress"": ""172.31.18.139""
          }
        ]
      }
    },
    ""Description"": ""EC2 instance has an unprotected port which is being probed by a known malicious host."",
    ""Service"": {
      ""Count"": 302,
      ""Archived"": false,
      ""ServiceName"": ""guardduty"",
      ""EventFirstSeen"": ""2018-01-04T21:02:48Z"",
      ""ResourceRole"": ""TARGET"",
      ""EventLastSeen"": ""2018-01-08T11:58:19Z"",
      ""DetectorId"": ""acb06179ebc0116fd3714af016feee9e"",
      ""Action"": {
        ""ActionType"": ""PORT_PROBE""
      }
    },
    ""Title"": ""Unprotected port on EC2 instance i-078843282e949bb15 is being probed."",
    ""Type"": ""Recon:EC2/PortProbeUnprotectedPort"",
    ""Region"": ""us-west-1"",
    ""Partition"": ""aws"",
    ""Arn"": ""arn:aws:guardduty:us-west-1:965234454899:detector/acb06179ebc0116fd3714af016feee9e/finding/8ab0618308a49b986ea5ebb86eeb4a75"",
    ""UpdatedAt"": ""2018-01-08T12:08:02.696Z"",
    ""SchemaVersion"": ""2.0"",
    ""Severity"": 2.0,
    ""Id"": ""8ab0618308a49b986ea5ebb86eeb4a75"",
    ""CreatedAt"": ""2018-01-04T21:14:02.953Z"",
    ""AccountId"": ""965234454899""
  }

I may well have missed something, but this looks like an API issue to me.

Has anyone seen the same or seen a workaround?

The attachment didn't stick last time, so here it is."
Amazon GuardDuty	"Re: Actor info missing from Recon:EC2/PortProbeUnprotectedPort
Thanks for reaching out. We're working on updating the SDKs with the missing information. Will update this post when the SDKs have been updated."
Amazon GuardDuty	"Re: Actor info missing from Recon:EC2/PortProbeUnprotectedPort
This has been fixed in the latest version of the SDK.

Thanks"
Amazon GuardDuty	"Sample events?
I am trying to parse GuardDuty events sent via a kinesis stream, and have run into an issue.

The documentation, the sample events, and what I actually receive in an alert are all using a different format. 

The documentation is close to how an actual alert is structured, but doesn't reference some of the structures I am seeing in the logs, causing me to miss some important information ... like IP addresses. Are there any better definitions of the version 2.0 schema anywhere? Is there somewhere I can grab accurate sample alerts that represent the data that I will get from cloudwatch/kinesis?"
Amazon GuardDuty	"Re: Sample events?
Hi,

Thanks for reaching out. Could you please explain what discrepancies are you seeing between the finding documentation and the actual finding? Also what's the finding type for that finding?

Thanks"
Amazon GuardDuty	"GuardDuty cli doesn't work with master account login
Hi all,

I have a setup where GuardDuty is setup with a master account setup.  This works just fine in the console, and I can see all the findings from child accounts in the master account console.

However, if I try and access the findings via the CLI, I cannot access them as I always get the error ""An error occurred (BadRequestException) when calling the GetFindings operation: The request is rejected because the input detectorId is not owned by the current account.""

I would expect this to work connecting as the master account, as I can see the data in the console, so the CLI is working differently to the console it seems.  As I don't have access to the child accounts directly I cannot interrogate the findings further through the CLI.

I appreciate that not all functions should be allowed otherwise I could mess around with the settings on a child account, but I think I should be able to perform the same actions as I can via the console - reading findings and archiving them.

Many thanks"
Amazon GuardDuty	"Re: GuardDuty cli doesn't work with master account login
Hi,

Thanks for reaching out. Are you sure you're using the same region in the CLI as the one you're accessing the console from? If so, please make sure you're using the correct detector ID for the current region when calling get-findings. You can retrieve that by calling ListDetectors:

$ aws guardduty list-detectors

Thanks,
Haitham"
Amazon GuardDuty	"accessKeyDetails missing for users in findings via API
I am using the API to access GuardDuty findings. For the finding UnauthorizedAccess:IAMUser/TorIPCaller
, when I retrieve the details thru the API (cli or boto3), I get the following information about the user:

      ""Resource"":{  
        ""ResourceType"":""AccessKey""
      },


If I instead try retrieving the details by exporting it from the UI, I get the actual details of the user:

    ""resource"": {
      ""resourceType"": ""AccessKey"",
      ""accessKeyDetails"": {
        ""accessKeyId"": ""AGEXVRHQQ"",
        ""principalId"": ""AGAEREARAE"",
        ""userType"": ""IAMUser"",
        ""userName"": ""ray""
      }
    },


This appears to be an omission in the API. Can anyone else confirm that the user details are missing?  Without them, these findings thru the API aren't actionable -- it seems I need to login to  the console to get the information about who triggered this finding.

Is there an alternative method for consuming GuardDuty findings that I should be using to retrieve all the necessary details?

Edited by: rcanzanese on Jan 17, 2018 10:05 AM"
Amazon GuardDuty	"Re: accessKeyDetails missing for users in findings via API
Thanks for reaching out. This issue has been fixed in the latest version of the SDK: https://github.com/aws/aws-sdk-java/issues/1426

Edited by: haitham-aws on Jan 29, 2018 11:46 AM"
Amazon GuardDuty	"""Rolled up"" findings hides actor details
Hi all,

When the findings in GuardDuty are ""rolled up"" (so there is a count > 0), I am presuming it does this per finding ID, where a finding ID is unique to a rule type and resource ID combination (could be wrong here)...

What this means however is that you can only ever see the latest actor details.  So if for example you have a resource that is scanned 10 times, you will only ever see the actor details for the 10th scan.  Is there somewhere where we can access the details of every instance of a finding, not just the latest? The same problem occurs even with cloudwatch notifications, as they are rolled up every 6 hours to you only see the latest every 6 hours.

Kind Regards,
Dave"
Amazon GuardDuty	"Issue calling GuardDuty from Lambda using Python
Has anyone else had issues trying to call GuardDuty from lambda using Python. I get the following error.

UnknownServiceError: Unknown service: 'guardduty'. Valid service names are: acm, apigateway, application-autoscaling, appstream, athena, autoscaling, batch, budgets, clouddirectory, cloudformation, cloudfront, cloudhsm, cloudhsmv2, cloudsearch, cloudsearchdomain, cloudtrail, cloudwatch, codebuild, codecommit, codedeploy, codepipeline, codestar, cognito-identity, cognito-idp, cognito-sync, config, cur, datapipeline, dax, devicefarm, directconnect, discovery, dms, ds, dynamodb, dynamodbstreams, ec2, ecr, ecs, efs, elasticache, elasticbeanstalk, elastictranscoder, elb, elbv2, emr, es, events, firehose, gamelift, glacier, glue, greengrass, health, iam, importexport, inspector, iot, iot-data, kinesis, kinesisanalytics, kms, lambda, lex-models, lex-runtime, lightsail, logs, machinelearning, marketplace-entitlement, marketplacecommerceanalytics, meteringmarketplace, mgh, mobile, mturk, opsworks, opsworkscm, organizations, pinpoint, polly, rds, redshift, rekognition, resourcegroupstaggingapi, route53, route53domains, s3, sdb, servicecatalog, ses, shield, sms, snowball, sns, sqs, ssm, stepfunctions, storagegateway, sts, support, swf, waf, waf-regional, workdocs, workspaces, xray

Looks like the Boto 3 library that is currently used by Lambda does not yet support GuardDuty. Anyone else had this problem."
Amazon GuardDuty	"Re: Issue calling GuardDuty from Lambda using Python
Thanks for bringing this to our attention. We notified the Lambda team and they're working on updating the SDK to the latest version."
Amazon GuardDuty	"Re: Issue calling GuardDuty from Lambda using Python
Do you know an ETA on this? Since at this time no one can call GuardDuty with the Python SDK at this time via Lambda. Thanks"
Amazon GuardDuty	"Re: Issue calling GuardDuty from Lambda using Python
Looks like the Boto SDK has now been updated and Guard Duty can now be called from lambda without an error."
Amazon GuardDuty	"Filtering out CloudWatch Logs stream events from GuardDuty
I run a lot of Lambda functions and I see a lot of CreateLogStream events in CloudTrail. Can I filter them out so that they don't increase the GuardDuty costs?

In fact I would also like to filter them out from CloudTrail, because they're just a lot of noise and hiding all the ""real"" events."
Amazon GuardDuty	"Re: Filtering out CloudWatch Logs stream events from GuardDuty
Hi,

Thanks for reaching out. GuardDuty doesn't currently support this use case.

Thanks"
Amazon GuardDuty	"Re: Filtering out CloudWatch Logs stream events from GuardDuty
Okay, thanks for the info. I hope you will consider this in the future. Otherwise it seems like GuardDuty is mostly charging for processing of useless logging meta events."
