label	description
AWS IoT Device Management	"AWS Shield as a DDoS Service?
Hi,

We are currently hosting some of our services on AWS, and some of our infrastructure on other places.
For one of our servers hosted elsewhere (serving raw TCP traffic, not HTTP/S), we would like to be able to benefit from AWS shield standard protection.
Does AWS Shield Standard protection apply to non-HTTP ports of EC2 instances?
Does it make sense to create an EC2 instance and put a reverse TCP proxy on it? Assuming 2TB of traffic per month, what setup / costs should we be looking at?

Edited by: tacticsoft on Dec 5, 2018 11:58 PM"
AWS IoT Device Management	"Shield Standard:  What does it protect
The FAQ and Info online aren't too clear about what services Shield Standard actually protect; I see mention of load balancers, etc. but little specifics.

I'm specifically interested in knowing if Shield Standard protects Elastic IPs allocated in VPCs, and what types of protection are in place (Protection against SYN floods, UDP Floods, ICMP Floods, etc.).

Is there more detailed info available?"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Standard defends against most common, frequently occurring network and transport layer DDoS attacks that target your web site or applications. On Amazon EC2, your traffic levels are inspected by an auto-mitigation system that can engage when a well-defined DDoS attack signature is detected or at high levels of traffic, given your choice of instance type. UDP reflection attacks, like DNS reflection, NTP reflection, SSDP reflection, etc. are examples of common DDoS attack vectors that can be mitigated by this system.

For improved DDoS resilience across a wide range of attack vectors, like SYN floods or web application layer attacks, consider using Amazon CloudFront or Application Load Balancer (ALB) with AWS WAF. You can also use a Classic Load Balancer for non-web use cases and Amazon Route 53 to also protect against DNS query floods.

You can learn more about these recommendations in the AWS Best Practices for DDoS Resiliency which is available at https://d0.awsstatic.com/whitepapers/Security/DDoS_White_Paper.pdf . This paper provides a prescriptive reference architecture you can use to help make your applications more DDoS resilient.

I will reach out to you directly to answer any follow-up questions you might have. I am interested to learn about your application and provide tailored recommendations.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
So... more specifically, I'm interested in:  knowing if Shield Standard protects Elastic IPs allocated in VPCs

That is, is it in effect if I'm not using CloudFront or ELBs?  The documentation only mentions these specifically as protected services."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Yes. AWS Shield Standard provides protection for EIP's in VPC.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Thanks, that was the primary question I had.  Thanks again, have a Happy New Year!"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Hello Jeffrey and other AWS employees,

Can AWS Shield Standard prevent a volumetric attack from saturating the bandwidth of a small EC2 instance and what will happen if a UDP attack hits a small instance while all UDP is blocked in the security group? Will you ever nullroute the IP, if a huge attack hits us? Layer 7 is not an issue since we'll have efficient rate limits.

I've read the relevant DDoS resiliency whitepaper and your previous answers. It does not answer my question, unfortunately. I need an answer for EC2 only, please.

Thanks in advance."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Advanced is available for Elastic IP Addresses (EIP's) which allows you to protect Amazon EC2 instances or Network Load Balancers (NLB's). To learn more about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
I'm about to deploy a web app in production using AWS BeanStalk on a single instance (basic tier).

Will my app be automatically protected through AWS Sheild Standard?"
AWS IoT Device Management	"Re: Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
AWS Shield Standard automatically protects every AWS resource type in every AWS region against common DDoS attacks. No action is required on your part.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Shield support for non-Web Apps
Is Shield supported for non-web applications which are not even using a ELB? Can it be assigned to a VPC with public IP addresses? 
In this case, is there any additional protection does AWS-shield provide over and above the Security-groups/NACL ?"
AWS IoT Device Management	"Re: Shield support for non-Web Apps
With AWS Shield Advanced you can now add an Elastic IP Address (EIP) as a protected resource, which allows you to protect Amazon EC2 instances and Network Load Balancers (NLB's). For more information about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"AWS Shield Advanced - Multiple Accounts
We've got several accounts all owned by the parent company, there are development, qa, and multiple production environments.  If we sign up for Shield advanced, will this cover only one of the accounts, or can we cover all of them?

Cheers

Keith"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
If your organization has multiple AWS accounts, then you can subscribe multiple AWS Accounts to AWS Shield Advanced. You will pay the monthly fee once as long as the AWS accounts are all under a single consolidated billing, and you own all the AWS accounts and resources in those accounts.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
Thanks for that - very helpful"
AWS IoT Device Management	"What if I've got my clients in my AWS account? Are they protected?
I wonder if I contract Shield Advanced the clients I've got in my AWS account are protected with Shield Advanced too.
I've got a web design company and my clients are in my AWS account so it is easier to manage.
Thanks,"
AWS IoT Device Management	"Re: What if I've got my clients in my AWS account? Are they protected?
Hi,

You can enable AWS Shield Advanced for the protection of multiple AWS resources, as long as the subscribing AWS Account holder directly owns and manages the AWS resources. Further, AWS Shield Advanced's monthly fee applies per organization subscribed to AWS Shield Advanced. If your organization has multiple AWS accounts, you will pay the monthly fee once as long as you own all the AWS accounts and resources in that account.

Thanks
Venkat"
AWS IoT Device Management	"AWS Shield as a DDoS Service?
Hi,

We are currently hosting some of our services on AWS, and some of our infrastructure on other places.
For one of our servers hosted elsewhere (serving raw TCP traffic, not HTTP/S), we would like to be able to benefit from AWS shield standard protection.
Does AWS Shield Standard protection apply to non-HTTP ports of EC2 instances?
Does it make sense to create an EC2 instance and put a reverse TCP proxy on it? Assuming 2TB of traffic per month, what setup / costs should we be looking at?

Edited by: tacticsoft on Dec 5, 2018 11:58 PM"
AWS IoT Device Management	"Shield Standard:  What does it protect
The FAQ and Info online aren't too clear about what services Shield Standard actually protect; I see mention of load balancers, etc. but little specifics.

I'm specifically interested in knowing if Shield Standard protects Elastic IPs allocated in VPCs, and what types of protection are in place (Protection against SYN floods, UDP Floods, ICMP Floods, etc.).

Is there more detailed info available?"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Standard defends against most common, frequently occurring network and transport layer DDoS attacks that target your web site or applications. On Amazon EC2, your traffic levels are inspected by an auto-mitigation system that can engage when a well-defined DDoS attack signature is detected or at high levels of traffic, given your choice of instance type. UDP reflection attacks, like DNS reflection, NTP reflection, SSDP reflection, etc. are examples of common DDoS attack vectors that can be mitigated by this system.

For improved DDoS resilience across a wide range of attack vectors, like SYN floods or web application layer attacks, consider using Amazon CloudFront or Application Load Balancer (ALB) with AWS WAF. You can also use a Classic Load Balancer for non-web use cases and Amazon Route 53 to also protect against DNS query floods.

You can learn more about these recommendations in the AWS Best Practices for DDoS Resiliency which is available at https://d0.awsstatic.com/whitepapers/Security/DDoS_White_Paper.pdf . This paper provides a prescriptive reference architecture you can use to help make your applications more DDoS resilient.

I will reach out to you directly to answer any follow-up questions you might have. I am interested to learn about your application and provide tailored recommendations.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
So... more specifically, I'm interested in:  knowing if Shield Standard protects Elastic IPs allocated in VPCs

That is, is it in effect if I'm not using CloudFront or ELBs?  The documentation only mentions these specifically as protected services."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Yes. AWS Shield Standard provides protection for EIP's in VPC.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Thanks, that was the primary question I had.  Thanks again, have a Happy New Year!"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Hello Jeffrey and other AWS employees,

Can AWS Shield Standard prevent a volumetric attack from saturating the bandwidth of a small EC2 instance and what will happen if a UDP attack hits a small instance while all UDP is blocked in the security group? Will you ever nullroute the IP, if a huge attack hits us? Layer 7 is not an issue since we'll have efficient rate limits.

I've read the relevant DDoS resiliency whitepaper and your previous answers. It does not answer my question, unfortunately. I need an answer for EC2 only, please.

Thanks in advance."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Advanced is available for Elastic IP Addresses (EIP's) which allows you to protect Amazon EC2 instances or Network Load Balancers (NLB's). To learn more about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
I'm about to deploy a web app in production using AWS BeanStalk on a single instance (basic tier).

Will my app be automatically protected through AWS Sheild Standard?"
AWS IoT Device Management	"Re: Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
AWS Shield Standard automatically protects every AWS resource type in every AWS region against common DDoS attacks. No action is required on your part.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Shield support for non-Web Apps
Is Shield supported for non-web applications which are not even using a ELB? Can it be assigned to a VPC with public IP addresses? 
In this case, is there any additional protection does AWS-shield provide over and above the Security-groups/NACL ?"
AWS IoT Device Management	"Re: Shield support for non-Web Apps
With AWS Shield Advanced you can now add an Elastic IP Address (EIP) as a protected resource, which allows you to protect Amazon EC2 instances and Network Load Balancers (NLB's). For more information about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"AWS Shield Advanced - Multiple Accounts
We've got several accounts all owned by the parent company, there are development, qa, and multiple production environments.  If we sign up for Shield advanced, will this cover only one of the accounts, or can we cover all of them?

Cheers

Keith"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
If your organization has multiple AWS accounts, then you can subscribe multiple AWS Accounts to AWS Shield Advanced. You will pay the monthly fee once as long as the AWS accounts are all under a single consolidated billing, and you own all the AWS accounts and resources in those accounts.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
Thanks for that - very helpful"
AWS IoT Device Management	"What if I've got my clients in my AWS account? Are they protected?
I wonder if I contract Shield Advanced the clients I've got in my AWS account are protected with Shield Advanced too.
I've got a web design company and my clients are in my AWS account so it is easier to manage.
Thanks,"
AWS IoT Device Management	"Re: What if I've got my clients in my AWS account? Are they protected?
Hi,

You can enable AWS Shield Advanced for the protection of multiple AWS resources, as long as the subscribing AWS Account holder directly owns and manages the AWS resources. Further, AWS Shield Advanced's monthly fee applies per organization subscribed to AWS Shield Advanced. If your organization has multiple AWS accounts, you will pay the monthly fee once as long as you own all the AWS accounts and resources in that account.

Thanks
Venkat"
AWS IoT Device Management	"TOTP on transaction validation
Hi community!

I searched through the Cognito docs and haven't found the answer to my problem.

Some transactions in my company system need to be confirmed by a token, because those transactions may lead to incorrect invoices and hence some major tax problems to be dealt later. We're still on architecture definition, and some AWS solutions need to be selected to plan our monthly budget and our development sprints.

After some research, I figured out that Cognito sends TOTP tokens when MFA is turned on, but apparently that's done only on login. I couldn't figure out however if Cognito can be used to send those TOTP tokens for other purposes, like the one described above. Is there a way to to that using this or any other AWS service, or is it better to develop a service compliant to RFC 6238?

I'd like to thank the help of you all in advance.

Best regards,
Guilherme Soares."
AWS IoT Device Management	"Pricing details for server to server communication (client credential flow)
Hi ,

Can some one help on pricing model for user pool only with app clients ? User pool created will not have any user but will have 2 app clients only (for server to server communication). In case of Client Credentials Flow, what are the billing charges ? It is based on number of hit to get the auth token ? Is there any charge on validating the token generated using url :  https://xxxxxxxx.auth.us-east-1.amazoncognito.com/oauth2/token via API gateway authorizers ?

Is there any charge on creating domain name for resource server ?

Thanks,
Ajay"
AWS IoT Device Management	"How to use Cognito Identity Provider API through the API Gateway
I've tried to set an method in the API Gateway with the integration request pointing to the AWS Service ""Cognito Identity"" and Action to AdminGetUser. Testing the method I get in the response this  exception ""com.amazon.coral.service#UnknownOperationException"".
I've tried to force the Content-Type, the X-Amz-Target but nothing has produced a better response. I've tried to set up some new methods pointing to S3, Step Function and these ones return a right response.
Please, may you tell me if the operation I'm trying is admitted and if YES, where is the trick ?
Thanks
Stefano"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
Hi,

I believe you don't have the x-amz-target header set up correctly. For AdminGetUser API on Cognito side, you need to set AWSCognitoIdentityProviderService.AdminGetUser as the value of x-amz-target with a POST method and the parameters in the payload.

POST
/¬†
¬†
content-type:application/x-amz-json-1.1
host:cognito-idp.us-east-1.amazonaws.com
x-amz-date:20170426T230022Z
x-amz-target:AWSCognitoIdentityProviderService.AdminGetUser
¬†
{""Username"": ""name"", ""UserPoolId"": ""id""}


Thanks,
-Ka Hou"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
I am getting Missing Authentication  Token while using the api
When I use the Authorization Header , I get not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get it running ?"
AWS IoT Device Management	"X-AMZ-TARGET: AWSCognitoIdentityProviderService.AdminGetUser Issue
Hi All
I am trying call api to get user details in following manner:

Url: https://cognito-idp.xx-xxxxxx-X.amazonaws.com
Headers: 
X-AMZ-TARGET : AWSCognitoIdentityProviderService.AdminGetUser
Content-Type: application/x-amz-json-1.0
Authorization : Bearer <Token>

But I am getting following response:
not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get this api running with Access token?"
AWS IoT Device Management	"Logout not working for federated OIDC provider (OP)
Signing out using the following method, as per the logout endpoint document, only removes the first user pool's sign-in cookie and not the federated OP. This is an incorrect implementation and would leave a false sense of signing out.

https://docs.aws.amazon.com/cognito/latest/developerguide/logout-endpoint.html
GET https:{domain}.auth.{region}.amazoncognito.com/logout?logout_uri={uri}&client_id={clientid}
Only deletes the sign-in cookie for that domain
Then redirects based on the logout_uri.

A workaround is for the RP to also know about the end_session_endpoint for the federated OP. This is not ideal.

The implementation should have the user pool using the OP iframe to logout method to sign out of any federated OPs and then perform the logout on the identity pool. IdentityServer3 & 4 have done the same in their implementation. 
http://openid.net/specs/openid-connect-session-1_0.html#OPiframe
http://docs.identityserver.io/en/release/topics/signout_federated.html

Edited by: andrewnb on May 18, 2018 1:52 PM

Edited by: andrewnb on May 18, 2018 1:52 PM"
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
AFAIK the logout is still in draft status for OIDC (both front-channel and back-channel) so we do not support logout yet. We can consider this feature in future updates to the service."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
I would highly recommend and strongly encourage that AWS implement some form of federated signout capability regardless of the state of the standard, before people face issues thinking they've signout but haven't if they're using 3rd party OPs.

The session management, front and back channel specifications are in implementer's draft status rather, rather than solely draft status. There are many other identity provider implementations following the implementer's draft (e.g. ADFS, IdentityServer3 & 4, Auth0, WSO2, etc.).

Cognito does support logout but the implementation doesn't support federated signout."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
Has there been any progress on logging out of federated OIDC providers?"
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
We have a use case for this as well. We are using an instance of IdentityServer as an identity provider with Cognito and need federated logout. We are manually going to implement it via a laundry list of SignOutUrls in each AppClient configuration, which is less than ideal.

Our IdentityServer instance is the lone identity provider with our Cognito instance, so we are able to redirect to the IdentityServer logout instance. This is NOT the long-term plan, though. We do see the need for multiple identity providers in the near future."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
Is there an update for federated OP signout?"
AWS IoT Device Management	"Is Cognito free in this case?
1) User start app.
2) User authenticate and get token from third-party identity provider (Facebook, Google).
3) Exchange identity provider token for AWS credentials in my Identity Pool.
4) Access AWS services with credentials (to DynamoDB, S3...).

Will I be charged for MAU using this example or not?

Im confusing becouse in AWS Cognito Pricing page says:

Users who sign in directly with their User Pool credentials or with social identity providers:

For users who sign in directly with their credentials from a User Pool or with social identity providers such as Google, Facebook and Amazon, there are volume-based pricing tiers for MAUs above the free tier, as shown in the table below. (price list below...)

But in AWS Cognito FAQ says:

Q: How much does Cognito Identity cost?
... Federated Identities and secure access control for AWS resources are always free with Cognito Identity.

Thanks!

Edited by: elritualk on Feb 25, 2019 9:57 PM

Edited by: elritualk on Feb 25, 2019 9:58 PM"
AWS IoT Device Management	"[Unity3D] Is there an economic way to grant app access to AWS services?
Hi,

Im pretty confused with some things. Im developing a game in Unity3D, and I want to use DynamoDB and S3 for players storage data.

I have in mind this two basic scenarios:

First scenario:

1) Players will authenticate with social platforms (Facebook, Google) using each platform SDK. If they login, they get an accessToken from the platform. Fine here.
2) Next, grant access to AWS by doing each player pass the accessToken credentials.AddLogin(""graph.facebook.com"", accessToken) in the AWS SDK;
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I will have one MAU for each player that login in the month. 10.000.000 unique logins in a month = 10.000.000 MAU = 10.000.000 * price of the MAU.

Second scenario (if possible)

1) Player will authenticate with social platforms (Facebook, Google) using each platform SDK.
2) App authenticate with Identity Pool ID in order to have access to AWS services.
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I can have infinite numbers of logins each month, but the MAU will be always 1 since its always the same for each player.

The questions are:
1) Is this 2 scenario possible?
2) Is possible to have an app with 10.000.000 users per month that let players use AWS services (DynamoDB, S3) without paying 10.000.000 MAU prices (at least paying for 1 MAU).

Thanks!"
AWS IoT Device Management	"Pinpoint Analytics events not being triggered by Cognito
I am unable to get my Cognito User Pool to emit any Sign-in, Sign-up, or Authentication Falure events to Pinpoint Analytics. Under ""General Settings"" -> ""Analytics"", I followed the ""AWS Management Console"" instructions specified here[1].

The automatically-generated IAM role that was created looks something like:
{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""mobiletargeting:UpdateEndpoint""
            ],
            ""Resource"": ""arn:aws:mobiletargeting:us-east-1:XXXX:apps/<pinpoint project ID>/endpoints/*""
        },
        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""mobileanalytics:PutItems""
            ],
            ""Resource"": ""*""
        }
    ]
}


As part of my troubleshooting, I checked ""Access Advisor"" for that IAM role and it claims to never have been accessed.

How do I configure my Cognito User Pool to emit these Analytics events?

Tangentially related to that (and not the original problem), it does not appear possible to enter in a previously-created IAM role in the ""IAM role"" field under General Settings -> Analytics.

[1]: https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-pinpoint-integration.html"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
I still cannot get Cognito User Pools to emit sign-in or sign-up events to Pinpoint. Help please?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Facing the same issue..any help is appreciated"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
facing the same issue..any help is appreciated"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Same issue here; under what conditions does authenticating a user with cognito trigger the pinpoint event?
does it work with the hosted login ui? when using android sdk to login?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Having same issue. Any update on this?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
We're facing the exact same issue too as reported.

Using the Hosted UI to Sign In or Sign Up does not generate any events in Pinpoint."
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Same issue"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Hello !
We are experiencing the same issue:
we are not able to connect cognito to pinpoint in Frankfurt zone.
Thank you AWS for your answer,
S

Edited by: sablier on Feb 25, 2019 8:52 AM

Edited by: sablier on Feb 25, 2019 8:52 AM"
AWS IoT Device Management	"Facebook display=popup
I've got a cognito user pool set up with facebook federated identity provider.
And everything works perfectly, from a technical angle.

However, my users think it looks ugly.

Here's why:

Cognito redirects the users to https://www.facebook.com/v2.9/dialog/oauth to do their sign-in.
However, that link loads up their whole facebook menu bar complete with friend requests and notifications in the background.

Fortunately, facebook provides an alternate link for signin, which is https://www.facebook.com/v2.9/dialog/oauth?display=popup (it's mostly the same, just has display=popup at the end).  That link provides a proper authentication screen without all the background stuff, and it's even more compact, which is more suitable for the size of my website window.

Unfortunately, I can't see how to configure Cognito to including this display=popup parameter in the URL it sends users to.

Is there a way to do this that I'm missing?

If not, could it be added as a feature?  (I imagine it'd be pretty straightforward.)"
AWS IoT Device Management	"Re: Facebook display=popup
Can we get an option to set display=popup on facebook login?"
AWS IoT Device Management	"facebook 2.9 api expires in 4 months
Facebook will stop supporting Graph API 2.9 (the version cognito uses) in 4 months.
Are there plans to update Cognito?
If not, I need to start now to remove my dependency on Cognito."
AWS IoT Device Management	"Re: facebook 2.9 api expires in 4 months
Can I get an answer to this?

Also, does anyone else not have this same question?  If not, why not?

(I think this would be of huge concern to most cognito users?)"
AWS IoT Device Management	"Change background outside of the User Pool App?
Hi Team,

Silly question, would it be possible to customize background color outside of the login panel in the User Pool App? Everything else can be customized (including the background ""inside"" of the login panel), but the ""global"" background remains gray. Perhaps we could even add a custom background image or other rendering nicety (e.g. a gradient).

Thanks"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hello,

Within the modal it can be done. I believe the class is .background-customizable. 
 However, I just saw that this is missing in the documentation so we will update it there as well.

If you mean outside the modal, then we do not support that.

Edited by: awslex on Aug 28, 2017 11:18 AM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
I see. Yes, I meant outside of the modal. Thanks

Edited by: denvlad on Aug 28, 2017 2:20 PM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Do you guys are planing to allow change the background color outside the modal ? 

My feedback is that the current color does not looks good and it is hard to combined with any other color that we could put to the modal

Thanks 
Francisco

Edited by: fmontada on Aug 28, 2017 4:52 PM"
AWS IoT Device Management	"....
Hey

Edited by: fmontada on Dec 23, 2017 11:34 AM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
We need to be able to do this as well."
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
+1.  We would also like to change the global (outside of the modal) background color of the hosted UI."
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hello,

As mentioned above, currently, changing the background outside the modal is not supported for Hosted UI. The list of modifications that you can currently perform are mentioned in the below documentation:

https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-ui-customization.html

You can also create your own custom UI and use AWS Amplify to implement Cognito Authentication:

https://aws-amplify.github.io/docs/js/authentication

However, I would like to inform you that, the Cognito team is currently working on it as many customers have requested this. Thank you for the feedback. Once the feature is released, you will be able to perform many modifications on the Hosted UI design and feel but, unfortunately, we will not be able to provide an estimated time for the release. 

Kindly, check our products announcement page [1] and AWS Blog [2] periodically for updates. 

[1] https://aws.amazon.com/new/
[2] https://aws.amazon.com/blogs/aws/"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hi, do you have a release date for the customization of background outside of the modal?  Or at least set the default to white, not grey?

üôè"
AWS IoT Device Management	"Tokens end up in browser localStorage
Hi!
I'm using Cognito UserPools with the Javascript SDK to signup and authenticate users. Everything works fine, I'm able to signup, login and receive JWT tokens. However the tokens end up in the browsers local storage, i.e. as key 'CognitoIdentityServiceProvider.<my-user-pool-clientid>.<my-email-adress>.accessToken' with value 'eyJraWQiOiJOSDhEeEFBSzVcL....'

Obviously I don't want to have my access tokens in cleartext in local storage. Am I doing something wrong or is this a bug/beta limitation?
Cheers
/Mike

Edited by: kobmic on Jun 12, 2016 9:41 PM"
AWS IoT Device Management	"Re: Tokens end up in browser localStorage
This is the expected behavior of our client SDKs. It adds the tokens to local storage so user can use the app without logging in again after the session is closed and then restarted.

These tokens are Base64 encoded JWT tokens and are not clear text. See this guide for more details about our tokens.

If you do not wish these tokens to be stored in local storage, you can call the clearCachedTokens method on a user object whenever you want. If you do this, user will have to login again for any user action that requires him to be signed in after this."
AWS IoT Device Management	"Re: Tokens end up in browser localStorage
Very clear and direct answer. 

I'm falling in love with Amplify, AWS cognito and all the AWS Serverless  stuff

Thanks"
AWS IoT Device Management	"Adding a custom domain for cognito
We're trying to use a custom domain name for a cognito user pool. However due to us having other cloudfront configurations for that domain, cognito fails to create the custom domain name because we have *.ourdomain.com defined in another cloudfront distro.

I've setup our own cloudfront distro to point at our cognito url, but it does not work properly, it looks like there are XSS errors when the cognito login page is trying to access it's own resources via a different cloudfront distro.

Is there any way to do this? I suspect we just need our custom domain whitelisted from cognito without cognito managing our own domain in cloudfront (or have cognito just user the custom subdomain  and not try to create a cloudfront instance using *.ourdomain.com).

Any advice? At this point we figure the easiest route is to just buy another domain to use for our login page, which seems kind of wasteful to us."
AWS IoT Device Management	"Cognito configuration issues with existing app client id
Hi,
I am facing an issues in regards to a use case scenario in regards to congnito user pool and identity pool.

Use case:

We have to switch an existing partner to cognito user/identity pool but we cannot change the app client id for them. Is it possible to switch this use case or not? If yes how?

1. We have to ensure that nothing in this should change for our partners. So output should not change. 
2. Also how can we migrate current partners tokens?
3. Can we  fetch all the data current Alexa client and also check if we can migrate partner tokens ?

Kindly help me out. Any kind of help is appreciated."
AWS IoT Device Management	"Re: Cognito configuration issues with existing app client id
Hi,

Can anybody help me out?"
AWS IoT Device Management	"Password change dialog is not shown on in first sign-up
We have a setup where we use number of identity providers in Cognito user pool. One of the providers is Cognito with username and password. We use a sign-up flow where admin creates users and they invited via email. 

Now we have the problem when a user is signing in the first time and is supposed to change the temporary password. Login with temporary password succeeds, but the change password dialog is not shown and there is the error 403 form request:   https://<our domain>.auth.eu-central-1.amazoncognito.com/changePassword?state= ... 


The error message is ""You tried to access a page that requires authentication, please try again after authenticating"".

We have other instances where this setup is working perfectly, but in this particular one we have the problem. We have compared all the settings with a working configuration and can not find a difference. Any similar experiences or ideas how to debug further?"
AWS IoT Device Management	"Restrict IAM Access To Namspaced Cognito User Pool Names
At my company we're using namespaced resource restrictions for each project.
We only have permission to create and manage S3 buckets (for e.g.) that match `project-*`.
The problem we're running into is that the Cognito User Pool's ARN only has the generated ID, so we can't restrict it based on the name. We want to have permission to create and manage multiple user pools that begin with our `project-` namespace. Is there a way to do that? Perhaps some sort of service specific IAM attribute we can add a condition for? Maybe there's a way to dictate a prefix for the user pool ID or something?"
AWS IoT Device Management	"Managing Azure SAML User Authorization in Cognito
We want to allow users in our environment to login to our javascript applications with their Azure AD credentials. We have configured a SAML identity provider for a cognito user pool which allows users to login to apps, however, now we would like to control permissions for different users. We would like to control the permissions within AWS and not have an attribute in AD that sets their role. Is this possible? The problem we are struggling with is how can cognito determine which role to assign to which user? We have hundreds of users so we don't want to build a role for each one.

We came up with a potential solution that required the role to be set in an attribute in AD (I've included a diagram of this potential solution). However, we don't like this solution because it requires that the user has a role attribute set in AD for each application and added to an azure group for each application. Additionally we would have a cognito user pool for each application. We couldn't help but think their must be a better way!

We are thinking that maybe we need to create a custom identity broker application and use LDAP instead but we are open to suggestions on the best way to move forward.

Any help would be appreciated!"
AWS IoT Device Management	"Feature Request: UI Customization - Change Background Colour (behind modal)
The UI Customization options within AWS Cognito allow for a lot of editing of the authentication modal to help it match any company branding but do not allow changes to the colour of the grey full background behind the modal. I'm requesting that editing the background colour would be added as another UI Customization option as the dark grey background clashes with our branding."
AWS IoT Device Management	"Post migration a username is created. How do I add that to a different DB?
Cognito has a migration lambda that allows us to confirm a user in our db. They send the email and PW to Cognito, the lambda fires, we verify matches, and the user is entered into Cognito.

At this point - behind the scenes - Cognito generates a username of some kind (UUID). The problem is, I need a way to get this username into our existing database, because our systems going forward will no longer rely on email and instead rely on this username.

Ideal flow:

Sign In
Migration Succeeds
Cognito generates username
Username is sent to our server.

Now because we have email set to auto-verified, no post-confirmation lambda can be called. The only way I see to do this with Cognito as-is is to either:

Ask users who already exist in our system to confirm their email again. This is a non-starter

Create a post-auth lambda, check user login count through a custom attribute, and if 0 (or if not already registered with the service, etc.) migrate the username to the new service.
If there is any other way to do this, please let me know."
AWS IoT Device Management	"How to debug cognito oauth2 request
I am trying to use cognito and as part of the first part of the oAuth2 handshake I send the following request: https://qis.auth.eu-west-1.amazoncognito.com/oauth2/authorize?response_type=code&client_id=1u8us1r2qk135ko5arei0ikop2&redirect_uri=https://d100h1es2fwleo.cloudfront.net/qis-session-manager&state=/

I receive a 302 redirect redirect to the attached error page. It merely says ""server error"". 
How am I expected to debug this?

Edited by: JimmyT on Feb 18, 2019 8:36 AM"
AWS IoT Device Management	"Re: How to debug cognito oauth2 request
I'm having exactly the same experience!  Looked through CloudWatch and enabled CloudtTrail but can't find anything to help me - feel completely helpless.  In my instance I'm hitting an App Client configured to use SAML federation.  I've narrowed the problem down to the SAML area, and I suspect my SAML metadata is causing an issue, but the same SAML metadata (provided by file, not URL) used to work, and there no errors are returned when I re-upload the file.

The URL I'm hitting to trigger the flow is: https://enterprise.auth.eu-west-1.amazoncognito.com/oauth2/authorize?response_type=code&client_id=3ifhga99ld48ttfd8j5sh1a46l&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fcallback&scope=email%20openid.  I then get a redirect back to http://localhost:3000/callback?error=server_error.  What then... ?

Could really do with help here please AWS.  If the SAML metadata file is invalid then please tell me that during the upload process. Otherwise make the 'server_error' response more meaningful with an explanation of the error.

Thanks
Andy"
AWS IoT Device Management	"Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
Hi,

I've been testing a Cognito User Pool that uses preferred_username as a login alias. I've noticed some interesting behaviors and I want to clarify the rules regarding usernames and preferred usernames.

First, I understand that regular usernames are required to be unique. However, I've also noticed it seems like preferred_usernames must be unique as well (a change from the OpenID Connect spec) at least when used as aliases. Further, I've noticed that many (all?) of the User Pool APIs seem to accept both username and preferred_username where a username is required. And finally, I've noticed that usernames and preferred usernames don't seem to be allowed to overlap ‚Äì the ""uniqueness pool"" seems to encompass both username and preferred_username.

So my questions are, when preferred_username is enabled as an alias:

1. do preferred usernames need to be unique?
2. do preferred usernames need to be unique with regard to regular usernames as well?
3. do all User Pool APIs that ask for a username also accept a preferred username alias?
4. is this behavior documented somewhere I've missed?
5. can I count on these behaviors remaining stable?

Thanks for your time!"
AWS IoT Device Management	"Re: Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
To answer your questions:
When preferred_username is enabled as an alias:
1. do preferred usernames need to be unique?  - Yes
2. do preferred usernames need to be unique with regard to regular usernames as well? - Yes
3. do all User Pool APIs that ask for a username also accept a preferred username alias? - Yes, Except ListUsers API for search.
4. is this behavior documented somewhere I've missed? - You can look at this documentation: https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html
5. can I count on these behaviors remaining stable? - Yes"
AWS IoT Device Management	"Re: Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
I am using email as an alias, with uniqueness constraint. It works fine when somebody tries register with the same email - the system returns an error and the user cannot proceed.

However, I have found out that the constraint can be broken if one uses other identity providers like Facebook or Google.

1. Assume a user registers in cognito with an email user@email.com
2. Then the same user, uses his Facebook account (that also has user@email.com) to register
3. You end up with two accounts with the same alias, user@email.com

Note that, if one tries 2 and then 1, they will get an error, as they should.

I am trying to create a pre-signup lambda trigger to reject a signup request from a social account that an already-registered email. The problem is that you cannot query cognito with aliases. Any ideas?"
AWS IoT Device Management	"Custom domain with API-only Cognito integration
We are using our own client UI for authentication through Cognito, leveraging the Core/Auth modules in the AWS Amplify library.  We would like to set up a custom domain so that any API calls for purposes of authenticating through Cognito are against our own subdomain.

All of the documentation I can find around custom domains with Cognito references custom domains for the Hosted UI, but there is no discussion regarding whether the underlying API calls will be against that custom domain or the default cognito-idp.xx-xxxx-x.amazonaws.com
 domain.

Can anyone confirm whether custom domains are compatible/valid with an API-only integration with Cognito?

Thanks!"
AWS IoT Device Management	"Unauthenticated users calling Sagemaker InvokeEndpoint
I have added the following to my unauth policy but I still get the following message:

User: arn:aws:sts::#####:assumed-role/Cognito_####Unauth_Role/CognitoIdentityCredentials is not authorized to perform: sagemaker:InvokeEndpoint on resource: ###

{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Sid"": ""VisualEditor0"",
            ""Effect"": ""Allow"",
            ""Action"": ""sagemaker:InvokeEndpoint"",
            ""Resource"": ""*""
        }
    ]
}"
AWS IoT Device Management	"Re: Unauthenticated users calling Sagemaker InvokeEndpoint
Any help would be appreciated.

If unauthenticated users cannot call InvokeEndpoint,  we would be forced to include access keys in the app."
AWS IoT Device Management	"Invalid IdP token for the user error
I'm trying to get AWS Cognito set up with my Okta SAML2.0 server. I've set up the user pool, my app client, my domain name, my identity provider and am using the sample beta SDK code.

I successfully get redirected to my Okta log in, but then when I log in via Okta and get redirected back, I get the error:

""Invalid IdP token for the user. Invalid user attributes: email: The attribute is required""

I suspect this is a configuration issue, but I'm unclear as to where the configuration problem lies.

I've attached a supporting image if it helps.

Any help would be appreciated!"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
Seems like in your user pool setup email is a required attribute. You will need to create an attribute mapping in Cognito console to populate email from incoming SAML Assertion. Additionally, you will need to make sure that your okta IdP setup populates the email claim in SAML assertion.
You can find more details related to defining attribute mapping in this blog:
https://aws.amazon.com/blogs/mobile/amazon-cognito-user-pools-supports-federation-with-saml/"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
We are having a similar issue.  We are trying to integrate our Azure AD with Cognito.  We believe we have followed all setup instructions per https://aws.amazon.com/blogs/mobile/amazon-cognito-user-pools-supports-federation-with-saml/

when we try and login to our browser app with AD, we get the following error in response

login?error_description=*Error*+in+SAML+response+processing%3A+Invaliduser*attributes*%3A+*email*%3A+The+attribute+is+required+&state=4PWzu8yHLuQYLtgI8jurCVJQKQFCbswD&error=server_error

see attached screenshots showing we have added the SAML attributes in Cogntio and Azure AD"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
@gamma1-  We came across similar issue. If you found the solution to your problem, could you please share it here. It will be a great help. I really appreciate it."
AWS IoT Device Management	"Re: Invalid IdP token for the user error
Make sure to find out your actual SAML assertion response and SAML attributes in it. You can capture SAML response in your browser using steps described here. https://docs.aws.amazon.com/IAM/latest/UserGuide/troubleshoot_saml_view-saml-response.html

In this case, SAML attribute string may be set up as NAMESPACE column shown in your Azure AD side. Something like this 'http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress' (instead of string 'emailaddress') 

In Cognito UserPools, go to  Attribute Mapping -> SAML, then use the exact attribute string that you see in the SAML response and map it to Email."
AWS IoT Device Management	"Are User Pool customer attribute immutable?
We just added our 25th custom attribute and found out that is the limit. I don't see any way to delete a custom attribute via the GUI or the Admin APIs. Is there any way that I'm missing, or is my User Pool locked with the existing 25 custom attributes?"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Hi,

Apologies for the issues. You are correct,  25 is the limit and they can't be removed, per the docs. We've heard the request for adding the ability to delete custom attributes from other customers and will prioritize it in future releases."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Thank you."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Any change here? I've got a typo in one of my custom attributes but can't edit or delete it. And just noticed it allows me to create an identically named custom attribute with only the mutable / immutable checkbox being different which seems odd since it appears to either the 2nd one anyway."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Any update? I need to delete a custom attribute"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1 for edit & removal"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1, especially for editing from the console.  

It's not too hard with AWS CLI, but the console would make it easier.  Thanks!"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1 for remove custom attributes"
AWS IoT Device Management	"should we secure client-id and userpool-id ?
Hi,

I have a javascript application integrated with cognito, using javascript SDK. The SDK requires user pool Id and Client Id, to connect with congnito. Everything works fine, no issues. 

My concern is that, should I hide these client-id and userpool-id from javascript code, so that the users wont be able to see from the sources (in the browser). or these public information ?"
AWS IoT Device Management	"Updates to Cognito custom attributes not showing up in Lambdas
We're using cognito user pools to authenticate lambdas via API Gateway. We get an Authorizer information in the ApiGatewayRequest which has the custom attributes that's been set in the cognito user pools.

However, it looks like if I update the custom attributes in Cognito, these don't get reflected in subsequent Lambda executions (ApiGatewayRequest still doesn't have new attributes). It's only when I log out and log back in again, that the new custom attributes appear.

Is there a cache somewhere that I can invalidate? Any tips here?"
AWS IoT Device Management	"Re: Updates to Cognito custom attributes not showing up in Lambdas
This is the same issue discussed in this thread and seems to be a bug  https://forums.aws.amazon.com/click.jspa?searchID=11528224&messageID=779681"
AWS IoT Device Management	"Re: Updates to Cognito custom attributes not showing up in Lambdas
Last update was 2017. Still not solved?"
AWS IoT Device Management	"authenticateUser error messages
When I call this function with a bad password the server returns ""Incorrect username or password"" which seems to be the standard phrase to not leak any insight into whether or not this is a valid account name.  But if I use an invalid email address the returned message is ""User does not exist"".

It seems to be a common practice to print such messages directly to the user, but in this case that would not be ideal so I'd have to check for this exact string and remap it.  This of course is very fragile if the server strings ever change slightly.  Just curious what the Cognito team's thoughts are on this language?"
AWS IoT Device Management	"Re: authenticateUser error messages
Cognito User Pools APIs throw different error types for different scenarios. You should rely on the type of error instead of the message in the error.

For example, UserNotFoundException is thrown if the user does not exists, UserNotConfirmedException is thrown if user exists but is not confirmed, NotAuthorizedException if the user given wrong username/password combination and so on as explained in our API reference."
AWS IoT Device Management	"Re: authenticateUser error messages
Hello,

Thanks for the reply.  I understand what you are saying and I would never write code against a particular response message as it could potentially change at any time.  My point was that the specific message you are returning in this case leaks information that could be considered a security risk.  Specifically, it would let an attacker know that they have found a valid username because they will start getting a different message back which indicates the account exists but they just have the wrong password.  The industry standard approach seems to be to return something like ""Incorrect username or password"" in all cases so the user (attacker) never knows if they have found an actual account.

Also, I do understand that I could look at the individual codes and build my own messages, I just think it is common practice to use the human-readable messages that the server returns as-is.  This isn't a huge deal, just something I thought I should point out."
AWS IoT Device Management	"Re: authenticateUser error messages
Thanks for pointing this out. When user pools was in public beta, sign in was only returning 'Incorrect username or password' for each request similar to what you suggested. However, we have changed this behaviour at the request of users. See for example the discussion below:

https://github.com/aws/amazon-cognito-identity-js/issues/42"
AWS IoT Device Management	"Re: authenticateUser error messages
Hello,

It's been almost two years since this thread was last active and I'd like to know AWS's position on this matter. I share the same concern expressed by the OP and other people (https://github.com/amazon-archives/amazon-cognito-identity-js/issues/42#issuecomment-319699401) regarding the security hole that returning different error messages creates. As it's recommended by OWASP (https://www.owasp.org/index.php/Authentication_Cheat_Sheet#Authentication_and_Error_Messages), ""https://forums.aws.amazon.com/ should respond with a generic error message regardless of whether the user ID or password was incorrect. It should also give no indication to the status of an existing account."". It greatly surprised me to read that AWS chose to compromise security ""at the request of users"". AWS Cognito presents itself as a ""Simple and Secure User Sign Up & Sign In"", and as such it should implement all industry best-practices.

Is it possible for you to reconsider and revert this behavior? Is there any additional barrier in place to prevent the abuse of this functionality? I'm having second thoughts about using AWS Cognito because of this, doubting about the seriousness of its implementation.

Thanks,
Mat√≠as"
AWS IoT Device Management	"Re: authenticateUser error messages
I agree with Matias--what Cognito is doing here does not conform with the information security industry's view of how you should handle login failures, and it will prevent enterprises (your biggest cash cows, AWS!) from adopting Cognito.

Please, at the very least, make an option to not provide this information back, and give the exact same failure when a password is wrong and when a username does not exist."
AWS IoT Device Management	"Re: authenticateUser error messages
Totally agree with that problem. Add option to switch on/switch off various error's messages. It's a big security problem to receive specific error message."
AWS IoT Device Management	"Re: authenticateUser error messages
+1, I just started implementing against Cognito and found it a bit unexpected that it didn't follow this fairly common best practice."
AWS IoT Device Management	"Re: authenticateUser error messages
Exception messages should be customisable, please can we have this feature?"
AWS IoT Device Management	"Re: authenticateUser error messages
+1"
AWS IoT Device Management	"Re: authenticateUser error messages
+10"
AWS IoT Device Management	"Re: authenticateUser error messages
Just stumbled to this thread while searching for JWT refresh information.
Couple of days ago started to get into Cognito and auth error messages got me thinking the same."
AWS IoT Device Management	"IdP initiated auth with Okta
Hi,

I've setup a Cognito user pool with a federation to a test Okta environment. This all works perfectly well with an SP initiated authentication flow, i.e. redirecting to https://myapp.auth.eu-west-1.amazoncognito.com/login?response_type=token&client_id=xxxx ....

However it doesn't work when I try to initiate the flow directly from Okta i.e. https://myapp.okta.com/app/poc/xxx/sso/saml

Okta offers an 'application dashboard' where users can access applications. Each application link uses  IdP initiated approach. When trying to access my app in this way, I get prompted to login to Okta and then an error from a Cognito page: ""Invalid samlResponse or relayState from identity provider"".

I've a suspicion the answer lies in the ""default relay state"" option that Okta offers, as if Cognito needs some additional context such as user pool ID, client ID etc to successfully authenticate. If I try specifying a URL as the relay state, I get a blank error on the aforementioned Cognito page.

Having examined the redirect Cognito builds when redirecting to Okta in a SP-initiated flow, it is absolutely passing on a RelayState. This seems to be a twice (?) base64 encoded JSON string. Decoding this yields an object:

{""userPoolId"":""eu-west-1_XXX"",""providerName"":""Okta"",""clientId"":""XX"",""redirectURI"":""https://localhost:5000/auth"",""responseType"":""token"",""providerType"":""SAML"",""scopes"":,""state"":null,""codeChallenge"":null,""codeChallengeMethod"":null,""serverHostPort"":""myapp.auth.eu-west-1.amazoncognito.com"",""creationTimeSeconds"":1513799357}

This might be the context I need in an IdP flow.

So, I guess my question is: is what I'm trying to do supported? If so, is it just a case of ensuring the relay state is set correctly? Or have I entirely misunderstood?

Thank you for any guidance,
Alex"
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Hi Alex,

Thank you for the question. Cognito User Pools do not currently support the IdP-initiated SAML flow. We do have that support on our roadmap.

Regards,
Tim"
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Great, glad it's on the roadmap."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
+1

This is a broken experience from an Auth system dashboard if our App's link goes to a Cognito error page."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Is the functionality of IdP-initiated SAML flow is available now?"
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Can we please have an update on this?
We are due to a major Auth refactor of our application and we're considering using Cognito for it, but we need to support IDP-initiated flow as one of base requirements.
Are there any easy, but secure workarounds? Like using Lambda etc..."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
We also need support for IDP-initiated authentication. Any update on this?"
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Any update on this? It was added to the roadmap a while ago. We still need support for IDP-initiated SAML flow."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
+1
Any updates on availability to share?  The absence of IdP-initiated SAML auth flow is a pretty big omission from a SAML offering over 2 years old"
AWS IoT Device Management	"Re: IdP initiated auth with Okta
+1 same support required from Google Apps IdP."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Any update on whether this is supported? It appears this is still not supported."
AWS IoT Device Management	"Re: IdP initiated auth with Okta
Actually FWIW I was able to get this working with OneLogin. I imagine the same steps would work for Okta though. 

The main thing that made it work for me was to use the ""Service Provider"" SAML Initiator vs the OneLogin initiated flow. In the background this appears to call the cognito /authorize endpoint which winds up creating the correct RelayState for this login flow.

If you're following the blog post instructions from https://aws.amazon.com/blogs/mobile/amazon-cognito-user-pools-supports-federation-with-saml/, ignore most of the information in Step 3 and follow below. Again, I've only confirmed that this works in OneLogin:

Create a new app and use the ""SAML Test Connector (Advanced)"" type. Once that is created update the configuration information as follows:

RelayState: <I left this blank>
Audience: urn:amazon:cognito:sp:<Your user pool ID>
ACS (Consumer) URL Validator: https:\/\/YOUR_APP_NAMEamazoncognito.com\/saml2\/idpresponse
ACS (Consumer) URL: https://YOUR_APP_NAME.auth.us-east-1.amazoncognito.com/saml2/idpresponse
Single Logout URL: <I left this blank>
Login URL: https://YOUR_APP_NAME.auth.us-east-1.amazoncognito.com/oauth2/authorize?identity_provider=Modio2&redirect_uri=CALLBACK_URL_HERE&response_type=CODE&client_id=YOUR_CLIENT_ID_HERE&scope=aws.cognito.signin.user.admin carbon-api/search.fuzzy email openid
SAML Initiator: Service Provider
SAML encryption method: AES-256-CBC


Under the ""Parameters"" table I also included the following parameters (mapping below is ""SAML Test Connector Field"" : ""Value""). These need to be included in the SAML Response and mapped to the Cognito User (under Attribute mapping part of Step 2 in the blog post above):

Email: Email
FirstName: First Name
LastName: Last Name


This now works seamlessly using either the hosted Cognito UI or straight from OneLogin.

Edited by: ejhayes10 on Feb 12, 2019 2:18 PM"
AWS IoT Device Management	"User Pool Backups?
I have noticed that there is no facility to get a backup from a user pool, this is quite needed for a production environment, any idea on when this would be available? I know there is an export facility but this has some shortcoming:

1) sub changes from between export/import making them unusable as user id (I now use the username instead)
2) federated identity token and information are not exported
3) the experience is not as simple as recovering a snapshot like in RDS
4) groups and groups relationships are not exported

Best,
R"
AWS IoT Device Management	"TooManyRequestsException: Rate exceeded - Cognito API Limits
We are trying to test our applications performance by signing in many users at once and performing operations with those users with the APIs that we have created in the API Gateway. So at the moment this is all at the API level with no UI involved. We are running into TooManyRequestsException: Rate exceeded errors though due to the default limits for the Cognito APIs specifically the user authentication operations that come with the AWS .NET SDK, which appear to have a limit of 10 to 20 requests/second depending on the API(https://docs.aws.amazon.com/cognito/latest/developerguide/limits.html).  For reference, our authentication process exactly mimics that of the Client Side Authentication flow here https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-authentication-flow.html. If the authentication tokens have expired we make a call to the InitiateAuth API again with the REFRESH_TOKEN to get new tokens. The specific error we see are seeing is...

Amazon.CognitoIdentityProvider.Model.TooManyRequestsException: Rate exceeded ---> Amazon.Runtime.Internal.HttpErrorResponseException: The remote server returned an error: (400) Bad Request.

We can work around these limits in our test environment by throttling how many users we are signing in at once, but we are having trouble understanding why the default rate limits are so low. It is likely that many users may sign in at the same time and/or need updated credentials at a rate higher than what the default limits are.  I understand a service limit increase can be requested, but with such a low starting rate we are starting to question whether or not we missed something or have set up the Cognito authentication process incorrectly. A previous product of ours at a peak time saw up to 750 concurrent session requests, which is what we are attempting to model using load/performance testing to make sure our application is properly handling that load to our expectations. We run our tests all in one account and in one UserPool, which is what our production environment will also look like, at least initially.

My main questions stemming from this are...
Why are the default limits so low? Do these rates actually support most use cases?

What is the best way to handle these Rate exceeded errors in a production environment before going the route of requesting a service limit increase? I assume similar to recommendations I have seen for other AWS services some sort of retry logic would be needed to handle this?

What is a reasonable service limit increase request for the load we are initially trying to support?

Edited by: DigiMoore on Feb 12, 2019 11:45 AM"
AWS IoT Device Management	"Cognito: send verification code to phone_number and email on signup?
Hi,

I am using AWS cognito to manage users. I want to send a verification code to user's phone_number and email on sign up(I am able to send code to phone_number or email, but not to both). I did not find a way to achieve it in cognito.

Please suggest me a way to achieve it.

I appreciate for your time.

Best Regards,
Prashanth Thugaiah"
AWS IoT Device Management	"Re: Cognito: send verification code to phone_number and email on signup?
Hello Prashanth,

Currently, if a user signs up with both a phone number and an email address, and your user pool settings require verification of both attributes, a verification code is sent via SMS to the phone. The email is not verified and the flow must be implemented in the app.

Your app needs to call GetUser [1] to see if an email address is awaiting verification. If it is, the app should call GetUserAttributeVerificationCode [2] to initiate the email verification flow and then submit the verification code by calling VerifyUserAttribute [3]. This is explained in our public documentation [4] under the notes section. You will be able to send the code to emails using this set up. 

Hope this helps. Let us know if you have any further queries.

[1] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_GetUser.html
[2] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_GetUserAttributeVerificationCode.html
[3] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_VerifyUserAttribute.html
[4] https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-email-phone-verification.html"
AWS IoT Device Management	"Customize Landing Page from Verification Email
Is it possible to customize the landing page that is reached from the link on the Verification Email?  Currently the URL is like: https:<custom-domain>.auth.us-west-2.amazoncognito.com/confirmUser?client_id=<client_id>&user_name=<user>&confirmation_code=<code>.  

I was able to get a logo image on the page, but no other customization.  Can we redirect back to our site after verification?

The default text is ""Your registration has been confirmed!"".  Can this text be modified to contain a link back to the site?

Thanks,"
AWS IoT Device Management	"Re: Customize Landing Page from Verification Email
Hi,

Thank you for your question. At this time, it is not possible to customize text, but it is on our roadmap to enhance both UI customization and text customization.

-Meghana"
AWS IoT Device Management	"Re: Customize Landing Page from Verification Email
+1 for this!"
AWS IoT Device Management	"Re: Customize Landing Page from Verification Email
+1 for this plus using a custom domain for the landing page!"
AWS IoT Device Management	"Re: Customize Landing Page from Verification Email
+1"
AWS IoT Device Management	"Re: Customize Landing Page from Verification Email
Hello,

The list of modifications that you can currently perform on Hosted UI are mentioned in the below documentation:

https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-ui-customization.html

You can also create your own custom UI and use AWS Amplify to implement Cognito Authentication:

https://aws-amplify.github.io/docs/js/authentication

However, as mentioned above, I would like to inform you that, the Cognito team is currently working on it as many customers have requested this. Thank you for the feedback. Once the feature is released, you will be able to perform many modifications on the Hosted UI design and feel but, unfortunately, we will not be able to provide an estimated time for the release. 

Kindly, check our products announcement page [1] and AWS Blog [2] periodically for updates. 

[1] https://aws.amazon.com/new/
[2] https://aws.amazon.com/blogs/aws/"
AWS IoT Device Management	"Cognito jwt token fails verification every time
This is the access token I get from logging in a user;
eyJraWQiOiJ3bXF3Q2ttbVFubll1RXJEVGU2MDVOWUdMR0VTSW5iWUVmd3ZBeXJHc053PSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJiMTMzZWQ0ZC02ZmUwLTQ0YjgtYjZiOS00YWY4NmJkMDYzMmQiLCJldmVudF9pZCI6IjlkMTE0N2I0LTU0NDItMTFlOC04YTIxLWM3Y2U2NjBlOWVlMCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE1MjU5NTA1NzEsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX21yazRSeWpZeiIsImV4cCI6MTUyNTk1NDE3MSwiaWF0IjoxNTI1OTUwNTcxLCJqdGkiOiIxNzkyYzk0Ni00ZWVkLTRjY2MtYTAzZS1mOTcyNDFlMzkxMTUiLCJjbGllbnRfaWQiOiI2dXBlNm5kdW5ka3Y3ZjVpOWpsbzZhOHAydCIsInVzZXJuYW1lIjoiam9uYXRoYW5rb3NnZWkxMDAwQGdtYWlsLmNvbSJ9.svSsUbl0deDKhQfQju-rjmmNVz31ljQLzaTDV_je3LeP-qDS1kYU8RC3k2cyQkq9xjFvHoSwUWQ4zbgLgDfcjnktvpbSNjuCvAvv-8MpQiD83b3OnsiNV0mgddegl-GBInMQplNVJgBIDchOeTsJc2Qkz8XNM7J3yUpS4B1QXgIOZJUjHagXjTbQwi_VAUMi-qs5hFpfeaRDh6zalYAeRBvNLxaQObZytAwrPges2eOEmC31v8sGOrZkWC577yb36qMuVSrtRgKwlKKsiuucPB44b4oB7zXO6jqRjPyY3rEo7GzCzGhwK_73gAwkSekENSrYA6NtnZqMFm3L1sGCIA

The public key for this user pool, matching the kid is;
umZZl1U3GFFZyVTRmHLgb1II9-fOIqg9CT4gGDyfLglsPMBV3m6G88KhgiStpnY_nmR_yx0PewIBYPJNEC6xxdKxDbKkIA7oZz-P-I1qJwYQsyhIfmVd9IwGIebYu1ZNrlJmseu4axi-Q3NbjRs4svXDt_WF4bkmGIvdlt35xta7-Djo-WiGWfFZBaurnDZqtIZ4xl_CJW0rByX1hBHSUn_sS4JL8YUnPC8vLDUXlG5sLH_7BTI1VMtpWWqROnY9B_J8fR6oDdaSWP_BaYQQr8g6ye3a95zpaTweTNnom2VMgj9g23qPYrKD9zXL4oXTjjTb0MbUHRLP8FcYI7E5Sw

I get the token from cognito directly with valid credentials, however all the tokens I've generated dozens of times always fail jwt verification. Every single one.

A validly generated jwt token from cognito signin should be verifiable with the correct public key.

I've tried the verification in Python in Node and on jwt.io, none worked."
AWS IoT Device Management	"Re: Cognito jwt token fails verification every time
I‚Äôm having the same problem. How are you getting your token? Through the browser with the Cognito login link?

I‚Äôm calling the /login Cognito API endpoint in Chrome to obtain a token, with response_type
 set to token
 - this returns an ID token, and I wonder if that‚Äôs the problem. Will the Cognito Authorizer test respond positively only to an access token? If so, how can I obtain the Access token from the /login endpoint?

I have also tried using the ID token in the Authorization header via Postman, but it also returns unauthorised.

For clarity, I am copying and pasting the token from the callback url, where it shows #id-token
.

Perhaps I‚Äôm missing something else... do I need to allocate the users in my pool to a group with an appropriate IAM role (i.e. to allow API gateway calls) before the test will pass?"
AWS IoT Device Management	"Re: Cognito jwt token fails verification every time
Hi,

I tried to verify the given token (skipping expiration check) and was able to do so. I would request you to confirm if the public key being used by you is correct. I used these Node packages to verify the same: jsonwebtoken & jwk-to-pem. I also tried to log the PEM public key used to sign this token and got a different key. 

//Usage: node verifyJWT.js <token_type> <ignoreExpiration> <userpoolID> <region> <ignoreExpirytoken> [pub]
//Example: node verifyJWT.js access true us-east-1_Hjsxxxx us-east-1 mytoken pub
var jwt = require('jsonwebtoken');
var request = require('request');
var jwkToPem = require('jwk-to-pem');
¬†
var userPoolId = process.argv[4];
var region = process.argv[5];
¬†
var token_type = process.argv[2];
var ignoreExpiry = process.argv[3];
var token = process.argv[6];
var print_pub = process.argv[7];
¬†
var iss = 'https://cognito-idp.' + region + '.amazonaws.com/' + userPoolId;
var pems;
¬†
verify(token);
¬†
function verify(token) {
  console.log('Verifying...');
  //Download PEM for your UserPool if not already downloaded
  if (!pems) {
    //Download the JWKs and save it as PEM
    request({
      url: iss + '/.well-known/jwks.json',
      json: true
    }, function(error, response, body) {
      if (!error && response.statusCode === 200) {
        pems = {};
        var keys = body.keys;
        for (var i = 0; i < keys.length; i++) {
          //Convert each key to PEM
          var key_id = keys[i].kid;
          var modulus = keys[i].n;
          var exponent = keys[i].e;
          var key_type = keys[i].kty;
          var jwk = {
            kty: key_type,
            n: modulus,
            e: exponent
          };
          var pem = jwkToPem(jwk);
          pems[key_id] = pem;
        }
        //Now continue with validating the token
        var isValid = ValidateToken(pems, token);
        console.log(""Is token valid?"");
        console.log(isValid);
      } else {
        //Unable to download JWKs, fail the call
        console.log(""Error downloading JWK!"");
      }
    });
  } else {
    //PEMs are already downloaded, continue with validating the token
    var isValid = ValidateToken(pems, token);
    console.log(""Is token valid?"");
    console.log(isValid);
  }
}
¬†
function ValidateToken(pems, token) {
  var isValid = false;
  //Fail if the token is not jwt
  var decodedJwt = jwt.decode(token, {
    complete: true
  });
  //console.log(decodedJwt);
  if (!decodedJwt) {
    console.log(""Not a valid JWT token"");
    return;
  }
¬†
  //Fail if token is not from your UserPool
  if (decodedJwt.payload.iss != iss) {
    console.log(""invalid issuer"");
    return;
  }
¬†
  //Reject the jwt if it's not an 'Access Token'
  if (decodedJwt.payload.token_use != token_type) {
    console.log(""Not an "" + token_type + "" token"");
    return;
  }
¬†
  //Get the kid from the token and retrieve corresponding PEM
  var kid = decodedJwt.header.kid;
  var pem = pems[kid];
  if (print_pub == 'pub') {
    console.log('Public Key: ');
    console.log(pem);
  }
  if (!pem) {
    console.log('Invalid access token');
    return;
  }
¬†
  //Verify the signature of the JWT token to ensure it's really coming from your User Pool
  console.log('Ignore expiry?\n' + ignoreExpiry);
  if (ignoreExpiry == 'true') {
    console.log('Skipping expiration check...');
    jwt.verify(token, pem, {
      issuer: iss,
      ignoreExpiration: true
    }, function(err, payload) {
      if (err) {
        console.log(err);
      } else {
        console.log(payload);
        isValid = true;
      }
    });
  } else {
    console.log('Also checking token expiration...');
    jwt.verify(token, pem, {
      issuer: iss,
      ignoreExpiration: false
    }, function(err, payload) {
      if (err) {
        console.log('Error verifying token: ' + err.name + ':' + err.message);
      } else {
        console.log(payload);
        isValid = true;
      }
    });
  }
  return isValid;
}


Regards,
Abhilash"
AWS IoT Device Management	"Re: Cognito jwt token fails verification every time
Hi, Abhilash

I also have the same problem. I have copy & paste your code and run locally. It says ""not a valid JWT token"".

This is my token:
eyJraWQiOiJrYnhFYm9GalRyRjlOVWFjbzFVenNZOUxkUEVYZ2hlaTJ2aVlwQ0NhQUxVPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiQmZQR1l6ZXROYkNKWGFlSVNTX2lpdyIsInN1YiI6IjlhMDk5ZDI5LTdhNDktNGYxNi1hZTY1LWFlNTkzY2YxNTljMSIsImF1ZCI6ImRuMGY1OWh1ZGF1cDdsODVvMHVxNm5yaDIiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1NDk4MTExMjMsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy13ZXN0LTIuYW1hem9uYXdzLmNvbVwvdXMtd2VzdC0yX3IwazVyZkJhNSIsImNvZ25pdG86dXNlcm5hbWUiOiI5YTA5OWQyOS03YTQ5LTRmMTYtYWU2NS1hZTU5M2NmMTU5YzEiLCJleHAiOjE1NDk4MTQ3MjMsImlhdCI6MTU0OTgxMTEyMywiZW1haWwiOiIyMTQ3MDYyNTdAcXEuY29tIn0.eH4QFt_CmnGfDP8YQBnIm-rhcZHuPpLYvCpXxrpNbtNrVOF730n2al8Hh9YAMNlRohJxFP661nH-eVsDatAABaMF3GpA4VDDQivLvgbx5qjF1LhINPz2vU10COKqRL6KmIzrYQ-TQVzUSu-0-oaTr4PTIQKeOyyZ2mTzz-y_f5Z5LyespANO4Q85hMuQt0Gm_wn5Khl0mWYWwiYvxYzoFuw-15J3wmFMiD4ZO7oHNuNByNbohkeVEbc2WP_vNM3NQ3yhHitoMUbm30ZaQrk_hvWogzjl_F3M8yKBFYBzd8uU9esU9xXuhjgQ7H63_jF0mQQWgqIajE5v6_AA0BbtAQ


and this is my jwks.json
{
    ""keys"": [
        {
            ""alg"": ""RS256"",
            ""e"": ""AQAB"",
            ""kid"": ""kbxEboFjTrF9NUaco1UzsY9LdPEXghei2viYpCCaALU="",
            ""kty"": ""RSA"",
            ""n"": ""ob0a3vAuDKPRQOt099SlxOIgWYd29dq-ZPpQNYKvCdjrGo5lepgtmBb9YC4-sw6753Ld-razabl83V7un1BjLFUvcmSXMP5nrhUeSRglvormsYTOdfYpBwWPFwI0GUrENNjAUA6DB0eDti3ieROdq9fgDujoBzqmJJjq7lVJ1U1HccLJzHceCKtjYjpSzveS0K5Adc9nl-7QkyuYzcdJ831T2VEIfke5RbpBnr9W7EJ2HWBWo8Xymdna4T1v4l96WM68hqM1_hjsb_ktBSqkFCuEMq_jDcss8Sn8yaHgQ97UhEW9Z3Eqo88ViFjsI5vOqLmHyIeD7GZKFbGdCvNI2w"",
            ""use"": ""sig""
        },
        {
            ""alg"": ""RS256"",
            ""e"": ""AQAB"",
            ""kid"": ""e5DLnBIwe2L2xW+4t1+2uzrMDhAv0JbiZxF6mTZx+So="",
            ""kty"": ""RSA"",
            ""n"": ""qEpcFZardygddQVxJ0mQDUgbhjaNzQzHgTFlqAxjfmRPAwfrB4Yp5ahyZI7f6ulKVFZt4vs5BollEXM_NQGKRT3TqbxWHDkdoUZttN00yMkWNvzEZJOYQ6iT_M8NvniWcOnhtkaDXKvE8rLnQJYj4EczPQ9gD7c7OSQQBj5iO2Zs4Ecp8pqfYvOFU3dkV0DnSS0TM2sN4rEuszQ_Aj2rSD79wq-GJ23bx4VDZ6lhZQuCY6h3clOufRuXkUZNQOrd90mEsSPxKtRJEqJyFBgBEUeDuqXpUiNpgA9MfNzyGV6CdSmKBUsw5zgq7efS96aMcZuAMXB513iL-nGl1l0FIQ"",
            ""use"": ""sig""
        }
    ]
}"
AWS IoT Device Management	"Re: Cognito jwt token fails verification every time
Sorry, it can be validated"
AWS IoT Device Management	"Access S3 bucket after authenticating on Cognito from other account
I have two AWS accounts. The account A has a Cognito identity pool configured with roles for Authenticated and Unauthenticated.

The trusted relationship policy for Authenticated role looks like this:

{
  ""Version"": ""2012-10-17"",
  ""Statement"": [
    {
      ""Effect"": ""Allow"",
      ""Principal"": {
        ""Federated"": ""cognito-identity.amazonaws.com""
      },
      ""Action"": ""sts:AssumeRoleWithWebIdentity"",
      ""Condition"": {
        ""StringEquals"": {
          ""cognito-identity.amazonaws.com:aud"": ""<identity_pool_id>""
        },
        ""ForAnyValue:StringLike"": {
          ""cognito-identity.amazonaws.com:amr"": ""authenticated""
        }
      }
    }
  ]
}


There is also a policy for Authenticated role that looks like this:

{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Action"": [
                ""s3:GetObject"",
                ""s3:PutObject"",
                ""s3:DeleteObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/public/*"",
                ""arn:aws:s3:::users-pictures/protected/${cognito-identity.amazonaws.com:sub}/*"",
                ""arn:aws:s3:::users-pictures/private/${cognito-identity.amazonaws.com:sub}/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Action"": [
                ""s3:PutObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/uploads/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Action"": [
                ""s3:GetObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/protected/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Condition"": {
                ""StringLike"": {
                    ""s3:prefix"": [
                        ""public/"",
                        ""public/*"",
                        ""protected/"",
                        ""protected/*"",
                        ""private/${cognito-identity.amazonaws.com:sub}/"",
                        ""private/${cognito-identity.amazonaws.com:sub}/*""
                    ]
                }
            },
            ""Action"": [
                ""s3:ListBucket""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures""
            ],
            ""Effect"": ""Allow""
        }
    ]
}


On account B I have an application that must authenticate on Cognito from account A, but needs to access a bucket on account B.

This application uses Storage from Amplify.

The bucket structure must be something like this:

users-pictures/private/${cognito-identity.amazonaws.com:sub}/*


When Amplify authenticates on account A and tries to access this bucket on account B, it gets an Access Denied (403).

Probably it's missing some configuration on account A and/or account B.

Could you help me, please?

Edited by: rodrigosouzamendonca on Feb 11, 2019 4:15 AM"
AWS IoT Device Management	"Is it okey to start use Cognito Sync Service?
Or this service is actually deprecated?

When I open the Cognito Sync page https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-sync.html, I see a banner 
""Note
If you're new to Amazon Cognito Sync, use AWS AppSync....""

However AppSync is completely different mechanizm. In a sense Cognito Sync is ""Data Store + Data Transport"", but AppSync is ""DataTransport"" only.

I'm interesting to use Cognito sync because of it's data storing feature. However, banner on the Cognito Sync page confuses me. 
By the way, I don't want to use AppSync at this moment. 

So my question - is it okey to start use Cognito Sync or it is/will be deprecated?"
AWS IoT Device Management	"How do you debug IAM issues?
I've added this to my dnynamodb IAM role for the User table. The User table id is the federated id, yet the get item fails saying I don't have permission. It seems like it should work, but it does not. Is there a way to debug this sort of problem?

They key is:
us-east-1:cbd72a19-787a-4314-a5d7-0c695bc89657

It's pulled from AWS.config.credentials.identityId after the authenticated cognito with the username and password.

{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""dynamodb:DeleteItem"",
                ""dynamodb:GetItem"",
                ""dynamodb:PutItem"",
                ""dynamodb:Query"",
                ""dynamodb:UpdateItem""
            ],
            ""Resource"": [
                ""arn:aws:dynamodb:::table/User""
            ],
            ""Condition"": {
                ""ForAllValues:StringEquals"": {
                    ""dynamodb:LeadingKeys"": [
                        ""${cognito-identity.amazonaws.com:sub}""
                    ]
                }
            }
        }
    ]
}

  There was a problem: User: arn:aws:sts::369659351212:assumed-role/redBasisCalcRole/redBasisCalc is not authorized to perform: dynamodb:GetItem on resource: arn:aws:dynamodb:us-east-1:369659351212:table/User"
AWS IoT Device Management	"Restrict access to existing web app
I have an existing web app (Node), it works with https on my EC2 server, are there any ways to restrict access to this app?
I saw AWS Cognito docs, but all I understood - that I should modify my app. But I can't do it.

Could you give me advice about how to do that properly?"
AWS IoT Device Management	"How to use identityId for fine grained permissions in a lambda function?
I want to make sure a user only has access to their own dynamodb record using an IAM role like:

 ""Condition"": {
                ""ForAllValues:StringEquals"": {
                    ""dynamodb:LeadingKeys"": [
                        ""${cognito-identity.amazonaws.com:sub}""
                    ] }}

My understanding is sub is actually the federated id returned by:
      AWS.config.credentials.identityId

So that means I have use the identityId as the user id so LeadingKeys will match the record id.

The problem is when I authenticate the user it's in the browser context. So in the browser after authentication and refresh identityId is set.

But then I call the lambda function. In the lambda function (no API gateway) how is the identityid supposed to be set? The authentication happened in the browser not the function so all that context isn't present. I never see this talked about. Anyone know how this works?"
AWS IoT Device Management	"Migrating Users across AWS accounts for Cognito User Pools
Hi everyone,

My question regards the best practices around this and also how best to go about implementing such a system. I've taken a look at the following articles
1. https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html
2. https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-using-lambda.html
3. https://docs.amazonaws.cn/en_us/cognito/latest/developerguide/using-amazon-cognito-javascript-sdk-user-migration-lambda.html

I am currently building a lambda function to seamlessly migrate users from one cognito user pool to another across different aws accounts. This adds an extra layer of complexity as to how the lambda function will assume a role or securely access user details from a user pool in a different aws account entirely.

My current thoughts are to create IAM role on both AWS accounts and have my lambda function assume whatever is required to access the user details. Another puzzle I have is enabling boto assume these roles across accounts and bring the results back to the current account. It's a problem my team and I trying to figure. Will like to hear thoughts on this, with special emphasis on security.

Cheers!
Nyah

Edited by: nyahcheck on Feb 8, 2019 4:24 PM

Edited by: nyahcheck on Feb 8, 2019 4:25 PM"
AWS IoT Device Management	"Post Confirmation Lambda Trigger after Admin Create
Hi,

I currently have a Cognito Pool that should trigger a Lambda Post Confirmation trigger after a User is confirmed. However, I am never seeing the Post Confirmation trigger event be invoked after a User is confirmed.

I believe my process of setting up a user might be the cause of this:

1. Use adminCreateUser to build the new user.
2. Use adminInitiateAuth to login the user for the first time and get the NEW_PASSWORD_REQUIRED challenge.
3. Use adminRespondToAuthChallenge to respond and set the user's password so we bypass the need to have the user reset the password.

I am able to successfully create the user and login via this route. I see the user get to a confirmation status as well.

However, I never see a Post Confirmation event in the Lambda. I tested to make sure my Lambda was working by setting it for PreSignUp and PostAuthentication. Both of those triggered fine.

I also attempted with the standard flow of:
1. Create user as admin.
2. Get password temp for user to login via email.
3. Login for user with temp password and set new password.
4. See user get confirmed.

In that instance, no Post Confirmation event is recorded in Lambda either.

Any help or ideas I can try would be greatly appreciated."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
The Cognito User Pools service does not invoke Post Confirmation trigger in this case. Since setting the password after first sign in attempt is an authentication attempt, successful authentication and setting the password triggers Post Authentication trigger.

We understand the confusion of user status being changed from FORCE_CHANGE_PASSWORD to CONFIRMED and why customers would expect Post Confirmation trigger to be invoked. We are considering the options to elevate this confusion and will post the update here."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
Any update?
I/we do not allow users to sign themselves up. An admin will always create the users record, and send an email with a temp password.

How do I trigger an event, after the email has been verified, or after the user sets required attributes?"
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
Hi,

I had this same issue. For a workaround, I set a trigger on the POST_AUTHENTICATION hook and then tested for the UserStatus of ""FORCE_CHANGE_PASSWORD"". If a user doesn't actually set a new password and leaves the site beforehand, this will be a false positive, but it worked for us in our use case.

def handler(event, _):
    ''' handle post auth event '''
    status = event['request']['userAttributes']['cognito:user_status']
¬†
    # If the status hasn't been confirmed yet, we can assume it now is
    if status == 'FORCE_CHANGE_PASSWORD':
       # Do Something
¬†
    return event


Hope that helps."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
I got the same problem. I'm relying on the trigger to populate user profile in DynamoDB but it only works for users who log in via Facebook, Google etc. Cognito is bad!"
AWS IoT Device Management	"OAuth is not enabled for app client settings modified via API
Hi,

I'm using Terraform to create Cognito pool and related resources and got this message in ""App Integration"" -> ""App client settings"":

""Your User Pool app client settings have been modified via the Cognito User Pools API (using a Lambda or CLI), and OAuth was not enabled. See the documentation for more details.""

As a result, the Facebook login now returns an error with message:

""error_description=Client+is+not+enabled+for+OAuth2.0+flows+&error=invalid_request#_=_""

The user was created in User Pool normally but due to the above error, I couldn't get the code or token on the URL.

Any thoughts?"
AWS IoT Device Management	"Re: OAuth is not enabled for app client settings modified via API
My bad! It's my own fault of not setting ""allowed_oauth_flows_user_pool_client"". It's all good now."
AWS IoT Device Management	"BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
Attempting to create a new user pool in ap-southeast-2 gives me the following error:

    ""errorCode"": ""LimitExceededException"",
    ""errorMessage"": ""The limit for user pools is: 100."",


Except that I have requested and received a limit increase to 600, and already have well over 100 pools (so clearly I have been able to create more than 100 pools in the past).

This error has happened before, and I was advised by AWS support at that time:


I have received feedback from the service team, they have an advised there was a technical issue from the 19th to the 21st August that caused customers to receive the error you had.
¬†
The issue has been cleared and they would like you to try again, should the issue persist to please notify us so we may escalate the issue further. 
¬†


As you can imagine, any interruption to user accounts and logins represents a major disruption to our business.

Please fix this as soon as possible.

To anyone reading this who has not yet committed to using Cognito in their app: DON'T. It is an unreliable, patchwork piece of s***."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
It's been 5 days, and not even a hint of a solution.

It seems that AWS and the Cognito team simply don't care? How hard can it possibly be to respect an increased user pool limit, given that the functionality was working perfectly until a week ago.

Absolutely embarrassing for all parties concerned (including our business, as we have to explain to our customers that our ""world leading"" cloud computing provider can't be bothered providing us with the services they're supposed to be providing.)

The flow-on effects of this are huge. Please please please fix this already."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
6 days and counting. No word from AWS."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
7 days and counting. No solution in sight.

Will this ever be fixed?"
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
8 days.

Not that anyone in the Cognito team cares, obviously, but I've encountered this issue twice in the space of five months, so I assume it will happen to others as well. Moral of the story is to not use Cognito, as they routinely break the service behind your back and are in no rush to fix it."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
After 9 days, the problem has finally been resolved.

The only clue I have is that the default Cognito user pool limit has been increased to 1000 according to the docs, yet my 'create user pool' requests were being denied, citing the old default limit of 100. Both of these number ignored the fact that i had previously requested and received an increase to my limit.

Such is the way with Cognito, it seems... Things break, a week goes by, then a few more days, and then, if you're lucky, they unbreak. No explanation given.

Throughout this time, https://status.aws.amazon.com/ has reported that Cognito in ap-southeast-2 has been operating normally. In the words of Balram Halwai, ""What a f***ing joke""."
AWS IoT Device Management	"Cognito Email Messages - Specify Sender Name?
Hi all,

We're working to get email confirmations set up in Cognito, have gotten SES set up and verified an email address.  Here's the issue we're seeing that I'm not sure how to solve:

From: <support@blah.org>
Date: Wed, Dec 21, 2016 at 10:58 PM
Subject: Email confirmation
To: customer@bloo.org
¬†
Your verification code is 967786.


Is there any way to specify the sender's name so it doesn't just show up as ""<support@blah.org>"" but rather shows up as ""Support Team <support@blah.org>""? I've looked at Lambda triggers for the Custom Message but there doesn't appear to be any way to supply a sender name. Any help would be greatly appreciated!"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
Unfortunately we don't support setting the sender name at this time.  We have heard this request before and it is on our feature requests list."
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
Any updates on this?"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1

I'd like to be able to do this too."
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
me too +1"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1. Any ETA on this?"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1 - Can we get an ETA on this feature?"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1

This is a very important feature request. Need to see some action from AWS on this!

Edited by: Severus on Jun 7, 2018 8:45 AM"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1
Any update?? Its been almost 2 years. Is there any way to work around using Cognito and SES?"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
You can use a Custom Message lambda trigger and just use it to call SES and bypass cognito."
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
I'd like to add my +1 to this as well.

While I understand that a workaround can be implemented, this would be probably the 10th or 11th Cognito workaround we've had to implement to get past design or implementation flaws in AWS. It seems every week, I'm writing to AWS support about an issue, and they'll respond by confirming that I've raised a valid problem, and it's going to be flagged to the engineering team, but there's no ETA on when it will be fixed. 

It's a bit ridiculous. I'm happy with AWS overall, but feeling a little fatigue from developing on this platform."
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
Does the workaround using Lambda and calling SES directly work, though? I believe the confirmation codes are replaced by the Cognito service itself and are not available in the Lambda. Meaning, when I get a custom message Lambda trigger I receive the following JSON blob:

{
   ""version"": ""1"",
   ""region"": ""us-east-1""
   ""triggerSource"": ""CustomMessage_ForgotPassword"",
   ""request"": {
      ""userAttributes"": {
         ""sub"": ""<UUID>"",
         ""email_verified"": ""true"",
         ""cognito:user_status"": ""RESET_REQUIRED"",
         ""email"": ""hi@acme.com""
      },
      ""codeParameter"": ""{####}"",
      ""linkParameter"": ""{##Click Here##}"",
      ""usernameParameter"": null
   },
   ""response"": {
      ""smsMessage"": null,
      ""emailMessage"": null,
      ""emailSubject"": null
   }
}


That is, the codeParameter value is literally {####} and then Cognito service replaces that. I don't see how we can send custom messages if that value isn't exposed.

Additionally, I'm not sure we can stop Cognito from sending an email for the forgot password event. This means using a Lambda for the CustomMessage_ForgotPassword event results in 2 emails: one from SES directly and one from Cognito.

Edited by: Rich Schumacher on Dec 14, 2018 9:25 AM

Edited by: Rich Schumacher on Dec 14, 2018 9:32 AM"
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
Its 2019! 
Is it done yet??? Any ETA? Anything at all???

If there is a feature that is this important to customers then it shouldn't take this long.
Hopefully 2019 will be our lucky year."
AWS IoT Device Management	"Re: Cognito Email Messages - Specify Sender Name?
+1 

This is not a good UX practice and it should be addressed."
AWS IoT Device Management	"Unable to log in first-time Cognito user pool users after a recent change
Hi Team,

I've used adminLinkProviderForUser for Cognito User Pools in a pre-signup trigger to automatically link user identities from external providers to an existing identity in the pool upon first sign-in. However, due to what appears to be a recent change on AWS side, this no longer works with App Integration. Instead, upon a successful sign-up and linking in the trigger, the user gets redirected to to the login page with the error message ""Already found an entry for username"". This behavior was not there when I first programmed the trigger.

Is there any way to work around this problem, or do we have to tell users to log in twice (once for the initial sign-up, then again for the actual login)?

In fact, adminLinkProviderForUser is a paradox now: it cannot be used to link an existing identity ( after a sign-up), but using it before that (in a pre-signup trigger) leads to the aforementioned error message.  

Thank you

Edited by: denvlad on Nov 8, 2017 1:29 PM"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Denvlad, thanks for your work on this. I am encountering the same issue but have some interesting test cases to add.

I have a lambda function that executes on the Cognito Presignup trigger and will link a new external identity to an existing one if they already have a Cognito identity with the same email address. If I deploy the lambda function, create a new Cognito Pool user and then sign in using an external provider, my user and identity are successfully linked but I receive a ""PreSignUp failed with error SourceUser with the specified attribute value is already linked to another user"". Signing in again using the external provider works as expected (I get the user identity that already existed and everything is fine).

If I then try and add a second new external identity it fails with a ""Already found an entry for username <userid>"", but this time it really does fail and my external identity is added as a new user in Cognito. Adding an external provider identity also fails for a completely different user and email address in the same way.

If I redeploy my lambda function again, I can link just one external provider (albeit with an initial error message), and subsequent attempts fail. Given that the initial use of my lambda function is much slower than subsequent uses, I wonder whether there is some RACE condition involved.

Here is my lambda:

package com.cognitopresignup.lambda;
¬†
import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
¬†
import com.amazonaws.services.cognitoidp.AWSCognitoIdentityProvider;
import com.amazonaws.services.cognitoidp.AWSCognitoIdentityProviderClientBuilder;
import com.amazonaws.services.cognitoidp.model.AdminLinkProviderForUserRequest;
import com.amazonaws.services.cognitoidp.model.AdminLinkProviderForUserResult;
import com.amazonaws.services.cognitoidp.model.ListUsersRequest;
import com.amazonaws.services.cognitoidp.model.ListUsersResult;
import com.amazonaws.services.cognitoidp.model.ProviderUserIdentifierType;
import com.amazonaws.services.cognitoidp.model.UserType;
import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;
¬†
public class Handler implements RequestHandler<CognitoTrigger, CognitoTrigger> {
¬†
	@Override
	public CognitoTrigger handleRequest(CognitoTrigger input, Context context) {
¬†
		context.getLogger().log(""Invocation from Cognito: "" + input.toString());
		context.getLogger().log(""Request details: "" + input.getRequest().getUserAttributes().toString());
¬†
		String triggerSource = input.getTriggerSource();
		if (!triggerSource.equals(""PreSignUp_ExternalProvider"")) {
			context.getLogger().log(""Trigger Source was: "" + triggerSource
					+ "", but this function only handles PreSignUp_ExternalProvider"");
			return input;
		}
¬†
		// Extract user attributes from the pre-signup invocation
		String userPoolId = input.getUserPoolId();
		String sourceEmail = input.getRequest().getUserAttributes().get(""email"");
		String sourceUserName = input.getUserName();
¬†
		// Get the identity provider details from the username
		String[] sourceUserNameParts = sourceUserName.split(""_"");
		String provider = sourceUserNameParts[0];
		String providerId = sourceUserNameParts[1];
¬†
		List<String> acceptableProviders = new ArrayList<String>();
		acceptableProviders.add(""Facebook"");
		acceptableProviders.add(""Google"");
		acceptableProviders.add(""LoginWithAmazon"");
¬†
		context.getLogger().log(""userPoolId: "" + userPoolId + "" sourceEmail: "" + sourceEmail + "" sourceUserName: ""
				+ sourceUserName + "" provider: "" + provider + "" providerId: "" + providerId);
¬†
		if (!acceptableProviders.contains(provider)) {
			context.getLogger().log(""Provider "" + provider + "" not supported. User will be given a new identity"");
			return input;
		}
¬†
		// Create client connection to Cognito to retrieve the user we want to link to
		AWSCognitoIdentityProvider cognitoClient = AWSCognitoIdentityProviderClientBuilder.standard()
				.withRegion(""us-east-1"").build();
¬†
		// Search for a user we already have, with the email of the user who is
		// signing-up
		ListUsersRequest listUsersRequest = new ListUsersRequest();
		listUsersRequest.setUserPoolId(userPoolId);
		String filterString = ""email = \"""" + sourceEmail + ""\"""";
		context.getLogger().log(""emailFilterString: "" + filterString);
		listUsersRequest.setFilter(filterString);
		ListUsersResult listUsersResult = cognitoClient.listUsers(listUsersRequest);
		List<UserType> destinationUsers = listUsersResult.getUsers();
¬†
		context.getLogger().log(""Executed Cognito Query"");
¬†
		// If there are no existing users with that email, we can exit
		if (destinationUsers.isEmpty()) {
			context.getLogger().log(""No existing user with that email so exiting pre-signup"");
			return input;
		}
¬†
		// We could have one to many users
		context.getLogger().log(""Users found with email: "" + destinationUsers.size());
¬†
		// Order the users by when they were created and choose the oldest as the
		// destination
		destinationUsers.sort(Comparator.comparing(UserType::getUserCreateDate));
		for (UserType user : destinationUsers) {
			context.getLogger().log(""User: "" + user.getUsername() + "" created "" + user.getUserCreateDate());
		}
		UserType destinationUser = destinationUsers.get(0);
¬†
		// Extract the destination user details
		String destinationUserName = destinationUser.getUsername();
		context.getLogger().log(""destination userName: "" + destinationUserName);
¬†
		// Work out the Destination user provider from the username
		String destinationUserProvider;
		if (providerId.startsWith(""Facebook"")) {
			destinationUserProvider = ""Facebook"";
		} else if (providerId.startsWith(""Google"")) {
			destinationUserProvider = ""Facebook"";
		} else if (providerId.startsWith(""LoginWithAmazon"")) {
			destinationUserProvider = ""LoginWithAmazon"";
		} else {
			destinationUserProvider = ""Cognito"";
		}
¬†
		// Create the destination user
		ProviderUserIdentifierType destinationProviderUserIdentifierType = new ProviderUserIdentifierType();
		destinationProviderUserIdentifierType.setProviderAttributeValue(destinationUserName);
		destinationProviderUserIdentifierType.setProviderName(destinationUserProvider);
¬†
		// Create the source user
		ProviderUserIdentifierType sourceProviderUserIdentifierType = new ProviderUserIdentifierType();
		sourceProviderUserIdentifierType.setProviderAttributeValue(providerId);
		sourceProviderUserIdentifierType.setProviderName(provider);
		sourceProviderUserIdentifierType.setProviderAttributeName(""Cognito_Subject"");
¬†
		// Perform the link
		AdminLinkProviderForUserRequest linkRequest = new AdminLinkProviderForUserRequest();
		linkRequest.setUserPoolId(userPoolId);
		linkRequest.setDestinationUser(destinationProviderUserIdentifierType);
		linkRequest.setSourceUser(sourceProviderUserIdentifierType);
		AdminLinkProviderForUserResult linkResult = cognitoClient.adminLinkProviderForUser(linkRequest);
		context.getLogger().log(""Result HTTP Metadata: "" + linkResult.getSdkHttpMetadata() + "". Result Metadata: ""
				+ linkResult.getSdkResponseMetadata());
		context.getLogger().log(""Finished"");
¬†
		return input;
	}
¬†
}


And the CognitoTrigger is modelled like this

package com.cognitopresignup.lambda;
¬†
import java.util.Map;
¬†
public class CognitoTrigger {
    private int version;
    private String triggerSource;
    private String region;
    private String userPoolId;
    private String userName;
    private Map<String, String> callerContext;
    private Request request;
    private Response response;
    
    public CognitoTrigger() {
		super();
	}
¬†
	public int getVersion() {
		return version;
	}
¬†
	public void setVersion(int version) {
		this.version = version;
	}
¬†
	public String getTriggerSource() {
		return triggerSource;
	}
¬†
	public void setTriggerSource(String triggerSource) {
		this.triggerSource = triggerSource;
	}
¬†
	public String getRegion() {
		return region;
	}
¬†
	public void setRegion(String region) {
		this.region = region;
	}
¬†
	public String getUserPoolId() {
		return userPoolId;
	}
¬†
	public void setUserPoolId(String userPoolId) {
		this.userPoolId = userPoolId;
	}
	
	public String getUserName() {
		return userName;
	}
¬†
	public void setUserName(String userName) {
		this.userName = userName;
	}
¬†
	public Map<String, String> getCallerContext() {
		return callerContext;
	}
¬†
	public void setCallerContext(Map<String, String> callerContext) {
		this.callerContext = callerContext;
	}
¬†
	public Request getRequest() {
		return request;
	}
¬†
	public void setRequest(Request request) {
		this.request = request;
	}
¬†
	public Response getResponse() {
		return response;
	}
¬†
	public void setResponse(Response response) {
		this.response = response;
	}
¬†
    public static class Request {
        private Map<String, String> userAttributes;
¬†
		public Map<String, String> getUserAttributes() {
			return userAttributes;
		}
¬†
		public void setUserAttributes(Map<String, String> userAttributes) {
			this.userAttributes = userAttributes;
		}
¬†
		public Request() {
			super();
		}
		
    }
¬†
    public static class Response { 
    	String autoConfirmUser;
    	String autoVerifyEmail;
    	String autoVerifyPhone;
    	
		public Response() {
			super();
		}
		
		public String getAutoConfirmUser() {
			return autoConfirmUser;
		}
		public void setAutoConfirmUser(String autoConfirmUser) {
			this.autoConfirmUser = autoConfirmUser;
		}
		public String getAutoVerifyEmail() {
			return autoVerifyEmail;
		}
		public void setAutoVerifyEmail(String autoVerifyEmail) {
			this.autoVerifyEmail = autoVerifyEmail;
		}
		public String getAutoVerifyPhone() {
			return autoVerifyPhone;
		}
		public void setAutoVerifyPhone(String autoVerifyPhone) {
			this.autoVerifyPhone = autoVerifyPhone;
		}
¬†
		@Override
		public String toString() {
			return ""Response [autoConfirmUser="" + autoConfirmUser + "", autoVerifyEmail="" + autoVerifyEmail
					+ "", autoVerifyPhone="" + autoVerifyPhone + ""]"";
		}
		
    }
¬†
	@Override
	public String toString() {
		return ""CognitoTrigger [version="" + version + "", triggerSource="" + triggerSource + "", region="" + region
				+ "", userPoolId="" + userPoolId + "", userName="" + userName + "", callerContext="" + callerContext
				+ "", request="" + request + "", response="" + response + ""]"";
	}
¬†
}"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
I'm not sure about Java code, but here's my sample in TypeScript which is a bit shorter so easier to glance what's going on: https://github.com/cumulous/backend/blob/1a1438e167ebebeaa5e1477636d9b2cf8ed4c267/src/cognito.ts#L364-L388

EDIT: I did test linking a second external identity with my code, and it has the same behavior as the first (i.e. an ""Already found an entry for username"" response after a successful linking in pre-signup, then a successful login after a second auth attempt). So it's likely an issue on your side.

EDIT2: I think you may be linking the second external user to the first external user instead of to the Cognito user. Make sure to filter your listUsers response by the type of provider (see my function getUserByAttribute as an example). After successful linking of both externals, I have 1 Cognito user with CONFIRMED status and 2(!) users with EXTERNAL_PROVIDER status, all with the same email. I was also told by the support that this behavior is intentional. So filter out all users with EXTERNAL_PROVIDER status and take the remaining one (which may or may not be CONFIRMED, depending on its email verification status etc; you may need to check for that separately, as I also do in the code).

The support hasn't been able to resolve the initial issue yet though.

Edited by: denvlad on Nov 15, 2017 8:42 PM"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Thanks for the tip and sharing your code.
The AdminLinkProviderForUser function only take two arguments; ProviderAttributeValue and ProviderName. On both occassions (for linking 2 external identities) I pass the same details for my Cognito user. I added some extra debug for user status and enabled, and that all looks fine too.
The error message seems to indicate that the second user already exists by the time I try and link them.
Perhaps there is some additional problem with the Java SDK.

Edited by: c3R1YXJ0 on Nov 17, 2017 9:20 AM"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Hey denvlad!

Do you have anything to brag about?

Did you figure out what causes this? Do you by any chance know whether AWS treats this as a bug somewhere so we could track it?"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
No, the AWS support was able to replicate the issue but they don't have a fix yet, and no timelines on a fix per their usual policy.

As a side note, we're actually moving to Firebase that better fits our use case and my new workplace's preferred provider (Google). I do hope that Cognito User Pools Auth succeeds though, it is a very convenient platform that integrates nicely with AWS. I also have heard people successfully using Firebase on AWS if that matters.

You're welcome to take on this thread, hopefully it will get addressed. I may not have access to further tests.

Edited by: denvlad on Dec 14, 2017 11:03 PM"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
That's just too bad. I've invested so much effort to get to this point. This is an obvious dealbreaker.

I can give em some time but.. then it's gonna be firebase for us too i guess. I just wonder how is the flow for obtaining aws credentials on the client apps going to look like.. 

I hope I won't have to find out :}"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Due to the security expectation, we currently don't support implicit linking(linking based on matching email addresses for example) done via a pre-signup lambda trigger to achieve the automatic linking.We will take this as a feature request and support it in the future."
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
To be fair, this limitation can (and should) be solved based on email_verified attribute for different providers. Moreover, it used to work for me when Cognito User Auth API was first introduced. But the point of the confusion is that it stopped working without an announcement.

Other platforms (e.g. Firebase and Auth0) thrive on this feature so if Cognito wants to stay competitive this should be a core (must-have) feature IMO. At the least, the decision to auto-link accounts based on some attribute should be deferred to the developer, not disabled blankly by AWS."
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Hi. Do you have any updates from AWS support team? I also faced into this problem."
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Our plans are to provide built-in support for linking between ""native"" accounts (with email address and password) and external identities such as Facebook or Google when the email address matches. We do not provide timelines for roadmap items, but I will tell you this is an area under active development.

Regards,
Tim"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Thanks"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Hi, any news on this?"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
I am encountering the same issue. 
How did you solve it?

Thanks!"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
I think everyone would appreciate it if there were some kind of update on this. Contacting support hasn't been fruitful either, because the documentation currently still exists that says linking should be possible. 

I, myself, am very frustrated with this experience of using Cognito as an authentication solution for the last 2 months or so. I keep running into limitations and bugs that would not be found in other platforms. Like others have expressed on the platform, I will look into alternatives like Firebase. We've lost a lot of productivity and time because Cognito is not ready as a product, at least for the webapp use case."
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Any update on this? All of our users signup with multiple IdPs so key for us."
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Hello,
Do you have any updates on this?"
AWS IoT Device Management	"Re: Unable to log in first-time Cognito user pool users after a recent change
Hi,
I'm facing the same issue. Any update on this @TimH@AWS? It could be a dealbreaker for us too."
AWS IoT Device Management	"LimitExceededException when creating groups
I'm getting LimitExceededExceptions when trying to create groups in one of my User Pools.  The error says my limit is 300 groups, but I currently only have 7 groups in that pool.  Anyone have any idea what could be causing an error like that?"
AWS IoT Device Management	"Re: LimitExceededException when creating groups
Me, too, here in Feb 2019.

15 groups exist.
Creation fails and tells me my limit is 300 (it is, we asked that it be raised).

We have a ticket open to ask about this. My fear is deletion of groups doesn't decrement the count against the limit, but I have not tested this as yet."
AWS IoT Device Management	"Re: LimitExceededException when creating groups
In my case, I was able to get the issue resolved via a support ticket.  They said the underlying bug still exists, but that my specific pool had been fixed to avoid the issue.

I never got a good answer to exactly what was going on, but from testing it seemed like attempting to create a group that already exists was causing the usage to increment by one even though the creation failed."
AWS IoT Device Management	"Cognito Forgot Password Security Risk?
I have heard a technique where hackers will use the forgot password to mine a user database.  From what I understand they attempt multiple usernames/phones/emails and look at the response to determine if that particular entry exists within the database.

From what I can tell, when attempting a forgot password, the API returns ""UserNotFoundException"", whereas other sites might say ""If the account was found you will receive an SMS/Email..."" as to not giveaway whether certain data exists within the database.

Is this a concern at all?  I understand that there is throttling, but I am not sure that this will cover the problem exactly.

Admittedly I am not an expert at this particular vulnerability, so any insight into whether it applies to Cognito would be appreciated."
AWS IoT Device Management	"Re: Cognito Forgot Password Security Risk?
Hello,

Since some applications may want to display detailed information on failures, the service does not explicitly suppress UserNotFoundException, as it becomes choice between user enumeration risk vs end user convenience. We can consider to make this configurable in our future releases

Pat"
AWS IoT Device Management	"Re: Cognito Forgot Password Security Risk?
Is this now configurable?"
AWS IoT Device Management	"Re: Cognito Forgot Password Security Risk?
Still not configurable?"
AWS IoT Device Management	"Cognito Message Customization - ""Your roles are still being created. Pleas""
When trying to utilize the Cognito Message Customizations for a user invitation email and saving I face the following error: ""Your roles are still being created. Please wait and try again.""

Here is the error in the console: { ""error"": { ""code"": 403, ""status"": ""Forbidden"", ""message"": ""Your roles are still being created. Please wait and try again."", ""data"": """" }}

Can someone help identify how to get this feature to work?"
AWS IoT Device Management	"PreTokenGeneration lambda trigger not configurable via CloudFormation?
I'm using the serverless framework, which uses cloudformation under the hood, to trigger a few events in my Cognito User pool.  One of the ones that I need working, is the ""PreTokenGeneration"" event so I can customize some of the claims for the user before they get the token. 

It appears however, that it is not supported in the CloudFormation API [1].  Is that correct?  If so - why is that?  Will it be supported soon?  Are there any workarounds aside from having to use a CLI Command to add the one trigger?

I can spin up all of the other triggers, but not this one.  And once I've set up the lambda triggers properly, I can add it after the fact via the gui or CLI, but it's a bit disjointed from my configuration.

[1] https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cognito-userpool-lambdaconfig.html"
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
Currently this is not supported through CloudFormation as the feature has just been released. However, it is very much on our roadmap to add support for this yet I cannot comment on a date for availability."
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
Thanks! 

Out of curiosity, what is the average / typical lag time in CF supporting new features from other AWS products?"
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
As a general rule, we don't comment on the availability of features but this is definitely something we have on our roadmap."
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
8 months later and it appears this trigger is still not available in CloudFormation?"
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
+1 to this -- still hasn't made it to CloudFormation!"
AWS IoT Device Management	"Re: PreTokenGeneration lambda trigger not configurable via CloudFormation?
+ 1 - It has been more than a year."
AWS IoT Device Management	"Custom OIDC scopes?
Cristian Bravo

Mon Feb 04 2019
11:30:03 GMT-0300 (Chile Summer Time)
Hi we're integrating Cognito's OpenID Flows with a government service which needs to attach cutoms params on ""scope"" in the URL request. So, this is the scenary:

Cognito:
URL/oauth2/authorize?identity_provider=BLAH&redirect_uri=BLAH&respose_type=code&client_id=BLAH&state=BLAH&scope=openid run name

As you can see, I need to attach the ""run name"" params.

With this, Cognito returns me an error page with ""invalid_request"" error. If I don't attach this customs params, the flow works correctly but I need to attach them to get this work in the entirely flow, 'cause it crash on the next step.

How can I achieve this? Please help.

Thanks in advance."
AWS IoT Device Management	"Re: Custom OIDC scopes?
Resolved with ""Resource Servers"" section!"
AWS IoT Device Management	"Use Cognito to handle user login on RoR app and Serverless site same domain
I am currently in the situation, where I have an existing Ruby on Rails application (Sharetribe open source) running as a marketplace with Devise as login handler.

What I want to do is move all the logic gradually to an implementation using AWS serverless and lambdas.

What I have done so far is set up an API Gateway in AWS where all requests are proxied to the existing RoR-site, and whenever a feature or page is moved to lambdas, the path will be defined in the gateway. This should be working fine, but I have a problem regarding sharing logins and authentication between RoR and Lambdas.

To handle that problem I want to use Cognito as authenticator and session keeper in both parts of the solution, so it will also work when I've moved all the features to Lambdas and are able to turn off the RoR application.

This should be easy enough if I only wanted to use Cognito with username and password and getting the JWT, but I also want to be able to allow people to log in with Facebook and possibly Google or some other social logins.

So my question is this: How would you make a call to Cognito that also allows to log in via Facebook, and store the login for future calls? I don't currently need to be able to grant the users access to other AWS resources, so just utilizing the User Pool of Cognito should be fine if that helps."
AWS IoT Device Management	"JavaScript in the Browser unauthenticated access
Hi,

I'm trying to use Cognito as a leeway to get temporary AWS credentials to access some resources. I combed through the information, it's patchy probably because the main use case are the mobile devices, though JavaScript is officially supported. Still, I believe I found out the proper beginning of the process, which is to:


create the Cognito Identity Pool (will also create authenticated and unauthenticated roles)
run AWS.CognitoIdentityCredentials.get()


This first step is failing, because apparently Cognito AWS endpoints do not respond with CORS headers. It would not be problem for mobile/desktop apps but for in-the-browser this is a show stopper. What to do now?

The rudimentary reproduction case is attached as a file, I removed AWS account ID from that. For that sample to work, you'd have to create the new Identity Pool with default settings in your AWS console and copy/paste region, account id, identity pool id and rolearn from there.

The messages I'm getting in the browser's console look like this:

XMLHttpRequest cannot load https://cognito-identity.eu-west-1.amazonaws.com/. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://inncognito.s3-website-eu-west-1.amazonaws.com' is therefore not allowed access. The response had HTTP status code 404.
................
and finally my code:

 Incognito error:  Error: Network Failure {message: ""Network Failure"", code\: ""NetworkingError"", time: Thu Nov 27 2014 09:55:26 GMT+0100 (Central European Standard Time), region: ""eu-west-1"", hostname: ""cognito-identity.eu-west-1.amazonaws.com""‚Ä¶}


Hopefully someone had a similar problem?

Best regards,
Kris."
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
I was successfully using cognito for unauthenticated access in eu-west-1 until yesterday.
Now I dont get the IdentyId but instead I get a 404 when aws javascript sdk is trying to access https://cognito-identity.eu-west-1.amazonaws.com/

Maybe it is related to network problems on eu-west-1 as stated in

http://status.aws.amazon.com/

26/11/2014
EC2 - Ireland
RESOLVED Network Connectivity
7:26 AM PST We are investigating Internet provider connectivity issues in the EU-WEST-1 Region.
7:46 AM PST Between 6:41 AM and 7:25 AM PST we experienced impaired Internet connectivity affecting some instances in the EU-WEST-1 Region. The issue has been resolved and the service is operating normally."
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
Thank you for the info and confirming the problem. Apparently, it did work in the past.

I've moved my Cognito endpoint away from Ireland to N.Virginia and tried again, the same result.

As a separate experiment, I run my previosly attached reproduction code (plus var AWS = require('aws-sdk'); ) in node.js: it works properly, i.e. AWS.CognitoIdentityCredentials.get(...) is successfull. It confirms that CORS setting of the AWS endpoint is the problem, maybe they have just changed it for some reason.

Best regards,
Kris."
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
Thanks.
So until yesterday, the only service that required CORS was S3.
http://docs.aws.amazon.com/AWSJavaScriptSDK/guide/browser-configuring.html

Today they added cognito too?
They have to document this change I think.

Regards."
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
I just got started off with this Cognito stuff, and seems to be a wrong time .. Doesn't work today.. Facing the same problem 

XMLHttpRequest cannot load https://cognito-identity.us-east-1.amazonaws.com/. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access. The response had HTTP status code 404.

Regards,

Edited by: narasayya on Nov 27, 2014 4:31 AM"
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
Hello:

We inadvertently disabled the OPTIONS verb on the Cognito Identity endpoints, effectively disabling CORS support. This has been corrected on cognito-identity.eu-west-1.amazonaws.com and will be corrected on cognito-identity.us-east-1.amazonaws.com shortly.

My deepest apologies for the troubles.

Regards,
Bob"
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
Hello:

CORS has been re-enabled on cognito-identity.us-east-1.amazonaws.com. Do let us know if you continue to have issues.

Regards,
Bob"
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
It's also working now in Ireland, thank you!"
AWS IoT Device Management	"Re: JavaScript in the Browser unauthenticated access
Hi, 
I believe that this problem has come up again on euwest1 and 2, i keep getting cors errors when trying to sign-in through Amplify-js along with the network error, this causes the sign-in process to take upto 2 mins. Im happy to provide logs or screenshots if need be.

Any help would be greatly appreciated.

Thank you"
AWS IoT Device Management	"InvalidSignatureException when connecting to Cognito via boto3
Hey All,

I'm in a python (+django) shell, alternately using two sets of confirmed AWS credentials, both of which have rights to Cognito given them. I'm trying to call any Cognito-identity service listed in the docs, (tried several calls), but always hit the same problem. When trying to call list_identities, for example, I get the following traceback:

>>> client.list_identities(IdentityPoolId='us-east-1:6197588b-e93b-4562-ab44-29XXXXXXXXX',MaxResults=2)
Traceback (most recent call last):
  File ""<console>"", line 1, in <module>
  File ""/Users/eb/py27/lib/python2.7/site-packages/botocore/client.py"", line 310, in _api_call
    return self._make_api_call(operation_name, kwargs)
  File ""/Users/eb/py27/lib/python2.7/site-packages/botocore/client.py"", line 396, in _make_api_call
    raise ClientError(parsed_response, operation_name)
ClientError: An error occurred (InvalidSignatureException) when calling the ListIdentities operation: The request signature we calculated does not match the signature you provided. Check your AWS Secret Access Key and signing method. Consult the service documentation for details.
¬†
The Canonical String for this request should have been
'POST
/¬†
¬†
content-type:application/x-amz-json-1.1
host:cognito-identity.us-east-1.amazonaws.com
user-agent:Boto3/1.2.2 Python/2.7.10 Darwin/14.5.0 Botocore/1.3.12
x-amz-date:20151213T220455Z
x-amz-target:AWSCognitoIdentityService.ListIdentities
¬†
content-type;host;user-agent;x-amz-date;x-amz-target
f1e2b42b05fc6b010b3842312bc1eeda1bee0a6b28b770ae9024bb74e61a1bbc'
¬†
The String-to-Sign should have been
'AWS4-HMAC-SHA256
20151213T220455Z
20151213/us-east-1/cognito-identity/aws4_request
2066e96761d59493b9299f3f6962e7ad20258b789c0d0b127618d8789c5486a9'

Any ideas? My time zone is set on this computer to be Eastern Standard time and that lines up with us-east-1 which is my default region. Input much appreciated."
AWS IoT Device Management	"Re: InvalidSignatureException when connecting to Cognito via boto3
Can you confirm you set your access key and secret key correctly and haven't accidentally swapped them?  If you have set them correctly, can you test calling another service if your role permits, i.e. S3 and see if that works?"
AWS IoT Device Management	"Re: InvalidSignatureException when connecting to Cognito via boto3
Hey, 

I actually fixed this problem. As you indicated, it was the Secret key and access key ID being incorrectly set. 

Thanks!"
AWS IoT Device Management	"Re: InvalidSignatureException when connecting to Cognito via boto3
Hello

I'm trying to call detectfaces API of Rekognition service directly via API Gateway, but getting Signature invalid error. Method: GET. I have used mapping template to pass parameters for API. Parameters are Bucket and File name )

Can anybody help to understand how to resolve this error?

I am able to call API via Lamba function using Python SDK

Thanks"
AWS IoT Device Management	"Re: InvalidSignatureException when connecting to Cognito via boto3
Hello

I'm trying to call detectfaces API of Rekognition service directly via API Gateway, but getting Signature invalid error. Method: GET. I have used mapping template to pass parameters for API. Parameters are Bucket and File name )

Can anybody help to understand how to resolve this error?

I am able to call API via Lamba function using Python SDK

Thanks"
AWS IoT Device Management	"AWS Shield as a DDoS Service?
Hi,

We are currently hosting some of our services on AWS, and some of our infrastructure on other places.
For one of our servers hosted elsewhere (serving raw TCP traffic, not HTTP/S), we would like to be able to benefit from AWS shield standard protection.
Does AWS Shield Standard protection apply to non-HTTP ports of EC2 instances?
Does it make sense to create an EC2 instance and put a reverse TCP proxy on it? Assuming 2TB of traffic per month, what setup / costs should we be looking at?

Edited by: tacticsoft on Dec 5, 2018 11:58 PM"
AWS IoT Device Management	"Shield Standard:  What does it protect
The FAQ and Info online aren't too clear about what services Shield Standard actually protect; I see mention of load balancers, etc. but little specifics.

I'm specifically interested in knowing if Shield Standard protects Elastic IPs allocated in VPCs, and what types of protection are in place (Protection against SYN floods, UDP Floods, ICMP Floods, etc.).

Is there more detailed info available?"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Standard defends against most common, frequently occurring network and transport layer DDoS attacks that target your web site or applications. On Amazon EC2, your traffic levels are inspected by an auto-mitigation system that can engage when a well-defined DDoS attack signature is detected or at high levels of traffic, given your choice of instance type. UDP reflection attacks, like DNS reflection, NTP reflection, SSDP reflection, etc. are examples of common DDoS attack vectors that can be mitigated by this system.

For improved DDoS resilience across a wide range of attack vectors, like SYN floods or web application layer attacks, consider using Amazon CloudFront or Application Load Balancer (ALB) with AWS WAF. You can also use a Classic Load Balancer for non-web use cases and Amazon Route 53 to also protect against DNS query floods.

You can learn more about these recommendations in the AWS Best Practices for DDoS Resiliency which is available at https://d0.awsstatic.com/whitepapers/Security/DDoS_White_Paper.pdf . This paper provides a prescriptive reference architecture you can use to help make your applications more DDoS resilient.

I will reach out to you directly to answer any follow-up questions you might have. I am interested to learn about your application and provide tailored recommendations.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
So... more specifically, I'm interested in:  knowing if Shield Standard protects Elastic IPs allocated in VPCs

That is, is it in effect if I'm not using CloudFront or ELBs?  The documentation only mentions these specifically as protected services."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Yes. AWS Shield Standard provides protection for EIP's in VPC.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Thanks, that was the primary question I had.  Thanks again, have a Happy New Year!"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Hello Jeffrey and other AWS employees,

Can AWS Shield Standard prevent a volumetric attack from saturating the bandwidth of a small EC2 instance and what will happen if a UDP attack hits a small instance while all UDP is blocked in the security group? Will you ever nullroute the IP, if a huge attack hits us? Layer 7 is not an issue since we'll have efficient rate limits.

I've read the relevant DDoS resiliency whitepaper and your previous answers. It does not answer my question, unfortunately. I need an answer for EC2 only, please.

Thanks in advance."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Advanced is available for Elastic IP Addresses (EIP's) which allows you to protect Amazon EC2 instances or Network Load Balancers (NLB's). To learn more about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
I'm about to deploy a web app in production using AWS BeanStalk on a single instance (basic tier).

Will my app be automatically protected through AWS Sheild Standard?"
AWS IoT Device Management	"Re: Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
AWS Shield Standard automatically protects every AWS resource type in every AWS region against common DDoS attacks. No action is required on your part.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Shield support for non-Web Apps
Is Shield supported for non-web applications which are not even using a ELB? Can it be assigned to a VPC with public IP addresses? 
In this case, is there any additional protection does AWS-shield provide over and above the Security-groups/NACL ?"
AWS IoT Device Management	"Re: Shield support for non-Web Apps
With AWS Shield Advanced you can now add an Elastic IP Address (EIP) as a protected resource, which allows you to protect Amazon EC2 instances and Network Load Balancers (NLB's). For more information about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"AWS Shield Advanced - Multiple Accounts
We've got several accounts all owned by the parent company, there are development, qa, and multiple production environments.  If we sign up for Shield advanced, will this cover only one of the accounts, or can we cover all of them?

Cheers

Keith"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
If your organization has multiple AWS accounts, then you can subscribe multiple AWS Accounts to AWS Shield Advanced. You will pay the monthly fee once as long as the AWS accounts are all under a single consolidated billing, and you own all the AWS accounts and resources in those accounts.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
Thanks for that - very helpful"
AWS IoT Device Management	"What if I've got my clients in my AWS account? Are they protected?
I wonder if I contract Shield Advanced the clients I've got in my AWS account are protected with Shield Advanced too.
I've got a web design company and my clients are in my AWS account so it is easier to manage.
Thanks,"
AWS IoT Device Management	"Re: What if I've got my clients in my AWS account? Are they protected?
Hi,

You can enable AWS Shield Advanced for the protection of multiple AWS resources, as long as the subscribing AWS Account holder directly owns and manages the AWS resources. Further, AWS Shield Advanced's monthly fee applies per organization subscribed to AWS Shield Advanced. If your organization has multiple AWS accounts, you will pay the monthly fee once as long as you own all the AWS accounts and resources in that account.

Thanks
Venkat"
AWS IoT Device Management	"TOTP on transaction validation
Hi community!

I searched through the Cognito docs and haven't found the answer to my problem.

Some transactions in my company system need to be confirmed by a token, because those transactions may lead to incorrect invoices and hence some major tax problems to be dealt later. We're still on architecture definition, and some AWS solutions need to be selected to plan our monthly budget and our development sprints.

After some research, I figured out that Cognito sends TOTP tokens when MFA is turned on, but apparently that's done only on login. I couldn't figure out however if Cognito can be used to send those TOTP tokens for other purposes, like the one described above. Is there a way to to that using this or any other AWS service, or is it better to develop a service compliant to RFC 6238?

I'd like to thank the help of you all in advance.

Best regards,
Guilherme Soares."
AWS IoT Device Management	"Pricing details for server to server communication (client credential flow)
Hi ,

Can some one help on pricing model for user pool only with app clients ? User pool created will not have any user but will have 2 app clients only (for server to server communication). In case of Client Credentials Flow, what are the billing charges ? It is based on number of hit to get the auth token ? Is there any charge on validating the token generated using url :  https://xxxxxxxx.auth.us-east-1.amazoncognito.com/oauth2/token via API gateway authorizers ?

Is there any charge on creating domain name for resource server ?

Thanks,
Ajay"
AWS IoT Device Management	"How to use Cognito Identity Provider API through the API Gateway
I've tried to set an method in the API Gateway with the integration request pointing to the AWS Service ""Cognito Identity"" and Action to AdminGetUser. Testing the method I get in the response this  exception ""com.amazon.coral.service#UnknownOperationException"".
I've tried to force the Content-Type, the X-Amz-Target but nothing has produced a better response. I've tried to set up some new methods pointing to S3, Step Function and these ones return a right response.
Please, may you tell me if the operation I'm trying is admitted and if YES, where is the trick ?
Thanks
Stefano"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
Hi,

I believe you don't have the x-amz-target header set up correctly. For AdminGetUser API on Cognito side, you need to set AWSCognitoIdentityProviderService.AdminGetUser as the value of x-amz-target with a POST method and the parameters in the payload.

POST
/¬†
¬†
content-type:application/x-amz-json-1.1
host:cognito-idp.us-east-1.amazonaws.com
x-amz-date:20170426T230022Z
x-amz-target:AWSCognitoIdentityProviderService.AdminGetUser
¬†
{""Username"": ""name"", ""UserPoolId"": ""id""}


Thanks,
-Ka Hou"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
I am getting Missing Authentication  Token while using the api
When I use the Authorization Header , I get not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get it running ?"
AWS IoT Device Management	"X-AMZ-TARGET: AWSCognitoIdentityProviderService.AdminGetUser Issue
Hi All
I am trying call api to get user details in following manner:

Url: https://cognito-idp.xx-xxxxxx-X.amazonaws.com
Headers: 
X-AMZ-TARGET : AWSCognitoIdentityProviderService.AdminGetUser
Content-Type: application/x-amz-json-1.0
Authorization : Bearer <Token>

But I am getting following response:
not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get this api running with Access token?"
AWS IoT Device Management	"Logout not working for federated OIDC provider (OP)
Signing out using the following method, as per the logout endpoint document, only removes the first user pool's sign-in cookie and not the federated OP. This is an incorrect implementation and would leave a false sense of signing out.

https://docs.aws.amazon.com/cognito/latest/developerguide/logout-endpoint.html
GET https:{domain}.auth.{region}.amazoncognito.com/logout?logout_uri={uri}&client_id={clientid}
Only deletes the sign-in cookie for that domain
Then redirects based on the logout_uri.

A workaround is for the RP to also know about the end_session_endpoint for the federated OP. This is not ideal.

The implementation should have the user pool using the OP iframe to logout method to sign out of any federated OPs and then perform the logout on the identity pool. IdentityServer3 & 4 have done the same in their implementation. 
http://openid.net/specs/openid-connect-session-1_0.html#OPiframe
http://docs.identityserver.io/en/release/topics/signout_federated.html

Edited by: andrewnb on May 18, 2018 1:52 PM

Edited by: andrewnb on May 18, 2018 1:52 PM"
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
AFAIK the logout is still in draft status for OIDC (both front-channel and back-channel) so we do not support logout yet. We can consider this feature in future updates to the service."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
I would highly recommend and strongly encourage that AWS implement some form of federated signout capability regardless of the state of the standard, before people face issues thinking they've signout but haven't if they're using 3rd party OPs.

The session management, front and back channel specifications are in implementer's draft status rather, rather than solely draft status. There are many other identity provider implementations following the implementer's draft (e.g. ADFS, IdentityServer3 & 4, Auth0, WSO2, etc.).

Cognito does support logout but the implementation doesn't support federated signout."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
Has there been any progress on logging out of federated OIDC providers?"
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
We have a use case for this as well. We are using an instance of IdentityServer as an identity provider with Cognito and need federated logout. We are manually going to implement it via a laundry list of SignOutUrls in each AppClient configuration, which is less than ideal.

Our IdentityServer instance is the lone identity provider with our Cognito instance, so we are able to redirect to the IdentityServer logout instance. This is NOT the long-term plan, though. We do see the need for multiple identity providers in the near future."
AWS IoT Device Management	"Re: Logout not working for federated OIDC provider (OP)
Is there an update for federated OP signout?"
AWS IoT Device Management	"Is Cognito free in this case?
1) User start app.
2) User authenticate and get token from third-party identity provider (Facebook, Google).
3) Exchange identity provider token for AWS credentials in my Identity Pool.
4) Access AWS services with credentials (to DynamoDB, S3...).

Will I be charged for MAU using this example or not?

Im confusing becouse in AWS Cognito Pricing page says:

Users who sign in directly with their User Pool credentials or with social identity providers:

For users who sign in directly with their credentials from a User Pool or with social identity providers such as Google, Facebook and Amazon, there are volume-based pricing tiers for MAUs above the free tier, as shown in the table below. (price list below...)

But in AWS Cognito FAQ says:

Q: How much does Cognito Identity cost?
... Federated Identities and secure access control for AWS resources are always free with Cognito Identity.

Thanks!

Edited by: elritualk on Feb 25, 2019 9:57 PM

Edited by: elritualk on Feb 25, 2019 9:58 PM"
AWS IoT Device Management	"[Unity3D] Is there an economic way to grant app access to AWS services?
Hi,

Im pretty confused with some things. Im developing a game in Unity3D, and I want to use DynamoDB and S3 for players storage data.

I have in mind this two basic scenarios:

First scenario:

1) Players will authenticate with social platforms (Facebook, Google) using each platform SDK. If they login, they get an accessToken from the platform. Fine here.
2) Next, grant access to AWS by doing each player pass the accessToken credentials.AddLogin(""graph.facebook.com"", accessToken) in the AWS SDK;
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I will have one MAU for each player that login in the month. 10.000.000 unique logins in a month = 10.000.000 MAU = 10.000.000 * price of the MAU.

Second scenario (if possible)

1) Player will authenticate with social platforms (Facebook, Google) using each platform SDK.
2) App authenticate with Identity Pool ID in order to have access to AWS services.
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I can have infinite numbers of logins each month, but the MAU will be always 1 since its always the same for each player.

The questions are:
1) Is this 2 scenario possible?
2) Is possible to have an app with 10.000.000 users per month that let players use AWS services (DynamoDB, S3) without paying 10.000.000 MAU prices (at least paying for 1 MAU).

Thanks!"
AWS IoT Device Management	"Pinpoint Analytics events not being triggered by Cognito
I am unable to get my Cognito User Pool to emit any Sign-in, Sign-up, or Authentication Falure events to Pinpoint Analytics. Under ""General Settings"" -> ""Analytics"", I followed the ""AWS Management Console"" instructions specified here[1].

The automatically-generated IAM role that was created looks something like:
{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""mobiletargeting:UpdateEndpoint""
            ],
            ""Resource"": ""arn:aws:mobiletargeting:us-east-1:XXXX:apps/<pinpoint project ID>/endpoints/*""
        },
        {
            ""Effect"": ""Allow"",
            ""Action"": [
                ""mobileanalytics:PutItems""
            ],
            ""Resource"": ""*""
        }
    ]
}


As part of my troubleshooting, I checked ""Access Advisor"" for that IAM role and it claims to never have been accessed.

How do I configure my Cognito User Pool to emit these Analytics events?

Tangentially related to that (and not the original problem), it does not appear possible to enter in a previously-created IAM role in the ""IAM role"" field under General Settings -> Analytics.

[1]: https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-pinpoint-integration.html"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
I still cannot get Cognito User Pools to emit sign-in or sign-up events to Pinpoint. Help please?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Facing the same issue..any help is appreciated"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
facing the same issue..any help is appreciated"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Same issue here; under what conditions does authenticating a user with cognito trigger the pinpoint event?
does it work with the hosted login ui? when using android sdk to login?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Having same issue. Any update on this?"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
We're facing the exact same issue too as reported.

Using the Hosted UI to Sign In or Sign Up does not generate any events in Pinpoint."
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Same issue"
AWS IoT Device Management	"Re: Pinpoint Analytics events not being triggered by Cognito
Hello !
We are experiencing the same issue:
we are not able to connect cognito to pinpoint in Frankfurt zone.
Thank you AWS for your answer,
S

Edited by: sablier on Feb 25, 2019 8:52 AM

Edited by: sablier on Feb 25, 2019 8:52 AM"
AWS IoT Device Management	"Facebook display=popup
I've got a cognito user pool set up with facebook federated identity provider.
And everything works perfectly, from a technical angle.

However, my users think it looks ugly.

Here's why:

Cognito redirects the users to https://www.facebook.com/v2.9/dialog/oauth to do their sign-in.
However, that link loads up their whole facebook menu bar complete with friend requests and notifications in the background.

Fortunately, facebook provides an alternate link for signin, which is https://www.facebook.com/v2.9/dialog/oauth?display=popup (it's mostly the same, just has display=popup at the end).  That link provides a proper authentication screen without all the background stuff, and it's even more compact, which is more suitable for the size of my website window.

Unfortunately, I can't see how to configure Cognito to including this display=popup parameter in the URL it sends users to.

Is there a way to do this that I'm missing?

If not, could it be added as a feature?  (I imagine it'd be pretty straightforward.)"
AWS IoT Device Management	"Re: Facebook display=popup
Can we get an option to set display=popup on facebook login?"
AWS IoT Device Management	"facebook 2.9 api expires in 4 months
Facebook will stop supporting Graph API 2.9 (the version cognito uses) in 4 months.
Are there plans to update Cognito?
If not, I need to start now to remove my dependency on Cognito."
AWS IoT Device Management	"Re: facebook 2.9 api expires in 4 months
Can I get an answer to this?

Also, does anyone else not have this same question?  If not, why not?

(I think this would be of huge concern to most cognito users?)"
AWS IoT Device Management	"Change background outside of the User Pool App?
Hi Team,

Silly question, would it be possible to customize background color outside of the login panel in the User Pool App? Everything else can be customized (including the background ""inside"" of the login panel), but the ""global"" background remains gray. Perhaps we could even add a custom background image or other rendering nicety (e.g. a gradient).

Thanks"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hello,

Within the modal it can be done. I believe the class is .background-customizable. 
 However, I just saw that this is missing in the documentation so we will update it there as well.

If you mean outside the modal, then we do not support that.

Edited by: awslex on Aug 28, 2017 11:18 AM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
I see. Yes, I meant outside of the modal. Thanks

Edited by: denvlad on Aug 28, 2017 2:20 PM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Do you guys are planing to allow change the background color outside the modal ? 

My feedback is that the current color does not looks good and it is hard to combined with any other color that we could put to the modal

Thanks 
Francisco

Edited by: fmontada on Aug 28, 2017 4:52 PM"
AWS IoT Device Management	"....
Hey

Edited by: fmontada on Dec 23, 2017 11:34 AM"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
We need to be able to do this as well."
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
+1.  We would also like to change the global (outside of the modal) background color of the hosted UI."
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hello,

As mentioned above, currently, changing the background outside the modal is not supported for Hosted UI. The list of modifications that you can currently perform are mentioned in the below documentation:

https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-ui-customization.html

You can also create your own custom UI and use AWS Amplify to implement Cognito Authentication:

https://aws-amplify.github.io/docs/js/authentication

However, I would like to inform you that, the Cognito team is currently working on it as many customers have requested this. Thank you for the feedback. Once the feature is released, you will be able to perform many modifications on the Hosted UI design and feel but, unfortunately, we will not be able to provide an estimated time for the release. 

Kindly, check our products announcement page [1] and AWS Blog [2] periodically for updates. 

[1] https://aws.amazon.com/new/
[2] https://aws.amazon.com/blogs/aws/"
AWS IoT Device Management	"Re: Change background outside of the User Pool App?
Hi, do you have a release date for the customization of background outside of the modal?  Or at least set the default to white, not grey?

üôè"
AWS IoT Device Management	"Tokens end up in browser localStorage
Hi!
I'm using Cognito UserPools with the Javascript SDK to signup and authenticate users. Everything works fine, I'm able to signup, login and receive JWT tokens. However the tokens end up in the browsers local storage, i.e. as key 'CognitoIdentityServiceProvider.<my-user-pool-clientid>.<my-email-adress>.accessToken' with value 'eyJraWQiOiJOSDhEeEFBSzVcL....'

Obviously I don't want to have my access tokens in cleartext in local storage. Am I doing something wrong or is this a bug/beta limitation?
Cheers
/Mike

Edited by: kobmic on Jun 12, 2016 9:41 PM"
AWS IoT Device Management	"Re: Tokens end up in browser localStorage
This is the expected behavior of our client SDKs. It adds the tokens to local storage so user can use the app without logging in again after the session is closed and then restarted.

These tokens are Base64 encoded JWT tokens and are not clear text. See this guide for more details about our tokens.

If you do not wish these tokens to be stored in local storage, you can call the clearCachedTokens method on a user object whenever you want. If you do this, user will have to login again for any user action that requires him to be signed in after this."
AWS IoT Device Management	"Re: Tokens end up in browser localStorage
Very clear and direct answer. 

I'm falling in love with Amplify, AWS cognito and all the AWS Serverless  stuff

Thanks"
AWS IoT Device Management	"Adding a custom domain for cognito
We're trying to use a custom domain name for a cognito user pool. However due to us having other cloudfront configurations for that domain, cognito fails to create the custom domain name because we have *.ourdomain.com defined in another cloudfront distro.

I've setup our own cloudfront distro to point at our cognito url, but it does not work properly, it looks like there are XSS errors when the cognito login page is trying to access it's own resources via a different cloudfront distro.

Is there any way to do this? I suspect we just need our custom domain whitelisted from cognito without cognito managing our own domain in cloudfront (or have cognito just user the custom subdomain  and not try to create a cloudfront instance using *.ourdomain.com).

Any advice? At this point we figure the easiest route is to just buy another domain to use for our login page, which seems kind of wasteful to us."
AWS IoT Device Management	"Cognito configuration issues with existing app client id
Hi,
I am facing an issues in regards to a use case scenario in regards to congnito user pool and identity pool.

Use case:

We have to switch an existing partner to cognito user/identity pool but we cannot change the app client id for them. Is it possible to switch this use case or not? If yes how?

1. We have to ensure that nothing in this should change for our partners. So output should not change. 
2. Also how can we migrate current partners tokens?
3. Can we  fetch all the data current Alexa client and also check if we can migrate partner tokens ?

Kindly help me out. Any kind of help is appreciated."
AWS IoT Device Management	"Re: Cognito configuration issues with existing app client id
Hi,

Can anybody help me out?"
AWS IoT Device Management	"Password change dialog is not shown on in first sign-up
We have a setup where we use number of identity providers in Cognito user pool. One of the providers is Cognito with username and password. We use a sign-up flow where admin creates users and they invited via email. 

Now we have the problem when a user is signing in the first time and is supposed to change the temporary password. Login with temporary password succeeds, but the change password dialog is not shown and there is the error 403 form request:   https://<our domain>.auth.eu-central-1.amazoncognito.com/changePassword?state= ... 


The error message is ""You tried to access a page that requires authentication, please try again after authenticating"".

We have other instances where this setup is working perfectly, but in this particular one we have the problem. We have compared all the settings with a working configuration and can not find a difference. Any similar experiences or ideas how to debug further?"
AWS IoT Device Management	"Restrict IAM Access To Namspaced Cognito User Pool Names
At my company we're using namespaced resource restrictions for each project.
We only have permission to create and manage S3 buckets (for e.g.) that match `project-*`.
The problem we're running into is that the Cognito User Pool's ARN only has the generated ID, so we can't restrict it based on the name. We want to have permission to create and manage multiple user pools that begin with our `project-` namespace. Is there a way to do that? Perhaps some sort of service specific IAM attribute we can add a condition for? Maybe there's a way to dictate a prefix for the user pool ID or something?"
AWS IoT Device Management	"Managing Azure SAML User Authorization in Cognito
We want to allow users in our environment to login to our javascript applications with their Azure AD credentials. We have configured a SAML identity provider for a cognito user pool which allows users to login to apps, however, now we would like to control permissions for different users. We would like to control the permissions within AWS and not have an attribute in AD that sets their role. Is this possible? The problem we are struggling with is how can cognito determine which role to assign to which user? We have hundreds of users so we don't want to build a role for each one.

We came up with a potential solution that required the role to be set in an attribute in AD (I've included a diagram of this potential solution). However, we don't like this solution because it requires that the user has a role attribute set in AD for each application and added to an azure group for each application. Additionally we would have a cognito user pool for each application. We couldn't help but think their must be a better way!

We are thinking that maybe we need to create a custom identity broker application and use LDAP instead but we are open to suggestions on the best way to move forward.

Any help would be appreciated!"
AWS IoT Device Management	"Feature Request: UI Customization - Change Background Colour (behind modal)
The UI Customization options within AWS Cognito allow for a lot of editing of the authentication modal to help it match any company branding but do not allow changes to the colour of the grey full background behind the modal. I'm requesting that editing the background colour would be added as another UI Customization option as the dark grey background clashes with our branding."
AWS IoT Device Management	"Post migration a username is created. How do I add that to a different DB?
Cognito has a migration lambda that allows us to confirm a user in our db. They send the email and PW to Cognito, the lambda fires, we verify matches, and the user is entered into Cognito.

At this point - behind the scenes - Cognito generates a username of some kind (UUID). The problem is, I need a way to get this username into our existing database, because our systems going forward will no longer rely on email and instead rely on this username.

Ideal flow:

Sign In
Migration Succeeds
Cognito generates username
Username is sent to our server.

Now because we have email set to auto-verified, no post-confirmation lambda can be called. The only way I see to do this with Cognito as-is is to either:

Ask users who already exist in our system to confirm their email again. This is a non-starter

Create a post-auth lambda, check user login count through a custom attribute, and if 0 (or if not already registered with the service, etc.) migrate the username to the new service.
If there is any other way to do this, please let me know."
AWS IoT Device Management	"How to debug cognito oauth2 request
I am trying to use cognito and as part of the first part of the oAuth2 handshake I send the following request: https://qis.auth.eu-west-1.amazoncognito.com/oauth2/authorize?response_type=code&client_id=1u8us1r2qk135ko5arei0ikop2&redirect_uri=https://d100h1es2fwleo.cloudfront.net/qis-session-manager&state=/

I receive a 302 redirect redirect to the attached error page. It merely says ""server error"". 
How am I expected to debug this?

Edited by: JimmyT on Feb 18, 2019 8:36 AM"
AWS IoT Device Management	"Re: How to debug cognito oauth2 request
I'm having exactly the same experience!  Looked through CloudWatch and enabled CloudtTrail but can't find anything to help me - feel completely helpless.  In my instance I'm hitting an App Client configured to use SAML federation.  I've narrowed the problem down to the SAML area, and I suspect my SAML metadata is causing an issue, but the same SAML metadata (provided by file, not URL) used to work, and there no errors are returned when I re-upload the file.

The URL I'm hitting to trigger the flow is: https://enterprise.auth.eu-west-1.amazoncognito.com/oauth2/authorize?response_type=code&client_id=3ifhga99ld48ttfd8j5sh1a46l&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fcallback&scope=email%20openid.  I then get a redirect back to http://localhost:3000/callback?error=server_error.  What then... ?

Could really do with help here please AWS.  If the SAML metadata file is invalid then please tell me that during the upload process. Otherwise make the 'server_error' response more meaningful with an explanation of the error.

Thanks
Andy"
AWS IoT Device Management	"Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
Hi,

I've been testing a Cognito User Pool that uses preferred_username as a login alias. I've noticed some interesting behaviors and I want to clarify the rules regarding usernames and preferred usernames.

First, I understand that regular usernames are required to be unique. However, I've also noticed it seems like preferred_usernames must be unique as well (a change from the OpenID Connect spec) at least when used as aliases. Further, I've noticed that many (all?) of the User Pool APIs seem to accept both username and preferred_username where a username is required. And finally, I've noticed that usernames and preferred usernames don't seem to be allowed to overlap ‚Äì the ""uniqueness pool"" seems to encompass both username and preferred_username.

So my questions are, when preferred_username is enabled as an alias:

1. do preferred usernames need to be unique?
2. do preferred usernames need to be unique with regard to regular usernames as well?
3. do all User Pool APIs that ask for a username also accept a preferred username alias?
4. is this behavior documented somewhere I've missed?
5. can I count on these behaviors remaining stable?

Thanks for your time!"
AWS IoT Device Management	"Re: Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
To answer your questions:
When preferred_username is enabled as an alias:
1. do preferred usernames need to be unique?  - Yes
2. do preferred usernames need to be unique with regard to regular usernames as well? - Yes
3. do all User Pool APIs that ask for a username also accept a preferred username alias? - Yes, Except ListUsers API for search.
4. is this behavior documented somewhere I've missed? - You can look at this documentation: https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html
5. can I count on these behaviors remaining stable? - Yes"
AWS IoT Device Management	"Re: Cognito User Pools: Preferred Username Alias Restrictions & Uniqueness
I am using email as an alias, with uniqueness constraint. It works fine when somebody tries register with the same email - the system returns an error and the user cannot proceed.

However, I have found out that the constraint can be broken if one uses other identity providers like Facebook or Google.

1. Assume a user registers in cognito with an email user@email.com
2. Then the same user, uses his Facebook account (that also has user@email.com) to register
3. You end up with two accounts with the same alias, user@email.com

Note that, if one tries 2 and then 1, they will get an error, as they should.

I am trying to create a pre-signup lambda trigger to reject a signup request from a social account that an already-registered email. The problem is that you cannot query cognito with aliases. Any ideas?"
AWS IoT Device Management	"Custom domain with API-only Cognito integration
We are using our own client UI for authentication through Cognito, leveraging the Core/Auth modules in the AWS Amplify library.  We would like to set up a custom domain so that any API calls for purposes of authenticating through Cognito are against our own subdomain.

All of the documentation I can find around custom domains with Cognito references custom domains for the Hosted UI, but there is no discussion regarding whether the underlying API calls will be against that custom domain or the default cognito-idp.xx-xxxx-x.amazonaws.com
 domain.

Can anyone confirm whether custom domains are compatible/valid with an API-only integration with Cognito?

Thanks!"
AWS IoT Device Management	"Unauthenticated users calling Sagemaker InvokeEndpoint
I have added the following to my unauth policy but I still get the following message:

User: arn:aws:sts::#####:assumed-role/Cognito_####Unauth_Role/CognitoIdentityCredentials is not authorized to perform: sagemaker:InvokeEndpoint on resource: ###

{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Sid"": ""VisualEditor0"",
            ""Effect"": ""Allow"",
            ""Action"": ""sagemaker:InvokeEndpoint"",
            ""Resource"": ""*""
        }
    ]
}"
AWS IoT Device Management	"Re: Unauthenticated users calling Sagemaker InvokeEndpoint
Any help would be appreciated.

If unauthenticated users cannot call InvokeEndpoint,  we would be forced to include access keys in the app."
AWS IoT Device Management	"Invalid IdP token for the user error
I'm trying to get AWS Cognito set up with my Okta SAML2.0 server. I've set up the user pool, my app client, my domain name, my identity provider and am using the sample beta SDK code.

I successfully get redirected to my Okta log in, but then when I log in via Okta and get redirected back, I get the error:

""Invalid IdP token for the user. Invalid user attributes: email: The attribute is required""

I suspect this is a configuration issue, but I'm unclear as to where the configuration problem lies.

I've attached a supporting image if it helps.

Any help would be appreciated!"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
Seems like in your user pool setup email is a required attribute. You will need to create an attribute mapping in Cognito console to populate email from incoming SAML Assertion. Additionally, you will need to make sure that your okta IdP setup populates the email claim in SAML assertion.
You can find more details related to defining attribute mapping in this blog:
https://aws.amazon.com/blogs/mobile/amazon-cognito-user-pools-supports-federation-with-saml/"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
We are having a similar issue.  We are trying to integrate our Azure AD with Cognito.  We believe we have followed all setup instructions per https://aws.amazon.com/blogs/mobile/amazon-cognito-user-pools-supports-federation-with-saml/

when we try and login to our browser app with AD, we get the following error in response

login?error_description=*Error*+in+SAML+response+processing%3A+Invaliduser*attributes*%3A+*email*%3A+The+attribute+is+required+&state=4PWzu8yHLuQYLtgI8jurCVJQKQFCbswD&error=server_error

see attached screenshots showing we have added the SAML attributes in Cogntio and Azure AD"
AWS IoT Device Management	"Re: Invalid IdP token for the user error
@gamma1-  We came across similar issue. If you found the solution to your problem, could you please share it here. It will be a great help. I really appreciate it."
AWS IoT Device Management	"Re: Invalid IdP token for the user error
Make sure to find out your actual SAML assertion response and SAML attributes in it. You can capture SAML response in your browser using steps described here. https://docs.aws.amazon.com/IAM/latest/UserGuide/troubleshoot_saml_view-saml-response.html

In this case, SAML attribute string may be set up as NAMESPACE column shown in your Azure AD side. Something like this 'http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress' (instead of string 'emailaddress') 

In Cognito UserPools, go to  Attribute Mapping -> SAML, then use the exact attribute string that you see in the SAML response and map it to Email."
AWS IoT Device Management	"Are User Pool customer attribute immutable?
We just added our 25th custom attribute and found out that is the limit. I don't see any way to delete a custom attribute via the GUI or the Admin APIs. Is there any way that I'm missing, or is my User Pool locked with the existing 25 custom attributes?"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Hi,

Apologies for the issues. You are correct,  25 is the limit and they can't be removed, per the docs. We've heard the request for adding the ability to delete custom attributes from other customers and will prioritize it in future releases."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Thank you."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Any change here? I've got a typo in one of my custom attributes but can't edit or delete it. And just noticed it allows me to create an identically named custom attribute with only the mutable / immutable checkbox being different which seems odd since it appears to either the 2nd one anyway."
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
Any update? I need to delete a custom attribute"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1 for edit & removal"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1, especially for editing from the console.  

It's not too hard with AWS CLI, but the console would make it easier.  Thanks!"
AWS IoT Device Management	"Re: Are User Pool customer attribute immutable?
+1 for remove custom attributes"
AWS IoT Device Management	"should we secure client-id and userpool-id ?
Hi,

I have a javascript application integrated with cognito, using javascript SDK. The SDK requires user pool Id and Client Id, to connect with congnito. Everything works fine, no issues. 

My concern is that, should I hide these client-id and userpool-id from javascript code, so that the users wont be able to see from the sources (in the browser). or these public information ?"
AWS IoT Device Management	"TooManyRequestsException: Rate exceeded - Cognito API Limits
We are trying to test our applications performance by signing in many users at once and performing operations with those users with the APIs that we have created in the API Gateway. So at the moment this is all at the API level with no UI involved. We are running into TooManyRequestsException: Rate exceeded errors though due to the default limits for the Cognito APIs specifically the user authentication operations that come with the AWS .NET SDK, which appear to have a limit of 10 to 20 requests/second depending on the API(https://docs.aws.amazon.com/cognito/latest/developerguide/limits.html).  For reference, our authentication process exactly mimics that of the Client Side Authentication flow here https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-authentication-flow.html. If the authentication tokens have expired we make a call to the InitiateAuth API again with the REFRESH_TOKEN to get new tokens. The specific error we see are seeing is...

Amazon.CognitoIdentityProvider.Model.TooManyRequestsException: Rate exceeded ---> Amazon.Runtime.Internal.HttpErrorResponseException: The remote server returned an error: (400) Bad Request.

We can work around these limits in our test environment by throttling how many users we are signing in at once, but we are having trouble understanding why the default rate limits are so low. It is likely that many users may sign in at the same time and/or need updated credentials at a rate higher than what the default limits are.  I understand a service limit increase can be requested, but with such a low starting rate we are starting to question whether or not we missed something or have set up the Cognito authentication process incorrectly. A previous product of ours at a peak time saw up to 750 concurrent session requests, which is what we are attempting to model using load/performance testing to make sure our application is properly handling that load to our expectations. We run our tests all in one account and in one UserPool, which is what our production environment will also look like, at least initially.

My main questions stemming from this are...
Why are the default limits so low? Do these rates actually support most use cases?

What is the best way to handle these Rate exceeded errors in a production environment before going the route of requesting a service limit increase? I assume similar to recommendations I have seen for other AWS services some sort of retry logic would be needed to handle this?

What is a reasonable service limit increase request for the load we are initially trying to support?

Edited by: DigiMoore on Feb 12, 2019 11:45 AM"
AWS IoT Device Management	"Cognito: send verification code to phone_number and email on signup?
Hi,

I am using AWS cognito to manage users. I want to send a verification code to user's phone_number and email on sign up(I am able to send code to phone_number or email, but not to both). I did not find a way to achieve it in cognito.

Please suggest me a way to achieve it.

I appreciate for your time.

Best Regards,
Prashanth Thugaiah"
AWS IoT Device Management	"Re: Cognito: send verification code to phone_number and email on signup?
Hello Prashanth,

Currently, if a user signs up with both a phone number and an email address, and your user pool settings require verification of both attributes, a verification code is sent via SMS to the phone. The email is not verified and the flow must be implemented in the app.

Your app needs to call GetUser [1] to see if an email address is awaiting verification. If it is, the app should call GetUserAttributeVerificationCode [2] to initiate the email verification flow and then submit the verification code by calling VerifyUserAttribute [3]. This is explained in our public documentation [4] under the notes section. You will be able to send the code to emails using this set up. 

Hope this helps. Let us know if you have any further queries.

[1] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_GetUser.html
[2] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_GetUserAttributeVerificationCode.html
[3] https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_VerifyUserAttribute.html
[4] https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-email-phone-verification.html"
AWS IoT Device Management	"Access S3 bucket after authenticating on Cognito from other account
I have two AWS accounts. The account A has a Cognito identity pool configured with roles for Authenticated and Unauthenticated.

The trusted relationship policy for Authenticated role looks like this:

{
  ""Version"": ""2012-10-17"",
  ""Statement"": [
    {
      ""Effect"": ""Allow"",
      ""Principal"": {
        ""Federated"": ""cognito-identity.amazonaws.com""
      },
      ""Action"": ""sts:AssumeRoleWithWebIdentity"",
      ""Condition"": {
        ""StringEquals"": {
          ""cognito-identity.amazonaws.com:aud"": ""<identity_pool_id>""
        },
        ""ForAnyValue:StringLike"": {
          ""cognito-identity.amazonaws.com:amr"": ""authenticated""
        }
      }
    }
  ]
}


There is also a policy for Authenticated role that looks like this:

{
    ""Version"": ""2012-10-17"",
    ""Statement"": [
        {
            ""Action"": [
                ""s3:GetObject"",
                ""s3:PutObject"",
                ""s3:DeleteObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/public/*"",
                ""arn:aws:s3:::users-pictures/protected/${cognito-identity.amazonaws.com:sub}/*"",
                ""arn:aws:s3:::users-pictures/private/${cognito-identity.amazonaws.com:sub}/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Action"": [
                ""s3:PutObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/uploads/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Action"": [
                ""s3:GetObject""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures/protected/*""
            ],
            ""Effect"": ""Allow""
        },
        {
            ""Condition"": {
                ""StringLike"": {
                    ""s3:prefix"": [
                        ""public/"",
                        ""public/*"",
                        ""protected/"",
                        ""protected/*"",
                        ""private/${cognito-identity.amazonaws.com:sub}/"",
                        ""private/${cognito-identity.amazonaws.com:sub}/*""
                    ]
                }
            },
            ""Action"": [
                ""s3:ListBucket""
            ],
            ""Resource"": [
                ""arn:aws:s3:::users-pictures""
            ],
            ""Effect"": ""Allow""
        }
    ]
}


On account B I have an application that must authenticate on Cognito from account A, but needs to access a bucket on account B.

This application uses Storage from Amplify.

The bucket structure must be something like this:

users-pictures/private/${cognito-identity.amazonaws.com:sub}/*


When Amplify authenticates on account A and tries to access this bucket on account B, it gets an Access Denied (403).

Probably it's missing some configuration on account A and/or account B.

Could you help me, please?

Edited by: rodrigosouzamendonca on Feb 11, 2019 4:15 AM"
AWS IoT Device Management	"Post Confirmation Lambda Trigger after Admin Create
Hi,

I currently have a Cognito Pool that should trigger a Lambda Post Confirmation trigger after a User is confirmed. However, I am never seeing the Post Confirmation trigger event be invoked after a User is confirmed.

I believe my process of setting up a user might be the cause of this:

1. Use adminCreateUser to build the new user.
2. Use adminInitiateAuth to login the user for the first time and get the NEW_PASSWORD_REQUIRED challenge.
3. Use adminRespondToAuthChallenge to respond and set the user's password so we bypass the need to have the user reset the password.

I am able to successfully create the user and login via this route. I see the user get to a confirmation status as well.

However, I never see a Post Confirmation event in the Lambda. I tested to make sure my Lambda was working by setting it for PreSignUp and PostAuthentication. Both of those triggered fine.

I also attempted with the standard flow of:
1. Create user as admin.
2. Get password temp for user to login via email.
3. Login for user with temp password and set new password.
4. See user get confirmed.

In that instance, no Post Confirmation event is recorded in Lambda either.

Any help or ideas I can try would be greatly appreciated."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
The Cognito User Pools service does not invoke Post Confirmation trigger in this case. Since setting the password after first sign in attempt is an authentication attempt, successful authentication and setting the password triggers Post Authentication trigger.

We understand the confusion of user status being changed from FORCE_CHANGE_PASSWORD to CONFIRMED and why customers would expect Post Confirmation trigger to be invoked. We are considering the options to elevate this confusion and will post the update here."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
Any update?
I/we do not allow users to sign themselves up. An admin will always create the users record, and send an email with a temp password.

How do I trigger an event, after the email has been verified, or after the user sets required attributes?"
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
Hi,

I had this same issue. For a workaround, I set a trigger on the POST_AUTHENTICATION hook and then tested for the UserStatus of ""FORCE_CHANGE_PASSWORD"". If a user doesn't actually set a new password and leaves the site beforehand, this will be a false positive, but it worked for us in our use case.

def handler(event, _):
    ''' handle post auth event '''
    status = event['request']['userAttributes']['cognito:user_status']
¬†
    # If the status hasn't been confirmed yet, we can assume it now is
    if status == 'FORCE_CHANGE_PASSWORD':
       # Do Something
¬†
    return event


Hope that helps."
AWS IoT Device Management	"Re: Post Confirmation Lambda Trigger after Admin Create
I got the same problem. I'm relying on the trigger to populate user profile in DynamoDB but it only works for users who log in via Facebook, Google etc. Cognito is bad!"
AWS IoT Device Management	"BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
Attempting to create a new user pool in ap-southeast-2 gives me the following error:

    ""errorCode"": ""LimitExceededException"",
    ""errorMessage"": ""The limit for user pools is: 100."",


Except that I have requested and received a limit increase to 600, and already have well over 100 pools (so clearly I have been able to create more than 100 pools in the past).

This error has happened before, and I was advised by AWS support at that time:


I have received feedback from the service team, they have an advised there was a technical issue from the 19th to the 21st August that caused customers to receive the error you had.
¬†
The issue has been cleared and they would like you to try again, should the issue persist to please notify us so we may escalate the issue further. 
¬†


As you can imagine, any interruption to user accounts and logins represents a major disruption to our business.

Please fix this as soon as possible.

To anyone reading this who has not yet committed to using Cognito in their app: DON'T. It is an unreliable, patchwork piece of s***."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
It's been 5 days, and not even a hint of a solution.

It seems that AWS and the Cognito team simply don't care? How hard can it possibly be to respect an increased user pool limit, given that the functionality was working perfectly until a week ago.

Absolutely embarrassing for all parties concerned (including our business, as we have to explain to our customers that our ""world leading"" cloud computing provider can't be bothered providing us with the services they're supposed to be providing.)

The flow-on effects of this are huge. Please please please fix this already."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
6 days and counting. No word from AWS."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
7 days and counting. No solution in sight.

Will this ever be fixed?"
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
8 days.

Not that anyone in the Cognito team cares, obviously, but I've encountered this issue twice in the space of five months, so I assume it will happen to others as well. Moral of the story is to not use Cognito, as they routinely break the service behind your back and are in no rush to fix it."
AWS IoT Device Management	"Re: BUG: Cognito user pool increased limits in ap-southeast-2 are not respected
After 9 days, the problem has finally been resolved.

The only clue I have is that the default Cognito user pool limit has been increased to 1000 according to the docs, yet my 'create user pool' requests were being denied, citing the old default limit of 100. Both of these number ignored the fact that i had previously requested and received an increase to my limit.

Such is the way with Cognito, it seems... Things break, a week goes by, then a few more days, and then, if you're lucky, they unbreak. No explanation given.

Throughout this time, https://status.aws.amazon.com/ has reported that Cognito in ap-southeast-2 has been operating normally. In the words of Balram Halwai, ""What a f***ing joke""."
AWS IoT Device Management	"""account with the email already exists"" error prevents email verification
Received the error ""An account with the email already exists."" when trying to verify an email address using a code.  Tested this several ways and believe this occurs when: 

1. Using Hosted UI, selecting 'Username and Also allow email login with verified email address' for sign-in. 
2. For Standard attributes, Email is selected and required.
3. Users are allowed to sign themselves up for an account.
4. Email is set for verification
5. Allowing Google and/or Facebook social login, with attribute mapping of email to User Pool email. 
6. Log in using either Google or Facebook. 
7. Try to 'Sign-Up' to create a User Pool account using an email that is associated with the Google or Facebook account you signed in as in step 6
8. System lets you create an account using that email, but then transitions to the screen to enter the verification code.  When you try to submit the code, the error ""An account with the email already exists."" appears at top, and user cannot complete verification. 

This is a typical scenario: A user logs in with a Social Login, and time passes.  They forget, and the come back to sign-up with a username/password.  But, if they try to use the same email that is associated with the social media account, they will run into this error. 

Also, if you start with no accounts, and do steps 1-5 above, but then reverse the user pool and social login steps like so: 
6. 'Sign-Up' to create a User Pool account and successfully verify your email using the code.
7. Log in using a Google or Facebook account that has the same email as in Step 6. 
8. The email used to create the User Pool account step 6 changes to 'Unverified'. 

I suggest that this behavior is a bug. It would seem that Social Media accounts and a User Pool account that share an email address should not create these effects.  OR that this Cognito configuration would not be allowed with Social Login.  OR that the user would not be allowed to get all the way to the email verification stage before being told they can't use that email address because it already is associated with a Google|Facebook|Standard Login account ... depending on the order in which the sign-ups occurred.  Happy to provide any additional details."
AWS IoT Device Management	"AWS Shield as a DDoS Service?
Hi,

We are currently hosting some of our services on AWS, and some of our infrastructure on other places.
For one of our servers hosted elsewhere (serving raw TCP traffic, not HTTP/S), we would like to be able to benefit from AWS shield standard protection.
Does AWS Shield Standard protection apply to non-HTTP ports of EC2 instances?
Does it make sense to create an EC2 instance and put a reverse TCP proxy on it? Assuming 2TB of traffic per month, what setup / costs should we be looking at?

Edited by: tacticsoft on Dec 5, 2018 11:58 PM"
AWS IoT Device Management	"Shield Standard:  What does it protect
The FAQ and Info online aren't too clear about what services Shield Standard actually protect; I see mention of load balancers, etc. but little specifics.

I'm specifically interested in knowing if Shield Standard protects Elastic IPs allocated in VPCs, and what types of protection are in place (Protection against SYN floods, UDP Floods, ICMP Floods, etc.).

Is there more detailed info available?"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Standard defends against most common, frequently occurring network and transport layer DDoS attacks that target your web site or applications. On Amazon EC2, your traffic levels are inspected by an auto-mitigation system that can engage when a well-defined DDoS attack signature is detected or at high levels of traffic, given your choice of instance type. UDP reflection attacks, like DNS reflection, NTP reflection, SSDP reflection, etc. are examples of common DDoS attack vectors that can be mitigated by this system.

For improved DDoS resilience across a wide range of attack vectors, like SYN floods or web application layer attacks, consider using Amazon CloudFront or Application Load Balancer (ALB) with AWS WAF. You can also use a Classic Load Balancer for non-web use cases and Amazon Route 53 to also protect against DNS query floods.

You can learn more about these recommendations in the AWS Best Practices for DDoS Resiliency which is available at https://d0.awsstatic.com/whitepapers/Security/DDoS_White_Paper.pdf . This paper provides a prescriptive reference architecture you can use to help make your applications more DDoS resilient.

I will reach out to you directly to answer any follow-up questions you might have. I am interested to learn about your application and provide tailored recommendations.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
So... more specifically, I'm interested in:  knowing if Shield Standard protects Elastic IPs allocated in VPCs

That is, is it in effect if I'm not using CloudFront or ELBs?  The documentation only mentions these specifically as protected services."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Yes. AWS Shield Standard provides protection for EIP's in VPC.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Thanks, that was the primary question I had.  Thanks again, have a Happy New Year!"
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
Hello Jeffrey and other AWS employees,

Can AWS Shield Standard prevent a volumetric attack from saturating the bandwidth of a small EC2 instance and what will happen if a UDP attack hits a small instance while all UDP is blocked in the security group? Will you ever nullroute the IP, if a huge attack hits us? Layer 7 is not an issue since we'll have efficient rate limits.

I've read the relevant DDoS resiliency whitepaper and your previous answers. It does not answer my question, unfortunately. I need an answer for EC2 only, please.

Thanks in advance."
AWS IoT Device Management	"Re: Shield Standard:  What does it protect
AWS Shield Advanced is available for Elastic IP Addresses (EIP's) which allows you to protect Amazon EC2 instances or Network Load Balancers (NLB's). To learn more about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
I'm about to deploy a web app in production using AWS BeanStalk on a single instance (basic tier).

Will my app be automatically protected through AWS Sheild Standard?"
AWS IoT Device Management	"Re: Is AWS Shield Standard automatically enabled for a AWS Beanstalk App?
AWS Shield Standard automatically protects every AWS resource type in every AWS region against common DDoS attacks. No action is required on your part.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Shield support for non-Web Apps
Is Shield supported for non-web applications which are not even using a ELB? Can it be assigned to a VPC with public IP addresses? 
In this case, is there any additional protection does AWS-shield provide over and above the Security-groups/NACL ?"
AWS IoT Device Management	"Re: Shield support for non-Web Apps
With AWS Shield Advanced you can now add an Elastic IP Address (EIP) as a protected resource, which allows you to protect Amazon EC2 instances and Network Load Balancers (NLB's). For more information about AWS Shield Advanced for EIP, see our What's New announcement at https://aws.amazon.com/about-aws/whats-new/2017/11/aws-shield-adds-advanced-ddos-protection-for-ec2-and-network-load-balancer/ .

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"AWS Shield Advanced - Multiple Accounts
We've got several accounts all owned by the parent company, there are development, qa, and multiple production environments.  If we sign up for Shield advanced, will this cover only one of the accounts, or can we cover all of them?

Cheers

Keith"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
If your organization has multiple AWS accounts, then you can subscribe multiple AWS Accounts to AWS Shield Advanced. You will pay the monthly fee once as long as the AWS accounts are all under a single consolidated billing, and you own all the AWS accounts and resources in those accounts.

Thanks, Jeff
AWS DDoS Response Team"
AWS IoT Device Management	"Re: AWS Shield Advanced - Multiple Accounts
Thanks for that - very helpful"
AWS IoT Device Management	"What if I've got my clients in my AWS account? Are they protected?
I wonder if I contract Shield Advanced the clients I've got in my AWS account are protected with Shield Advanced too.
I've got a web design company and my clients are in my AWS account so it is easier to manage.
Thanks,"
AWS IoT Device Management	"Re: What if I've got my clients in my AWS account? Are they protected?
Hi,

You can enable AWS Shield Advanced for the protection of multiple AWS resources, as long as the subscribing AWS Account holder directly owns and manages the AWS resources. Further, AWS Shield Advanced's monthly fee applies per organization subscribed to AWS Shield Advanced. If your organization has multiple AWS accounts, you will pay the monthly fee once as long as you own all the AWS accounts and resources in that account.

Thanks
Venkat"
AWS IoT Device Management	"TOTP on transaction validation
Hi community!

I searched through the Cognito docs and haven't found the answer to my problem.

Some transactions in my company system need to be confirmed by a token, because those transactions may lead to incorrect invoices and hence some major tax problems to be dealt later. We're still on architecture definition, and some AWS solutions need to be selected to plan our monthly budget and our development sprints.

After some research, I figured out that Cognito sends TOTP tokens when MFA is turned on, but apparently that's done only on login. I couldn't figure out however if Cognito can be used to send those TOTP tokens for other purposes, like the one described above. Is there a way to to that using this or any other AWS service, or is it better to develop a service compliant to RFC 6238?

I'd like to thank the help of you all in advance.

Best regards,
Guilherme Soares."
AWS IoT Device Management	"Pricing details for server to server communication (client credential flow)
Hi ,

Can some one help on pricing model for user pool only with app clients ? User pool created will not have any user but will have 2 app clients only (for server to server communication). In case of Client Credentials Flow, what are the billing charges ? It is based on number of hit to get the auth token ? Is there any charge on validating the token generated using url :  https://xxxxxxxx.auth.us-east-1.amazoncognito.com/oauth2/token via API gateway authorizers ?

Is there any charge on creating domain name for resource server ?

Thanks,
Ajay"
AWS IoT Device Management	"How to use Cognito Identity Provider API through the API Gateway
I've tried to set an method in the API Gateway with the integration request pointing to the AWS Service ""Cognito Identity"" and Action to AdminGetUser. Testing the method I get in the response this  exception ""com.amazon.coral.service#UnknownOperationException"".
I've tried to force the Content-Type, the X-Amz-Target but nothing has produced a better response. I've tried to set up some new methods pointing to S3, Step Function and these ones return a right response.
Please, may you tell me if the operation I'm trying is admitted and if YES, where is the trick ?
Thanks
Stefano"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
Hi,

I believe you don't have the x-amz-target header set up correctly. For AdminGetUser API on Cognito side, you need to set AWSCognitoIdentityProviderService.AdminGetUser as the value of x-amz-target with a POST method and the parameters in the payload.

POST
/¬†
¬†
content-type:application/x-amz-json-1.1
host:cognito-idp.us-east-1.amazonaws.com
x-amz-date:20170426T230022Z
x-amz-target:AWSCognitoIdentityProviderService.AdminGetUser
¬†
{""Username"": ""name"", ""UserPoolId"": ""id""}


Thanks,
-Ka Hou"
AWS IoT Device Management	"Re: How to use Cognito Identity Provider API through the API Gateway
I am getting Missing Authentication  Token while using the api
When I use the Authorization Header , I get not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get it running ?"
AWS IoT Device Management	"X-AMZ-TARGET: AWSCognitoIdentityProviderService.AdminGetUser Issue
Hi All
I am trying call api to get user details in following manner:

Url: https://cognito-idp.xx-xxxxxx-X.amazonaws.com
Headers: 
X-AMZ-TARGET : AWSCognitoIdentityProviderService.AdminGetUser
Content-Type: application/x-amz-json-1.0
Authorization : Bearer <Token>

But I am getting following response:
not a valid key=value pair (missing equal-sign) in Authorization header: 'Bearer

How to get this api running with Access token?"
AWS IoT Device Management	"[Unity3D] Is there an economic way to grant app access to AWS services?
Hi,

Im pretty confused with some things. Im developing a game in Unity3D, and I want to use DynamoDB and S3 for players storage data.

I have in mind this two basic scenarios:

First scenario:

1) Players will authenticate with social platforms (Facebook, Google) using each platform SDK. If they login, they get an accessToken from the platform. Fine here.
2) Next, grant access to AWS by doing each player pass the accessToken credentials.AddLogin(""graph.facebook.com"", accessToken) in the AWS SDK;
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I will have one MAU for each player that login in the month. 10.000.000 unique logins in a month = 10.000.000 MAU = 10.000.000 * price of the MAU.

Second scenario (if possible)

1) Player will authenticate with social platforms (Facebook, Google) using each platform SDK.
2) App authenticate with Identity Pool ID in order to have access to AWS services.
3) Player can start using AWS services, DynamoDB, S3.

In this scenario, I can have infinite numbers of logins each month, but the MAU will be always 1 since its always the same for each player.

The questions are:
1) Is this 2 scenario possible?
2) Is possible to have an app with 10.000.000 users per month that let players use AWS services (DynamoDB, S3) without paying 10.000.000 MAU prices (at least paying for 1 MAU).

Thanks!"
