label	description
Ruby Development	"AWS Cognito Authentication of user not working
Hello 

I have created the cognito user Pool and trying to  Register my user through simple HTML Registration page where my user is sign up but after sign up I am getting verification code. and I need to Authenticate that user so that after authentication I will be able to verify my user through the OTP code sent on my Registered mail Id.
so below is the code to sign up user and its authentication  but in my case my user is not getting Authenticated I have did the authentication process similar to the process given in AWS Tutorial: Integrating User Pools for JavaScript Apps for Authenticating the User please Let me know where I am going Wrong.

Code:

<!DOCTYPE html>

<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
	<!-- Javascript SDK-->
  <script src=""https://code.jquery.com/jquery-1.11.3.min.js""></script> 
  <script src=""js/amazon-cognito-auth.min.js""></script>
  <script src=""https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js""></script> 
  <script src=""js/amazon-cognito-identity.min.js""></script>  
  <script src=""js/config.js""></script>
  <script src=""lib/AuthenticationDetails.js""></script>
  <script src=""lib/AuthenticationHelper.js""></script>
   <script src=""lib/CognitoJwtToken.js""></script>
  <script src=""lib/CognitoIdToken.js""></script> 

  </head>


  <body>

    <h1 class=""h3 mb-3 font-weight-normal"" id=""titleheader"">Register an Account</h1>

	<input type=""personalname"" class=""form-control"" id=""personalnameRegister"" placeholder=""Name"" pattern="".*"" required>
    <input type=""email"" class=""form-control"" id=""emailInputRegister"" placeholder=""Email"" pattern="".*"" required>
	<input type=""password"" class=""form-control"" id=""passwordInputRegister"" placeholder=""Password"" pattern="".*"" required>
    <input type=""password"" class=""form-control"" id=""confirmationpassword"" placeholder=""Confirm Password"" pattern="".*"" required>
	<button id=""mainbutton"" class=""btn btn-lg btn-primary btn-block"" type=""button"" onclick=""registerButton()"" >Register</button>

	<script>

		var username;
		var password;
		var personalname;
		var poolData;

	  function registerButton() {

		personalnamename =  document.getElementById(""personalnameRegister"").value;	
		username = document.getElementById(""emailInputRegister"").value;

		if (document.getElementById(""passwordInputRegister"").value != document.getElementById(""confirmationpassword"").value) {
			alert(""Passwords Do Not Match!"")
			throw ""Passwords Do Not Match!""
		} else {
			password =  document.getElementById(""passwordInputRegister"").value;	
		}

		var authenticationData = 
		{
			Username : 'username',
			Password : 'password',
       };

		poolData = {
				UserPoolId : _config.cognito.userPoolId, // Your user pool id here
				ClientId : _config.cognito.clientId // Your client id here
			};		
		var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
		var userData = {
        Username : 'username',
        Pool : userPool
    };
		var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
		var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

		var attributeList = [];

		var dataEmail = {
			Name : 'email', 
			Value : username, //get from form field
		};

		var dataPersonalName = {
			Name : 'name', 
			Value : personalname, //get from form field
		};

		var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
		var attributePersonalName = new AmazonCognitoIdentity.CognitoUserAttribute(dataPersonalName);


		attributeList.push(attributeEmail);
		attributeList.push(attributePersonalName);

		userPool.signUp(username, password, attributeList, null, function(err, result){
			if (err) {
				alert(err.message || JSON.stringify(err));
				return;
			}
			cognitoUser = result.user;
			console.log('user name is ' + cognitoUser.getUsername());
			//change elements of page
			document.getElementById(""titleheader"").innerHTML = ""Check your email for a verification link"";

		});

		cognitoUser.authenticateUser(authenticationDetails, {
        onSuccess: function (result) {

            var accessToken = result.getAccessToken().getJwtToken();
            console.log(accessToken+""accessToken"");
             var idToken = result.idToken.jwtToken;
        },

        onFailure: function(err) {
            alert(err);
        },

    });

	  }

	</script>

 </body>

</html>


Thanks In advance."
Ruby Development	"Resend Temporary Password from client-side
I working on a scenario when the user never got (or lost) the email with the temporary password. Now common sense will drive the user to the ""forgot password"" process. But here, he'll get an error saying ""User password cannot be reset in the current state."" What now? I'm trying to find a way to re-send the email with the temporary password FROM the client-side. 

I know there's the option of AdminCreateUser with ""MessageAction"": ""RESEND"" but that involves the back-end and I would prefer keeping this logic in a component in client-side (where the rest of the authentication logic already is). 

I've been trying with the method ""resendConfirmationCode"" of CognitoUser but I get a ""NotAuthorizedException"" error with the message ""Can't resend confirmation code for this user""

Every other post I've read regarding this very scenario ultimately proposes the AdminCreateUser option without even trying to explain why ""resendConfirmationCode"" doesn't work.  

Even if it can't be done, any help with this issue will be greatly appreciated.

Edited by: jrojas on Dec 6, 2018 11:32 AM"
Ruby Development	"Signiature Version 4 Test Suite Inconsistency
The AWS Signature Version 4 Test Suite from Amazon consists of 24 tests.  Each test consists of 5 files:
(1) Request (.req) , (2) Canonical Request (.creq), (3) String to Sign (.sts), (4) the correct Authorization header
(.authz) and, finally, (5) the Signed Request (.sreq)  showing the original request with the Authorization header in
context.

In 22 of the 24 tests, in accordance with the specification, the last line of the String to Sign file is the SHA-256 digest
of the Canonical Request file.  This is no surprise.  The spec says that the last line of the String to Sign is supposed to be a hash of the Canonical Request, and in the test suite, SHA-256 is the chosen hash in all cases.

In 2 of the tests, this is not the case.  Those two tests are (1) post-x-www-form-urlencoded-parameters; and (2) post-x-www-form-urlencoded.   

Why is this?  Is it an error in the test suite?  

This is not just nit-picking.  I happen to have a use-case which is similar to the two test suite examples.  My code works for ALL the test suite examples, except for the two cases which are similar to my actual use case, and I cannot get my code to work.   It is a common case.  So I would really appreciate an answer soon."
Ruby Development	"Lambda function : ""Unexpected token  < error""
I have written a lambda function javascript code for my alexa skill.But when I try compiling the code it shows error :
Response:
{
  ""errorMessage"": ""Unexpected token <""errorType"": ""SyntaxError"",
  ""stackTrace"": [
    ""                                                              ^"",
    """",
    ""SyntaxError: Unexpected token <"",
    ""createScript (vm.js:80:10)"",
    ""Object.runInThisContext (vm.js:139:10)"",
    ""Module._compile (module.js:616:28)"",
    ""Object.Module._extensions..js (module.js:663:10)"",
    ""Module.load (module.js:565:32)"",
    ""tryModuleLoad (module.js:505:12)"",
    ""Function.Module._load (module.js:497:3)"",
    ""Module.require (module.js:596:17)"",
    ""require (internal/module.js:11:18)""
  ]
}

I am hereby attaching my javascript code and screenshots of aws console.
Looking forward for help.
Thank you."
Ruby Development	"Re: Lambda function : ""Unexpected token  < error""
You dont need the <script> tag on the js file.
As it is already a js file, everything inside is seen as javascript, so the error is most probably the interpreter complaining that there is ""<"" which is not valid

hope this helps,
RT"
Ruby Development	"NodeJS Lambda functions and source code comments
Do commented lines within Lambda code cause any performance degradation? of any kind?

Edited by: leforge on Dec 5, 2018 8:40 AM"
Ruby Development	"Re: NodeJS Lambda functions and source code comments
No performance degradation as comment lines are ignored.
RT"
Ruby Development	"3rd Party cookies disabled (Brave Browser) preventing Cognito login
When using the Brave Browser with 3rd party cookies disabled, login on my site does not work when using Cognito. I am using the aws amplify cognito react library to connect.

I get a 307 internal redirect with the first OPTIONS request and it does not return any access control headers in the response. When cookies are allowed, I get the correct 200 response. 

Here's some sample javascript I run in console mimicking the request. It works only if third party cookies are allowed. 

await fetch(""https://cognito-idp.us-east-1.amazonaws.com/"", {""credentials"":""omit"",""referrer"":""https://+mysite.com+/login"",""referrerPolicy"":""no-referrer-when-downgrade"",""body"":null,""method"":""OPTIONS"",""mode"":""cors""});

Am I setting something up incorrectly?  Thanks for all the help!

Edited by: DSB on Dec 5, 2018 5:54 PM"
Ruby Development	"Socket.IO-Redis-Adapter With Elasticache Redis Fails WSS Upgrade Header
We have a websockets server and I'm currently working on migrating our services to Elastic Beanstalk. The servers were previously located on Heroku and were using a separate redis instance (also provided by Heroku) for maintaining websockets connections between multiple server instances.

I have created an elasticache redis instances on AWS which is able to connect successfully, however the websockets upgrade http request always returns a 400.

What's puzzling is that when I connect to the Heroku-generated redis, the request passes and a websockets connection is successfully established.

I've gone through security groups to enable all connections from everywhere on all ports and made sure ssl was properly configured to isolate the problem, but it still doesn't establish a successful connection.

I'm not sure if this is a limitation of elasticache now, so I'm hoping someone with more experience on AWS could shed some light on this."
Ruby Development	"AWS SDK SQS - Include custom header
I am using the AWS SDK SQS behind a router, to get through the router I need to include a custom header in the REQUEST.

I've seen this documentation (https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Request.html#build-event) that talks about the .on ('build') event in REQUEST, however, using the SQS service is not working, no error has been thrown and the custom header is not included in the REQUEST.

Is it possible include a custom header using AWS SDK with SQS service ?
How make to make this work?

Edited by: neias on Nov 29, 2018 3:17 AM (clarifications)"
Ruby Development	"Re: AWS SDK SQS - Include custom header
After help, I was able to send messages to the queue with a custom header, below the sample code:

var sqs = new aws.SQS({http_wire_trace: true});
 
var params = {
    MessageBody: 'Hello world!',
    QueueUrl: queueUrl,
    DelaySeconds: 0
};
 
var req = sqs.sendMessage(params);
 
req.on('build', () => {
    req.httpRequest.headers = 'bar';
});
 
req.on('success', (resp) => {
    console.log(resp.request.httpRequest.headers)
    });
 
req.send();"
Ruby Development	"AWS-SDK, getMetricWidgetImage is not returning singleValue Image
---–------------------------------------------------------------------------------------
EDIT (Answer)
Even though there seems to be a property for ""view"", the AWS support informed me, that this type is not supported in ""CloudWatch::prototype.getMetricWidgetImage"". It's simply ignoring it.

---–------------------------------------------------------------------------------------

Hello AWS-Support,

I am using the AWS-API via the AWS-SDK for NodeJS/JS and want to generate images from CloudWatch's ""CloudWatch::prototype.getMetricWidgetImage"" in order to display those images on a custom site.

With props like this, everything works fine: 
{ 
  ""metrics"": [
    [ ""LogMetrics"", ""errorOnAXH"", { ""period"": 60, ""label"": ""AXH Backend Prod Log Errors/min"", ""stat"": ""SampleCount"" } ]
  ],
  ""view"": ""timeSeries"",
  ""stacked"": false,
  ""region"": ""eu-central-1"",
  ""title"": ""Log Errors""
};


But if I want to change ""view"": ""timeSeries""
 to ""view"": ""singleValue""
 it doesn't work. I always get an timeSeries-Image back from the API.

Can you tell why this isn't working and probably fix that?

Thank you in advance,
Mark

Edited by: marklabenski on Nov 29, 2018 9:49 AM

Edited by: marklabenski on Nov 29, 2018 9:51 AM"
Ruby Development	"Re: AWS-SDK, getMetricWidgetImage is not returning singleValue Image
See edit note on top"
Ruby Development	"Lambda Nodejs
Hello, I had a recent problem with a nodejs lambda function and I can't seam to understand how aws is keeping the node env 
If i run the lambda function first time I will get the expected output
""A""
then if I run it multiple times, thins are starting to become strange:
""A"",""A"".......

So it seams that the log is not cleaned, the way to clean it is to ""save"" the file again.

Anybody can explin this to me? O point me to some documentation ?

Lets say that i had 2 files 
index.js
module.exports.handler  = (event, context, callback) => {
require('./log').add(""A"").show();
}
log.js 
module.exports = {
   list : [],
   add : function (v) {
     this.list.push(v);
     return this;
   },
   show : function() {
   console.log(this.list);
    return this;
   } 
}

Edited by: alin1918 on Oct 19, 2018 3:17 AM

Edited by: alin1918 on Oct 19, 2018 3:19 AM"
Ruby Development	"Re: Lambda Nodejs
Hello
When your lambda function gets called the first time, it is a cold start. Meaning AWS needs to allocate where will it run and separate the memory and all the background process needed to run it. Once you run it, AWS keeps your function online for a while before releasing the memory and everything else.
So in the case of your function, calling it multiple consecutive times just adds to the list Array and that's why you see the result as 

here is the actual documentation
https://docs.aws.amazon.com/lambda/latest/dg/running-lambda-code.html
here is an article on that
https://read.acloud.guru/how-long-does-aws-lambda-keep-your-idle-functions-around-before-a-cold-start-bf715d3b810
hope this helps,"
Ruby Development	"Lambda recurse
Hi
I'm to organize a lambda execution which exceeds lambda execution time restriction limit. So I have to  call for my lambda recursively if there's still job to work.

I found several examples in the internet similar to this https://hackernoon.com/write-recursive-aws-lambda-functions-the-right-way-4a4b5ae633b6. It mentions a call to some recurse function.

In practice such a call rises 
unhandled exception TypeError: recurse is not a function


I can not find any documentation on this function.

So should it be node environment or lambda context function?
Or should it be required from some preinstalled module?
Or is it just about a local own wrapper on regular lambda call over sdk?

What is the best practice on this?

Thx!"
Ruby Development	"Re: Lambda recurse
Hello
Recursion is a big issue because it consumes too much memory and runs for long time which in turn becomes a bottleneck and increased costs
Depending on what you are trying to do, you could put objects in SQS or S3 and then trigger a lambda call.  So each lambda call does only one thing, runs in parallel, and there is no recursion. 

hope this helps,
RT"
Ruby Development	"AWS SDK for JS in Browser with a CognitoUser instead of IAM credentials?
Greetings,

I have a browser app that interacts with S3. Since it was mostly an in-house tool, after handling authenticating to an API, it directly received the ID and secret for a very restricted IAM user which was then used to setup the AWS SDK in the browser.

I am now trying to change that app to use Cognito for authentication. I wound up using AWS Amplify just to handle the authentication part, and now I'm trying to figure out if there's a way of using the credentials I get from Cognito to setup the AWS JavaScript SDK and replicate the same functionality from that point on. (The way Amplify currently handles interaction with S3 does not cover all my needs)

Is there a way of doing this? Alternatively, if I can use only the JS SDK (no Amplify) to login a user via Cognito, that is also preferable to me.

Thank you."
Ruby Development	"Re: AWS SDK for JS in Browser with a CognitoUser instead of IAM credentials?
Hello
You will need to create the role,  cognito user pool and validate a user before using the code but take a look at this example

https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html

hope this helps
RT"
Ruby Development	"Instance Hacked - now what?
I have an instance running in a free tier in Ubuntu for the purpose of hosting a Discord Bot. Somehow, a malicious user was able to access my bot and send multiple ""messages"" as my bot in several channels on my discord server. By the time I noticed, the code running in my instance either crashed or the hacker stopped my bot code running Node.js under forever npm. To get the Bot up and running again, i had to re-invite my bot to my server and restart my node.js JavaScript application in Putty shell."
Ruby Development	"Re: Instance Hacked - now what?
so what's your question?"
Ruby Development	"Cloudwatch logs missing entries
Hi there,

This started to happen two days ago. I have an ECS task that runs in a Node container. I have a try..catch block that looks like this:

try {
...
} catch (err) {
  console.error('Error', err)
  reportFailure(task.taskToken, err.message)
}


reportFailure() function basically calls `sendTaskFailure` API on the step function client, so I can see the error message right in the Step function console. The problem that started to happen recently is this code no longer sends `err` to cloudwatch logs. If I can see the err.message in step functions, surely the line `console.error('Error', err)` would have been executed, therefore logged in the corresponding cloudwatch log stream.

Can anyone advise what might have gone wrong here? I am a bit lost."
Ruby Development	"AdminListGroupsForUser returning UserNotFoundException
Please see this post for a more in-depth description:

https://stackoverflow.com/questions/53393588/adminlistgroupsforuser-returns-user-does-not-exist?noredirect=1#comment93662919_53393588

My application has to authenticate with 2 services (one of which is AWS Cognito) before proceeding.  After successful authentication, I attempt to get the groups for that user but am returned with UserNotFoundException. This was interesting as I had just authenticated with the same user credentials and the user is clearly in the pool.

In the link above, you can see that I paired these together and that the latter call to adminGetUser()
 is successful and returns the user whereas the former call to adminListGroupsForUser
 returns an error and cannot find the user.

Edited by: willpim94 on Nov 20, 2018 6:27 AM"
Ruby Development	"Cloudsearch Access issue. No 'Access-Control-Allow-Origin' header .
I would appreciate help on this.
Code:-
    var cloudsearch = new CloudSearch({apiVersion: '2013-01-01'})  
    cloudsearch.listDomainNames(function(err, data) {
      if (err) console.log(err, err.stack); // an error occurred
      else     console.log(data);           // successful response
    });

Error in browser console:-
OPTIONS https://cloudsearch.us-west-2.amazonaws.com/ 404 (Not Found)
Failed to load https://cloudsearch.us-west-2.amazonaws.com/: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:4200' is therefore not allowed access.

Note:-
i. Tried S3 bucket api. It works.
ii. Full Access policy added in IAM user and Cloudsearch.

Edited by: Mil on Oct 29, 2018 4:41 AM"
Ruby Development	"Re: Cloudsearch Access issue. No 'Access-Control-Allow-Origin' header .
The issue is resolved now by adding cors-anywhere.
https://github.com/Rob--W/cors-anywhere#client"
Ruby Development	"AWSJavaScriptSDK Cloudsearch CORS Issue
CORS support is not present in cloudsearch. Code snippet and output are given below.

Code snippet (aws javascript sdk):-
  cloudsearch_test() {
    var cloudsearch = new CloudSearch({apiVersion: '2013-01-01'});
    var params = {
      DomainNames: [
        'cs_domain'
      ]
    };
    cloudsearch.describeDomains(params, function(err, data) {
      if (err) console.log(err, err.stack); // an error occurred
      else     console.log(data);           // successful response
    });
  }

Browser Console output:-
cloudsearch.us-west-2.amazonaws.com/:1 Failed to load resource: the server responded with a status of 404 (Not Found)
localhost/:1 Access to XMLHttpRequest at 'https://cloudsearch.us-west-2.amazonaws.com/' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: It does not have HTTP ok status.

Tried adding cors packages in angular project. But It didn't work. 

Packages available:-
•	https://www.npmjs.com/package/cors
•	https://www.npmjs.com/package/cors-anywhere

Tried following ways suggested to add CORS but found no luck.
1.	https://geekbites.move4mobile.io/2016/08/18/nodejs-proxy-cors/
2.	https://medium.freecodecamp.org/the-best-ways-to-connect-to-the-server-using-angular-cli-b0c6b699716c

Errors:-
1.	AppComponent.html:2 ERROR ReferenceError: __dirname is not defined
  at getHandler (cors-anywhere.js:253)
2.	AppComponent.html:2 ERROR TypeError: Cannot read property 'DEBUG_MIME' of undefined        at Mime.push../node_modules/send/node_modules/mime/mime.js.Mime.define (mime.js:25)

Could you please help.
Regards,
Milan

Edited by: AppSolZone on Nov 15, 2018 6:00 AM

Edited by: AppSolZone on Nov 15, 2018 6:00 AM"
Ruby Development	"Re: AWSJavaScriptSDK Cloudsearch CORS Issue
Hi,

Unfortunately CloudSearch does not support CORS at this time. In order to get around this issue you can wrap around it with API Gateway which has support for CORS.
I hope this is helpful for you!

Best regards
Emanuel"
Ruby Development	"Re: AWSJavaScriptSDK Cloudsearch CORS Issue
The issue is resolved now by adding cors-anywhere.
https://github.com/Rob--W/cors-anywhere#client"
Ruby Development	"Writing files to AWS Elastic Beanstalk at Runtime
I have developed a web application with a Node.js backend on a local machine using Webstorm IDE. Among other things, the application creates a new unique folder and writes 7 javascript (.js) files to this folder during runtime each time a user requests a new account. Everything works properly in the local development environment.

When the application is uploaded and deployed to AWS Elastic Beanstalk, and a new user is requested though the application web page, I am receiving the following 404 (Not Found) error in the browser's Developer, JavaScript Console. The same error appears for each of the 7 files. The number 1541877962401 is the unique folder name generated by the application when a user requests a new account and user.js is one of the 7 javascript files copied to this newly created folder. savedUser is an existing folder in the file structure and is not created during runtime.

GET http://sowtest082-env.stsvxa672t.us-east-1.elasticbeanstalk.com/savedUser/1541877962401/user.js net::ERR_ABORTED 404 (Not Found)

I am guessing that the application does not have the correct permissions to create the folder and/or files in AWS?

Within the context of the Elastic Beanstalk environment, what is the best method to create a folder and copy javascript files to this folder during runtime? It is fairly easy to restructure the location of the folder and the files within it in the development environment so as to match the ASW EB environment. Reengineering the application to store the contents of these files in an AWS MySQL database engine would take a lot more work.

Bye the way, these 7 files are not tmp files and they are not config files...

Thanks..."
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi,

I am going to assume this is a Node.js ElasticBeanstalk environment.
How do you write/copy those files and where? If you use a node module, like fs for example, you should be able to log what is going on.
Since this is working in your local environment I assume you are mounting the new routes to be accessible by your users.

Going forward you probably need to think about several aspects. If this is a load balanced EB environment then you are generating those files just in one of the instances so when somebody hits the load balancer there is a chance they are not going to hit the same instance always.
Another thing to keep in mind is that instances can be terminated, for a variety of reasons, so if you are trying to maintain any kind of state, you should be doing that outside of the instances themselves.
I am not sure about the scope of your application but copying files for any user that hits your application is not a scalable solution, you may have to think of different strategies.

Best regards
Emanuel"
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi, thank you for your response.  And even though I am an experienced developer this is my first AWS deployment.  Let me address each of your questions in turn:
1. Yes, this is a Node.js Elastic Beanstalk environment.  I will look at the BS logs to confirm that what I think is happening is in fact happening.  I did include the error message that I am seeing through the browser's Developer, JavaScript Console which is basically that the application either can't see the newly created file or that the files are not being created in the first place. 
2. Yes, the folder and files are generated using the node.js file system module.  Each time a user requests a new account 1) a new unique folder (1541877962401 in my example) is created and 2) the 7 javascript files are copied from 7 startup files in the application into the newly created folder.  These 7 files are then updated by users through the application interface as more information is required.  All of these files are located in the root directory in a folder entitled 'data'.
3. Yes I am using a load balanced environment which I set up through the EB Configuration page.  Very good point and agree entirely.  Separation of the business logic, or data, from the application logic is a concept that I am quite familiar with.  This separation is also important when updating the application.  Can you give me some direction as to how this can be done?  It sounds to me like this is at the core of my problem?
4. Yes I agree, given that these files are really data files, they need to be stored outside of the instance itself for all the reasons you have indicated.  
5. Fully understand that you do not have a high-level view of the application, but scalability is not an issue.  Suffice it to say that when one user creates an account there will be a number of other users that utilize that account.

Looks like what this comes down to is how and where do I locate the 'data' files in an AWS BS environment that is independent of the instance?  I am guessing this will be on a separate AWS server?  If you can point me in the right direction that would be very helpful.

Once again thanks for your help.  

Regards..."
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi,

Thank you for the detailed observations, they definitely help building a clearer picture.

1. You need to look at the logs on the server side, as the browser console messages will not tell you much as you can probably have determined by now. I think this should be relatively straightforward.
You can retrieve the server logs from the EB console.
2. My understanding, at this point is, that this is some sort of working directory for the user. What happens with it when the user is done editing? Do you save the state? Do you remove the files? Can the user continue at a later time?
3,4&5. I need a bit more information about how your application handles the state of those files in relation to the user (see the questions above). Based on the information gathered so far, I think it would be a good idea to store this data in AWS S3, a storage service. That would allow you to process those files independent of the EB instances.The changes to your app will be relatively straightforward.
Depending on the answer on question 2, there might be other things you may want to consider.

Best regards
Emanuel"
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Sure thing, yes I am aware of how to access the log files within the EB Console. I will send a copy of the node.log and error.log at the end of this response.
To answer your first question, when the user completes their changes, the results are updated to the files.  The files are maintained, and no there is no programmatic means to remove them.  The user can, and will need to, make additional updates at a later time on an ongoing basis.
I will definitely check out the AWS S3 storage service. It sounds like this will allow me to process these files independent of the EB instances which I think is what is needed.  Changes to the application should be straightforward and limited to changing the path where the files are saved.  All data files are located in this one data folder.

This is helpful.  Gives me somewhere to focus. If you have additional suggestions, as always they will be appreciated.  Many thanks..."
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi, as you suggested, it looks like Amazon S3 is the correct solution.  Amazon recommends that you use the aws-sdk module to access S3 buckets.  I am quite familiar with using modules within node.js.  I even found some code off of the aws development center that imports an aws-sdk module, instantiates a new bucket object, creates the bucket and copies a data object into the bucket.  Looks promising. Thanks again.

P.S. I'm going to mark this question as answered.

Cheers man..."
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi,

Sorry for the delay in response.
I am glad that you were able to move in the right direction with your application. Yes, you should use the AWS SDK to interact with S3 and make sure to assign the appropriate IAM role to your EC2 fleet.
There is one point that is missing though: you mentioned your users are able to save the state of their work and resume at a later point in time. How do you allow that, do you use some sort of database? And how are they logging into your App?

Best regards
Emanuel"
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
Hi, not a problem.  One nice thing about a discussion forum is that you can respond to it when it's convenient to you not the other way around.

I'm looking at both Amazon S3 and DynamoDB as possible data solutions.  As far as I can make out, Amazon S3 is a storage service while DynamoDB is a nosql database service.  One drawback of the nosql solution would be that I would need to rewrite the application data interfaces.  This would take some effort but I think is doable.  Right now the application uses proprietary, i.e. I designed it, data storage based on the JSON file format.

Having said that I like the fact that I can download dynamoDB to my local development computer and in the process have a development environment that mirrors the aws production environment. This is a major plus to me.

Suggestions or comments?

Cheers..."
Ruby Development	"Re: Writing files to AWS Elastic Beanstalk at Runtime
If your storage of user data is JSON-based, DynamoDB feels like a natural fit for your app.
You will need to make some changes but those are rather straightforward and I think it will pay off quickly.

Best regards
Emanuel"
Ruby Development	"Node.js + Amazon Linix + Single Instance + Nginx HTTPS failure
Problem and Errors
I'm trying to configure HTTPS for my Single Instance Elastic Beanstalk Node.js server using LetsEncrypt certificates.  I've set it up according to https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/https-singleinstance-nodejs.html with some slight tweeks.  The HTTP -> HTTPS redirect is working, but I get a '<URL> unexpectedly closed the connection' and ERR_CONNECTION_CLOSED page when visiting the site in Chrome.  When I try to curl in from the Windows Command Prompt, I get 'curl: (35) schannel: failed to receive handshake, SSL/TLS connection failed'.

Nginx Configuration
See contents of .ebextensions/https-instance.config below (minus the indentation...).  The only difference between this and the Amazon recommended config file is that I'm pulling the Cert/Key directly from the /etc/letsencrypt directory rather than having this file generate them for me.  After looking at a bunch of forums, this doesn't seem like it should cause issues.  I've obviously confirmed that that the LetsEncrypt generation was successful and that the files are actually there.  I should also note that my DNS is Namecheap, and I have 3 A records pointing to the instance (root, www, and wildcard).

files:
  /etc/nginx/conf.d/https.conf:
    mode: ""000644""
    owner: root
    group: root
    content: |
      # HTTPS server

      server {
          listen       443;
          server_name  localhost;

          ssl                  on;
          ssl_certificate      /etc/letsencrypt/live/safebetsoftwarellc.net/fullchain.pem;
          ssl_certificate_key  /etc/letsencrypt/live/safebetsoftwarellc.net/privkey.pem;

          ssl_session_timeout  5m;

          ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;
          ssl_prefer_server_ciphers   on;

          # For enhanced health reporting support, uncomment this block:

          #if ($time_iso8601 ~ ""^(\d{4})-(\d{2})-(\d{2})T(\d{2})"") {
          #    set $year $1;
          #    set $month $2;
          #    set $day $3;
          #    set $hour $4;
          #}
          #access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;
          #access_log  /var/log/nginx/access.log  main;

          location / {
              proxy_pass  http://nodejs;
              proxy_set_header   Connection """";
              proxy_http_version 1.1;
              proxy_set_header        Host            $host;
              proxy_set_header        X-Real-IP       $remote_addr;
              proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header        X-Forwarded-Proto https;
          }
      }

Nginx Logs
I'm logging at the debug level, but don't see much relevant information the error or access logs.  I'm also no server admin, so I might be missing something simple  They're attached though, and the relevant portions are at the bottom of the files (connection attempts made on 11/6 around 10:45 Pacific Time).  Thanks for your help!

Edited by: Gkleinereva on Nov 6, 2018 11:47 AM"
Ruby Development	"Re: Node.js + Amazon Linix + Single Instance + Nginx HTTPS failure
I realized that I still had an erroneous entry in iptables redirecting traffic from port 443 to port 8081.  Thus, I don't think the traffic was being routed according to my nginx configuration files.  I terminated and re-created the environment and everything is working correctly.

In case it helps anyone, I checked my iptables configuration in putty with the command below

sudo iptables -t nat -L

And attached is a screenshot the iptables configuration that is now working (which was also the default for a new AWS Linux environment)."
Ruby Development	"AWS Lambda with NodeJS gives me wrong telegram bot behavior.
Hello community

Hi, I am using AWS Lamba as webhook for all messages that comes to bot. However I got an issue. For some reason BOT does not reply on first command. Just no answer. 
I will give an example:

I put command 1. Result: no answer
I put command 2. Result: answer on command 1
I put command 3. Result: answer on command 2
I put command 4. Result: answer on command 3

and so on...
what is going wrong?

Edited by: vetal2060 on Nov 7, 2018 7:30 AM
exports.handler = (event, context) => {
  // Message
  let message;
  if (event.body.channel_post && event.body.channel_post.text) {
    message = event.body.channel_post.text;
  } else if (event.body.message && event.body.message.text) {
    message = event.body.message.text;
  }
  const processCommand = processCommands(message);
 
  // Chat ID
  let chatId;
  if (event.body.message && event.body.message.chat && event.body.message.chat.id) {
    chatId = event.body.message.chat.id;
  } else if (event.body.channel_post && event.body.channel_post.chat && event.body.channel_post.chat.id) {
    chatId = event.body.channel_post.chat.id;
  }
 
  if (chatId) {
    processCommand.then((response) => {
      const processTelegram = sendMessageToTelegram(chatId, response);
      processTelegram.then(() => {
        context.succeed();
      }).catch(() => {
        context.fail();
      });
    }).catch((error) => {
      const processTelegram = sendMessageToTelegram(chatId, error.message);
      processTelegram.then(() => {
        context.succeed();
      }).catch(() => {
        context.fail();
      });
    });
  } else {
    processCommand.then(() => {
      context.succeed();
    }).catch(() => {
      context.fail();
    });
  }
 
  return processCommand;
};"
Ruby Development	"Internal Server Error when get apps pinpoint
Hi,
I have installed the sdk in nodejs. With my accessKeyId and secretAccessKey I can create an application in pinpoint, I can also recover the data of a specific application. But I can not get all the applications (getApps (params = {}, callback) ⇒ AWS.Request).
In the IAM I have put in my user, my role and my group the privacy policy that is in (Link: https://docs.aws.amazon.com/es_es/pinpoint/latest/developerguide/permissions-actions.html).
When I try to access all applications, with the following code:
const params = {
      PageSize: ""5"",
      Token: ""tokentest1""
    };
    pinpoint.getApps(params, function(err, data) {
      if (err) console.log(err, err.stack);
      // an error occurred
      else console.log(data); // successful response
    });


The answer I get is:
name:""InternalServerErrorException""
requestId:""be9d8ffb-e0f0-11e8-891d-e5fc10d60fa0""
retryable:true
stack:""InternalServerErrorException: Internal server error\n    at Object.extractError (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/protocol/json.js:48:27)\n    at Request.extractError (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/protocol/rest_json.js:52:8)\n    at Request.callListeners (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/sequential_executor.js:106:20)\n    at Request.emit (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/sequential_executor.js:78:10)\n    at Request.emit (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/request.js:683:14)\n    at Request.transition (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/request.js:22:10)\n    at AcceptorStateMachine.runTo (/Users/develop/projects/nodejs/notifier-service/node_modules/aws-sdk/lib/state_machine.js:14:12)\n    at /Users/develop/p...
statusCode:500


Can somebody help me? What am I wrong?

Thanks"
Ruby Development	"Running Headless Chrome on Lambda function, Viewport, Click, Screenshot
Hi,
I have a Lambda function that should go to pages and scrape information. I have click events. My function runs perfectly locally but when I run it on Lambda I have error: Node is not HTML element.
I am using Puppeteer.
I was thinking that it may be the viewport that I have set to (width: 1413, height: 749).

Is there any rule of setting the headless chrome viewport on AWS ?

Or maybe other ideas why this migtht happen?

I would really appreciate some help.

Thanks"
Ruby Development	"Regarding Arabic font issue on AWS server having CentOS
Hello,

I am using html-pdf npm for converting html to pdf. Html-pdf internally uses phantomjs which is used to convert html sring into pdf.
The problem I am facing is that arabic fonts are not showing properly in pdf.Kindly help me in installing custom fonts in centOS which can be used by phantomjs as custom fonts. Basically i am using AWS as my server having centOS intalled as operating system.

Please help me in this issue.

Thanks."
Ruby Development	"Re: Regarding Arabic font issue on AWS server having CentOS
Hi gurpreet1137,

Which arabic font are you using and what do you see in the PDF generated?
Also could you also tell us what version of CentOS are you running?

Best regards
Emanuel"
Ruby Development	"Re: Regarding Arabic font issue on AWS server having CentOS
Hey Emanuel,
I am using centOS 6 .Issue i am facing is with font style.I am using majalla font.Initially i tried to give this font in font-family class in my html.But later i found phantomjs is using operating system fonts.So I have majalla.ttf fonts installed in /usr/share/fonts/ directory.May be i am not able to install that fonts properly or something.
So,Kindly help me in installing custom fonts on Centos which can be used by phantomjs.
Here is the link to pdf which i got after conversion:

https://alj-bucket.s3.ap-south-1.amazonaws.com/invoice-5bc86030665ddb0ab380b0ff-d3pDh5Dh4NctwqLbmEj6NCzL4p2l6wEx.pdf 

Also i am attaching screenshot of correct font style which i want."
Ruby Development	"Re: Regarding Arabic font issue on AWS server having CentOS
Hi,

It is true that PhantomJS uses the fonts that are installed on the machine for rendering.
The difference between the screenshot and the PDF example you have provided is hard to tell, not being an Arabic language expert.
Have you tried to install the fonts to /usr/local/share/fonts/ as well?
Could you also tell which PhantomJS version are you using?

Best regards,
Emanuel"
Ruby Development	"Re: Regarding Arabic font issue on AWS server having CentOS
Hi Emanuelaws ,

I am using npm version 0.7.2 of phantom. Yes i also tried to install fonts in /usr/local/share/fonts/.
But it is not working.
I am referring to following link for installing fonts on centOS for installing fonts:
https://medium.com/@stockholmux/besting-phantomjs-font-problems-ee22795f5c0b 

Please correct me if i am installing fonts correctly or please tell me how to install fonts and check that fonts installed correctly.I have both ttf file and pfb file.All i need is how to install them properly.

I think it is operating system problem or i am not able to install fonts properly because when i run my code on my localhost having macOS,it is working perfectly."
Ruby Development	"Re: Regarding Arabic font issue on AWS server having CentOS
Hi,

Please check if you have fontconfig on the system. You can do that just by writing:
 fc-list 

If the output of the command is ""Command not found"" you need to install fontconfig. You can do that by running:  yum install fontconfig 

You can copy now the font you want to usr/share/fonts and you should be able to list them via:
 fc-list"
Ruby Development	"Browser interaction with Cognito & S3
I am trying to implement an app which handles authentication with Cognito and then allows users to upload data to an S3 bucket.

I know how to handle the uploads using the aws-sdk for JavaScript, but it seems to me that now the recommended way to handle in-browser direct interaction with AWS services is with AWS Amplify. 

First question: Is this the case? Is it at allpossible to handle Cognito authentication using the aws-sdk for JavaScript or do I have to use Amplify?

I have managed to handle log-in (including changing password) correctly, using Amplify's Auth class, and now I am trying to handle the S3 upload. For logging in, I only needed to create a User Pool and an App Client. It seems that to be able to use the AWS Amplify ""Storage"" methods I need to use an Identity Pool.

Second question: Do I need to create an Identity Pool to work with Amplify Storage? If so, Why? Is there a work around?

It also seems like ""Storage"" updates files in one of three categories (public, private, etc). 

Third question: Is there a way to prevent this? To upload in a more free-form manner?

Finally, using the aws-sdk, I get events that keep track of upload progress, allowing me to present this information to the users.

Fourth question: Is there any such functionality with AWS Amplify?

Thank you!"
Ruby Development	"AWS Cognito Hosted UI in Angular
Hello All,
We plan to develop a web site in Angular.Js (6.0) and we plan to keep user identities in AWS cognito. We don't plan to use any federated identities like facebook, google and we plan to make use of Cognito Hosted UI for authentication, so that we never get hold of user name and password. How do we integrate the cognito auth in our app?
I can see 2 options:
1) https://github.com/aws/amazon-cognito-auth-js - This library looks promising and by reading it seems, it will allow me to add the authentication functionality using hosted UI

After doing some reading, I have found another option

2) https://aws-amplify.github.io/docs/js/authentication - This one, I am not sure if it will support authentication with hosted UI as the documentation says ""The Hosted UI support is only available for React / Web""

Please suggest what is the right option for the implicit flow. Also, does anyone of them support renew of access token after an hour?"
Ruby Development	"Connecting to AWS IoT using generated presigned url on mqtt returns 403
Good Day,

I have created a lambda function which will generate the presigned url required by the mqtt client to connect to AWS IoT. Source code is below:

const v4 = require('aws-signature-v4');
const crypto = require('crypto');

			let url = v4.createPresignedURL(
				'GET',
				process.env.iot_endpoint_host.toLowerCase(),
				'/mqtt',
				'iotdevicegateway',
				crypto.createHash('sha256').update('', 'utf8').digest('hex'),
				{
					'key': process.env.iot_access_key,
					'secret': process.env.iot_secret_key,
					'protocol': 'wss',
					'region': process.env.iot_region,
				}
			);

			// @Note We are currently removing the generated X-Amz-Security-Token until we can find a better fix
			// @issue https://github.com/aws/aws-sdk-js/issues/1456\
			let hasXSecurityToken = url.indexOf('X-Amz-Security-Token');
			if(hasXSecurityToken  != -1) {
				url = url.substr(0, hasXSecurityToken - 1);
			}
                        return url;

The access token and secret token is from an IAM user which has the AWSIoTFullAccess policy.
The code works on our development site but it is returning a 403 response on our production.

Both environments are also using the same IAM user

Has anyone encountered any similar issues and found a way to fix it?

EDIT: aws-signature-v4 was updated to 1.3.0 which broke the code. Development server was still using 1.2.1. Not sure which part got updated that broke the code. I'll try to check it once I have time.

Edited by: wally-weareeleven on Oct 22, 2018 12:42 AM

Edited by: wally-weareeleven on Oct 22, 2018 2:15 AM"
Ruby Development	"AWS Pinpoint : Active targetable endpoints is Nul
Hello

I integrated AWS Amplify into my project react native. I use facebook Account Kit for connecting users. I'm having problems with aws pinpoint.

    The analytics module works very well
    the push notification module does not work very well:
    the golds of tests to know to send a push notification according to the token FCM, I receive very well the message push notification.
    In the dashboard impossible, you can not create segments or campaigns because ""Active targetable endpoints is 0"". What should I do please? I need your help .

Sincerely

aws-amplify: 1.1.7
aws-amplify-react-native: 2.0.7
@ aws-amplify / pushnotification: 1.0.16

Edited by: foongon on Oct 21, 2018 4:33 PM"
Ruby Development	"STS : ECONNRESET NetworkingError When Assume Role STS
Hello,

I'm Trying to AssumeRole using aws-sdk NodeJS on Lambda to get temporary credentials to access cross account, lambda have permission to assume role and i tried it using aws-sdk for .net core and its working, but for Lambda RunTime Node.js 8.10 i got the following error::

{ Error: read ECONNRESET
at _errnoException (util.js:1022:11)
at TLSWrap.onread (net.js:628:25)
message: 'read ECONNRESET',
code: 'NetworkingError',
errno: 'ECONNRESET',
syscall: 'read',
region: 'us-east-1',
hostname: 'sts.amazonaws.com',
retryable: true,
time: 2018-10-14T16:42:47.474Z } 'Error: read ECONNRESET\n at _errnoException (util.js:1022:11)\n at TLSWrap.onread (net.js:628:25)'


the following code snippet for assuming role:


var AWS = require('aws-sdk');
var sts = new AWS.STS();
 
var self = module.exports = {
AssumeRole: function (RoleArn, callback) {
    return new Promise((resolve, reject) => {
      var params = {
        RoleArn: RoleArn,
        RoleSessionName: ""SubAccount"",
        DurationSeconds: 300
      };
      sts.assumeRole(params, function (err, data) {
        if (err) {
          console.log(err, err.stack);
          reject(new Error('Could not assume role'));
        }// an error occurred
        else {
          console.log(data); // successful response
 
          resolve(data)
        }
 
      })
    });
  }
}


Edited by: MaryAlfred on Oct 17, 2018 3:56 AM

Edited by: MaryAlfred on Oct 17, 2018 3:56 AM"
Ruby Development	"Re: STS : ECONNRESET NetworkingError When Assume Role STS
Just Solve it by execluding aws-sdk from the installed packages and depend on aws-sdk inside lambda it self"
Ruby Development	"Is lodash included in Lambda execution environment
Recently, I forgot to included lodash in my Lamdba code package. After uploaded the package, my Lambda could be executed without error. I also tried with other Lambda functions, and results were the same. So, I would like to confirm whether lodash is officially included in Lambda execution environment.

PS. My Lambda's region is ap-southeast-1."
Ruby Development	"Re: Is lodash included in Lambda execution environment
Yeah it Seems to be included but would be nice to get confirmation from @AWS and see a list of any other modules there."
Ruby Development	"Error deploying Node.J application on AWS Elastic Beanstack
Dear Sir/Madam,

I am trying to install my Node.JS Application on AWS Elastic Beanstack. I get the following error. How do I resolve the same.

Regards, Partha

My application uses JDBC. My machine had Java 0.9.1. However, JDBC would not install. So, I installed Java-1.8 on my machine and set the JAVA_HOME to Java-1.8. On my local machine when I give java -version. I get the following output.

java version ""1.8.0_181""
Java(TM) SE Runtime Environment (build 1.8.0_181-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)


I am not sure whether the error is due to the wrong version of Java being used while deploying on AWS.

		i-058048d806408d5fe	Severe	23 hours	2	--	--	--	--	--	--	--	--	--	--	0.00	0.00	0.2	0.0	99.8	0.0
Application update failed at 2018-10-13T23:53:43Z with exit status 1 and error: Hook /opt/elasticbeanstalk/hooks/appdeploy/pre/50npm.sh failed.
 
+ /opt/elasticbeanstalk/containerfiles/ebnode.py --action npm-install
 
<div class=""jive-quote"">java@0.9.1 install /tmp/deployment/application/node_modules/java
node-gyp rebuild</div>
 
[node-java] Error: not found: javac
gyp: Call to 'node findJavaHome.js' returned exit status 1 while in binding.gyp. while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack at ChildProcess.onCpExit (/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:336:16)
gyp ERR! stack at emitTwo (events.js:126:13)
gyp ERR! stack at ChildProcess.emit (events.js:214:7)
gyp ERR! stack at Process.ChildProcess._handle.onexit (internal/child_process.js:198:12)
gyp ERR! System Linux 4.14.67-66.56.amzn1.x86_64
gyp ERR! command ""/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/node"" ""/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js"" ""rebuild""
gyp ERR! cwd /tmp/deployment/application/node_modules/java
gyp ERR! node -v v8.11.4
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok 
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! java@0.9.1 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the java@0.9.1 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
 
npm ERR! A complete log of this run can be found in:
npm ERR! /tmp/.npm/_logs/2018-10-13T23_53_43_945Z-debug.log
Running npm install: /opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/npm
Setting npm config jobs to 1
npm config jobs set to 1
Running npm with --production flag
Failed to run npm install. Snapshot logs for more details.
UTC 2018/10/13 23:53:43 cannot find application npm debug log at /tmp/deployment/application/npm-debug.log 
 
Traceback (most recent call last):
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 695, in <module>
main()
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 677, in main
node_version_manager.run_npm_install(options.app_path)
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 136, in run_npm_install
self.npm_install(bin_path, self.config_manager.get_container_config('app_staging_dir'))
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 180, in npm_install
raise e
subprocess.CalledProcessError: Command '['/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/npm', '--production', 'install']' returned non-zero exit status 1.
Incorrect application version ""pConfMan-20181014"" (deployment 2). Expected version ""pconfman-source-v131018"" (deployment 1)."
Ruby Development	"Nodejs mysql query returning undefined
Hello Friends,

I am trying to write a nodejs lambda function, which connects to RDS, executes query and return the value

The code is fetching value from DB and confirmed it with console.log output
When I am trying to pass the resultset value to lex fulfilment, I always get The status of your order is undefined.

Can someone please let me know how to pass the right value. The orderstatus value(highlighted in code) always return undefined

below is my code:

var mysql = require('mysql');
var config = require('./config.json');
var pool = mysql.createPool({
host : config.dbhost,
user : config.dbuser,
password : config.dbpass,
database : config.dbname
});

function Opencartcall(orderid,callback){
const idvalue=orderid;
var orderstatus;
pool.getConnection(function(err, connection) {
// Use the connection
console.log('Opencartcall entry---------'+idvalue);
connection.query(""select b.name from oc_order_history a, oc_order_status b where a.order_status_id=b.order_status_id and a.order_id=""+mysql.escape(idvalue), function (error, results, fields) {
// And done with the connection.
connection.release();
// Handle error after the release.
if (error) throw error;
else callback(null,results[0].name);
orderstatus=results[0].name;
+console.log('orderstatus value issssss---------'+orderstatus);+ // value comes correctly here

process.exit();
});
});
return orderstatus; // returning as undefined
}
function close(sessionAttributes, fulfillmentState, message) {
return {
sessionAttributes,
dialogAction: {
type: 'Close',
fulfillmentState,
message,
},
};
}

function dispatch(intentRequest, callback) {
console.log(`request received for userId=${intentRequest.userId}, intentName=${intentRequest.currentIntent.name}`);
const sessionAttributes = intentRequest.sessionAttributes;
const slots = intentRequest.currentIntent.slots;
const crust = slots.crust;
//const orderstat=Opencartcall(crust,function(err,data));
const orderstat=Opencartcall(crust, function(err,data){
if (err) {
// error handling code goes here
console.log(""ERROR : "",err); 
} else { 
// code to execute on data retrieval
console.log(""result from db is : "",data); 
} 

});
callback(close(sessionAttributes, 'Fulfilled',
{'contentType': 'PlainText', 'content': `The status of your order is ${orderstat}`})); 

}

// Main handler
// Route the incoming request based on intent.
// The JSON body of the request is provided in the event slot.
exports.handler = (event, context, callback) => {
context.callbackWaitsForEmptyEventLoop = false;
try {
dispatch(event,
(response) => {
callback(null, response);
});
} catch (err) {
callback(err);
}
}"
Ruby Development	"Active targetable endpoints is empty every time.
I did everything as described in the documentation for Pinpoint aws amplify. 

registered remote notifications, configured with the instructions PinpointAnaytics & PinpointTargeting, but I still do not see active endpoints. I can not create a company; there are no edpoints.
It seems that Pinpoint does not work now at all?

i use react native framework amplify"
Ruby Development	"User/device not recognized in AWS Pinpoint console during PushNotification.
Which Category is your question related to? **



React Native



What AWS Services are you utilizing? **



'@aws-amplify/pushnotification'



Provide additional details e.g. code snippets **




extracted from my source code (below) in the app.js file. but in the console aws pinpoint the endpoint is not register to receive push notifications? .

import Amplify, { Analytics } from 'aws-amplify';
import aws_exports from './aws-exports';
import PushNotification from '@aws-amplify/pushnotification';

// gets the registration token
PushNotification.onRegister((token) => {
    console.log('in app registration', token);   
});

NB: aws-amplify analytics works perfectly
Nb: I use facebook account kit for login and authentication
Nb : i use Android

link dashboard aws pinpoint: https://ibb.co/d2hi9K

Thank You for you reply"
Ruby Development	"no response outputtext after promise.
I must be missing something basic.  I have been working on this for a week.  Argh.  How does one create an alexa response after / in a promise.  The following code for example the ""then"" console log shows ""foo"", but the response does nothing.  no error just, the output json doesn't have an outputtext -> not blank output text, outputtext is not in the json.
skill.intent('bogus',{},function(request, response) {
		new Promise(function(resolve, reject) {
		  setTimeout(resolve, 100, 'foo');
		}).then( function(values) {
			console.log(values);
			response.send(values);
		})
		.catch(err =>{
			console.log(err);
		});		
});


The code above uses allexa-app.sdk, but I have also tried ask.sdk, and alexa.sdk.  syntax is different but the results are the same.  Also have used node 8.10 as well as node 4.3.2"
Ruby Development	"Re: no response outputtext after promise.
Another more specific example is below.  This time with ask-sdk-core.  

const myIntentHandler = {
  canHandle(handlerInput) {
    return handlerInput.requestEnvelope.request.type === 'IntentRequest'
      && handlerInput.requestEnvelope.request.intent.name === 'myIntent';
  },
  handle(handlerInput) {
 
  		  var params = {
			};
    var say = 'Abadeet';
		   var dynamodb = new AWS.DynamoDB();
		  var params = {
			};
			var promise1 = new Promise (function (resolv, reject) {
				 dynamodb.listTables(params, function(err, data) {
				   if (err) {
				   console.log(err, err.stack); // an error occurred
				   }
				   else  {
					for(var i = 0; i < data.TableNames.length; i++){
						say = say + "" "" + data.TableNames[i]; 
						}				
				 }	
		});
    }).then(function (){
		return handlerInput.responseBuilder
		  .speak(say)
		  .withSimpleCard('meTexta', say)
		  .getResponse();
	  });
  },
};


Results returned by lambda-local 
info: {
     ""version"" : ""1.0"",
     ""userAgent"": ""ask-node/2.0.7 Node/v4.3.2"",
     ""sessionAttributes"": {}
}


How do I get alexa out put text from the list tables query?"
Ruby Development	"Re: no response outputtext after promise.
Okay, so by some carefully placed console.logs I was able to determine that the response was sent before the promise was finished.  Therefor the response.say didn't work.  So the question is in an async world how do you wait for all the functions to end.  Me thinks from most examples I have seen somehow it does, but in my case not.  I did find something that works,,,, stuff a return on the promise so mr. Process hangs around greedily awaiting some return goodies.  Is there a better way or alternative?

skill.intent('listTable',{},function (request, response) {
 	if(USEDB) {
	return dynamodb.listTables().promise()
	.then(data => {
		console.log(data);
		var say = ""I found the following tables: "";
		for(var i = 0; i < data.TableNames.length; i++){
			if( i == data.TableNames.length -1) {
				say = say + "", and "" + data.TableNames[i]; 
				}
			else { 
				say = say + "", "" + data.TableNames[i];
				}
			}		
		response.say(say).reprompt(reprompt).shouldEndSession(false);		
		});
		}
	else {
		response.say(""Budget table found"");
		response.reprompt(""What are you saying?"").shouldEndSession(false);
	}
});"
Ruby Development	"Error: Signature Does Not Match
I'm getting a Signature Does Not Match error when I tried to pull some items from my bucket. I'm not using the SDK because I can't for my application, and I am trying to do all of this in Javascript. Bucket and Access Key are removed for obvious reasons Here is my code:

var request = new XMLHttpRequest();
	var signingKey = getSigningKey(dateStamp, secretKey, regionName, serviceName);
	var time = new Date();
 
	time = time.toISOString();
	time = time.replace(/:/g, '').replace(/-/g,'');
	time = time.substring(0,time.indexOf('.'))+""Z"";
	console.log(time);
 
	var canonString = ""GET\n""+
						encodeURI(""/"")+""\n""+
						encodeURI(""delimiter"")+'='+encodeURI(""/"")+'&'+
						encodeURI(""max-keys"")+'='+encodeURI(""100"")+'&'+
						encodeURI(""prefix"")+'='+encodeURI(""08"")+'\n'
						""host:""+bucketName+"".s3.amazonaws.com\n""+
						'x-amz-content-sha256:UNSIGNED-PAYLOAD\n'+
						'x-amz-date:'+time+'\n'+
						""UNSIGNED-PAYLOAD"";
 
	var stringToSign = ""AWS4-HMAC-SHA256\n""+
						time+""\n""+
						""20181002/us-east-1/s3/aws4_request\n""+
						CryptoJS.SHA256(canonString).toString();
 
	var authString = CryptoJS.HmacSHA256(signingKey, stringToSign).toString();
 
	request.open(""GET"", ""https://""+bucketName+"".s3.amazonaws.com/?delimiter=%2F&max-keys=100&prefix=08"", false);
	request.setRequestHeader(""Authorization"", ""AWS4-HMAC-SHA256 Credential=""+accessKey+""/20181002/us-east-1/s3/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=""+authString);
	request.setRequestHeader(""host"", bucketName+"".s3.amazonaws.com"");
	request.setRequestHeader(""x-amz-content-sha256"", ""UNSIGNED-PAYLOAD"");
	request.setRequestHeader(""x-amz-date"", time);
	console.log(request);
	request.send();


Here is the error I get from my request:
<?xml version=""1.0"" encoding=""UTF-8""?>↵<Error><Code>SignatureDoesNotMatch</Code><Message>The request signature we calculated does not match the signature you provided. Check your key and signing method.</Message><AWSAccessKeyId>{Access Key Hidden}</AWSAccessKeyId><StringToSign>AWS4-HMAC-SHA256↵20181002T195053Z↵20181002/us-east-1/s3/aws4_request↵52b0da09ba63dcaf0988ab525e070206df7eb29842e4da5c5f86ad700095a65f</StringToSign><SignatureProvided>45999eeece30bcc40b50f51ff163fb90e24613ced1ad17a565ee21f01c4d738c</SignatureProvided><StringToSignBytes>41 57 53 34 2d 48 4d 41 43 2d 53 48 41 32 35 36 0a 32 30 31 38 31 30 30 32 54 31 39 35 30 35 33 5a 0a 32 30 31 38 31 30 30 32 2f 75 73 2d 65 61 73 74 2d 31 2f 73 33 2f 61 77 73 34 5f 72 65 71 75 65 73 74 0a 35 32 62 30 64 61 30 39 62 61 36 33 64 63 61 66 30 39 38 38 61 62 35 32 35 65 30 37 30 32 30 36 64 66 37 65 62 32 39 38 34 32 65 34 64 61 35 63 35 66 38 36 61 64 37 30 30 30 39 35 61 36 35 66</StringToSignBytes><CanonicalRequest>GET↵/↵delimiter=%2F&amp;max-keys=100&amp;prefix=08↵host:{bucketName}.s3.amazonaws.com↵x-amz-content-sha256:UNSIGNED-PAYLOAD↵x-amz-date:20181002T195053Z↵↵host;x-amz-content-sha256;x-amz-date↵UNSIGNED-PAYLOAD</CanonicalRequest><CanonicalRequestBytes>47 45 54 0a 2f 0a 64 65 6c 69 6d 69 74 65 72 3d 25 32 46 26 6d 61 78 2d 6b 65 79 73 3d 31 30 30 26 70 72 65 66 69 78 3d 30 38 0a 68 6f 73 74 3a 64 65 6d 6f 61 70 70 2d 62 75 63 6b 65 74 2e 73 33 2e 61 6d 61 7a 6f 6e 61 77 73 2e 63 6f 6d 0a 78 2d 61 6d 7a 2d 63 6f 6e 74 65 6e 74 2d 73 68 61 32 35 36 3a 55 4e 53 49 47 4e 45 44 2d 50 41 59 4c 4f 41 44 0a 78 2d 61 6d 7a 2d 64 61 74 65 3a 32 30 31 38 31 30 30 32 54 31 39 35 30 35 33 5a 0a 0a 68 6f 73 74 3b 78 2d 61 6d 7a 2d 63 6f 6e 74 65 6e 74 2d 73 68 61 32 35 36 3b 78 2d 61 6d 7a 2d 64 61 74 65 0a 55 4e 53 49 47 4e 45 44 2d 50 41 59 4c 4f 41 44</CanonicalRequestBytes><RequestId>663D12468C5DEF82</RequestId><HostId>7Cfx27ngtMmwXlFAIb1tyY6ZAKpRpACQOpUoGMo0aul/A1R8rFlvFqg+05EH0kDvWzy/RgUFm0U=</HostId></Error>


Edited by: td76099 on Oct 2, 2018 12:56 PM
made this more specific"
Ruby Development	"Unknown error, the response body from fetch is undefined-Auth.confirmSignIn
Describe the bug
I am trying to send the verification code received by the user to confirm the signIn, I have the SMS_MFA enabled. However, I keep getting this error Unknown error, the response body from fetch is: undefined and thats all I get, there is nothing else to help me understand what the error is about. And everything else is working fine, I call signIn, signUp, confirmSignUp and resendSignUp, they all work fine. The problem is only with confirmSignIn and I have no idea what it could be, I already researched online, but had no success. Another strange thing that happens, when I enter the wrong code, it shows me the 'CodeMismatchException', but it fails with 'Unknown error' when code is the right one. PS: I already have cognito configured to work with SMS MFA

To Reproduce
Steps to reproduce the behavior:
I just installed aws-amplify and started using Auth according to the docs, everything else works fine, it's just when I call confirmSignIn

Expected behavior
Receive a successful response when the correct code is sent for verification.

Smartphone (please complete the following information):
The problem happens in android and iOS

Additional context
I'm using:
react-native version 0.55.4
aws-amplify version ^1.0.11

Code
I have a file where a call all the Auth functions and export them

export const confirmSignIn = (cognitoUser, code) => Auth.confirmSignIn(cognitoUser, code, 'SMS_MFA');

Then I call that confirmSignIn function from a different file

confirmSignIn(cognitoUser, code).then((userSession) => {
         console.log(userSession);
      }).catch((error) => {
         switch (error.name) {
           case 'CodeMismatchException':
            this.codeInput.clear();
            break;
           default:
            console.log(error);
            break;
        }
      });

Edited by: dolivas on Oct 1, 2018 9:26 AM

Edited by: dolivas on Oct 1, 2018 9:26 AM"
Ruby Development	"AWS Lambda function for upload/putObject image works only on local machine
I have a lambda function which uses 'request' to get a stream of a file by URL and suppose to upload it to a bucket on s3. It is working perfectly on my local machine using node but not inside the lambda. After running the lambda, I have an empty file with the name I wanted.

Stuff you should know

The lambda function is async
The node version is 8.10
In the example you see putObject, but I have also tried with upload
Even when adding a manual sleep of 90-120 seconds to let the lambda run, the file is not uploaded
I tried using context.succeed or callback('some result'), but it still did not work properly


This is the relevant part of the code
module.exports.handler = async(event, context, callback) => {
  const path = 'bucketToUpload';
  const name = 'imageFileName.jpg';
  let options = {
    uri: responseUrl, // This is the url of the image
    encoding: null
  };
  let reqRes = await request(options); // Here I have the stream
  let awsPutRes = await s3.client.putObject({
    Body: reqRes.body,
    Key: name,
    Bucket: path
  }).promise();
};

Would really appreciate any help or directions for this issue.

Edited by: chenos on Sep 30, 2018 7:32 AM"
Ruby Development	"How to use an API Gateway JavaScript client SDK with WebPack?
Greetings!

I'm writing a serverless webapp with React + API Gateway + Lambda and it's great!
Currently the API is public and access is not controlled, and I can use very simple AJAX to interact with the API.
Now I'd like to control access to a large part of the API using IAM policies.
From what I understand, I have (at least) these options on the client side to gain access to the protected part of the API

1. Write my own code to sign the requests with Signature Version 4, per  these instructions 
2. Use API Gateway to generate a JavaScript client SDK, include the downloaded SDK .js files, and instantiate the client with credentials, and get the SigV4 signing for free. See  this reference 

My problem is that I'm using WebPack to manage the dependencies in the project. The javascript package that API Gateway generates does not play well with WebPack because of a lack of exports and requires in the included .js files. This is my first three weeks doing JavaScript development, so I'm very much in the deep end with the tooling involved. I've scoured StackOverflow and the rest of the web and haven't found a solution. 

It seems that a similar issue was recently, like in the last month-ish, resolved by AWS with the Cognito JS SDK. See their  blog post.

I've killed several days playing dependency whack-a-mole with export-loaders and import-loaders in WebPack, but there's no end in sight.

Has anyone solved this?

Is there an obvious workaround that I'm missing?

Thanks everyone!"
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
Was this ever resolved.  I'm having the same issue."
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
I am also running into the same issue.."
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
Same question here"
Ruby Development	"Get last n minutes data from dynamodb streams with node SDK.
How can we get last n minutes data from the dynamo streams given that the stream has around 26 shards and getRecords() is returning empty records when ShardIteratorType is set to LATEST."
Ruby Development	"Create a NodeJS container in CodeBuild
Hi,
I am trying to create my NodeJS server as a container (using the aws/codebuild/nodejs.8.11.0) using Codebuild.
Similar to this example:  https://docs.aws.amazon.com/codebuild/latest/userguide/sample-docker.html 
except that it uses go and I use NodeJS.
I have my code in AWSCodeCommit.
I have setup Codebuild and ECR repo (currently empty) and configured as per the whole steps described.
I have also given access to Codebuild service from ECR using:
Effect: Allow,
Principal: Service: codebuild.amazon.com,
Action: ecr:GetDownloadUrlForLayer,...

The first line of my Dockerfile is:
FROM nodejs:8.11.0


The build fails at this line saying:
Step 1/9 : FROM nodejs:8.11.0
pull access denied for nodejs, repository does not exist or may require 'docker login'


Any idea why this would happen?
Should I explicitly add the AWS nodejs container to my ECR? If so, how?
I tried searching everywhere for this but can't figure out.

Edited by: Jogeshwar on Sep 26, 2018 3:27 PM"
Ruby Development	"Signing an API Call to S3 using Security Credentials from Instance Metadata
Hello, 

I am running a Java/Tomcat app on an EC2 instance and need to make GET and PUT calls to S3. I have an IAM role correctly giving permissions to the EC2 to communicate with S3 and I can run CLI commands which work fine. 

My problem is I need to make these calls within the Java app and cannot use the AWS SDK. The Java app allows me to run JavaScript services which is what I am using to make the calls. I created a service that successfully calculates the AWS Signature Version 4, essentially creating presigned url that the SDK will give you in 1 line of code. 

The code works with an actual IAM User (with the exact same permissions as the EC2 IAM Role). But I am trying to use the role instead of the user since our security org will not allow me to use a user in production plus I would have to chage the id and key every 90 days...blah, blah, blah. 

I know I can make calls to http://169.254.169.254/latest/meta-data/iam/security-credentials/ and get the name of my IAM Role, add that to the url and call it again to get an ID, Key, and Token. referenced here: http://169.254.169.254/latest/meta-data/iam/security-credentials/. 

When I use the credentials from the instance metadata, sending the ID and Key from the metadata rather than the IAM User, I receive the error ""InvalidAccessKeyId, The AWS Access Key Id you provided does not exist in our records."" Through some searching, I found I probably needed to send the Token as a header as well. I URI encode the token returned from the instance metadata, add the header to my whole signing calculations. Sending the ID, Key, and Token, I receive the error ""InvalidToken, The provided token is malformed or otherwise invalid."" So I've tried no encoding the token, but that gives me a signature mismatch error. 

I am stuck. I know the IAM role has the correct permissions to talk to S3. I know the code calculates the signature correctly using an IAM User ID and Key. But I receive errors as soon as I start using the instance metadata. 

Has anyone calculated their own AWS signature v4 using the instance metadata? What am I missing?

Thanks,
Chris"
Ruby Development	"Not able to invoke simple lamba function
Hi,

I am using nodejs v8.10 and trying to invoke lambda function. 

Points to note: 
- They are not in VPC
-  Following roles are attached: AWSLambdaExecute, AWSLambdaRole, AWSLambdaBasicExecutionRole.
- Both functions are in same region.

Code:

const AWS = require('aws-sdk');

const lambda = new AWS.Lambda({
    region: my-region,
    accessKeyId: my-access-key,
    secretAccessKey: my-secret-key
});

const params = {
        InvocationType: ""RequestResponse"",
        FunctionName: ""sample"",
        Payload: JSON.stringify({name: 'sample req'})
    }

  lambda.invoke(params).promise().then(res => {
        console.log(""......>>>>"", res)
    })

lambda does not print the above log.

I am not able to figure out the issue. Can someone help me out!"
Ruby Development	"Re: Not able to invoke simple lamba function
There are 2 types of errors which could occur here when invoking a Lambda with RequestResponse, both of which you need to catch differently: connectivity errors (e.g. network issue connecting to the Lambda API) and functional errors (e.g. bad request).
I don't think your log statement would catch connectivity issues as you don't catch a failed promise.

Try something like the following to debug further:

return lambda.invoke(params).promise().then(res => {
   if (res.FunctionError) {
       // Functional error (e.g. bad request)
        console.log(`FunctionError returned. Error details: ${res.Payload}`);
        return;
    }
    // Success
    console.log('Success': res.Payload);
}).catch(err => {
   // Connectivity issue
   console.log(""Error invoking Lambda: "", err);
});"
Ruby Development	"Re: Not able to invoke simple lamba function
Thanks for the reply Paul!

Well, My code snippet was working. I replaced console.log with context.done(null, res). And the response was being displayed.

Also, InvocationType was set to RequestResponse.

Edited by: ankit9 on Sep 26, 2018 2:21 AM"
Ruby Development	"Problems with invoking lambda and returning async api call
Hi all.

I have this function that I use to get an access token from another lambda function. I then query google api to get some photo data. I then want to return this photo data from the function. The problem is that I can't seem to actually return any data from my function as written, or any other way with promises/async/await. 

I get this log error: 
{
  ""errorMessage"": ""Converting circular structure to JSON"",
  ""errorType"": ""TypeError"",
  ""stackTrace"": []
}


Here is my function:

const request = require('request-promise');
const aws = require('aws-sdk');
const lambda = new aws.Lambda({
  region: 'us-east-1'
});   
 
const params = {
    FunctionName: ""getTokenThingy"", 
    InvocationType: ""RequestResponse"", 
    LogType: ""Tail""
};
 
exports.handler = async (event, context) => {
    console.log(""Starting invoke of function"");
    console.log(""Invoking access function"");
    // Get access token
    return await lambda.invoke(params, async (err, data) => {
        if (err) {
            console.log(error);
            return ""test"";
        }
        else {
            console.log(""Retrieved data from payload""); 
            let payloadReponse = JSON.parse(data.Payload);
            const accessToken = payloadReponse.body.accessToken;
 
            console.log(""Access token "" + accessToken);
            
            let photoResult = await libraryApiGetPhotos(accessToken);
            console.log(""Got photo results: "" + photoResult.length);
            return ""test"";
            
        }   
    });
}
 
async function libraryApiGetPhotos(accessToken) {
    let photos = [];
    let error = null;
    const bodyParams = { 
        ""filters"": {
            ""mediaTypeFilter"" : { 
                ""mediaTypes"": [ ""PHOTO""]
            }
        }
    };
    let options = { 
        method: 'POST',
        uri: process.env.googlePhotosAPIEndpoint + process.env.mediaListSearchAffix,
        body: bodyParams,
        json: true,
        auth: { 'bearer' : accessToken }
    }
 
    return request(options)
        .then( (parsedBody) => {
            console.log(""Getting media items"");
            photos = photos.concat(parsedBody.mediaItems);
            console.log(""Count of photos: "" + photos.length);
            return photos;
        }).catch( (err) => {
            error = err.error.error ||
                {name: err.name, code: err.statusCode, message: err.message};
            console.log(error);
        });
}


All the logs occur in the correct order but there is no response at the end and just that error. I have tried varied different ways of converting to promises instead of await/async with no luck. Would love some suggestions.

Thanks"
Ruby Development	"How to get new token from Cognito from the frontend?
I have a react app and I am using Cognito to handle user's authentication. I need to know how do I make a call to Cognito with the refresh token so that it gives me back a new token?

I looked into all of the examples from Cognito and they didn't work. They are using dependencies that I don't have and they don't clearly list how to get them.

Can someone please help?"
Ruby Development	"How to get Cognito User Id with acces Token or Cognito user sub from IAM
Hi,

I am using NodeJS 8.1 for a lambda function called by Alexa.
I am also using the Swift SDK.
I am using Cognito Identity to identify users though the iOS app and the account is linked with the Alexa skill.

The problem is that we use the cognito user-sub to store data under an S3 bucket. 

We want to limit acces to cognito user with the key {cognito-identity.amazonaws.com:sub} which, in fact is the user ID and not the sub. 

Actually, from the alexa lambda function I am using the GET /oauth2/userInfo service, which only returns the user-sub and which is the only API I found I can use with the accesToken delivered by the account linking.

Is there a way to get the user ID from the alexa Lambda function or to get the user sub to restrict the policy under the IAM console ?"
Ruby Development	"How to expose webservice available inside corporate VPN to AWS Lambda?
Hi,

We have an enterprise application (hosted on premise) which provides access to its APIs thru RESTful webservices. These webservices are now accessible only from with in our corporate network. We are planning to invoke those webservices from AWS Lambda. In the case of accessing them from EC2, we can create a VPN connection with in VPC and expose those Web services. Please share thoughts on how can we enable access to those Webservices from AWS Lambda where we dont have VPC and VPN connections used.

Thanks
Rathnam"
Ruby Development	"Re: How to expose webservice available inside corporate VPN to AWS Lambda?
Hi Experts,

Please let me know if you know any option.

Thanks
Rathnam"
Ruby Development	"Re: How to expose webservice available inside corporate VPN to AWS Lambda?
Hi Experts,

Another reminder.
How to expose a on-premise RESTful webservice to AWS Lambda with out making the webservice accessible to everyone/public?

Thanks
Rathnam"
Ruby Development	"Using SSL Cert created from Light Sail Load Balancer on my expressjs app
Hi all,

I have a node app (using expressjs) deployed on Light Sail. Following https://lightsail.aws.amazon.com/ls/docs/en/articles/attach-validated-certificate-to-load-balancer instructions I was able to create a valid cert and attach it to my load balancer.

My question is how do I use the cert for https? Is there something I need to do on my node app? Or any other configuration I need to do? I'm unable to use my website over https

Thanks"
Ruby Development	"Javascript library + federated entity
Hello,
I am developing web application using cognito, s3....
Every client has its own user pool and bucket (B2B).
I am trying to use javascript s3 aws library and I would like to know, what is best practice in using it.
Do I have to create federated entity for every user pool or put every client in one ( thousands of clients )? Or can I use the library without using the federated entity and use clientId or ec2 instance role?
Thanks for your opinions."
Ruby Development	"How to host/start a ionic app on elasticBeanstalk ?
Hi there,
As soon as a add my start script  ""ionic-app-scripts serve --no-open"" in my package.json,
my server does not respond and i can't get logs.
If i try to get logs, my app reload/restart each time.

""scripts"": {
    ""preinstall"": ""npm install -g ionic cordova"",
    ""start"": ""ionic-app-scripts serve --no-open""
  },

Can anyone tell me what's the correct way to do that ?

I also tried awsmobile that returned me errors, impossible to let it work."
Ruby Development	"API Gateway - Enabling Cloudwatch logs and metrics
Using the AWS web console this is just a matter of navigating to the API's stage in question and ticking the boxes under CloudWatch Settings. However I am using the node aws-sdk to build my API and I see no way to do this programatically. There is nothing under createStage, createMethod or anywhere else I have looked. Can I enable CloudWatch for my API using the aws-sdk?"
Ruby Development	"Re: API Gateway - Enabling Cloudwatch logs and metrics
+1, as far as I can tell, the CloudWatch settings can only be controlled through the web console/dashboard (feels soooo weird...)"
Ruby Development	"Re: API Gateway - Enabling Cloudwatch logs and metrics
Look like this is an old question (but unresolved), for what it is worth,
I use the update_stage method to set it up like so:
resp = client.update_stage({
                               rest_api_id: ""string"", # required
                               stage_name: ""string"", # required
                               patch_operations: [
                                   {
                                       op: ""replace"",
                                       path: ""/*/*/logging/logLevel"",
                                       value: 'info'
                                   }
                               ]
                           })"
Ruby Development	"Socket.IO-Redis-Adapter With Elasticache Redis Fails WSS Upgrade Header
We have a websockets server and I'm currently working on migrating our services to Elastic Beanstalk. The servers were previously located on Heroku and were using a separate redis instance (also provided by Heroku) for maintaining websockets connections between multiple server instances.

I have created an elasticache redis instances on AWS which is able to connect successfully, however the websockets upgrade http request always returns a 400.

What's puzzling is that when I connect to the Heroku-generated redis, the request passes and a websockets connection is successfully established.

I've gone through security groups to enable all connections from everywhere on all ports and made sure ssl was properly configured to isolate the problem, but it still doesn't establish a successful connection.

I'm not sure if this is a limitation of elasticache now, so I'm hoping someone with more experience on AWS could shed some light on this."
Ruby Development	"Lambda Nodejs
Hello, I had a recent problem with a nodejs lambda function and I can't seam to understand how aws is keeping the node env 
If i run the lambda function first time I will get the expected output
""A""
then if I run it multiple times, thins are starting to become strange:
""A"",""A"".......

So it seams that the log is not cleaned, the way to clean it is to ""save"" the file again.

Anybody can explin this to me? O point me to some documentation ?

Lets say that i had 2 files 
index.js
module.exports.handler  = (event, context, callback) => {
require('./log').add(""A"").show();
}
log.js 
module.exports = {
   list : [],
   add : function (v) {
     this.list.push(v);
     return this;
   },
   show : function() {
   console.log(this.list);
    return this;
   } 
}

Edited by: alin1918 on Oct 19, 2018 3:17 AM

Edited by: alin1918 on Oct 19, 2018 3:19 AM"
Ruby Development	"Re: Lambda Nodejs
Hello
When your lambda function gets called the first time, it is a cold start. Meaning AWS needs to allocate where will it run and separate the memory and all the background process needed to run it. Once you run it, AWS keeps your function online for a while before releasing the memory and everything else.
So in the case of your function, calling it multiple consecutive times just adds to the list Array and that's why you see the result as 

here is the actual documentation
https://docs.aws.amazon.com/lambda/latest/dg/running-lambda-code.html
here is an article on that
https://read.acloud.guru/how-long-does-aws-lambda-keep-your-idle-functions-around-before-a-cold-start-bf715d3b810
hope this helps,"
Ruby Development	"Running Headless Chrome on Lambda function, Viewport, Click, Screenshot
Hi,
I have a Lambda function that should go to pages and scrape information. I have click events. My function runs perfectly locally but when I run it on Lambda I have error: Node is not HTML element.
I am using Puppeteer.
I was thinking that it may be the viewport that I have set to (width: 1413, height: 749).

Is there any rule of setting the headless chrome viewport on AWS ?

Or maybe other ideas why this migtht happen?

I would really appreciate some help.

Thanks"
Ruby Development	"Connecting to AWS IoT using generated presigned url on mqtt returns 403
Good Day,

I have created a lambda function which will generate the presigned url required by the mqtt client to connect to AWS IoT. Source code is below:

const v4 = require('aws-signature-v4');
const crypto = require('crypto');

			let url = v4.createPresignedURL(
				'GET',
				process.env.iot_endpoint_host.toLowerCase(),
				'/mqtt',
				'iotdevicegateway',
				crypto.createHash('sha256').update('', 'utf8').digest('hex'),
				{
					'key': process.env.iot_access_key,
					'secret': process.env.iot_secret_key,
					'protocol': 'wss',
					'region': process.env.iot_region,
				}
			);

			// @Note We are currently removing the generated X-Amz-Security-Token until we can find a better fix
			// @issue https://github.com/aws/aws-sdk-js/issues/1456\
			let hasXSecurityToken = url.indexOf('X-Amz-Security-Token');
			if(hasXSecurityToken  != -1) {
				url = url.substr(0, hasXSecurityToken - 1);
			}
                        return url;

The access token and secret token is from an IAM user which has the AWSIoTFullAccess policy.
The code works on our development site but it is returning a 403 response on our production.

Both environments are also using the same IAM user

Has anyone encountered any similar issues and found a way to fix it?

EDIT: aws-signature-v4 was updated to 1.3.0 which broke the code. Development server was still using 1.2.1. Not sure which part got updated that broke the code. I'll try to check it once I have time.

Edited by: wally-weareeleven on Oct 22, 2018 12:42 AM

Edited by: wally-weareeleven on Oct 22, 2018 2:15 AM"
Ruby Development	"STS : ECONNRESET NetworkingError When Assume Role STS
Hello,

I'm Trying to AssumeRole using aws-sdk NodeJS on Lambda to get temporary credentials to access cross account, lambda have permission to assume role and i tried it using aws-sdk for .net core and its working, but for Lambda RunTime Node.js 8.10 i got the following error::

{ Error: read ECONNRESET
at _errnoException (util.js:1022:11)
at TLSWrap.onread (net.js:628:25)
message: 'read ECONNRESET',
code: 'NetworkingError',
errno: 'ECONNRESET',
syscall: 'read',
region: 'us-east-1',
hostname: 'sts.amazonaws.com',
retryable: true,
time: 2018-10-14T16:42:47.474Z } 'Error: read ECONNRESET\n at _errnoException (util.js:1022:11)\n at TLSWrap.onread (net.js:628:25)'


the following code snippet for assuming role:


var AWS = require('aws-sdk');
var sts = new AWS.STS();
 
var self = module.exports = {
AssumeRole: function (RoleArn, callback) {
    return new Promise((resolve, reject) => {
      var params = {
        RoleArn: RoleArn,
        RoleSessionName: ""SubAccount"",
        DurationSeconds: 300
      };
      sts.assumeRole(params, function (err, data) {
        if (err) {
          console.log(err, err.stack);
          reject(new Error('Could not assume role'));
        }// an error occurred
        else {
          console.log(data); // successful response
 
          resolve(data)
        }
 
      })
    });
  }
}


Edited by: MaryAlfred on Oct 17, 2018 3:56 AM

Edited by: MaryAlfred on Oct 17, 2018 3:56 AM"
Ruby Development	"Re: STS : ECONNRESET NetworkingError When Assume Role STS
Just Solve it by execluding aws-sdk from the installed packages and depend on aws-sdk inside lambda it self"
Ruby Development	"Is lodash included in Lambda execution environment
Recently, I forgot to included lodash in my Lamdba code package. After uploaded the package, my Lambda could be executed without error. I also tried with other Lambda functions, and results were the same. So, I would like to confirm whether lodash is officially included in Lambda execution environment.

PS. My Lambda's region is ap-southeast-1."
Ruby Development	"Re: Is lodash included in Lambda execution environment
Yeah it Seems to be included but would be nice to get confirmation from @AWS and see a list of any other modules there."
Ruby Development	"Error deploying Node.J application on AWS Elastic Beanstack
Dear Sir/Madam,

I am trying to install my Node.JS Application on AWS Elastic Beanstack. I get the following error. How do I resolve the same.

Regards, Partha

My application uses JDBC. My machine had Java 0.9.1. However, JDBC would not install. So, I installed Java-1.8 on my machine and set the JAVA_HOME to Java-1.8. On my local machine when I give java -version. I get the following output.

java version ""1.8.0_181""
Java(TM) SE Runtime Environment (build 1.8.0_181-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)


I am not sure whether the error is due to the wrong version of Java being used while deploying on AWS.

		i-058048d806408d5fe	Severe	23 hours	2	--	--	--	--	--	--	--	--	--	--	0.00	0.00	0.2	0.0	99.8	0.0
Application update failed at 2018-10-13T23:53:43Z with exit status 1 and error: Hook /opt/elasticbeanstalk/hooks/appdeploy/pre/50npm.sh failed.
 
+ /opt/elasticbeanstalk/containerfiles/ebnode.py --action npm-install
 
<div class=""jive-quote"">java@0.9.1 install /tmp/deployment/application/node_modules/java
node-gyp rebuild</div>
 
[node-java] Error: not found: javac
gyp: Call to 'node findJavaHome.js' returned exit status 1 while in binding.gyp. while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack at ChildProcess.onCpExit (/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:336:16)
gyp ERR! stack at emitTwo (events.js:126:13)
gyp ERR! stack at ChildProcess.emit (events.js:214:7)
gyp ERR! stack at Process.ChildProcess._handle.onexit (internal/child_process.js:198:12)
gyp ERR! System Linux 4.14.67-66.56.amzn1.x86_64
gyp ERR! command ""/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/node"" ""/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js"" ""rebuild""
gyp ERR! cwd /tmp/deployment/application/node_modules/java
gyp ERR! node -v v8.11.4
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok 
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! java@0.9.1 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the java@0.9.1 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
 
npm ERR! A complete log of this run can be found in:
npm ERR! /tmp/.npm/_logs/2018-10-13T23_53_43_945Z-debug.log
Running npm install: /opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/npm
Setting npm config jobs to 1
npm config jobs set to 1
Running npm with --production flag
Failed to run npm install. Snapshot logs for more details.
UTC 2018/10/13 23:53:43 cannot find application npm debug log at /tmp/deployment/application/npm-debug.log 
 
Traceback (most recent call last):
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 695, in <module>
main()
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 677, in main
node_version_manager.run_npm_install(options.app_path)
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 136, in run_npm_install
self.npm_install(bin_path, self.config_manager.get_container_config('app_staging_dir'))
File ""/opt/elasticbeanstalk/containerfiles/ebnode.py"", line 180, in npm_install
raise e
subprocess.CalledProcessError: Command '['/opt/elasticbeanstalk/node-install/node-v8.11.4-linux-x64/bin/npm', '--production', 'install']' returned non-zero exit status 1.
Incorrect application version ""pConfMan-20181014"" (deployment 2). Expected version ""pconfman-source-v131018"" (deployment 1)."
Ruby Development	"Nodejs mysql query returning undefined
Hello Friends,

I am trying to write a nodejs lambda function, which connects to RDS, executes query and return the value

The code is fetching value from DB and confirmed it with console.log output
When I am trying to pass the resultset value to lex fulfilment, I always get The status of your order is undefined.

Can someone please let me know how to pass the right value. The orderstatus value(highlighted in code) always return undefined

below is my code:

var mysql = require('mysql');
var config = require('./config.json');
var pool = mysql.createPool({
host : config.dbhost,
user : config.dbuser,
password : config.dbpass,
database : config.dbname
});

function Opencartcall(orderid,callback){
const idvalue=orderid;
var orderstatus;
pool.getConnection(function(err, connection) {
// Use the connection
console.log('Opencartcall entry---------'+idvalue);
connection.query(""select b.name from oc_order_history a, oc_order_status b where a.order_status_id=b.order_status_id and a.order_id=""+mysql.escape(idvalue), function (error, results, fields) {
// And done with the connection.
connection.release();
// Handle error after the release.
if (error) throw error;
else callback(null,results[0].name);
orderstatus=results[0].name;
+console.log('orderstatus value issssss---------'+orderstatus);+ // value comes correctly here

process.exit();
});
});
return orderstatus; // returning as undefined
}
function close(sessionAttributes, fulfillmentState, message) {
return {
sessionAttributes,
dialogAction: {
type: 'Close',
fulfillmentState,
message,
},
};
}

function dispatch(intentRequest, callback) {
console.log(`request received for userId=${intentRequest.userId}, intentName=${intentRequest.currentIntent.name}`);
const sessionAttributes = intentRequest.sessionAttributes;
const slots = intentRequest.currentIntent.slots;
const crust = slots.crust;
//const orderstat=Opencartcall(crust,function(err,data));
const orderstat=Opencartcall(crust, function(err,data){
if (err) {
// error handling code goes here
console.log(""ERROR : "",err); 
} else { 
// code to execute on data retrieval
console.log(""result from db is : "",data); 
} 

});
callback(close(sessionAttributes, 'Fulfilled',
{'contentType': 'PlainText', 'content': `The status of your order is ${orderstat}`})); 

}

// Main handler
// Route the incoming request based on intent.
// The JSON body of the request is provided in the event slot.
exports.handler = (event, context, callback) => {
context.callbackWaitsForEmptyEventLoop = false;
try {
dispatch(event,
(response) => {
callback(null, response);
});
} catch (err) {
callback(err);
}
}"
Ruby Development	"Active targetable endpoints is empty every time.
I did everything as described in the documentation for Pinpoint aws amplify. 

registered remote notifications, configured with the instructions PinpointAnaytics & PinpointTargeting, but I still do not see active endpoints. I can not create a company; there are no edpoints.
It seems that Pinpoint does not work now at all?

i use react native framework amplify"
Ruby Development	"User/device not recognized in AWS Pinpoint console during PushNotification.
Which Category is your question related to? **



React Native



What AWS Services are you utilizing? **



'@aws-amplify/pushnotification'



Provide additional details e.g. code snippets **




extracted from my source code (below) in the app.js file. but in the console aws pinpoint the endpoint is not register to receive push notifications? .

import Amplify, { Analytics } from 'aws-amplify';
import aws_exports from './aws-exports';
import PushNotification from '@aws-amplify/pushnotification';

// gets the registration token
PushNotification.onRegister((token) => {
    console.log('in app registration', token);   
});

NB: aws-amplify analytics works perfectly
Nb: I use facebook account kit for login and authentication
Nb : i use Android

link dashboard aws pinpoint: https://ibb.co/d2hi9K

Thank You for you reply"
Ruby Development	"no response outputtext after promise.
I must be missing something basic.  I have been working on this for a week.  Argh.  How does one create an alexa response after / in a promise.  The following code for example the ""then"" console log shows ""foo"", but the response does nothing.  no error just, the output json doesn't have an outputtext -> not blank output text, outputtext is not in the json.
skill.intent('bogus',{},function(request, response) {
		new Promise(function(resolve, reject) {
		  setTimeout(resolve, 100, 'foo');
		}).then( function(values) {
			console.log(values);
			response.send(values);
		})
		.catch(err =>{
			console.log(err);
		});		
});


The code above uses allexa-app.sdk, but I have also tried ask.sdk, and alexa.sdk.  syntax is different but the results are the same.  Also have used node 8.10 as well as node 4.3.2"
Ruby Development	"Re: no response outputtext after promise.
Another more specific example is below.  This time with ask-sdk-core.  

const myIntentHandler = {
  canHandle(handlerInput) {
    return handlerInput.requestEnvelope.request.type === 'IntentRequest'
      && handlerInput.requestEnvelope.request.intent.name === 'myIntent';
  },
  handle(handlerInput) {
 
  		  var params = {
			};
    var say = 'Abadeet';
		   var dynamodb = new AWS.DynamoDB();
		  var params = {
			};
			var promise1 = new Promise (function (resolv, reject) {
				 dynamodb.listTables(params, function(err, data) {
				   if (err) {
				   console.log(err, err.stack); // an error occurred
				   }
				   else  {
					for(var i = 0; i < data.TableNames.length; i++){
						say = say + "" "" + data.TableNames[i]; 
						}				
				 }	
		});
    }).then(function (){
		return handlerInput.responseBuilder
		  .speak(say)
		  .withSimpleCard('meTexta', say)
		  .getResponse();
	  });
  },
};


Results returned by lambda-local 
info: {
     ""version"" : ""1.0"",
     ""userAgent"": ""ask-node/2.0.7 Node/v4.3.2"",
     ""sessionAttributes"": {}
}


How do I get alexa out put text from the list tables query?"
Ruby Development	"Re: no response outputtext after promise.
Okay, so by some carefully placed console.logs I was able to determine that the response was sent before the promise was finished.  Therefor the response.say didn't work.  So the question is in an async world how do you wait for all the functions to end.  Me thinks from most examples I have seen somehow it does, but in my case not.  I did find something that works,,,, stuff a return on the promise so mr. Process hangs around greedily awaiting some return goodies.  Is there a better way or alternative?

skill.intent('listTable',{},function (request, response) {
 	if(USEDB) {
	return dynamodb.listTables().promise()
	.then(data => {
		console.log(data);
		var say = ""I found the following tables: "";
		for(var i = 0; i < data.TableNames.length; i++){
			if( i == data.TableNames.length -1) {
				say = say + "", and "" + data.TableNames[i]; 
				}
			else { 
				say = say + "", "" + data.TableNames[i];
				}
			}		
		response.say(say).reprompt(reprompt).shouldEndSession(false);		
		});
		}
	else {
		response.say(""Budget table found"");
		response.reprompt(""What are you saying?"").shouldEndSession(false);
	}
});"
Ruby Development	"Error: Signature Does Not Match
I'm getting a Signature Does Not Match error when I tried to pull some items from my bucket. I'm not using the SDK because I can't for my application, and I am trying to do all of this in Javascript. Bucket and Access Key are removed for obvious reasons Here is my code:

var request = new XMLHttpRequest();
	var signingKey = getSigningKey(dateStamp, secretKey, regionName, serviceName);
	var time = new Date();
 
	time = time.toISOString();
	time = time.replace(/:/g, '').replace(/-/g,'');
	time = time.substring(0,time.indexOf('.'))+""Z"";
	console.log(time);
 
	var canonString = ""GET\n""+
						encodeURI(""/"")+""\n""+
						encodeURI(""delimiter"")+'='+encodeURI(""/"")+'&'+
						encodeURI(""max-keys"")+'='+encodeURI(""100"")+'&'+
						encodeURI(""prefix"")+'='+encodeURI(""08"")+'\n'
						""host:""+bucketName+"".s3.amazonaws.com\n""+
						'x-amz-content-sha256:UNSIGNED-PAYLOAD\n'+
						'x-amz-date:'+time+'\n'+
						""UNSIGNED-PAYLOAD"";
 
	var stringToSign = ""AWS4-HMAC-SHA256\n""+
						time+""\n""+
						""20181002/us-east-1/s3/aws4_request\n""+
						CryptoJS.SHA256(canonString).toString();
 
	var authString = CryptoJS.HmacSHA256(signingKey, stringToSign).toString();
 
	request.open(""GET"", ""https://""+bucketName+"".s3.amazonaws.com/?delimiter=%2F&max-keys=100&prefix=08"", false);
	request.setRequestHeader(""Authorization"", ""AWS4-HMAC-SHA256 Credential=""+accessKey+""/20181002/us-east-1/s3/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=""+authString);
	request.setRequestHeader(""host"", bucketName+"".s3.amazonaws.com"");
	request.setRequestHeader(""x-amz-content-sha256"", ""UNSIGNED-PAYLOAD"");
	request.setRequestHeader(""x-amz-date"", time);
	console.log(request);
	request.send();


Here is the error I get from my request:
<?xml version=""1.0"" encoding=""UTF-8""?>↵<Error><Code>SignatureDoesNotMatch</Code><Message>The request signature we calculated does not match the signature you provided. Check your key and signing method.</Message><AWSAccessKeyId>{Access Key Hidden}</AWSAccessKeyId><StringToSign>AWS4-HMAC-SHA256↵20181002T195053Z↵20181002/us-east-1/s3/aws4_request↵52b0da09ba63dcaf0988ab525e070206df7eb29842e4da5c5f86ad700095a65f</StringToSign><SignatureProvided>45999eeece30bcc40b50f51ff163fb90e24613ced1ad17a565ee21f01c4d738c</SignatureProvided><StringToSignBytes>41 57 53 34 2d 48 4d 41 43 2d 53 48 41 32 35 36 0a 32 30 31 38 31 30 30 32 54 31 39 35 30 35 33 5a 0a 32 30 31 38 31 30 30 32 2f 75 73 2d 65 61 73 74 2d 31 2f 73 33 2f 61 77 73 34 5f 72 65 71 75 65 73 74 0a 35 32 62 30 64 61 30 39 62 61 36 33 64 63 61 66 30 39 38 38 61 62 35 32 35 65 30 37 30 32 30 36 64 66 37 65 62 32 39 38 34 32 65 34 64 61 35 63 35 66 38 36 61 64 37 30 30 30 39 35 61 36 35 66</StringToSignBytes><CanonicalRequest>GET↵/↵delimiter=%2F&amp;max-keys=100&amp;prefix=08↵host:{bucketName}.s3.amazonaws.com↵x-amz-content-sha256:UNSIGNED-PAYLOAD↵x-amz-date:20181002T195053Z↵↵host;x-amz-content-sha256;x-amz-date↵UNSIGNED-PAYLOAD</CanonicalRequest><CanonicalRequestBytes>47 45 54 0a 2f 0a 64 65 6c 69 6d 69 74 65 72 3d 25 32 46 26 6d 61 78 2d 6b 65 79 73 3d 31 30 30 26 70 72 65 66 69 78 3d 30 38 0a 68 6f 73 74 3a 64 65 6d 6f 61 70 70 2d 62 75 63 6b 65 74 2e 73 33 2e 61 6d 61 7a 6f 6e 61 77 73 2e 63 6f 6d 0a 78 2d 61 6d 7a 2d 63 6f 6e 74 65 6e 74 2d 73 68 61 32 35 36 3a 55 4e 53 49 47 4e 45 44 2d 50 41 59 4c 4f 41 44 0a 78 2d 61 6d 7a 2d 64 61 74 65 3a 32 30 31 38 31 30 30 32 54 31 39 35 30 35 33 5a 0a 0a 68 6f 73 74 3b 78 2d 61 6d 7a 2d 63 6f 6e 74 65 6e 74 2d 73 68 61 32 35 36 3b 78 2d 61 6d 7a 2d 64 61 74 65 0a 55 4e 53 49 47 4e 45 44 2d 50 41 59 4c 4f 41 44</CanonicalRequestBytes><RequestId>663D12468C5DEF82</RequestId><HostId>7Cfx27ngtMmwXlFAIb1tyY6ZAKpRpACQOpUoGMo0aul/A1R8rFlvFqg+05EH0kDvWzy/RgUFm0U=</HostId></Error>


Edited by: td76099 on Oct 2, 2018 12:56 PM
made this more specific"
Ruby Development	"Unknown error, the response body from fetch is undefined-Auth.confirmSignIn
Describe the bug
I am trying to send the verification code received by the user to confirm the signIn, I have the SMS_MFA enabled. However, I keep getting this error Unknown error, the response body from fetch is: undefined and thats all I get, there is nothing else to help me understand what the error is about. And everything else is working fine, I call signIn, signUp, confirmSignUp and resendSignUp, they all work fine. The problem is only with confirmSignIn and I have no idea what it could be, I already researched online, but had no success. Another strange thing that happens, when I enter the wrong code, it shows me the 'CodeMismatchException', but it fails with 'Unknown error' when code is the right one. PS: I already have cognito configured to work with SMS MFA

To Reproduce
Steps to reproduce the behavior:
I just installed aws-amplify and started using Auth according to the docs, everything else works fine, it's just when I call confirmSignIn

Expected behavior
Receive a successful response when the correct code is sent for verification.

Smartphone (please complete the following information):
The problem happens in android and iOS

Additional context
I'm using:
react-native version 0.55.4
aws-amplify version ^1.0.11

Code
I have a file where a call all the Auth functions and export them

export const confirmSignIn = (cognitoUser, code) => Auth.confirmSignIn(cognitoUser, code, 'SMS_MFA');

Then I call that confirmSignIn function from a different file

confirmSignIn(cognitoUser, code).then((userSession) => {
         console.log(userSession);
      }).catch((error) => {
         switch (error.name) {
           case 'CodeMismatchException':
            this.codeInput.clear();
            break;
           default:
            console.log(error);
            break;
        }
      });

Edited by: dolivas on Oct 1, 2018 9:26 AM

Edited by: dolivas on Oct 1, 2018 9:26 AM"
Ruby Development	"AWS Lambda function for upload/putObject image works only on local machine
I have a lambda function which uses 'request' to get a stream of a file by URL and suppose to upload it to a bucket on s3. It is working perfectly on my local machine using node but not inside the lambda. After running the lambda, I have an empty file with the name I wanted.

Stuff you should know

The lambda function is async
The node version is 8.10
In the example you see putObject, but I have also tried with upload
Even when adding a manual sleep of 90-120 seconds to let the lambda run, the file is not uploaded
I tried using context.succeed or callback('some result'), but it still did not work properly


This is the relevant part of the code
module.exports.handler = async(event, context, callback) => {
  const path = 'bucketToUpload';
  const name = 'imageFileName.jpg';
  let options = {
    uri: responseUrl, // This is the url of the image
    encoding: null
  };
  let reqRes = await request(options); // Here I have the stream
  let awsPutRes = await s3.client.putObject({
    Body: reqRes.body,
    Key: name,
    Bucket: path
  }).promise();
};

Would really appreciate any help or directions for this issue.

Edited by: chenos on Sep 30, 2018 7:32 AM"
Ruby Development	"How to use an API Gateway JavaScript client SDK with WebPack?
Greetings!

I'm writing a serverless webapp with React + API Gateway + Lambda and it's great!
Currently the API is public and access is not controlled, and I can use very simple AJAX to interact with the API.
Now I'd like to control access to a large part of the API using IAM policies.
From what I understand, I have (at least) these options on the client side to gain access to the protected part of the API

1. Write my own code to sign the requests with Signature Version 4, per  these instructions 
2. Use API Gateway to generate a JavaScript client SDK, include the downloaded SDK .js files, and instantiate the client with credentials, and get the SigV4 signing for free. See  this reference 

My problem is that I'm using WebPack to manage the dependencies in the project. The javascript package that API Gateway generates does not play well with WebPack because of a lack of exports and requires in the included .js files. This is my first three weeks doing JavaScript development, so I'm very much in the deep end with the tooling involved. I've scoured StackOverflow and the rest of the web and haven't found a solution. 

It seems that a similar issue was recently, like in the last month-ish, resolved by AWS with the Cognito JS SDK. See their  blog post.

I've killed several days playing dependency whack-a-mole with export-loaders and import-loaders in WebPack, but there's no end in sight.

Has anyone solved this?

Is there an obvious workaround that I'm missing?

Thanks everyone!"
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
Was this ever resolved.  I'm having the same issue."
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
I am also running into the same issue.."
Ruby Development	"Re: How to use an API Gateway JavaScript client SDK with WebPack?
Same question here"
Ruby Development	"Get last n minutes data from dynamodb streams with node SDK.
How can we get last n minutes data from the dynamo streams given that the stream has around 26 shards and getRecords() is returning empty records when ShardIteratorType is set to LATEST."
Ruby Development	"Create a NodeJS container in CodeBuild
Hi,
I am trying to create my NodeJS server as a container (using the aws/codebuild/nodejs.8.11.0) using Codebuild.
Similar to this example:  https://docs.aws.amazon.com/codebuild/latest/userguide/sample-docker.html 
except that it uses go and I use NodeJS.
I have my code in AWSCodeCommit.
I have setup Codebuild and ECR repo (currently empty) and configured as per the whole steps described.
I have also given access to Codebuild service from ECR using:
Effect: Allow,
Principal: Service: codebuild.amazon.com,
Action: ecr:GetDownloadUrlForLayer,...

The first line of my Dockerfile is:
FROM nodejs:8.11.0


The build fails at this line saying:
Step 1/9 : FROM nodejs:8.11.0
pull access denied for nodejs, repository does not exist or may require 'docker login'


Any idea why this would happen?
Should I explicitly add the AWS nodejs container to my ECR? If so, how?
I tried searching everywhere for this but can't figure out.

Edited by: Jogeshwar on Sep 26, 2018 3:27 PM"
Ruby Development	"Signing an API Call to S3 using Security Credentials from Instance Metadata
Hello, 

I am running a Java/Tomcat app on an EC2 instance and need to make GET and PUT calls to S3. I have an IAM role correctly giving permissions to the EC2 to communicate with S3 and I can run CLI commands which work fine. 

My problem is I need to make these calls within the Java app and cannot use the AWS SDK. The Java app allows me to run JavaScript services which is what I am using to make the calls. I created a service that successfully calculates the AWS Signature Version 4, essentially creating presigned url that the SDK will give you in 1 line of code. 

The code works with an actual IAM User (with the exact same permissions as the EC2 IAM Role). But I am trying to use the role instead of the user since our security org will not allow me to use a user in production plus I would have to chage the id and key every 90 days...blah, blah, blah. 

I know I can make calls to http://169.254.169.254/latest/meta-data/iam/security-credentials/ and get the name of my IAM Role, add that to the url and call it again to get an ID, Key, and Token. referenced here: http://169.254.169.254/latest/meta-data/iam/security-credentials/. 

When I use the credentials from the instance metadata, sending the ID and Key from the metadata rather than the IAM User, I receive the error ""InvalidAccessKeyId, The AWS Access Key Id you provided does not exist in our records."" Through some searching, I found I probably needed to send the Token as a header as well. I URI encode the token returned from the instance metadata, add the header to my whole signing calculations. Sending the ID, Key, and Token, I receive the error ""InvalidToken, The provided token is malformed or otherwise invalid."" So I've tried no encoding the token, but that gives me a signature mismatch error. 

I am stuck. I know the IAM role has the correct permissions to talk to S3. I know the code calculates the signature correctly using an IAM User ID and Key. But I receive errors as soon as I start using the instance metadata. 

Has anyone calculated their own AWS signature v4 using the instance metadata? What am I missing?

Thanks,
Chris"
Ruby Development	"Not able to invoke simple lamba function
Hi,

I am using nodejs v8.10 and trying to invoke lambda function. 

Points to note: 
- They are not in VPC
-  Following roles are attached: AWSLambdaExecute, AWSLambdaRole, AWSLambdaBasicExecutionRole.
- Both functions are in same region.

Code:

const AWS = require('aws-sdk');

const lambda = new AWS.Lambda({
    region: my-region,
    accessKeyId: my-access-key,
    secretAccessKey: my-secret-key
});

const params = {
        InvocationType: ""RequestResponse"",
        FunctionName: ""sample"",
        Payload: JSON.stringify({name: 'sample req'})
    }

  lambda.invoke(params).promise().then(res => {
        console.log(""......>>>>"", res)
    })

lambda does not print the above log.

I am not able to figure out the issue. Can someone help me out!"
Ruby Development	"Re: Not able to invoke simple lamba function
There are 2 types of errors which could occur here when invoking a Lambda with RequestResponse, both of which you need to catch differently: connectivity errors (e.g. network issue connecting to the Lambda API) and functional errors (e.g. bad request).
I don't think your log statement would catch connectivity issues as you don't catch a failed promise.

Try something like the following to debug further:

return lambda.invoke(params).promise().then(res => {
   if (res.FunctionError) {
       // Functional error (e.g. bad request)
        console.log(`FunctionError returned. Error details: ${res.Payload}`);
        return;
    }
    // Success
    console.log('Success': res.Payload);
}).catch(err => {
   // Connectivity issue
   console.log(""Error invoking Lambda: "", err);
});"
Ruby Development	"Re: Not able to invoke simple lamba function
Thanks for the reply Paul!

Well, My code snippet was working. I replaced console.log with context.done(null, res). And the response was being displayed.

Also, InvocationType was set to RequestResponse.

Edited by: ankit9 on Sep 26, 2018 2:21 AM"
Ruby Development	"Problems with invoking lambda and returning async api call
Hi all.

I have this function that I use to get an access token from another lambda function. I then query google api to get some photo data. I then want to return this photo data from the function. The problem is that I can't seem to actually return any data from my function as written, or any other way with promises/async/await. 

I get this log error: 
{
  ""errorMessage"": ""Converting circular structure to JSON"",
  ""errorType"": ""TypeError"",
  ""stackTrace"": []
}


Here is my function:

const request = require('request-promise');
const aws = require('aws-sdk');
const lambda = new aws.Lambda({
  region: 'us-east-1'
});   
 
const params = {
    FunctionName: ""getTokenThingy"", 
    InvocationType: ""RequestResponse"", 
    LogType: ""Tail""
};
 
exports.handler = async (event, context) => {
    console.log(""Starting invoke of function"");
    console.log(""Invoking access function"");
    // Get access token
    return await lambda.invoke(params, async (err, data) => {
        if (err) {
            console.log(error);
            return ""test"";
        }
        else {
            console.log(""Retrieved data from payload""); 
            let payloadReponse = JSON.parse(data.Payload);
            const accessToken = payloadReponse.body.accessToken;
 
            console.log(""Access token "" + accessToken);
            
            let photoResult = await libraryApiGetPhotos(accessToken);
            console.log(""Got photo results: "" + photoResult.length);
            return ""test"";
            
        }   
    });
}
 
async function libraryApiGetPhotos(accessToken) {
    let photos = [];
    let error = null;
    const bodyParams = { 
        ""filters"": {
            ""mediaTypeFilter"" : { 
                ""mediaTypes"": [ ""PHOTO""]
            }
        }
    };
    let options = { 
        method: 'POST',
        uri: process.env.googlePhotosAPIEndpoint + process.env.mediaListSearchAffix,
        body: bodyParams,
        json: true,
        auth: { 'bearer' : accessToken }
    }
 
    return request(options)
        .then( (parsedBody) => {
            console.log(""Getting media items"");
            photos = photos.concat(parsedBody.mediaItems);
            console.log(""Count of photos: "" + photos.length);
            return photos;
        }).catch( (err) => {
            error = err.error.error ||
                {name: err.name, code: err.statusCode, message: err.message};
            console.log(error);
        });
}


All the logs occur in the correct order but there is no response at the end and just that error. I have tried varied different ways of converting to promises instead of await/async with no luck. Would love some suggestions.

Thanks"
Ruby Development	"How to get new token from Cognito from the frontend?
I have a react app and I am using Cognito to handle user's authentication. I need to know how do I make a call to Cognito with the refresh token so that it gives me back a new token?

I looked into all of the examples from Cognito and they didn't work. They are using dependencies that I don't have and they don't clearly list how to get them.

Can someone please help?"
Ruby Development	"How to get Cognito User Id with acces Token or Cognito user sub from IAM
Hi,

I am using NodeJS 8.1 for a lambda function called by Alexa.
I am also using the Swift SDK.
I am using Cognito Identity to identify users though the iOS app and the account is linked with the Alexa skill.

The problem is that we use the cognito user-sub to store data under an S3 bucket. 

We want to limit acces to cognito user with the key {cognito-identity.amazonaws.com:sub} which, in fact is the user ID and not the sub. 

Actually, from the alexa lambda function I am using the GET /oauth2/userInfo service, which only returns the user-sub and which is the only API I found I can use with the accesToken delivered by the account linking.

Is there a way to get the user ID from the alexa Lambda function or to get the user sub to restrict the policy under the IAM console ?"
Ruby Development	"How to expose webservice available inside corporate VPN to AWS Lambda?
Hi,

We have an enterprise application (hosted on premise) which provides access to its APIs thru RESTful webservices. These webservices are now accessible only from with in our corporate network. We are planning to invoke those webservices from AWS Lambda. In the case of accessing them from EC2, we can create a VPN connection with in VPC and expose those Web services. Please share thoughts on how can we enable access to those Webservices from AWS Lambda where we dont have VPC and VPN connections used.

Thanks
Rathnam"
Ruby Development	"Re: How to expose webservice available inside corporate VPN to AWS Lambda?
Hi Experts,

Please let me know if you know any option.

Thanks
Rathnam"
Ruby Development	"Re: How to expose webservice available inside corporate VPN to AWS Lambda?
Hi Experts,

Another reminder.
How to expose a on-premise RESTful webservice to AWS Lambda with out making the webservice accessible to everyone/public?

Thanks
Rathnam"
Ruby Development	"Using SSL Cert created from Light Sail Load Balancer on my expressjs app
Hi all,

I have a node app (using expressjs) deployed on Light Sail. Following https://lightsail.aws.amazon.com/ls/docs/en/articles/attach-validated-certificate-to-load-balancer instructions I was able to create a valid cert and attach it to my load balancer.

My question is how do I use the cert for https? Is there something I need to do on my node app? Or any other configuration I need to do? I'm unable to use my website over https

Thanks"
Ruby Development	"Javascript library + federated entity
Hello,
I am developing web application using cognito, s3....
Every client has its own user pool and bucket (B2B).
I am trying to use javascript s3 aws library and I would like to know, what is best practice in using it.
Do I have to create federated entity for every user pool or put every client in one ( thousands of clients )? Or can I use the library without using the federated entity and use clientId or ec2 instance role?
Thanks for your opinions."
Ruby Development	"How to host/start a ionic app on elasticBeanstalk ?
Hi there,
As soon as a add my start script  ""ionic-app-scripts serve --no-open"" in my package.json,
my server does not respond and i can't get logs.
If i try to get logs, my app reload/restart each time.

""scripts"": {
    ""preinstall"": ""npm install -g ionic cordova"",
    ""start"": ""ionic-app-scripts serve --no-open""
  },

Can anyone tell me what's the correct way to do that ?

I also tried awsmobile that returned me errors, impossible to let it work."
Ruby Development	"API Gateway - Enabling Cloudwatch logs and metrics
Using the AWS web console this is just a matter of navigating to the API's stage in question and ticking the boxes under CloudWatch Settings. However I am using the node aws-sdk to build my API and I see no way to do this programatically. There is nothing under createStage, createMethod or anywhere else I have looked. Can I enable CloudWatch for my API using the aws-sdk?"
Ruby Development	"Re: API Gateway - Enabling Cloudwatch logs and metrics
+1, as far as I can tell, the CloudWatch settings can only be controlled through the web console/dashboard (feels soooo weird...)"
Ruby Development	"Re: API Gateway - Enabling Cloudwatch logs and metrics
Look like this is an old question (but unresolved), for what it is worth,
I use the update_stage method to set it up like so:
resp = client.update_stage({
                               rest_api_id: ""string"", # required
                               stage_name: ""string"", # required
                               patch_operations: [
                                   {
                                       op: ""replace"",
                                       path: ""/*/*/logging/logLevel"",
                                       value: 'info'
                                   }
                               ]
                           })"
Ruby Development	".NET Core IoT and IotData in the same app - how do I configure this?
I'm trying to write a simple .NET core web app that makes some calls to interact with AWS IoT. I wanted to be able to search or list things and get their current shadow. I believe I need to use the IoT service to search and list, and IotData to get thing shadows. I'm running into a problem however where I can't seem to find a configuration that works for both.

If I don't have ServiceURL specified in the Appconfig.Development.json, IotData throws AmazonClientException: No RegionEndpoint or ServiceURL configured


If I provide ServiceURL with the endpoint listed in our AWS IoT dashboard ""ENDPOINT.iot.REGION.amazonaws.com"", IotData calls begin to work but the IoT service calls fail with the exception ResourceNotFoundException: Not Found

If I remove all of the IotData code and add the ""Region"" field to Appconfig.Development.json with our region, the IoT calls begin to work.

If I uncomment the IotData calls with the ""Region"" field, I get AmazonClientException: The RegionEndpoint property is not applicable for AmazonIotDataClient and should not be set.

In the past I've used Boto3 in Python and didn't have to configure any of this this way; the region was specified in ~/.aws/config and never had to provide a Service URL, and I've written scripts that used both services, so I'm very confused as to what the issue is.

I'm also certain I have the correct permissions with the keys I'm using as I'm able to perform all of these operations from the AWS CLI. Does anyone have any recommendations on how to configure this so that both services work?

For reference, this is a simple example of what I'm trying to do: https://gist.github.com/nathan-miller-actigraph/6cd18c99ee2ee4ca05fb5f74598287ae (the actual application is a .NET Core 2.1 SPA)."
Ruby Development	"Re: .NET Core IoT and IotData in the same app - how do I configure this?
I figured it out. For anyone who runs into this same problem, you can create a second section in your appsettings.json:

    ""AwsIotDataConfig"": {
        ""Profile"": ""default"",
        ""ServiceURL"": ""https://data.iot.us-east-1.amazonaws.com/""
    },
    ""AwsConfig"": {
        ""Profile"": ""default"",
        ""Region"": ""us-east-1""
    }


then in your Startup.cs, when you call GetAWSOptions, you can pass in the name of the config section:

            var awsGenericOptions = Configuration.GetAWSOptions(""AwsConfig"");
            services.AddDefaultAWSOptions(awsGenericOptions);
 
            var awsIotDataOptions = Configuration.GetAWSOptions(""AwsIotDataConfig"");


and when you add the IotData service, specify that it should use the IotData specific options:

            services.AddAWSService<IAmazonIoT>();
            services.AddAWSService<IAmazonIotData>(awsIotDataOptions);"
Ruby Development	"Add  3 tables of AWS DynamoDb in our .Net core project
Hello,
       I want to add 3 tables of DynamoDB table in our AWS Serverless project From AWS. then how to configure the Serverless.template file , Function.cs File , default.json file and any other files to be add???  to get the access of items from DynamoDB Table.
        If you have any running code or example step by step then pls send it.it will be very helpful.

Thank You"
Ruby Development	"Process.Start() not starting the .exe file after Deployment in EC2 instance
Hi,

I have deployed my C# application in AWS EC2 instance using IIS. I am facing a blocking issue that the Process.Start() not starting the .exe file. But it works when run in development mode.

If the same application is hosted in my local server, it is working perfectly. Even if same access is provided to EC2(as in the local server), the Process.Start() is not invoked.

I have provided folder access for IUSR , IIS_USRS

Looking for your advice in this regard.

Thanks
Anand"
Ruby Development	"How to setup AWS Transfer for SFTP with Custom IdentityProvider?
Hello all,
I am trying to setup an AWS Transfer for SFTP server with custom identity provider, but I can't make any sense of the documentation, as I am completely new to AWS concepts. I tried to follow the link 
https://docs.aws.amazon.com/transfer/latest/userguide/authenticating-users.html#authentication-custom-ip but I still am unable to figure out, how to provide my serverId to the cloudformation template while deploying the template, and also provide the api gateway url to the server when creating the server, while I am not able to edit the server api gateway url once, it is created?

Best Regards"
Ruby Development	"AWS Transfer for SFTP Custom IdentityProvider
Hello all,
I am trying to setup an AWS Transfer for SFTP server with custom identity provider, but I can't make any sense of the documentation, as I am completely new to AWS concepts. I tried to follow the link 
https://docs.aws.amazon.com/transfer/latest/userguide/authenticating-users.html#authentication-custom-ip but I still am unable to figure out, how to provide my serverId to the cloudformation template while deploying the template, and also provide the api gateway url to the server when creating the server, while I am not able to edit the server api gateway url once, it is created?"
Ruby Development	"Lambda C# deployment package from VisualStudio2017 fails
I am using VS2017 and C# to create a simple Lambda function, triggered by APIcall.
Access to postgreSQL and PARQUET libraries works fine, though packages are downgraded from their current versions. In order to write to S3, I include the package AWSSDK.S3, which gest removed during the publishing process and subsequently causes erros.

Transcript from publish command:
Executing publish command
... invoking 'dotnet publish', working folder 'C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\bin\Release\netcoreapp2.1\publish'
... Disabling compilation context to reduce package size. If compilation context is needed pass in the ""/p:PreserveCompilationContext=false"" switch.
... publish: Microsoft (R) Build Engine version 15.9.20+g88f5fadfbe for .NET Core
... publish: Copyright (C) Microsoft Corporation. All rights reserved.
... publish:   Restoring packages for C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj...
... publish:   Generating MSBuild file C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\obj\AWS_testCS_PARQUET.csproj.nuget.g.props.
... publish:   Restore completed in 1.01 sec for C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj.
... publish: Function.cs(169,23): error CS0234: The type or namespace name 'AmazonS3Client' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(169,63): error CS0234: The type or namespace name 'AmazonS3Client' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(170,23): error CS0234: The type or namespace name 'Model' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(170,72): error CS0234: The type or namespace name 'Model' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(179,51): error CS0234: The type or namespace name 'Model' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(187,51): error CS0234: The type or namespace name 'AmazonS3Client' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
... publish: Function.cs(189,49): error CS0234: The type or namespace name 'Model' does not exist in the namespace 'Amazon.S3' (are you missing an assembly reference?) [C:\@CHRIS\@AWS\VS2017_projects\AWS_testCS_PARQUET\AWS_testCS_PARQUET\AWS_testCS_PARQUET.csproj]
Failed to deploy Lambda Function
 
 
The packages linked in are
Amazon.Lambda.Core (1.1.0) - current
AWSSDK.Core (3.3.31.10) - current
AWSSDK.APIGateway (3..3.23.26) - current
Npgsql (4.0.4) - current
Parquet.Net (3.0.0) - downgraded from 3.3.3
AWSSDK.S3 (3.3.31.18) - removed during publishing

The code runs fine as console app.

So, the question is: how do you access S3 given the Lambda environment enforced during the VS/AWS publishing process?"
Ruby Development	"How can I detect completion of a RefreshGateway request?
Context 
I am writing code to move files to an S3 store which is accessed through a file storage gateway.
I know that the uploaded files will not appear until a RefreshCache is performed to update the directory in the file gateway.

Issue 
My code needs to perform operations THROUGH the file gateway after the cache has been refreshed. So after calling AmazonStorageGatewayClient.RefreshCacheAsync  or AmazonStorageGatewayClient.RefreshCache I need to wait until the cache has completed refreshing before proceeding with my code.

Question 
When the call to RefreshCache completes do I know the refresh is complete, or just that it has been submitted for processing? If the later, how can I check to see if the actual refresh has completed?

Things I've considered
I know I can set up a cloudwatch notification to watch for a gateway refresh to be completed, but I don't know how I could  use that to communicate back to my code that the operation is completed (I can't use a Lambda in this situation). 

Questions:
Is the refresh done with AmazonStorageGatewayClient.RefreshCache call returns from the API?
If not is there a way to detect in my code when it IS done?"
Ruby Development	"CodeUri  Artifact dotnetcore2.1
Hello, 
Regarding the sam generated helloworld project in dotnetcore, the template.yaml file points the CodeUri property to the zip file in the artifacts folder which means I have to build locally and pass my artifact to my repo. When I pointed the the CodeUri to my src folder which held the program.cs, .csproj file, and the aws-lambda-tools-defaults.json(Similar to the folder you would point at with a sam nodejs or sam python lambda project) the lambda failed saying that the project was missing the .deps.json file which was in my debug or release folders. I have a pipeline that uses codebuild and I would like codebuild to be the stage that builds the artifact . Is there a way I can use codebuild to build the artifact instead of doing that locally?
Example:

HelloWorldFunction:
        Type: AWS::Serverless::Function 
        Properties:
            CodeUri: ./artifacts/HelloWorld.zip"
Ruby Development	"Object does not match ""udp"" - MediaLive creating channel
I'm trying to create a MediaLive channel with 2 RTP input attachments and 1 UDP output.
amazonMediaLiveClient.CreateChannel(createChannelRequest) gives me this exception:
""Object does not match ""udp""""

Can someone please tell me a bit more about this message? I'm trying to debug my code, but I have no idea where to start with this. I don't use any object named ""udp"". I also tried to download the source and search for some similar messages, but I had no luck

The complete exception:

Amazon.MediaLive.Model.UnprocessableEntityException
HResult=0x80131500
Message=Object does not match ""udp""
Source=AWSSDK.Core
StackTrace:
at Amazon.Runtime.Internal.HttpErrorResponseExceptionHandler.HandleException(IExecutionContext executionContext, HttpErrorResponseException exception) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\ErrorHandler\HttpErrorResponseExceptionHandler.cs:line 115
at Amazon.Runtime.Internal.ExceptionHandler`1.Handle(IExecutionContext executionContext, Exception exception) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\ErrorHandler\ExceptionHandler.cs:line 38
at Amazon.Runtime.Internal.ErrorHandler.ProcessException(IExecutionContext executionContext, Exception exception) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\ErrorHandler\ErrorHandler.cs:line 204
at Amazon.Runtime.Internal.ErrorHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\ErrorHandler\ErrorHandler.cs:line 78
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.CallbackHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\CallbackHandler.cs:line 45
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.Signer.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\Signer.cs:line 38
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.EndpointDiscoveryHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\EndpointDiscoveryHandler.cs:line 54
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.CredentialsRetriever.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\CredentialsRetriever.cs:line 72
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.RetryHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\RetryHandler\RetryHandler.cs:line 84
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.CallbackHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\CallbackHandler.cs:line 45
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.EndpointResolver.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\EndpointResolver.cs:line 34
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.Marshaller.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\Marshaller.cs:line 37
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.CallbackHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\CallbackHandler.cs:line 45
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.ErrorCallbackHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\ErrorCallbackHandler.cs:line 44
at Amazon.Runtime.Internal.PipelineHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\PipelineHandler.cs:line 60
at Amazon.Runtime.Internal.MetricsHandler.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\Handlers\MetricsHandler.cs:line 40
at Amazon.Runtime.Internal.RuntimePipeline.InvokeSync(IExecutionContext executionContext) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\Pipeline\RuntimePipeline.cs:line 135
at Amazon.Runtime.AmazonServiceClient.Invokehttps://forums.aws.amazon.com/(AmazonWebServiceRequest request, InvokeOptionsBase options) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Core\Amazon.Runtime\AmazonServiceClient.cs:line 203
at Amazon.MediaLive.AmazonMediaLiveClient.CreateChannel(CreateChannelRequest request) in E:\JenkinsWorkspaces\v3-trebuchet-release\AWSDotNetPublic\sdk\src\Services\MediaLive\Generated\_bcl45\AmazonMediaLiveClient.cs:line 345
at AWSPlayout.Program.Main(String[] args) in C:\.Net\aws\AWSPlayout\AWSPlayout\Program.cs:line 532

Inner Exception 1:
HttpErrorResponseException: The remote server returned an error: (422).

Inner Exception 2:
WebException: The remote server returned an error: (422)."
Ruby Development	"Can I use a .ebignore file when deploying with the VS17 EB toolkit?
Hi, I currently have my ASP.NET CORE MVC application hosted thanks to EB but I am trying to make a .ebignore file to work on deployment so I can ignore the folder, wwwroot/apps, but it just does not work.

i have read the documentation but it says nothing about the Visual Studio 2017 EB toolkit and ebignore together.
I have put the ebignore file in the root and its content is basically:

wwwroot/apps

Am I missing something?
I really need that folder not to be deployed.

Edited by: codingcow on Feb 13, 2019 1:01 AM"
Ruby Development	"IIS REST API unable to communicate with external RDS SQL Server
Hello,

I am wanting to query the IIS API from over the internet and provide the API read/write permissions. When I do so from Postman, it says ""Access to the path 'C:\inetpub\wwwroot\Pictures\afc14cb1-052f-438c-a59c-dfee2b214b39' is denied."" I presume this has to do with the IIS API not having the necessary write permissions. How would I provide the IIS API write permission to  'C:\inetpub\wwwroot\'?

I have deployed an IIS Web API to Elastic Beanstalk and SQL Server Express to RDS. Both are on the same subnet and are in the same security group, the database has public accessibility too.

In the IIS application the Data Source=databaseEndPoint,port#;Initial Catalog=database name;User ID=userId;Password=password have all be provided. I have also tried providing these details through Elastic Beanstalks ""Environment properties"".

Some assistance would be greatly appreciated.

Many thanks!

Edited by: SomeAwsDeveloper on Jan 30, 2019 6:18 PM"
Ruby Development	"MONO on ARM a1 EC2 Instance running Amazon Linux 2
I'd like to install mono-complete on a new ARM a1 EC2 instance. Has anyone tried to compile mono on ARM on Amazon Linux 2 - any pointer? Thanks!

MPT"
Ruby Development	"Re: MONO on ARM a1 EC2 Instance running Amazon Linux 2
As root (sudo su)

Add epel (automatically enabled):
yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm

Install Mono:
yum install mono-core

Install root certificates:
mozroot —import —ask-remove

Install XSP4
yum groupinstall ""Development Tools"" (or figure out how to install only the components needed.
Download source zip and unzip
Copy /usr/bin/mcs to /usr/bin/dmcs as it looks for the old version
./Automake
./Configure /PREFIX=/bin
make
make install

So far, so good, everything except for stuff that includes x86 binaries works."
Ruby Development	"Re: MONO on ARM a1 EC2 Instance running Amazon Linux 2
Self-helpt."
Ruby Development	"Downloaded files are corrupted when publishing on AWS lambda
Hello, 
I have .Net core 2.1 project which I am publishing on AWS Lambda, some endpoints I have will get a file from S3 and download it to me.
The thing is when I test locally, the same audio/image file is returned fully to me and I can preview it but when I publish to Lambda I get corrupted files, that I can't preview.

Anything I should configure to fix this?
A code sample:

        public ActionResult<IFormFile> GetPortrait(https://forums.aws.amazon.com/ string imageId)
        {
              Stream image=GetFromS3(imageId);
              return File(image, ""image/jpeg""); // returns a FileStreamResult
        }"
Ruby Development	"Re: Downloaded files are corrupted when publishing on AWS lambda
Are you returning the results through API Gateway? If so, API Gateway tries to return text or base64 encoded data. Do a web search for 'how to return S3 data from API Gateway' - there are some special API Gateway settings that have to be implemented.

I wanted to return a 1x1 pixel image but instead, I returned a redirect to a public bucket with the file!

MPT."
Ruby Development	"Implement Logout with Cognito
Hi there!!

I could implement the login but I cannot figure out how to implement logout in asp.net core... I want to get to the login page when user logout, so suppose I should set same url for login and logout in Cognito, but how should I call the logout action from my code?

I've tried to redirect to Cognito logout in this way:
var url = cognitoEndPointLogout + ""client_id=<mi client id>"" + ""&logout_uri=https://localhost:5001"";

The problem with this it's requiring the redirect_uri in the url. So trying another approach:
var url = cognitoEndPointLogout + ""client_id=<mi client id>"" + ""&redirect_uri=https://localhost:5001"" + ""&response_type=code"" + ""&state=STATE"" + ""&scope=openid+profile+aws.cognito.signin.user.admin"";

But I'm getting redirect mismatch. So non of solutions proposed here is working  -> https://docs.aws.amazon.com/cognito/latest/developerguide/logout-endpoint.html

Any suggestion about what can I be doing wrong? :S

Thanks!!"
Ruby Development	"Re: Implement Logout with Cognito
Solved by myself. Close the thread since I'm not being helped. Just for the ones can be interested, do not trust at all the Amazon documentation about sign out, there's some missing details clue to properly get signed out and redirected to sign in."
Ruby Development	"Re: Implement Logout with Cognito
I would love to know your solution if you could share it.  I am struggling to call the logout endpoint in my ASP.NET Core 2 application and receiving the same error as you are.  Thank you."
Ruby Development	"How to authenticate(login)  IAM User in .net  web application
The requirement is to authenticate the IAM users in a custom web application so that the users can upload to S3 bucket as per the permission."
Ruby Development	"Re: How to authenticate(login)  IAM User in .net  web application
The processes are well documented with a nice code example:
https://docs.aws.amazon.com/sdk-for-net/v3/developer-guide/cognito-creds-provider.html"
Ruby Development	"Re: How to authenticate(login)  IAM User in .net  web application
Thanks for the link. However it is not mentioning how an IAM user can be logged using his/her username and password using custom .net web application."
Ruby Development	"Re: How to authenticate(login)  IAM User in .net  web application
Also I am looking for authentication using IAM Users, not using coginto."
Ruby Development	".NET Core and AWSSDK on Mac, credentials file not found
I'm trying develop using .NET Core w/ Visual Code on my Mac. Everything works great but my web app cannot access the credentials file when making calls to the AWSSDK when run locally on the Mac. I've configured in appsettings.json and web.config since it isn't clear which to use, but neither work.

Specifically, I get the error: ""App.config does not contain credentials information. Either add the AWSAccessKey and AWSSecretKey properties or the AWSProfileName property.""

Here's my appsettings.json:
{
  ""AWS"": {
    ""Profile"": ""default"",
    ""ProfilesLocation"": ""/Users/<myuserfolder>/.aws/credentials"",
    ""Region"": ""us-west-2""
  }
}

And here is my web.config:
  <appsettings>
      <add key=""AWSProfileName"" value=""default""/>
      <add key=""AWSProfilesLocation"" value=""/Users/<myuserfolder>/.aws/credentials"" />
  </appsettings>

Some docs say to use the SDK Store, but as far as I can tell, that cannot be configured on a Mac due to missing crypto dll.

Please help!

Thanks."
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
In .NET Core applications config information is not automatically loaded like it was in .NET Framework because of the changes done to the configuration framework. This blog post should help explain how to configure AWS with .NET Core

https://blogs.aws.amazon.com/net/post/Tx1GYCSXGTLN6PM/Configuring-AWS-SDK-with-NET-Core"
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Thanks, but that article does not talk at all about how to setup credentials for the AWSSDK."
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Do you mean obtaining AWS credentials or how to get your credentials loaded into your application. Assuming you have your credentials you would add them to the ~/.aws/credential file with a given profile. 

http://docs.aws.amazon.com/sdk-for-net/v3/developer-guide/net-dg-config-creds.html#creds-file

In the blog post I mentioned earlier it talked about how you can reference the profile in your appSettings.json file and using the AWSSDK.Extensions.NETCore.Setup NuGet package you can pull out the credentials or create service clients with the configured credentials."
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Yes, I saw all that. I cannot get it to work on a Mac no matter what I do. Works great on Windows with Visual Studio, but not on Mac with ASP.NET Core.

I put the credentials file where you said, but it is apparently never found/read from. Tried setting up paths in appsettings.json as well, doesn't work either.

Hard coding in the environment variables works, but that is not an ideal solution."
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Have you figured out this issue? I'm running into the same issue when deploying on windows server 2008. My appsettings.json is in the correct format, but the AWS configuration doesn't pick up the profile name."
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
MikeOG - are you still experiencing this issue?"
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
I've just successfully gone through the examples in https://aws.amazon.com/blogs/developer/configuring-aws-sdk-with-net-core/ on both MAC and Windows.

Are you getting the exact same error: ""App.config does not contain credentials information. Either add the AWSAccessKey and AWSSecretKey properties or the AWSProfileName property.""?

Can you post your appsettings.json, and Startup.cs files?

Edited by: johnv@AWS on Dec 6, 2016 4:37 PM"
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Hi Johnv,

Yes I'm facing the same issue. It works locally, but when deploying on the server it fails. The server is running under a user that has the profile setup.
This is my appsettings.json:
 {
  ""AWS"": {
    ""Profile"": ""profileName"",
    ""Region"": ""us-east-1""
  }
}


My Startup.cs has the following:
public Startup(IHostingEnvironment env)
        {
            var builder = new ConfigurationBuilder()
                .SetBasePath(env.ContentRootPath)
                .AddJsonFile(""appsettings.json"", optional: true, reloadOnChange: true)
                .AddJsonFile($""appsettings.{env.EnvironmentName}.json"", optional: true)
                .AddEnvironmentVariables();
 
            Configuration = builder.Build();
 
        }
 
public void ConfigureServices(IServiceCollection services)
        {
            var mapper = ConfigureAutoMapper.Configure();
            services.AddOptions();
            services.Configure<MongoOptions>(Configuration);
            services.AddSingleton<IHttpContextAccessor, HttpContextAccessor>();
            services.AddSingleton<IRepository, Repository>();
            services.AddSingleton(mapper);
            services.AddMvc();
            services.AddDefaultAWSOptions(Configuration.GetAWSOptions());
            services.AddAWSService<IAmazonSimpleEmailService>();
 
        }"
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Norm, that blog post is for ASP.NET Core, can you enlighten us of any changes for a console application?"
Ruby Development	"Re: .NET Core and AWSSDK on Mac, credentials file not found
Is there an example for getting this to work on a Mac for a netcore console application? I'm am unable to get it working."
Ruby Development	"Suddenly can't RDP into Windows Server 2012 EC2 Instance
Initially after creating a Windows Server 2012 EC2 Instance I was able to RDP into it using Windows Remote Desktop Connection. Then, suddenly I could no longer RDP into the instance. Remote Desktop Manager Failed with this message ""An internal error has occurred."" I have been able to ping and telnet the machine to verify the machine is running and the port is open. Has anyone else experienced this issue?"
Ruby Development	"Re: Suddenly can't RDP into Windows Server 2012 EC2 Instance
Sounds like a temporary issue.

Please restart your instance and try connecting again."
Ruby Development	"Intermittent  SSL_ERROR_ZERO_RETURN when getting S3 objects
Hi,

I have a .NET Core application running on EC2 Linux machine. The application performs intensive concurrent reads from S3 (it scans over 100k files, up to 50 concurrently, the whole run takes about 40min). Today, some of the S3 requests started failing with the following error:

System.Net.Http.HttpRequestException: The SSL connection could not be established, see inner exception. ---> System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception. ---> Interop+OpenSsl+SslException: SSL Handshake failed with OpenSSL error - SSL_ERROR_ZERO_RETURN.

The failures seem to be concentrated in short time intervals (about a second), i.e. all runs fine, then several requests fail in a row, then all continues fine, and repeats again after a while.
I don't see any correlation between the failures to specific S3 objects (every time it fails on different files).

I would really appreciate any help and ideas on the cause of the problem.

AWSSDK.S3 version in use 3.3.31.10.

Full stacktrace:
System.Net.Http.HttpRequestException: The SSL connection could not be established, see inner exception. ---> System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception. ---> Interop+OpenSsl+SslException: SSL Handshake failed with OpenSSL error - SSL_ERROR_ZERO_RETURN.
   at Interop.OpenSsl.DoSslHandshake(SafeSslHandle context, Bytehttps://forums.aws.amazon.com/& sendBuf, Int32& sendCount)
   at System.Net.Security.SslStreamPal.HandshakeInternal(SafeFreeCredentials credential, SafeDeleteContext& context, SecurityBuffer inputBuffer, SecurityBuffer outputBuffer, SslAuthenticationOptions sslAuthenticationOptions)
   --- End of inner exception stack trace ---
   at System.Net.Security.SslState.StartSendAuthResetSignal(ProtocolToken message, AsyncProtocolRequest asyncRequest, ExceptionDispatchInfo exception)
   at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartSendBlob(Byte[] incoming, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartSendBlob(Byte[] incoming, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartSendBlob(Byte[] incoming, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartSendBlob(Byte[] incoming, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartSendBlob(Byte[] incoming, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer, Int32 count, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
   at System.Net.Security.SslState.PartialFrameCallback(AsyncProtocolRequest asyncRequest)





End of stack trace from previous location where exception was thrown ---





   at System.Net.Security.SslState.ThrowIfExceptional()
   at System.Net.Security.SslState.InternalEndProcessAuthentication(LazyAsyncResult lazyResult)
   at System.Net.Security.SslState.EndProcessAuthentication(IAsyncResult result)
   at System.Net.Security.SslStream.EndAuthenticateAsClient(IAsyncResult asyncResult)
   at System.Net.Security.SslStream.c.<AuthenticateAsClientAsync>b__47_1(IAsyncResult iar)
   at System.Threading.Tasks.TaskFactory`1.FromAsyncCoreLogic(IAsyncResult iar, Func`2 endFunction, Action`1 endAction, Task`1 promise, Boolean requiresSynchronization)





End of stack trace from previous location where exception was thrown ---





   at System.Net.Http.ConnectHelper.EstablishSslConnectionAsyncCore(Stream stream, SslClientAuthenticationOptions sslOptions, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.ConnectHelper.EstablishSslConnectionAsyncCore(Stream stream, SslClientAuthenticationOptions sslOptions, CancellationToken cancellationToken)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at System.Net.Http.HttpConnectionPool.CreateConnectionAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at System.Net.Http.HttpConnectionPool.WaitForCreatedConnectionAsync(ValueTask`1 creationTask)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at System.Net.Http.HttpConnectionPool.SendWithRetryAsync(HttpRequestMessage request, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.FinishSendAsyncUnbuffered(Task`1 sendTask, HttpRequestMessage request, CancellationTokenSource cts, Boolean disposeCts)
   at Amazon.Runtime.HttpWebRequestMessage.GetResponseAsync(CancellationToken cancellationToken)
   at Amazon.Runtime.Internal.HttpHandler`1.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.RedirectHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.Unmarshaller.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.S3.Internal.AmazonS3ResponseHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.ErrorHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.CallbackHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.EndpointDiscoveryHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.EndpointDiscoveryHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.CredentialsRetriever.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.RetryHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.RetryHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.CallbackHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.CallbackHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.S3.Internal.AmazonS3ExceptionHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.ErrorCallbackHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.Runtime.Internal.MetricsHandler.InvokeAsync[T](IExecutionContext executionContext)
   at Amazon.S3.Transfer.Internal.OpenStreamCommand.ExecuteAsync(CancellationToken cancellationToken)
   at Amazon.S3.Transfer.TransferUtility.OpenStreamAsync(TransferUtilityOpenStreamRequest request, CancellationToken cancellationToken)
   at MyTest.MyTest.DownloadAndDecompress(S3Object s3File) in D:\Dev\MyTest\MyTest.cs:line 108
   at MyTest.MyTest.<Run>b__7_0(S3Object f) in D:\Dev\MyTest\MyTest.cs:line 76

Best regards,
Vasili"
Ruby Development	"Dax Timeout
I'm using GraphQl with DynamoDb plus DAX, and when I click for the request, and it takes longer than 1 minute, it shows timeout.

I'm pretty sure this is some DAX issue, I've tried to set DaxClientConfig.RequestTimeout longer, but I keep receiving timeout.

Is there a default timeout for DAX? How Can I solve this?

Exception in logs:
POST|Version: 1.0|ResourceName: healtcheck|StatusCode: 200|Error querying index `menu_distribution_product_index`: Timeout waiting for an available tube. HostPort : 10.2.128.212:8111|Menu.Utilities.DataAccess.DynamoDB.DynamoDbRepository+<GetRestaurantProductsAsync>d__5.MoveNext|0"
Ruby Development	"AWS Transscribe API StartTranscriptionJob
Hello, 

i have a problem starting a transcription job via API. I want to transcribe a german audio file but i get this error message: ""You need to specify MediaSampleRate for language de-DE"".
According to the docs it is an optional parameter.
I tested with an english audio file and dont't have any problems."
Ruby Development	"What VM to use
The technology that I'm using is Angular 5, ASP.NET WebAPI, and SQL Server.  The user will be logging into the VM to use the website.  

What type of VM/service shoulda I choose? RDS?"
Ruby Development	"Re: What VM to use
The best architecture would be to spin up a VM with Window Server on and then separately have an RDS instance as well connecting the two via security groups and put your server behind and elastic load balancer if you ever want to run multiple instances for redundancy."
Ruby Development	"lambda dotnet core 2.1: issue with System.IdentityModel.Tokens
For some reason i am unable to utilize the nuget package System.IdentityModel.Tokens.Jwt while using developing a dotnet core lambda.
The Error message that i receive is at runtime using the Mock Lambda Test Tool is as followed.

System.IO.FileLoadException: Could not load file or assembly 'System.IdentityModel.Tokens.Jwt, Version=5.3.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'. Could not find or load a specific file. (Exception from HRESULT: 0x80131621)


  at JWTTest.Function.FunctionHandler(string input, ILambdaContext context)

Sample Code is as followed and was created by using the AWS Lambda Blank Template, adding the System.IdentityModel.Tokens nuget package and adding the call to new JwtSecurityToken(). When running tests everything works fine. It only appears to be happening during the execute of the Mock Lambda Test Tool.

using Amazon.Lambda.Core;
using System;
using System.IdentityModel.Tokens.Jwt;
 
// Assembly attribute to enable the Lambda function's JSON input to be converted into a .NET class.
[assembly: LambdaSerializer(typeof(Amazon.Lambda.Serialization.Json.JsonSerializer))]
 
namespace JWTTest
{
    public class Function
    {
 
        /// <summary>
        /// A simple function that takes a string and does a ToUpper
        /// </summary>
        /// <param name=""input""></param>
        /// <param name=""context""></param>
        /// <returns></returns>
        public string FunctionHandler(string input, ILambdaContext context)
        {
            var strToken = ""eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"";//example token from jwt.io
 
            var jwtToken = new JwtSecurityToken(strToken);// this is where the error is thrown.
 
            Console.WriteLine(jwtToken.Subject);// should be 1234567890
 
            return input?.ToUpper();
        }
    }
}


No matter what I do keep on encountering the above error.

Edited by: KStolte on Jan 10, 2019 9:21 AM"
Ruby Development	"Re: lambda dotnet core 2.1: issue with System.IdentityModel.Tokens
Forgive me if this sounds like the stupid user response but have you checked that you have updated your .net core versions and have the dev SDKs installed as well?

https://dotnet.microsoft.com/download 

Alternatively have you checked the nuget package manager and checked that all your SDK versions are consolidated under a single version?"
Ruby Development	"need code sample
I am planning to integrate simple mail service to our company for marketing purpose. I am using windows services with c# code. I can send mails but I can't able to get the bounce,click,open status for each and every mail programmatically. Could you please send me the sample codes or projects to know the status of each and every mail."
Ruby Development	"Re: need code sample
This isn't a feature that is part of SMS, you would have to do the introduce blank image via an API and write the code yourself to monitor which emails have been sent and opened. (Using the aforementioned image api)"
Ruby Development	"ELB Managed Updates
Does anyone from AWS know why Managed Platform Updates isn't available for .NET, I know it says it in the documentation, but is there any update on when/if this will ever be available?

Thanks!
Scott"
Ruby Development	"Cognito with .Net 4 MVC application
Hi,
I am trying to use Cognito with a .Net 4 MVC application. I was thinking of leaving it working the same way and saving the user in Cognito at the same time. This will enable the new satellite applications being built to be able to authenticate. 
Has anyone implemented Cognito in .Net 4 MVC application?
Kind Regards"
Ruby Development	"AWS Cognito Authentication of user not working
Hello 

I have created the cognito user Pool and trying to  Register my user through simple HTML Registration page where my user is sign up but after sign up I am getting verification code. and I need to Authenticate that user so that after authentication I will be able to verify my user through the OTP code sent on my Registered mail Id.
so below is the code to sign up user and its authentication  but in my case my user is not getting Authenticated I have did the authentication process similar to the process given in AWS Tutorial: Integrating User Pools for JavaScript Apps for Authenticating the User please Let me know where I am going Wrong.

Code:

<!DOCTYPE html>

<html lang=""en"">
  <head>
    <meta charset=""utf-8"">
	<!-- Javascript SDK-->
  <script src=""https://code.jquery.com/jquery-1.11.3.min.js""></script> 
  <script src=""js/amazon-cognito-auth.min.js""></script>
  <script src=""https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js""></script> 
  <script src=""js/amazon-cognito-identity.min.js""></script>  
  <script src=""js/config.js""></script>
  <script src=""lib/AuthenticationDetails.js""></script>
  <script src=""lib/AuthenticationHelper.js""></script>
   <script src=""lib/CognitoJwtToken.js""></script>
  <script src=""lib/CognitoIdToken.js""></script> 

  </head>


  <body>

    <h1 class=""h3 mb-3 font-weight-normal"" id=""titleheader"">Register an Account</h1>

	<input type=""personalname"" class=""form-control"" id=""personalnameRegister"" placeholder=""Name"" pattern="".*"" required>
    <input type=""email"" class=""form-control"" id=""emailInputRegister"" placeholder=""Email"" pattern="".*"" required>
	<input type=""password"" class=""form-control"" id=""passwordInputRegister"" placeholder=""Password"" pattern="".*"" required>
    <input type=""password"" class=""form-control"" id=""confirmationpassword"" placeholder=""Confirm Password"" pattern="".*"" required>
	<button id=""mainbutton"" class=""btn btn-lg btn-primary btn-block"" type=""button"" onclick=""registerButton()"" >Register</button>

	<script>

		var username;
		var password;
		var personalname;
		var poolData;

	  function registerButton() {

		personalnamename =  document.getElementById(""personalnameRegister"").value;	
		username = document.getElementById(""emailInputRegister"").value;

		if (document.getElementById(""passwordInputRegister"").value != document.getElementById(""confirmationpassword"").value) {
			alert(""Passwords Do Not Match!"")
			throw ""Passwords Do Not Match!""
		} else {
			password =  document.getElementById(""passwordInputRegister"").value;	
		}

		var authenticationData = 
		{
			Username : 'username',
			Password : 'password',
       };

		poolData = {
				UserPoolId : _config.cognito.userPoolId, // Your user pool id here
				ClientId : _config.cognito.clientId // Your client id here
			};		
		var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
		var userData = {
        Username : 'username',
        Pool : userPool
    };
		var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
		var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

		var attributeList = [];

		var dataEmail = {
			Name : 'email', 
			Value : username, //get from form field
		};

		var dataPersonalName = {
			Name : 'name', 
			Value : personalname, //get from form field
		};

		var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
		var attributePersonalName = new AmazonCognitoIdentity.CognitoUserAttribute(dataPersonalName);


		attributeList.push(attributeEmail);
		attributeList.push(attributePersonalName);

		userPool.signUp(username, password, attributeList, null, function(err, result){
			if (err) {
				alert(err.message || JSON.stringify(err));
				return;
			}
			cognitoUser = result.user;
			console.log('user name is ' + cognitoUser.getUsername());
			//change elements of page
			document.getElementById(""titleheader"").innerHTML = ""Check your email for a verification link"";

		});

		cognitoUser.authenticateUser(authenticationDetails, {
        onSuccess: function (result) {

            var accessToken = result.getAccessToken().getJwtToken();
            console.log(accessToken+""accessToken"");
             var idToken = result.idToken.jwtToken;
        },

        onFailure: function(err) {
            alert(err);
        },

    });

	  }

	</script>

 </body>

</html>


Thanks In advance."
Ruby Development	"Resend Temporary Password from client-side
I working on a scenario when the user never got (or lost) the email with the temporary password. Now common sense will drive the user to the ""forgot password"" process. But here, he'll get an error saying ""User password cannot be reset in the current state."" What now? I'm trying to find a way to re-send the email with the temporary password FROM the client-side. 

I know there's the option of AdminCreateUser with ""MessageAction"": ""RESEND"" but that involves the back-end and I would prefer keeping this logic in a component in client-side (where the rest of the authentication logic already is). 

I've been trying with the method ""resendConfirmationCode"" of CognitoUser but I get a ""NotAuthorizedException"" error with the message ""Can't resend confirmation code for this user""

Every other post I've read regarding this very scenario ultimately proposes the AdminCreateUser option without even trying to explain why ""resendConfirmationCode"" doesn't work.  

Even if it can't be done, any help with this issue will be greatly appreciated.

Edited by: jrojas on Dec 6, 2018 11:32 AM"
Ruby Development	"Signiature Version 4 Test Suite Inconsistency
The AWS Signature Version 4 Test Suite from Amazon consists of 24 tests.  Each test consists of 5 files:
(1) Request (.req) , (2) Canonical Request (.creq), (3) String to Sign (.sts), (4) the correct Authorization header
(.authz) and, finally, (5) the Signed Request (.sreq)  showing the original request with the Authorization header in
context.

In 22 of the 24 tests, in accordance with the specification, the last line of the String to Sign file is the SHA-256 digest
of the Canonical Request file.  This is no surprise.  The spec says that the last line of the String to Sign is supposed to be a hash of the Canonical Request, and in the test suite, SHA-256 is the chosen hash in all cases.

In 2 of the tests, this is not the case.  Those two tests are (1) post-x-www-form-urlencoded-parameters; and (2) post-x-www-form-urlencoded.   

Why is this?  Is it an error in the test suite?  

This is not just nit-picking.  I happen to have a use-case which is similar to the two test suite examples.  My code works for ALL the test suite examples, except for the two cases which are similar to my actual use case, and I cannot get my code to work.   It is a common case.  So I would really appreciate an answer soon."
Ruby Development	"Lambda function : ""Unexpected token  < error""
I have written a lambda function javascript code for my alexa skill.But when I try compiling the code it shows error :
Response:
{
  ""errorMessage"": ""Unexpected token <""errorType"": ""SyntaxError"",
  ""stackTrace"": [
    ""                                                              ^"",
    """",
    ""SyntaxError: Unexpected token <"",
    ""createScript (vm.js:80:10)"",
    ""Object.runInThisContext (vm.js:139:10)"",
    ""Module._compile (module.js:616:28)"",
    ""Object.Module._extensions..js (module.js:663:10)"",
    ""Module.load (module.js:565:32)"",
    ""tryModuleLoad (module.js:505:12)"",
    ""Function.Module._load (module.js:497:3)"",
    ""Module.require (module.js:596:17)"",
    ""require (internal/module.js:11:18)""
  ]
}

I am hereby attaching my javascript code and screenshots of aws console.
Looking forward for help.
Thank you."
Ruby Development	"Re: Lambda function : ""Unexpected token  < error""
You dont need the <script> tag on the js file.
As it is already a js file, everything inside is seen as javascript, so the error is most probably the interpreter complaining that there is ""<"" which is not valid

hope this helps,
RT"
Ruby Development	"NodeJS Lambda functions and source code comments
Do commented lines within Lambda code cause any performance degradation? of any kind?

Edited by: leforge on Dec 5, 2018 8:40 AM"
Ruby Development	"Re: NodeJS Lambda functions and source code comments
No performance degradation as comment lines are ignored.
RT"
Ruby Development	"3rd Party cookies disabled (Brave Browser) preventing Cognito login
When using the Brave Browser with 3rd party cookies disabled, login on my site does not work when using Cognito. I am using the aws amplify cognito react library to connect.

I get a 307 internal redirect with the first OPTIONS request and it does not return any access control headers in the response. When cookies are allowed, I get the correct 200 response. 

Here's some sample javascript I run in console mimicking the request. It works only if third party cookies are allowed. 

await fetch(""https://cognito-idp.us-east-1.amazonaws.com/"", {""credentials"":""omit"",""referrer"":""https://+mysite.com+/login"",""referrerPolicy"":""no-referrer-when-downgrade"",""body"":null,""method"":""OPTIONS"",""mode"":""cors""});

Am I setting something up incorrectly?  Thanks for all the help!

Edited by: DSB on Dec 5, 2018 5:54 PM"
Ruby Development	"Socket.IO-Redis-Adapter With Elasticache Redis Fails WSS Upgrade Header
We have a websockets server and I'm currently working on migrating our services to Elastic Beanstalk. The servers were previously located on Heroku and were using a separate redis instance (also provided by Heroku) for maintaining websockets connections between multiple server instances.

I have created an elasticache redis instances on AWS which is able to connect successfully, however the websockets upgrade http request always returns a 400.

What's puzzling is that when I connect to the Heroku-generated redis, the request passes and a websockets connection is successfully established.

I've gone through security groups to enable all connections from everywhere on all ports and made sure ssl was properly configured to isolate the problem, but it still doesn't establish a successful connection.

I'm not sure if this is a limitation of elasticache now, so I'm hoping someone with more experience on AWS could shed some light on this."
Ruby Development	"AWS SDK SQS - Include custom header
I am using the AWS SDK SQS behind a router, to get through the router I need to include a custom header in the REQUEST.

I've seen this documentation (https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Request.html#build-event) that talks about the .on ('build') event in REQUEST, however, using the SQS service is not working, no error has been thrown and the custom header is not included in the REQUEST.

Is it possible include a custom header using AWS SDK with SQS service ?
How make to make this work?

Edited by: neias on Nov 29, 2018 3:17 AM (clarifications)"
Ruby Development	"Re: AWS SDK SQS - Include custom header
After help, I was able to send messages to the queue with a custom header, below the sample code:

var sqs = new aws.SQS({http_wire_trace: true});
 
var params = {
    MessageBody: 'Hello world!',
    QueueUrl: queueUrl,
    DelaySeconds: 0
};
 
var req = sqs.sendMessage(params);
 
req.on('build', () => {
    req.httpRequest.headers = 'bar';
});
 
req.on('success', (resp) => {
    console.log(resp.request.httpRequest.headers)
    });
 
req.send();"
Ruby Development	"AWS-SDK, getMetricWidgetImage is not returning singleValue Image
---–------------------------------------------------------------------------------------
EDIT (Answer)
Even though there seems to be a property for ""view"", the AWS support informed me, that this type is not supported in ""CloudWatch::prototype.getMetricWidgetImage"". It's simply ignoring it.

---–------------------------------------------------------------------------------------

Hello AWS-Support,

I am using the AWS-API via the AWS-SDK for NodeJS/JS and want to generate images from CloudWatch's ""CloudWatch::prototype.getMetricWidgetImage"" in order to display those images on a custom site.

With props like this, everything works fine: 
{ 
  ""metrics"": [
    [ ""LogMetrics"", ""errorOnAXH"", { ""period"": 60, ""label"": ""AXH Backend Prod Log Errors/min"", ""stat"": ""SampleCount"" } ]
  ],
  ""view"": ""timeSeries"",
  ""stacked"": false,
  ""region"": ""eu-central-1"",
  ""title"": ""Log Errors""
};


But if I want to change ""view"": ""timeSeries""
 to ""view"": ""singleValue""
 it doesn't work. I always get an timeSeries-Image back from the API.

Can you tell why this isn't working and probably fix that?

Thank you in advance,
Mark

Edited by: marklabenski on Nov 29, 2018 9:49 AM

Edited by: marklabenski on Nov 29, 2018 9:51 AM"
Ruby Development	"Re: AWS-SDK, getMetricWidgetImage is not returning singleValue Image
See edit note on top"
Ruby Development	"Lambda Nodejs
Hello, I had a recent problem with a nodejs lambda function and I can't seam to understand how aws is keeping the node env 
If i run the lambda function first time I will get the expected output
""A""
then if I run it multiple times, thins are starting to become strange:
""A"",""A"".......

So it seams that the log is not cleaned, the way to clean it is to ""save"" the file again.

Anybody can explin this to me? O point me to some documentation ?

Lets say that i had 2 files 
index.js
module.exports.handler  = (event, context, callback) => {
require('./log').add(""A"").show();
}
log.js 
module.exports = {
   list : [],
   add : function (v) {
     this.list.push(v);
     return this;
   },
   show : function() {
   console.log(this.list);
    return this;
   } 
}

Edited by: alin1918 on Oct 19, 2018 3:17 AM

Edited by: alin1918 on Oct 19, 2018 3:19 AM"
Ruby Development	"Re: Lambda Nodejs
Hello
When your lambda function gets called the first time, it is a cold start. Meaning AWS needs to allocate where will it run and separate the memory and all the background process needed to run it. Once you run it, AWS keeps your function online for a while before releasing the memory and everything else.
So in the case of your function, calling it multiple consecutive times just adds to the list Array and that's why you see the result as 

here is the actual documentation
https://docs.aws.amazon.com/lambda/latest/dg/running-lambda-code.html
here is an article on that
https://read.acloud.guru/how-long-does-aws-lambda-keep-your-idle-functions-around-before-a-cold-start-bf715d3b810
hope this helps,"
Ruby Development	"Lambda recurse
Hi
I'm to organize a lambda execution which exceeds lambda execution time restriction limit. So I have to  call for my lambda recursively if there's still job to work.

I found several examples in the internet similar to this https://hackernoon.com/write-recursive-aws-lambda-functions-the-right-way-4a4b5ae633b6. It mentions a call to some recurse function.

In practice such a call rises 
unhandled exception TypeError: recurse is not a function


I can not find any documentation on this function.

So should it be node environment or lambda context function?
Or should it be required from some preinstalled module?
Or is it just about a local own wrapper on regular lambda call over sdk?

What is the best practice on this?

Thx!"
Ruby Development	"Re: Lambda recurse
Hello
Recursion is a big issue because it consumes too much memory and runs for long time which in turn becomes a bottleneck and increased costs
Depending on what you are trying to do, you could put objects in SQS or S3 and then trigger a lambda call.  So each lambda call does only one thing, runs in parallel, and there is no recursion. 

hope this helps,
RT"
Ruby Development	"AWS SDK for JS in Browser with a CognitoUser instead of IAM credentials?
Greetings,

I have a browser app that interacts with S3. Since it was mostly an in-house tool, after handling authenticating to an API, it directly received the ID and secret for a very restricted IAM user which was then used to setup the AWS SDK in the browser.

I am now trying to change that app to use Cognito for authentication. I wound up using AWS Amplify just to handle the authentication part, and now I'm trying to figure out if there's a way of using the credentials I get from Cognito to setup the AWS JavaScript SDK and replicate the same functionality from that point on. (The way Amplify currently handles interaction with S3 does not cover all my needs)

Is there a way of doing this? Alternatively, if I can use only the JS SDK (no Amplify) to login a user via Cognito, that is also preferable to me.

Thank you."
Ruby Development	"Re: AWS SDK for JS in Browser with a CognitoUser instead of IAM credentials?
Hello
You will need to create the role,  cognito user pool and validate a user before using the code but take a look at this example

https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html

hope this helps
RT"
Ruby Development	"Instance Hacked - now what?
I have an instance running in a free tier in Ubuntu for the purpose of hosting a Discord Bot. Somehow, a malicious user was able to access my bot and send multiple ""messages"" as my bot in several channels on my discord server. By the time I noticed, the code running in my instance either crashed or the hacker stopped my bot code running Node.js under forever npm. To get the Bot up and running again, i had to re-invite my bot to my server and restart my node.js JavaScript application in Putty shell."
Ruby Development	"Re: Instance Hacked - now what?
so what's your question?"
Ruby Development	"Cloudwatch logs missing entries
Hi there,

This started to happen two days ago. I have an ECS task that runs in a Node container. I have a try..catch block that looks like this:

try {
...
} catch (err) {
  console.error('Error', err)
  reportFailure(task.taskToken, err.message)
}


reportFailure() function basically calls `sendTaskFailure` API on the step function client, so I can see the error message right in the Step function console. The problem that started to happen recently is this code no longer sends `err` to cloudwatch logs. If I can see the err.message in step functions, surely the line `console.error('Error', err)` would have been executed, therefore logged in the corresponding cloudwatch log stream.

Can anyone advise what might have gone wrong here? I am a bit lost."
Ruby Development	"AWSJavaScriptSDK Cloudsearch CORS Issue
CORS support is not present in cloudsearch. Code snippet and output are given below.

Code snippet (aws javascript sdk):-
  cloudsearch_test() {
    var cloudsearch = new CloudSearch({apiVersion: '2013-01-01'});
    var params = {
      DomainNames: [
        'cs_domain'
      ]
    };
    cloudsearch.describeDomains(params, function(err, data) {
      if (err) console.log(err, err.stack); // an error occurred
      else     console.log(data);           // successful response
    });
  }

Browser Console output:-
cloudsearch.us-west-2.amazonaws.com/:1 Failed to load resource: the server responded with a status of 404 (Not Found)
localhost/:1 Access to XMLHttpRequest at 'https://cloudsearch.us-west-2.amazonaws.com/' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: It does not have HTTP ok status.

Tried adding cors packages in angular project. But It didn't work. 

Packages available:-
•	https://www.npmjs.com/package/cors
•	https://www.npmjs.com/package/cors-anywhere

Tried following ways suggested to add CORS but found no luck.
1.	https://geekbites.move4mobile.io/2016/08/18/nodejs-proxy-cors/
2.	https://medium.freecodecamp.org/the-best-ways-to-connect-to-the-server-using-angular-cli-b0c6b699716c

Errors:-
1.	AppComponent.html:2 ERROR ReferenceError: __dirname is not defined
  at getHandler (cors-anywhere.js:253)
2.	AppComponent.html:2 ERROR TypeError: Cannot read property 'DEBUG_MIME' of undefined        at Mime.push../node_modules/send/node_modules/mime/mime.js.Mime.define (mime.js:25)

Could you please help.
Regards,
Milan

Edited by: AppSolZone on Nov 15, 2018 6:00 AM

Edited by: AppSolZone on Nov 15, 2018 6:00 AM"
Ruby Development	"Re: AWSJavaScriptSDK Cloudsearch CORS Issue
Hi,

Unfortunately CloudSearch does not support CORS at this time. In order to get around this issue you can wrap around it with API Gateway which has support for CORS.
I hope this is helpful for you!

Best regards
Emanuel"
Ruby Development	"Re: AWSJavaScriptSDK Cloudsearch CORS Issue
The issue is resolved now by adding cors-anywhere.
https://github.com/Rob--W/cors-anywhere#client"
Ruby Development	"Node.js + Amazon Linix + Single Instance + Nginx HTTPS failure
Problem and Errors
I'm trying to configure HTTPS for my Single Instance Elastic Beanstalk Node.js server using LetsEncrypt certificates.  I've set it up according to https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/https-singleinstance-nodejs.html with some slight tweeks.  The HTTP -> HTTPS redirect is working, but I get a '<URL> unexpectedly closed the connection' and ERR_CONNECTION_CLOSED page when visiting the site in Chrome.  When I try to curl in from the Windows Command Prompt, I get 'curl: (35) schannel: failed to receive handshake, SSL/TLS connection failed'.

Nginx Configuration
See contents of .ebextensions/https-instance.config below (minus the indentation...).  The only difference between this and the Amazon recommended config file is that I'm pulling the Cert/Key directly from the /etc/letsencrypt directory rather than having this file generate them for me.  After looking at a bunch of forums, this doesn't seem like it should cause issues.  I've obviously confirmed that that the LetsEncrypt generation was successful and that the files are actually there.  I should also note that my DNS is Namecheap, and I have 3 A records pointing to the instance (root, www, and wildcard).

files:
  /etc/nginx/conf.d/https.conf:
    mode: ""000644""
    owner: root
    group: root
    content: |
      # HTTPS server

      server {
          listen       443;
          server_name  localhost;

          ssl                  on;
          ssl_certificate      /etc/letsencrypt/live/safebetsoftwarellc.net/fullchain.pem;
          ssl_certificate_key  /etc/letsencrypt/live/safebetsoftwarellc.net/privkey.pem;

          ssl_session_timeout  5m;

          ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;
          ssl_prefer_server_ciphers   on;

          # For enhanced health reporting support, uncomment this block:

          #if ($time_iso8601 ~ ""^(\d{4})-(\d{2})-(\d{2})T(\d{2})"") {
          #    set $year $1;
          #    set $month $2;
          #    set $day $3;
          #    set $hour $4;
          #}
          #access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;
          #access_log  /var/log/nginx/access.log  main;

          location / {
              proxy_pass  http://nodejs;
              proxy_set_header   Connection """";
              proxy_http_version 1.1;
              proxy_set_header        Host            $host;
              proxy_set_header        X-Real-IP       $remote_addr;
              proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header        X-Forwarded-Proto https;
          }
      }

Nginx Logs
I'm logging at the debug level, but don't see much relevant information the error or access logs.  I'm also no server admin, so I might be missing something simple  They're attached though, and the relevant portions are at the bottom of the files (connection attempts made on 11/6 around 10:45 Pacific Time).  Thanks for your help!

Edited by: Gkleinereva on Nov 6, 2018 11:47 AM"
Ruby Development	"Re: Node.js + Amazon Linix + Single Instance + Nginx HTTPS failure
I realized that I still had an erroneous entry in iptables redirecting traffic from port 443 to port 8081.  Thus, I don't think the traffic was being routed according to my nginx configuration files.  I terminated and re-created the environment and everything is working correctly.

In case it helps anyone, I checked my iptables configuration in putty with the command below

sudo iptables -t nat -L

And attached is a screenshot the iptables configuration that is now working (which was also the default for a new AWS Linux environment)."
Ruby Development	"AWS Pinpoint : Active targetable endpoints is Nul
Hello

I integrated AWS Amplify into my project react native. I use facebook Account Kit for connecting users. I'm having problems with aws pinpoint.

    The analytics module works very well
    the push notification module does not work very well:
    the golds of tests to know to send a push notification according to the token FCM, I receive very well the message push notification.
    In the dashboard impossible, you can not create segments or campaigns because ""Active targetable endpoints is 0"". What should I do please? I need your help .

Sincerely

aws-amplify: 1.1.7
aws-amplify-react-native: 2.0.7
@ aws-amplify / pushnotification: 1.0.16

Edited by: foongon on Oct 21, 2018 4:33 PM"
